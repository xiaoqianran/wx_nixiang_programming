var e=require("../../common/vendor.js"),a=require("../../config/config.js"),t={data:function(){return{userAccount:"",userPassword:"",showPassword:!1,isRememberMe:!0,passwordflag:!0,state:!1,avatarUrl:getApp().globalData.avatarUrl,canSeePassword:"/static/me/cannotSeePassword.jpg",cannotSeePassword:"/static/me/canSeePassword.jpg",campusList:[{name:"佛山校区",value:0},{name:"广州校区",value:1}],current:0}},onLoad:function(){var a=e.index.getStorageSync("remember-me");a&&(this.userAccount=a.account,this.userPassword=a.password,this.current=parseInt(a.current))},methods:{goLoggedIn:function(){if(""==this.userAccount||""==this.userPassword)e.index.showToast({title:"请检查学号或密码是否为空!",icon:"none",duration:2e3});else if(this.state){getApp().globalData.account=this.userAccount,getApp().globalData.password=this.userPassword,e.index.showLoading({title:"登录中...",mask:!0});var t=this;e.index.request({url:a.config.loginUrl,method:"POST",data:{account:this.userAccount,password:this.userPassword,openid:this.userAccount+"openid"},success:function(n){if(0==n.data.code){var o=n.data.data;getApp().globalData.account=t.userAccount,getApp().globalData.password=t.userPassword,getApp().globalData.className=o.className,getApp().globalData.college=o.college,getApp().globalData.enrollmentYear=o.enrollmentYear,getApp().globalData.gender=o.gender,getApp().globalData.major=o.major,getApp().globalData.name=o.name,getApp().globalData.token=o.token,getApp().globalData.isLogin=!0,getApp().globalData.xq=t.campusList[t.current],e.index.setStorage({key:"login",data:{account:t.userAccount,password:t.userPassword,result:n.data,xq:getApp().globalData.xq,token:getApp().globalData.token,version:a.config.version},success:function(){}}),t.isRememberMe&&e.index.setStorage({key:"remember-me",data:{account:t.userAccount,password:t.userPassword,current:t.current},success:function(){}}),e.index.hideLoading(),e.index.showLoading({title:"获取课表中...",mask:"true"}),e.index.request({url:a.config.schduleUrl,method:"GET",dataType:"json",header:{token:getApp().globalData.token},data:{account:getApp().globalData.account,term:getApp().globalData.term},success:function(a){return"C0105"==a.data.code?(e.index.hideLoading(),e.index.showToast({title:"绑定成功！",icon:"success",success:function(){e.index.hideLoading(),e.index.reLaunch({url:"/pages/tabbar/plan/plan"})}}),!0):"0"!=a.data.code?(e.index.hideLoading(),e.index.showToast({title:a.data.message,icon:"error"}),!1):(getApp().globalData.term,getApp().globalData.schedule=a.data.data,e.index.hideLoading(),e.index.setStorage({key:"schedule"+getApp().globalData.account+getApp().globalData.term,data:{account:getApp().globalData.account,schedule:JSON.parse(a.data.data),term:getApp().globalData.term,date:(new Date).getTime()},success:function(e){}}),void e.index.showToast({title:"绑定成功！",icon:"success",success:function(){e.index.hideLoading(),e.index.reLaunch({url:"/pages/tabbar/plan/plan"})}}))},fail:function(a){e.index.hideLoading(),e.index.showToast({title:"获取失败！",icon:"error",success:function(){e.index.hideLoading()}})}})}else e.index.hideLoading(),200==n.statusCode?e.index.showToast({title:n.data.message,icon:"error"}):e.index.showToast({title:"错误码:"+n.statusCode,icon:"error"})},fail:function(a){e.index.hideLoading(),e.index.showToast({title:"请检查网络连接",icon:"error"})}})}else e.index.showToast({title:"请先阅读并同意《隐私条款》!",icon:"none",duration:2e3})},changeText:function(){this.showPassword=!this.showPassword,this.passwordflag=!this.passwordflag},checkboxChange:function(e){this.state=!this.state},isRememberMeChange:function(e){this.isRememberMe=!this.isRememberMe},goPrivacy:function(a){1==a?e.index.navigateTo({url:"/pages/userAgreement/userAgreement"}):2==a&&e.index.navigateTo({url:"/pages/userAgreement/privacPpolicy/privacPpolicy"})},changeAccountName:function(e){this.accountName=e},changeAccountCollege:function(e){this.accountCollege=e},radioChange:function(e){this.current=e.detail.value},forget:function(){e.index.showModal({title:"忘记密码",content:"请自行到融合门户重置密码\r\n（http://imy.gdufe.edu.cn/）\r\n无需校园网或VPN",confirmText:"复制链接",success:function(a){a.confirm&&e.index.setClipboardData({data:"http://imy.gdufe.edu.cn/",success:function(){e.index.showToast({title:"复制成功",icon:"success"})}})}})}}};Array||e.resolveComponent("uni-icons")(),Math;var n=e._export_sfc(t,[["render",function(a,t,n,o,s,r){return{a:e.f(a.campusList,(function(t,n,o){return{a:t.value,b:n===a.current,c:e.t(t.name),d:t.value}})),b:e.o((function(){return a.radioChange&&a.radioChange.apply(a,arguments)})),c:a.userAccount,d:e.o((function(e){return a.userAccount=e.detail.value})),e:a.passwordflag,f:a.userPassword,g:e.o((function(e){return a.userPassword=e.detail.value})),h:e.o((function(e){return a.changeText()})),i:e.p({type:a.passwordflag?"eye":"eye-filled",size:"24"}),j:a.isRememberMe,k:e.o((function(){return a.isRememberMeChange&&a.isRememberMeChange.apply(a,arguments)})),l:a.state,m:e.o((function(){return a.checkboxChange&&a.checkboxChange.apply(a,arguments)})),n:e.o((function(e){return a.goPrivacy(1)})),o:e.o((function(e){return a.goPrivacy(2)})),p:e.o((function(e){return a.goLoggedIn()})),q:e.o((function(){return a.forget&&a.forget.apply(a,arguments)}))}}]]);wx.createPage(n);