require("../../@babel/runtime/helpers/Objectvalues");var e=require("../../common/vendor.js"),t=require("../../config/config.js"),o={components:{weekTime:function(){return"../../components/weeksCalendar/weekTime.js"}},data:function(){return{account:this.account,curMonth:0,startDate:getApp().globalData.startDate,xq:getApp().globalData.xq,startX:0,startY:0,moveX:0,moveY:0,like_state:0,memberData:"未修改",testMode:getApp().globalData.testMode,term:getApp().globalData.term,schedule:getApp().globalData.schedule,getAllTermSchedule:getApp().globalData.getAllTermSchedule,nowWeek:getApp().globalData.nowWeek,weekday:getApp().getweekday(getApp().getDate(1),1),weekdayNum:getApp().getweekday(getApp().getDate(1),2),date:getApp().getDate(),hasStroage:!1,color:"#ccc",temOpacity:!1,getClassroom:"",getName:"",getTeacher:"",getWeeks:"",getCode:"",getTime:"",termTip:"暂无",termTipTeacher:"暂无",allWeek:["请选择周数","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],getChooseWeek:getApp().globalData.nowWeek,allTerm:t.config.allTerm,index:0,borderColorList:["#cbc4ea","#d6dff6","#b7e4d7","#f3ebbe","#f1ccd4","#c9c3e9","#b9e2ba","#f7dcc4","#ffa6ad","#8ac0e6","#73dea4","#ebbb98","#cbc4ea","#d6dff6","#b7e4d7","#f3ebbe","#f1ccd4","#c9c3e9","#b9e2ba","#f7dcc4","#ffa6ad","#8ac0e6","#73dea4"],backgroundColorList:["#e8e4fe","#e5f3fe","#ecfeff","#fef7db","#feeeef","#e4e7fa","#f0ffec","#ffe9dc","#ffdee0","#e3f3ff","#d1ffe6","#ffdcc2","#e8e4fe","#e5f3fe","#ecfeff","#fef7db","#feeeef","#e4e7fa","#f0ffec","#ffe9dc","#ffdee0","#e3f3ff","#d1ffe6"],colorList:["#a273df","#569ce1","#54cabc","#eba93c","#f582a3","#7370b3","#76c473","#f69a7f","#ff5c68","#85a3e4","#65c28f","#e68a47","#a273df","#569ce1","#54cabc","#eba93c","#f582a3","#7370b3","#76c473","#f69a7f","#ff5c68","#85a3e4","#65c28f"],LessonDetaiInfo:[],LessonDetaiIndex:0}},onShow:function(){this.refreshSchedule()},onLoad:function(){this.nowWeek=getApp().globalData.nowWeek,this.initSchedule();for(var e=this.allTerm.length,t=0;t<e;t++)this.allTerm[t]==getApp().globalData.term&&(this.index=t);this.getClassTip(Object.values(this.schedule[21]))},methods:{initSchedule:function(){var t=e.index.getStorageSync("config");t&&(getApp().globalData.term=t.nowTerm,this.term=t.nowTerm,this.startDate=t.startDate),getApp().updateConfig();var o=e.index.getStorageSync("login");this.account=o.account;var a=this.term,n=this;e.index.getStorage({key:"schedule"+this.account+a,success:function(e){n.isSameWeek(e.data.date,(new Date).getTime())?(n.schedule=e.data.schedule,n.nowWeek=getApp().getNowWeek(getApp().globalData.startDate).week,a!=n.term||n.nowWeek<1?n.nowWeek=1:n.nowWeek>=20&&n.nowWeek<=22&&(n.nowWeek=20)):n.getScheduleFromService(a)},fail:function(e){n.getScheduleFromService(a)}})},getPitch:function(e){return e<7?"1-2":e<14?"3-4":e<21?"5-6":e<28?"7-8":e<35?"9-10":e<42?"11-12":void 0},getNowWeek:function(e){return getApp().getNowWeek(e)},changeweekdayNum:function(e){this.weekdayNum=e},changeTestMode:function(){getApp().globalData.testMode=!getApp().globalData.testMode,this.testMode=getApp().globalData.testMode},refreshSchedule:function(){this.schedule=getApp().globalData.schedule},nameIsEmpty:function(e){return null==e.name?"":e.name},changeNull:function(e){return null==e&&(e=""),e},changeOpacity:function(e,t){""==e.classroom?this.temOpacity=!1:(this.temOpacity=!0,this.LessonDetaiInfo=e,this.LessonDetaiIndex=e.code)},chooseWeek:function(e){var t=this.nowWeek-parseInt(e.target.value);if(t<0)for(var o=0;o<Math.abs(t);o++)this.$children[0].nextWeek();else if(t>0)for(o=0;o<Math.abs(t);o++)this.$children[0].prevWeek();parseInt(e.target.value)>0&&(this.nowWeek=parseInt(e.target.value))},chooseTerm:function(t,o){var a=this;e.index.showLoading({title:"获取中"}),this.index=t.target.value;var n=o[this.index];this.term=n;var i=this;e.index.getStorage({key:"schedule"+this.account+n,success:function(t){i.schedule=t.data.schedule,n!=getApp().globalData.nowTerm?a.nowWeek=1:a.nowWeek=getApp().globalData.nowTerm,a.isSameWeek(t.data.date,(new Date).getTime())||i.getScheduleFromService(n),e.index.hideLoading()},fail:function(e){i.getScheduleFromService(n)}})},getScheduleFromService:function(o){var a=this;if(0!=getApp().isLogin&&""!=this.account&&null!=this.account){var n=this;e.index.request({url:t.config.schduleUrl,method:"GET",dataType:"json",header:{token:getApp().globalData.token},data:{account:this.account,term:o},success:function(t){if(0!=t.data.code)return e.index.hideLoading(),e.index.showToast({title:t.data.message,icon:"error"}),!1;n.schedule=JSON.parse(t.data.data),"{}"==t.data.data?e.index.showToast({title:"课表为空噢~",icon:"error"}):(o!=getApp().globalData.term?n.nowWeek=1:n.nowWeek=getApp().globalData.nowWeek,e.index.hideLoading(),e.index.setStorage({key:"schedule"+a.account+o,data:{account:a.account,schedule:JSON.parse(t.data.data),term:o,date:(new Date).getTime()},success:function(e){}}))},fail:function(t){e.index.hideLoading(),e.index.showToast({title:"获取失败！",icon:"error",success:function(){e.index.hideLoading()}})}})}},isSameWeek:function(e,t){var o=new Date;o.setTime(e);var a=new Date;return a.setTime(t),this.tmonday(o)===this.tmonday(a)},tmonday:function(e){var t=new Date(e),o=t.getDay(),a=t.getDate();return 0===o&&(o=7),t.setDate(a-o+1),t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()},backToThisWeek:function(t){this.initSchedule();var o=new Date,a=new Date(this.startDate);o>=a?(this.$children[0].init(new Date),this.nowWeek=getApp().globalData.nowWeek):(this.$children[0].init(a),this.nowWeek=1),this.term!=getApp().globalData.term&&e.index.showToast({title:"已切换回本学期",icon:"none"})},changeBorderColor:function(e){return e?this.borderColorList[e-1]:null!==e?this.borderColorList[0]:void 0},changeBackgroundColor:function(e){return e?this.backgroundColorList[e-1]:null!==e?this.backgroundColorList[0]:void 0},changeColor:function(e){return e?this.colorList[e-1]:null!==e?this.colorList[0]:void 0},changeDetailBorderColor:function(){return this.LessonDetaiIndex?this.borderColorList[this.LessonDetaiIndex-1]:null!==this.LessonDetaiIndex?this.borderColorList[0]:void 0},changeDetailBackgroundColor:function(){return this.LessonDetaiIndex?this.backgroundColorList[this.LessonDetaiIndex-1]:null!==this.LessonDetaiIndex?this.backgroundColorList[0]:void 0},changeDetailColor:function(){return this.LessonDetaiIndex?this.colorList[this.LessonDetaiIndex-1]:null!==this.LessonDetaiIndex?this.colorList[0]:void 0},isShowBackBtn:function(){return this.nowWeek!=this.getChooseWeek||this.term!=getApp().globalData.term},touchStart:function(e){this.startX=e.touches[0].pageX,this.startY=e.touches[0].pageY},touchMove:function(e){var t=e.touches[0].pageX,o=e.touches[0].pageY,a=t-this.startX,n=o-this.startY,i=0;Math.abs(a)>Math.abs(n)&&(a<-10?i=1:a>10&&(i=-1)),this.like_state=i,this.moveX=a,this.moveY=n},touchEnd:function(t){Math.abs(this.moveX)>60&&-100!=this.like_state&&(this.like_state,1==this.like_state?this.nowWeek>=20?e.index.showToast({title:"已是最后一周啦~"}):(this.nowWeek+=1,this.$children[0].nextWeek()):-1==this.like_state&&(this.nowWeek<=1?e.index.showToast({title:"已是第一周啦~",icon:"none"}):(this.nowWeek-=1,this.$children[0].prevWeek())),this.like_state=-100)},detailBtnClick:function(){this.temOpacity=!this.temOpacity},getClassTip:function(e){e.length>0?(this.termTip=e[0].name,this.termTipTeacher=e[0].teacher):(this.termTip="暂无",this.termTipTeacher="暂无")},conflictLesson:function(e){return!(e.length>1)},showBorder:function(e){if(e%2==0)return"timetable-getConflictClass"},changePostionOfHalfLesson:function(e){return e&&2==e.length&&Number(e.replace("0",""))%2==0?"flex-end":"flex-start"}}};Array||e.resolveComponent("week-time")();var a=e._export_sfc(o,[["render",function(t,o,a,n,i,s){return e.e({a:e.t(t.term),b:e.o((function(e){return t.chooseTerm(e,t.allTerm)})),c:t.allTerm,d:t.index,e:e.t(t.nowWeek),f:e.o((function(){return t.chooseWeek&&t.chooseWeek.apply(t,arguments)})),g:t.allWeek,h:t.getChooseWeek,i:e.o((function(){return t.backToThisWeek&&t.backToThisWeek.apply(t,arguments)})),j:e.o(t.changeBack),k:"佛山校区"==t.xq.name},(t.xq.name,{}),{l:e.f(t.schedule[t.nowWeek],(function(o,a,n){return e.e({a:t.conflictLesson(o)},t.conflictLesson(o)?{b:e.t(o.name),c:e.t(o.classroom)}:{d:e.f(o,(function(o,a,n){return{a:e.t(o.name),b:e.t(o.classroom),c:a,d:e.n(t.showBorder(a))}}))},{e:t.changeBorderColor(o.code),f:t.changeBackgroundColor(o.code),g:t.changeColor(o.code),h:0==o.flag?"7vh":"13.6vh",i:o.name?"1px":"",j:o.name?"solid":"",k:a,l:e.o((function(e){return t.changeOpacity(o,a)}),a),m:t.changePostionOfHalfLesson(o.time)})})),m:!t.conflictLesson(t.LessonDetaiInfo)},t.conflictLesson(t.LessonDetaiInfo)?{o:e.t(t.LessonDetaiInfo.name),p:e.t(t.LessonDetaiInfo.teacher),q:e.t(t.LessonDetaiInfo.classroom),r:e.t(t.LessonDetaiInfo.time),s:e.t(t.LessonDetaiInfo.weeks)}:{n:e.f(t.LessonDetaiInfo,(function(o,a,n){return{a:e.t(o.name),b:e.t(o.teacher),c:e.t(o.classroom),d:e.t(o.time),e:e.t(o.weeks),f:a,g:e.n(t.showBorder(a))}}))},{t:t.changeDetailColor(),v:e.o((function(e){return t.detailBtnClick()})),w:t.changeDetailBorderColor(),x:t.changeDetailBackgroundColor(),y:t.changeDetailColor(),z:t.temOpacity,A:e.o((function(){return t.touchStart&&t.touchStart.apply(t,arguments)})),B:e.o((function(){return t.touchMove&&t.touchMove.apply(t,arguments)})),C:e.o((function(){return t.touchEnd&&t.touchEnd.apply(t,arguments)})),D:e.t(t.termTip),E:e.t(t.termTipTeacher)})}]]);wx.createPage(a);