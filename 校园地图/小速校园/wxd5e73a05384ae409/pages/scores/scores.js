var e=require("../../common/vendor.js"),t=require("../../config/config.js"),r=require("../../config/tips.js"),a={data:function(){return{refreshTime:0,showEmpty:!0,kevyType:"loading",kevyText:"加载中...",term:"",avgGPA:0,allTermGPA:0,allCredit:0,allTermCredit:0,credits:[{zxxf:0,mxxf:0,yxxf:0,hxxf:0,zxjd:0,fxjd:0}],rank:{total:0,rank:0},scores:[],borderColorList:["#cbc4ea","#d6dff6","#b7e4d7","#f3ebbe","#f1ccd4","#c9c3e9","#b9e2ba","#f7dcc4","#ffa6ad","#8ac0e6","#73dea4","#ebbb98","#cbc4ea","#d6dff6","#b7e4d7","#f3ebbe","#f1ccd4","#c9c3e9","#b9e2ba","#f7dcc4","#ffa6ad","#8ac0e6","#73dea4"],backgroundColorList:["#e8e4fe","#e5f3fe","#ecfeff","#fef7db","#feeeef","#e4e7fa","#f0ffec","#ffe9dc","#ffdee0","#e3f3ff","#d1ffe6","#ffdcc2","#e8e4fe","#e5f3fe","#ecfeff","#fef7db","#feeeef","#e4e7fa","#f0ffec","#ffe9dc","#ffdee0","#e3f3ff","#d1ffe6"],colorList:["#a273df","#569ce1","#54cabc","#eba93c","#f582a3","#7370b3","#76c473","#f69a7f","#ff5c68","#85a3e4","#65c28f","#e68a47","#a273df","#569ce1","#54cabc","#eba93c","#f582a3","#7370b3","#76c473","#f69a7f","#ff5c68","#85a3e4","#65c28f"]}},onLoad:function(){this.chooseTerm(),this.getScorcesByStorage()},methods:{getScorces:function(){var a=this,s=this;e.index.request({url:t.config.scoresUrl,method:"GET",data:{account:getApp().globalData.account},header:{token:getApp().globalData.token},success:function(t){"0"==t.data.code?null==t.data.data?(e.index.showToast({title:"还没有成绩噢",icon:"error",duration:2e3}),a.kevyType="data",a.kevyText="还没有成绩噢"):(s.setScoreInfo(JSON.parse(t.data.data)),a.showEmpty=!1):0==a.showEmpty?e.index.showToast({title:"更新失败，当前是上次查询结果",icon:"none"}):(e.index.showToast({title:"查询失败，请稍后重试",icon:"none"}),a.kevyType="error",a.kevyText=r.tips.error,a.showEmpty=!0)},fail:function(t){0==a.showEmpty?e.index.showToast({title:"更新失败，当前是上次查询结果",icon:"none"}):(e.index.showToast({title:"查询失败，请稍后重试",icon:"none"}),a.kevyType="error",a.kevyText=r.tips.error,a.showEmpty=!0)}})},countDown:function(){0==this.refreshTime--&&(this.refreshTime=0,clearInterval(this.timer))},getScorcesSync:function(){var r=this;this.refreshTime=60,setInterval(this.countDown,1e3),e.index.showLoading({title:"更新中..."}),e.index.request({url:t.config.scoresSyncUrl,method:"GET",data:{account:getApp().globalData.account},header:{token:getApp().globalData.token},success:function(t){e.index.hideLoading(),"0"==t.data.code?null==t.data.data?e.index.showToast({title:"还没有成绩噢",icon:"error",duration:2e3}):(e.index.showToast({title:"更新成功",icon:"success"}),r.setScoreInfo(JSON.parse(t.data.data))):e.index.showToast({title:"更新失败，当前是上次查询结果",icon:"none"})},fail:function(t){e.index.hideLoading(),e.index.showToast({title:"更新失败",icon:"none"})}})},setScoreInfo:function(t){this.rank=t[1],this.credits=t[0];var r=0,a=0,s={};for(var n in t.forEach((function(e,t){if(!(t<2)){var r=e.lessonTerm;s[r]||(s[r]={term:r,scores:[],sumCredits:0,totalGpaCredits:0,avgGpa:0}),s[r].scores.push(e),s[r].sumCredits+=e.credit,s[r].totalGpaCredits+=e.gpa*e.credit,a+=e.gpa*e.credit}})),s){var o=s[n];o.avgGpa=o.sumCredits>0?(o.totalGpaCredits/o.sumCredits).toFixed(2):0,s[n].sumCredits=s[n].sumCredits.toFixed(1),r+=parseFloat(o.sumCredits)}a/=r,this.allTermCredit=r,this.allTermGPA=a.toFixed(2),this.scores=s,e.index.setStorage({key:"scores",data:{scores:s,rank:t[1],credits:t[0],allTermCredit:r,allTermGPA:a.toFixed(2)}})},getScorcesByStorage:function(){var t=this;e.index.getStorage({key:"scores",success:function(e){t.scores=e.data.scores,t.rank=e.data.rank,t.credits=e.data.credits,t.getScorces(),t.showEmpty=!1,t.allTermCredit=e.data.allTermCredit,t.allTermGPA=e.data.allTermGPA},fail:function(e){t.getScorces()}})},getGPA:function(e){switch("优"==e?e="95":"良"==e?e="85":"中"==e||"中等"==e?e="75":"及格"==e||"合格"==e?e="65":"不及格"!=e&&"不合格"!=e||(e="55"),e=Number(e)){case 100:return 5;case 99:return 4.9;case 98:return 4.8;case 97:return 4.7;case 96:return 4.6;case 95:return 4.5;case 94:return 4.4;case 93:return 4.3;case 92:return 4.2;case 91:return 4.1;case 90:return 4;case 89:return 3.9;case 88:return 3.8;case 87:return 3.7;case 86:return 3.6;case 85:return 3.5;case 84:return 3.4;case 83:return 3.3;case 82:return 3.2;case 81:return 3.1;case 80:return 3;case 79:return 2.9;case 78:return 2.8;case 77:return 2.7;case 76:return 2.6;case 75:return 2.5;case 74:return 2.4;case 73:return 2.3;case 72:return 2.2;case 71:return 2.1;case 70:return 2;case 69:return 1.9;case 68:return 1.8;case 67:return 1.7;case 66:return 1.6;case 65:return 1.5;case 64:return 1.4;case 63:return 1.3;case 62:return 1.2;case 61:return 1.1;case 60:return 1;default:return 0}},getColor:function(e){if("优"!=e&&"良"!=e&&"中"!=e&&"及格"!=e&&"不及格"!=e)return e>=80?"#2ec4b6":e>=60?"#3d3d3d":e>=0?"#aa0000":"black";switch(e){case"优":case"良":return"#2ec4b6";case"中":case"及格":return"#3d3d3d";case"不及格":return"#aa0000";default:return"black"}},getRankColor:function(e,t){return e<=.15*t?"#30c4b7":e<=.5*t?"#0047d5":e<=.8*t?"#ffaa00":e<=1*t?"#aa0000":"black"},getGPAColor:function(e){return e>=3?"#fff":e>=2?"#ffaa00":"#aa0000"},getBgc:function(e){switch(e){case"学科基础课":return this.backgroundColorList[0];case"通识课":return this.backgroundColorList[1];case"专业课":return this.backgroundColorList[2];default:return this.backgroundColorList[3]}},getTypeColor:function(e){switch(e){case"学科基础课":return this.colorList[0];case"通识课":return this.colorList[1];case"专业课":return this.colorList[2];default:return this.colorList[3]}},chooseTerm:function(){var e=getApp().globalData.account,t=parseInt(e.substring(0,2));this.freshman1="20"+t+"-20"+(t+1)+"-1",this.freshman2="20"+t+"-20"+(t+1)+"-2",this.sophomore1="20"+(t+1)+"-20"+(t+2)+"-1",this.sophomore2="20"+(t+1)+"-20"+(t+2)+"-2",this.juniors1="20"+(t+2)+"-20"+(t+3)+"-1",this.juniors2="20"+(t+2)+"-20"+(t+3)+"-2",this.graduates1="20"+(t+3)+"-20"+(t+4)+"-1",this.graduates2="20"+(t+3)+"-20"+(t+4)+"-2"}}};Array||(e.resolveComponent("uni-collapse-item")+e.resolveComponent("uni-collapse")+e.resolveComponent("kevy-empty")+e.resolveComponent("uni-card"))(),Math||(function(){return"../../uni_modules/uni-collapse/components/uni-collapse-item/uni-collapse-item.js"}+function(){return"../../uni_modules/uni-collapse/components/uni-collapse/uni-collapse.js"}+function(){return"../../uni_modules/kevy-empty/components/kevy-empty/kevy-empty.js"}+function(){return"../../uni_modules/uni-card/components/uni-card/uni-card.js"})();var s=e._export_sfc(a,[["render",function(t,r,a,s,n,o){return e.e({a:e.t(t.credits.totalGpa),b:e.t(t.rank.rank),c:e.t(t.rank.total),d:t.getRankColor(t.rank.rank,t.rank.total),e:e.f(t.scores,(function(r,a,s){return{a:e.t(r.avgGpa),b:e.t(r.sumCredits),c:e.t(r.term),d:e.f(r.scores,(function(r,a,s){return e.e({a:e.t(r.lessonType),b:t.getBgc(r.lessonType),c:t.getTypeColor(r.lessonType),d:e.t(r.lessonName),e:e.t(r.overallGrade),f:t.getColor(r.overallGrade),g:e.t(r.credit),h:e.t(r.gpa),i:"无"!=r.experimentalGrade},"无"!=r.experimentalGrade?{j:e.t(r.usualGrade),k:e.t(r.experimentalGrade),l:e.t(r.finalGrade)}:{m:e.t(r.usualGrade),n:e.t(r.finalGrade)},{o:a})})),e:a,f:"6f3929e3-1-"+s+",6f3929e3-0"}})),f:!t.showEmpty,g:t.showEmpty,h:e.p({type:t.kevyType,text:t.kevyText,show:t.showEmpty}),i:e.t(t.allTermCredit),j:e.t(t.allTermGPA),k:0==t.refreshTime},0==t.refreshTime?{l:e.o((function(){return t.getScorcesSync&&t.getScorcesSync.apply(t,arguments)}))}:{m:e.t(t.refreshTime)},{n:e.p({title:"绩点计算方法",thumbnail:"",extra:"小速贴士",note:"Tips"})})}]]);wx.createPage(s);