var e=wx.cloud.database();Page({xinxi:{q:[],fenlei:"",name:"",age:"",detail:"",number:"",id:"",address:"",img:[],xuanze:""},data:{img:[]},submit:function(a){console.log(a),""!==this.data.img&&""!==a.detail.value.name&&""!==a.detail.value.number&&""!==a.detail.value.age&&""!==a.detail.value.xuehao&&""!==a.detail.value.address?e.collection("zhu_ce").add({data:{name:a.detail.value.name,age:a.detail.value.age,xuehao:a.detail.value.xuehao,number:a.detail.value.number,address:a.detail.value.address,fenlei:a.detail.value.fenlei,src:this.data.img},success:function(e){wx.switchTab({url:"../my/my"}),wx.showToast({title:"提交成功"})}}):wx.showToast({title:"你还有未填信息",icon:"none"})},onLoad:function(a){var t=this;t.setData({id:a.id}),console.log("e",t.data.id),e.collection("zhu_ce").get({success:function(e){console.log("注册信息获取",e),t.setData({q:e})},fail:function(e){console.log("注册信息失败",e)}})},upload_img:function(){var e=this;wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(a){var t=Date.parse(new Date);t/=1e3,console.log("当前时间戳为："+t);var o=a.tempFilePaths;console.log(o),wx.cloud.uploadFile({cloudPath:"product/"+t+".png",filePath:o[0],success:function(a){console.log(a.fileID),e.setData({img:e.data.img.concat(a.fileID)})},fail:function(e){}})}})},delete:function(e){console.log(this.data.img),console.log(e.currentTarget.dataset.id);var a=e.currentTarget.dataset.id,t=this.data.img;t.splice(a,1),this.setData({img:t}),wx.cloud.deleteFile({fileList:[e.currentTarget.dataset.src],success:function(e){console.log(e.fileList)},fail:function(e){}}),console.log(this.data.img)},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){wx.redirectTo({url:"../zhu_ce/zhu_ce"})},onReachBottom:function(){},onShareAppMessage:function(){}});