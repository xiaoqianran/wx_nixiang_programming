var e=require("../../@babel/runtime/helpers/interopRequireDefault"),t=require("../../@babel/runtime/helpers/toConsumableArray"),i=require("../../@babel/runtime/helpers/objectSpread2"),a=require("../../utils/icon"),n=e(require("../../utils/systemInfo")),r=n.default.globalData.CDN_PATH;function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>1e3?(Math.round(e/100)/10).toFixed(1)+"公里":e+"米"}function d(e){return(e=e||1)>60?(e/60).toFixed(1)+"小时":e+"分钟"}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.distance?"步行".concat(o(e.distance),"(").concat(d(e.duration),")"):""}function u(e){return{buildingId:e.door.building_id,buildName:e.door.builidng_name,floorName:e.door.floor_name,icon:a.CN_DIRECTION_CONFIG[e.action]}}var s={underpass_num:"地下通道",crosswalk_num:"人行横道",overpass_num:"天桥",light_num:"红绿灯"};function c(e){var t=e.segmentList,n=void 0===t?[]:t,r=e.start,o=void 0===r?{}:r,d=e.end,s=void 0===d?{}:d,c=e.type,g=e.startWalkInfo,f=e.endWalkInfo,h="室内路线",m="室内路线",p=!1;"driving"===c&&(g&&(h=l(g)),f&&(m=l(f))),o.buildingId===s.buildingId&&(p=!0),n=n.filter((function(e){return e.action}));var v=[{title:"从".concat(o.name,"出发"),extra:o.floorName||"",icon:{url:a.POSITION_ICON}}];n.reduce((function(e,t){var n,r,o=e.res,d=e.pre,l={url:(n=t,n.buildingid&&n.__downup?a.STAIRS_CONFIG[n.cl_type+""+n.__downup]:n.maneuverType?a.DIRECTION_CONFIG[n.maneuverType]:a.CN_DIRECTION_CONFIG[n.action])},s="driving"===c&&"mycar"===t.__type,g="出建筑物"===t.action,f="进入建筑物"===t.action;if(t.buildingid||g||f||s)if(s)d.title="我的车",d.icon={url:a.CN_DIRECTION_CONFIG["驾车"]},d.extra="前往我的车",d.expandButtonText=h;else if(g){var v=u(t);d.title=v.buildName,d.icon={url:v.icon},d.extra=v.floorName,d.expandButtonText=h}else if(f){var I=u(t);d={title:I.buildName,icon:{url:I.icon},buildingid:I.buildingId,extra:I.floorName,expandButtonText:m,children:[]},o.push(d)}else d.buildingid&&d.buildingid===t.buildingid?d.children.push({icon:l,title:t.action,extra:(t.action,r=t.roadLength,r?"行进".concat(r,"米"):"")}):(d={buildingid:t.buildingid,extra:t.textInfo,hiddenIndoorBuildTitle:p,childrenVisible:p,children:[]},o.push(d));else o.push({icon:l,hasSolidLine:!t.hasOwnProperty("buildingid"),title:t.action,extra:t.textInfo}),d=i({},t);return{res:o,pre:d}}),{res:v,pre:{}});var I={title:s.name,extra:s.floorName||"",icon:{url:a.POSITION_ICON}};return v.push(I),v}Component({properties:{height:{type:Number,value:500},sourceData:{type:Object,observer:function(e){var t=e.activeIndex||0,i=e.start,a=e.end,n=e.type;if("driving"===n){var r=e.cardData[t],o=r.segmentList,d=r.endWalkInfo,l=r.startWalkInfo;this.setData({type:n,meta:null,activeIndex:t,cards:e.cardData,data:c({segmentList:o,start:i,end:a,type:n,endWalkInfo:d,startWalkInfo:l})})}if("walk"===n&&e.cardData){var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];for(var i in s)e[i]&&t.push({val:e[i],text:s[i]});return t}(e.cardData);e.end.floorName&&u.unshift({text:"目的地在",val:e.end.floorName}),this.setData({type:n,meta:{title:"".concat(e.cardData.time," ").concat(e.cardData.distance),des:u},cards:null,data:c({segmentList:e.segmentList,start:i,end:a,type:n})})}}}},data:{CDN_PATH:r,meta:{title:"",des:""},scrollTop:0,type:"walk",data:[],isIPhoneX:n.default.globalData.isIPhoneX,logo:a.TENCENTMAPLOGO,windowHeight:n.default.globalData.windowHeight},lifetimes:{ready:function(){var e=n.default.globalData.themeColor;this.setData({themeColor:e})}},methods:{onToggleChildren:function(e){var i=e.currentTarget.dataset.index;if(void 0!==i){var a=t(this.data.data),n=a[i];n.childrenVisible=!n.childrenVisible,this.setData({data:a})}},onSelectCardItem:function(e){e.currentTarget.dataset&&this.triggerEvent("selectDriving",{index:e.currentTarget.dataset.index||0}),this.setData({scrollTop:0})},onToggleRouteDetail:function(){this.triggerEvent("toggleroutedetail")}}});