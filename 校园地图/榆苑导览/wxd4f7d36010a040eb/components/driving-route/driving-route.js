var e=require("../../@babel/runtime/helpers/interopRequireWildcard"),t=require("../../@babel/runtime/helpers/interopRequireDefault"),r=require("../../@babel/runtime/helpers/objectSpread2"),a=t(require("../../presenters/DrivingRoutePlanCloudPresenter")),i=require("../../config/appConfig"),n=t(require("../../utils/systemInfo")),s=require("../../models/RequestAPI"),o=e(require("../../utils/utils"));Component({properties:{height:{type:Number},data:{type:Object,observer:function(e){this.queryOptions=e,e.startPoint&&e.endPoint&&(this._setLoading(),s.requestAPI.sendModePv("driving"),this.drivingRoutePlanPresenter.driving({start:e.startPoint,end:e.endPoint}))}}},data:{status:null,scrollTop:0,routeDetailVisible:!1,CDN_PATH:i.CDN_PATH},lifetimes:{attached:function(){this.drivingRoutePlanPresenter=new a.default(this)},ready:function(){var e=n.default.globalData.themeColor,t=n.default.globalData.navigation;this.setData({themeColor:e,navigation:t})}},methods:{setDrivingSuccess:function(e){var t={type:"driving",start:this.drivingRoutePlanPresenter.start,end:this.drivingRoutePlanPresenter.end,activeIndex:e.activeIndex,cardData:e.cardData};this.setData(r({status:!1},t)),this.triggerEvent("mapdatachange",{type:"driving",data:{sourceData:t,polyline:e.polyline}}),this.triggerEvent("handlpageerror",{isNetworkError:!1,retry:!1,retryCb:!1})},setDrivingFail:function(e){var t=this,r="warning",a=function(){t.drivingRoutePlanPresenter.driving({start:t.queryOptions.startPoint,end:t.queryOptions.endPoint})};switch(e.status){case-1e3:r="loadError",this.triggerEvent("handlpageerror",{errorType:r,isNetworkError:!0,retry:!0,retryCb:a});break;case-1002:r="locationError",this.setData({status:{type:r,loadErrorText:e.message||"网路异常，请稍后重试",retry:a}});break;case-1003:r="locationAuthError",this.triggerEvent("handlpageerror",{errorType:r});break;default:this.setData({status:{type:r,warningText:e.message,loadErrorText:e.message||"网路异常，请稍后重试",retry:a}})}if(-1e3!==e.status){var i=e.meta||{};this.triggerEvent("mapdatachange",{type:"driving",data:{markers:i.markers||[],polyline:[]}}),i.markers&&i.markers.length>0&&this.setBounds(i.markers)}},setBounds:function(e){this.bounds=e,this.triggerEvent("mapboundschange",{type:"driving",data:{padding:[80,80,80,80],points:e}})},setMarkers:function(e){Array.isArray(e)&&e.length&&this.triggerEvent("mapdatachange",{type:"driving",data:{markers:e}})},_setLoading:function(){this.setData({status:{type:"loading",loadingText:"路线加载中..."}})},onRoutePlanTap:function(e){var t=+e.currentTarget.dataset.index;t!==this.data.activeIndex?(this.drivingRoutePlanPresenter.selectDriving(t),this.setData({scrollTop:0})):this.onToggleRouteDetail()},onToggleRouteDetail:function(){var e=this;this.setData({routeDetailVisible:!this.data.routeDetailVisible}),this.triggerEvent("toggleroutedetail",{callback:function(){e.setBounds(e.bounds)}})},onNavigate:function(){var e=this.properties.data.endPoint,t=e.latitude,r=e.longitude,a=e.name,i=void 0===a?"":a,n=wx.getSystemInfoSync().SDKVersion;o.compareVersion(n,"2.14.0")>=0?this.triggerEvent("onOpenMapApp",{latitude:parseFloat(t),longitude:parseFloat(r),destination:i}):wx.openLocation({latitude:parseFloat(t),longitude:parseFloat(r),name:i})}}});