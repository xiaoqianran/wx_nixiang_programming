var e=require("../@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.requestAPI=exports.default=void 0;var t=require("../@babel/runtime/helpers/objectSpread2"),r=e(require("../@babel/runtime/regenerator")),n=require("../@babel/runtime/helpers/asyncToGenerator"),a=require("../@babel/runtime/helpers/classCallCheck"),u=require("../@babel/runtime/helpers/createClass"),s=e(require("../utils/request")),i="https://pr.map.qq.com/pingd",o=s.default.get,c=(s.default.post,require("../libs/runtime"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e),this.key=t.key||"",this.themeColor=t.themeColor||"#427CFF"}var s,c,p,l,h,f,d,y,v,k;return u(e,[{key:"setKey",value:function(e){this.key=e||""}},{key:"getKey",value:function(){return this.key}},{key:"setThemeColor",value:function(e){this.themeColor=e||"#427CFF"}},{key:"getThemeColor",value:function(){return this.themeColor}},{key:"wxPromise",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(r,n){t.success=function(e){r(e)},t.fail=function(e){n(e)},wx[e](t)}))}},{key:"getLocation",value:(k=n(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wxPromise("getLocation",{type:"gcj02"});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)})},{key:"driving",value:(v=n(r.default.mark((function e(n){var a;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o("https://apis.map.qq.com/ws/direction/v1/driving",t({key:this.key,output:"json",get_speed:1,get_mp:1,policy:"LEAST_TIME"},n));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"transit",value:(y=n(r.default.mark((function e(n){var a;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t({key:this.key,output:"json",policy:"LEAST_TIME"},n),e.next=3,o("https://apis.map.qq.com/ws/direction/v1/transit",n);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"walking",value:(d=n(r.default.mark((function e(n){var a;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t({key:this.key,output:"json"},n),Object.keys(n).map((function(e){return n[e]||delete n[e],!0})),e.next=4,o("https://apis.map.qq.com/ws/direction/v1/walking",n);case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"geocoder",value:(f=n(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t({key:this.key},n),e.next=3,o("https://apis.map.qq.com/ws/geocoder/v1",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"searchPoi",value:(h=n(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t,tp:2,qt:"dt",referer:"qqmap_app",enc:"utf8",key:this.key},e.prev=1,e.next=4,o("https://apis.map.qq.com/ws/native/apic",n);case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{err:"网络请求失败"});case 10:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return h.apply(this,arguments)})},{key:"getSuggestions",value:(l=n(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t({key:this.key},n),e.next=3,o("https://apis.map.qq.com/ws/place/v1/suggestion",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"getSearch",value:(p=n(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t({key:this.key},n),e.next=3,o("https://apis.map.qq.com/ws/place/v1/search",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getLocationDetail",value:(c=n(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t(t({},n),{},{key:this.key}),e.next=3,o("https://apis.map.qq.com/ws/geocoder/v1/",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"sendPv",value:function(e){var r;try{r=wx.getAccountInfoSync().miniProgram.appId}catch(e){r=""}return e=t({key:this.key,appid:"miniprogram_plugin",logid:"route_plan",miniappid:r,userid:this._getUserId()},e),o(i,e)}},{key:"sendModePv",value:function(e){var t={appid:"miniprogram_plugin_routeplan",userid:this._getUserId(),type:e};return o(i,t)}},{key:"checkAuth",value:(s=n(r.default.mark((function e(n){var a,u;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{u=wx.getAccountInfoSync(),a=u.miniProgram.appId}catch(e){a=""}return n=t({key:"LMQBZ-NZX33-XDQ36-YDW6A-QUNVT-Q5FFU",pid2:a,key2:this.key,output:"json"},n),e.next=4,o("https://apikey.map.qq.com/mkey/index.php/mkey/check",n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"_getUserId",value:function(){var e=wx.getStorageSync("userid");if(!e){var t=this._getRandom();return wx.setStorageSync("userid",t),t}if(e.split("_")[0]===this._getFullDate())return e;var r=this._getRandom();return wx.setStorageSync("userid",r),r}},{key:"_getRandom",value:function(){var e=+new Date;return this._getFullDate(e)+"_"+e.toString(36)+"_"+Math.floor(1e4*Math.random())}},{key:"_getFullDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:+new Date,t=new Date(e),r=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();return"".concat(r,"-").concat(n,"-").concat(a)}}]),e}());exports.default=c;var p=new c;exports.requestAPI=p;