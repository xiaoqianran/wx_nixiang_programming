Object.defineProperty(exports,"__esModule",{value:!0}),exports.CoordinateTranslate=void 0;var t=require("../../@babel/runtime/helpers/classCallCheck"),a=require("../../@babel/runtime/helpers/createClass"),e=function(){function e(a,n,i,r,h,s,o){t(this,e),this.latitude=a,this.longitude=n,this.speed=i||0,this.heading=r,this.accuracy=h,this.timestamp=s,this.altitude=o,this.pos=[],this.a={x:128,y:128},this.b=256/360,this.c=256/(2*Math.PI),this.d=!0}return a(e,[{key:"clamp",value:function(t,a,e){return Math.max(a,Math.min(e,t))}},{key:"fromLatLngToPoint",value:function(t,a){var e={x:0,y:0},n=this.a;e.x=n.x+t*this.b;var i=this.clamp(Math.sin(a*Math.PI/180),-(1-1e-15),1-1e-15);return e.y=n.y+.5*Math.log((1+i)/(1-i))*-this.c,e}},{key:"fromPointToLatLng",value:function(t,a){var e=this.a,n=180*(2*Math.atan(Math.exp((a-e.y)/-this.c))-Math.PI/2)/Math.PI;return{x:(t-e.x)/this.b,y:n}}},{key:"latLngToCoord",value:function(t,a,e){var n=this.fromLatLngToPoint(t,a);if(n){var i=e||18,r=Math.pow(2,i);n.x*=r,n.y*=r}return n}},{key:"coordToLatLng",value:function(t,a,e){var n=e||18,i=Math.pow(2,n),r={x:t/i,y:a/i};return this.fromPointToLatLng(r.x,r.y)}},{key:"mercator2latLng",value:function(t,a){t=t/20037508.34*180,a=a/20037508.34*180,a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2);var e={};return e.x=t,e.y=a,e}},{key:"latLng2Mercator",value:function(t,a){t=20037508.34*t/180,a=20037508.34*(a=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180))/180;var e={};return e.x=t,e.y=a,e}},{key:"getCollideIndex",value:function(){return this.collideIndex}},{key:"intersect",value:function(t){for(var a=Array.prototype.slice.call(t),e=0;e<a.length;e++)this.pos.push(a[e].id);for(;a.length>1;){var n=a.shift();this.poiGland(n,a)}}},{key:"poiGland",value:function(t,a){for(var e=this.getBounds(t),n=0;n<a.length;n++){var i=a[n];if(!i.bad){var r=this.getBounds(i);if(this.impact(e,r)){i.bad=!0;var h=i.id,s=this.pos.indexOf(h);s>-1&&this.pos.splice(s,1)}}}var o;o=this.pos.slice(),this.collideIndex=o}},{key:"impact",value:function(t,a){var e=t.x<=a.x?a.x:t.x,n=t.y<=a.y?a.y:t.y;return e>=t.x&&e<=t.x+t.w&&n>=t.y&&n<=t.y+t.h&&e>=a.x&&e<=a.x+a.w&&n>=a.y&&n<=a.y+a.h}},{key:"getBounds",value:function(t){var a={};return a.x=t.min.x,a.y=t.min.y,a.w=Math.abs(t.max.x-t.min.x),a.h=Math.abs(t.max.y-t.min.y),a}},{key:"judgeRect",value:function(t,a){var e=t.max,n=t.min,i=a.max,r=a.min,h=n.x-e.x,s=n.y-e.y,o=r.x-i.x,u=r.y-i.y,l=h/2,y=s/2,c=o/2,x=u/2,M=e.x+h,v=e.y+s,d=n.x+o,f=n.y+u;return Math.abs(d-M)<=Math.abs(l)+Math.abs(c)&&Math.abs(f-v)<=Math.abs(y)+Math.abs(x)}},{key:"distanceTo",value:function(t,a){var e,n=[0,0,0],i=[0,0,0],r=t.x,h=t.y,s=a.x,o=a.y;r*=.01745329251994329,h*=.01745329251994329,s*=.01745329251994329,o*=.01745329251994329;var u=Math.sin(r),l=Math.sin(h),y=Math.cos(r),c=Math.cos(h),x=Math.sin(s),M=Math.sin(o),v=Math.cos(s),d=Math.cos(o);return n[0]=c*y,n[1]=c*u,n[2]=l,i[0]=d*v,i[1]=d*x,i[2]=M,e=Math.sqrt((n[0]-i[0])*(n[0]-i[0])+(n[1]-i[1])*(n[1]-i[1])+(n[2]-i[2])*(n[2]-i[2])),12742001.5798544*Math.asin(e/2)}},{key:"headingTo",value:function(t,a){var e=a.x-t.x,n=a.y-t.y,i=180*Math.atan2(e,n)/Math.PI;return i>=360?i-=360:i<0&&(i+=360),i}}]),e}();exports.CoordinateTranslate=e;