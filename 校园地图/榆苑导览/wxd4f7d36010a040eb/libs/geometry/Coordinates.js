Object.defineProperty(exports,"__esModule",{value:!0}),exports.Coordinates=void 0;var t=require("../../@babel/runtime/helpers/classCallCheck"),a=require("../../@babel/runtime/helpers/createClass"),e=function(){function e(a,i,n,h,r,s,o){t(this,e),this.latitude=a,this.longitude=i,this.speed=n||0,this.heading=h,this.accuracy=r,this.timestamp=s,this.altitude=o,this.pos=[],this.a={x:128,y:128},this.b=256/360,this.c=256/(2*Math.PI),this.d=!0}return a(e,[{key:"clamp",value:function(t,a,e){return Math.max(a,Math.min(e,t))}},{key:"fromLatLngToPoint",value:function(t,a){var e={x:0,y:0},i=this.a;e.x=i.x+t*this.b;var n=this.clamp(Math.sin(a*Math.PI/180),-(1-1e-15),1-1e-15);return e.y=i.y+.5*Math.log((1+n)/(1-n))*-this.c,e}},{key:"fromPointToLatLng",value:function(t,a){var e=this.a,i=180*(2*Math.atan(Math.exp((a-e.y)/-this.c))-Math.PI/2)/Math.PI;return{x:(t-e.x)/this.b,y:i}}},{key:"latLngToCoord",value:function(t,a,e){var i=this.fromLatLngToPoint(t,a);if(i){var n=e||18,h=Math.pow(2,n);i.x*=h,i.y*=h}return i}},{key:"coordToLatLng",value:function(t,a,e){var i=e||18,n=Math.pow(2,i),h={x:t/n,y:a/n};return this.fromPointToLatLng(h.x,h.y)}},{key:"mercator2latLng",value:function(t,a){t=t/20037508.34*180,a=a/20037508.34*180,a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2);var e={};return e.x=t,e.y=a,e}},{key:"latLng2Mercator",value:function(t,a){t=20037508.34*t/180,a=20037508.34*(a=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180))/180;var e={};return e.x=t,e.y=a,e}},{key:"getCollideIndex",value:function(){return this.collideIndex}},{key:"intersect",value:function(t){for(var a=Array.prototype.slice.call(t),e=0;e<a.length;e++)this.pos.push(a[e].id);for(;a.length>1;){var i=a.shift();this.poiGland(i,a)}}},{key:"poiGland",value:function(t,a){for(var e=this.getBounds(t),i=0;i<a.length;i++){var n=a[i];if(!n.bad){var h=this.getBounds(n);if(this.impact(e,h)){n.bad=!0;var r=n.id,s=this.pos.indexOf(r);s>-1&&this.pos.splice(s,1)}}}var o;o=this.pos.slice(),this.collideIndex=o}},{key:"impact",value:function(t,a){var e=t.x<=a.x?a.x:t.x,i=t.y<=a.y?a.y:t.y;return e>=t.x&&e<=t.x+t.w&&i>=t.y&&i<=t.y+t.h&&e>=a.x&&e<=a.x+a.w&&i>=a.y&&i<=a.y+a.h}},{key:"getBounds",value:function(t){var a={};return a.x=t.min.x,a.y=t.min.y,a.w=Math.abs(t.max.x-t.min.x),a.h=Math.abs(t.max.y-t.min.y),a}},{key:"judgeRect",value:function(t,a){var e=t.max,i=t.min,n=a.max,h=a.min,r=i.x-e.x,s=i.y-e.y,o=h.x-n.x,u=h.y-n.y,y=r/2,l=s/2,c=o/2,x=u/2,M=e.x+r,v=e.y+s,d=i.x+o,f=i.y+u;return Math.abs(d-M)<=Math.abs(y)+Math.abs(c)&&Math.abs(f-v)<=Math.abs(l)+Math.abs(x)}},{key:"distanceTo",value:function(t,a){var e,i=[0,0,0],n=[0,0,0],h=t.x,r=t.y,s=a.x,o=a.y;h*=.01745329251994329,r*=.01745329251994329,s*=.01745329251994329,o*=.01745329251994329;var u=Math.sin(h),y=Math.sin(r),l=Math.cos(h),c=Math.cos(r),x=Math.sin(s),M=Math.sin(o),v=Math.cos(s),d=Math.cos(o);return i[0]=c*l,i[1]=c*u,i[2]=y,n[0]=d*v,n[1]=d*x,n[2]=M,e=Math.sqrt((i[0]-n[0])*(i[0]-n[0])+(i[1]-n[1])*(i[1]-n[1])+(i[2]-n[2])*(i[2]-n[2])),12742001.5798544*Math.asin(e/2)}},{key:"headingTo",value:function(t,a){var e=a.x-t.x,i=a.y-t.y,n=180*Math.atan2(e,i)/Math.PI;return n>=360?n-=360:n<0&&(n+=360),n}}]),e}();exports.Coordinates=e;