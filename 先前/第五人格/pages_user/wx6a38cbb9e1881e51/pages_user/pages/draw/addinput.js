var a=getApp();Page({data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,drawId:null,addressInfo:{deliveryConsignee:"",deliveryPhone:"",deliveryAddress:"",id:""},region:["请选择您的地区","",""],canDh:!0},onLoad:function(e){var t=this;wx.setNavigationBarTitle({title:"填写收货地址"}),t.setData({wxToken:a.globalData.wxToken,drawId:e.id}),t.data.wxToken?t.getData():a.initOkCallback=function(e){t.setData({wxToken:a.globalData.wxToken}),t.getData()}},getData:function(){},priceDh:function(){var a=this;return 0!=a.data.canDh&&(""==a.data.addressInfo.deliveryConsignee?(wx.showToast({title:"请输入收货人姓名",icon:"none",duration:2e3}),!1):""==a.data.addressInfo.deliveryPhone?(wx.showToast({title:"请输入收货人电话",icon:"none",duration:2e3}),!1):"请选择地区"==a.data.region[0]?(wx.showToast({title:"请选择您的地区",icon:"none",duration:2e3}),!1):""==a.data.addressInfo.deliveryAddress?(wx.showToast({title:"请输入详细地址",icon:"none",duration:2e3}),!1):(a.data.canDh=!1,a.data.addressInfo.deliveryAddress=a.data.region[0]+a.data.region[1]+a.data.region[2]+a.data.addressInfo.deliveryAddress,a.data.addressInfo.id=a.data.drawId,void wx.showModal({title:"温馨提示",content:"请检查地址是否正确，保存后将无法更改",cancelText:"修改地址",confirmText:"确认保存",success:function(e){e.confirm?wx.request({url:a.data.apiUrl+"/w/epro/h55/lottery/prize/delivery/submit",data:a.data.addressInfo,method:"POST",header:{"Content-Type":"application/json",wxToken:a.data.wxToken},success:function(e){200==e.data.code?(wx.reportEvent("draw_det_input",{}),wx.showModal({title:"领取成功",content:"领取成功, 实物奖励将在7个工作日内发放",showCancel:!1,success:function(e){a.data.addressInfo={deliveryConsignee:"",deliveryPhone:"",deliveryAddress:""},a.setData({region:""}),wx.setStorage({key:"refreshDet",data:!0}),wx.navigateBack()}}),a.getData()):wx.showToast({title:e.data.msg,icon:"none",duration:2e3}),a.data.canDh=!0}}):e.cancel&&(a.data.canDh=!0)}})))},nameVal:function(a){this.data.addressInfo.deliveryConsignee=a.detail.value},telVal:function(a){this.data.addressInfo.deliveryPhone=a.detail.value},addressVal:function(a){this.data.addressInfo.deliveryAddress=a.detail.value},bindRegionChange:function(a){this.setData({region:a.detail.value})},handlerGobackClick:function(e){getCurrentPages().length>=2?wx.navigateBack({delta:e}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});