var t=require("../../../../@babel/runtime/helpers/toConsumableArray"),e=getApp();Page({data:{imgUrl:e.globalData.imgUrl,apiUrl:e.globalData.apiUrl,wxToken:e.globalData.wxToken,user:[],usersy_gold:0,usersy_silver:0,viewType:0,historyListUse:[],historyListUseNo:1,historyListUseReget:!0,historyListGet:[],historyListGetNo:1,historyListGetReget:!0},onLoad:function(){var t=this;this.setData({wxToken:e.globalData.wxToken}),this.data.wxToken?this.getData():e.initOkCallback=function(a){t.setData({wxToken:e.globalData.wxToken}),t.getData()}},getData:function(){this.getUserInfo()},getUserInfo:function(){var t=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/userinfo",data:{wxToken:t.data.wxToken},header:{wxToken:t.data.wxToken},success:function(e){var a=e.data.data;a.priceNum=100*a.goldCoin+a.silverCoin,null==a.silverCoin&&(a.silverCoin=0),null==a.goldCoin&&(a.goldCoin=0),t.setData({user:a}),null!=a.idvId&&(t.getListUse(),t.getListGet())}})},getListUse:function(){var e=this;if(!e.data.historyListUseReget)return!1;wx.request({url:this.data.apiUrl+"/w/epro/role/account/balance/page",data:{wxToken:e.data.wxToken,pageNo:e.data.historyListUseNo,pageSize:20,changeType:"expenditure"},method:"GET",header:{wxToken:e.data.wxToken},success:function(a){var i=a.data.data.records;if(i.length<1)return e.data.historyListUseReget=!1,!1;e.setData({historyListUse:[].concat(t(e.data.historyListUse),t(i))})}})},getListGet:function(){var e=this;if(!e.data.historyListGetReget)return!1;wx.request({url:this.data.apiUrl+"/w/epro/role/account/balance/page",data:{wxToken:e.data.wxToken,pageNo:e.data.historyListGetNo,pageSize:20,changeType:"income"},method:"GET",header:{wxToken:e.data.wxToken},success:function(a){var i=a.data.data.records;if(i.length<1)return e.data.historyListGetReget=!1,!1;e.setData({historyListGet:[].concat(t(e.data.historyListGet),t(i))})}})},chType:function(t){this.setData({viewType:t.currentTarget.dataset.type})},goDetail:function(t){var e=t.currentTarget.dataset.id;wx.navigateTo({url:"/pages_user/pages/saishi/dh/detail?id="+e})},handlerGobackClick:function(t){getCurrentPages().length>=2?wx.navigateBack({delta:t}):wx.redirectTo({url:e.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:e.globalData.pageIndex})},copyCode:function(t){if(""==t.currentTarget.dataset.code)return!1;wx.setClipboardData({data:t.currentTarget.dataset.code,success:function(t){}})},onPullDownRefresh:function(){},onReachBottom:function(){0==this.data.viewType&&(this.data.historyListGetNo++,this.getListGet()),1==this.data.viewType&&(this.data.historyListUseNo++,this.getListUse())},onShareAppMessage:function(){}});