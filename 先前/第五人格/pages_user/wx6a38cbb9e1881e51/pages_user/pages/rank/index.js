var t=require("../../../@babel/runtime/helpers/defineProperty"),a=getApp(),e="https://nie.res.netease.com/id5/m/zt/20201215094137/data";Page({data:t({wxToken:a.globalData.wxToken,apiUrl:a.globalData.apiUrl,imgUrl:a.globalData.imgUrl,isloadIng:!1,userInfo:{},bindUserVisible:!1,unBindVisible:!1,popName:"",playbtn:!0,videoContext:"",viewType:1,switchJgz:!1,dataIndex:-1,tierIndex:-1,roleData:[],newroleData:[],tiersList:[{name:"巅峰七阶",key:8},{name:"七阶",key:7},{name:"六阶",key:6},{name:"五阶",key:5},{name:"四阶",key:4},{name:"三阶",key:3},{name:"二阶",key:2},{name:"一阶",key:1}],tiersPic1:[e+"/vsrecord/ic/j8.png",e+"/vsrecord/ic/j7.png",e+"/vsrecord/ic/j6.png",e+"/vsrecord/ic/j5.png",e+"/vsrecord/ic/j4.png",e+"/vsrecord/ic/j3.png",e+"/vsrecord/ic/j2.png",e+"/vsrecord/ic/j1.png"],tiersPic2:[e+"/vsrecord/ic/q8.png",e+"/vsrecord/ic/q7.png",e+"/vsrecord/ic/q6.png",e+"/vsrecord/ic/q5.png",e+"/vsrecord/ic/q4.png",e+"/vsrecord/ic/q3.png",e+"/vsrecord/ic/q2.png",e+"/vsrecord/ic/q1.png"],sortName:"use_rate",sortKey:1,sortDirection:2,sortClass:"bottom",campId:1,part:-127,start_time:[],end_time:[],position:"",roleqsz:["救援型","牵制型","破译型","辅助型"]},"bindUserVisible",!1),onLoad:function(t){var e=this;this.data.wxToken=a.globalData.wxToken,this.data.wxToken?(this.getUserInfo(),this.getUserInit()):a.initOkCallback=function(t){e.setData({wxToken:t}),e.getUserInfo(),e.getUserInit(),a.initOkCallback=null}},getUserInit:function(){var t=this;this.setData({userInfo:a.globalData.userInfo}),this.data.userInfo||(a.initUserOver=function(e){t.setData({userInfo:a.globalData.userInfo}),a.initUserOver=null})},handlerGobackClick:function(t){getCurrentPages().length>=2?wx.navigateBack({delta:t}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){2==this.data.pageCount?this.goPanda():wx.redirectTo({url:a.globalData.pageIndex})},chType:function(t){this.setData({viewType:t.currentTarget.dataset.index,campId:t.currentTarget.dataset.index,part:-127,sortKey:1,sortType:2,dataIndex:-1}),this.allDw()},switchDw:function(t){this.setData({tierIndex:t.target.dataset.info,part:t.target.dataset.key}),this.getRankData()},switchDw2:function(t){this.setData({dataIndex:t.target.dataset.index,position:this.data.roleqsz[t.target.dataset.index]}),this.getRankData()},getUserInfo:function(){this.setData({campId:1,part:-127,sortKey:1,sortType:2,position:""}),this.getRankData()},getRankData:function(){var t=this;this.myQequest("/gameRole/playTop",{campId:this.data.campId,part:this.data.part,sortKey:this.data.sortKey,sortType:this.data.sortDirection,position:this.data.position},(function(a){console.log("/gameRole/playTop",a),t.setData({roleData:a.data,start_time:a.data[0].start_time.split("-"),end_time:a.data[0].end_time.split("-")});for(var e=t.data.roleData,i=0;i<t.data.roleData.length;i++)t.data.roleData[i].use_rate=parseFloat((100*e[i].use_rate).toFixed(1)),t.data.roleData[i].win_rate=parseFloat((100*e[i].win_rate).toFixed(1)),t.data.roleData[i].ping_rate=parseFloat((100*e[i].ping_rate).toFixed(1)),t.data.roleData[i].ban_rate=parseFloat((100*e[i].ban_rate).toFixed(1)),t.data.roleData[i].run_rate=parseFloat((100*e[i].run_rate).toFixed(1));t.setData({newroleData:t.data.roleData}),console.log(t.data.newroleData),1==t.data.campId?t.setData({but_total_hero_list:t.data.newroleData}):2==t.data.campId&&t.setData({civ_total_hero_list:t.data.newroleData})}))},alltype:function(){this.setData({dataIndex:-1}),this.data.position="",this.getRankData()},allDw:function(){this.setData({tierIndex:-1,part:-127,sortName:"use_rate",sortClass:"bottom",sortKey:1,position:""}),this.getRankData()},goRole:function(t){if(!this.data.userInfo.idvId)return this.handleBindUserDialog(),!1;var a="监管";2==t.currentTarget.dataset.campid&&(a="求生"),wx.navigateTo({url:"/pages/vsrecord/role?from=rank&heroId="+t.currentTarget.dataset.id+"&gameId="+this.data.userInfo.idvId+"&zy="+a})},handlerSort:function(t){var a=t.target.dataset.name;if(a!==this.data.sortName)this.setData({sortDirection:2,sortName:a,sortClass:"bottom",sortKey:t.currentTarget.dataset.index}),console.log(a,this.data.sortName);else if(a===this.data.sortName){var e=this.data.sortClass;e="bottom"===e?"top":"bottom";var i=this.data.sortDirection;i=i-1==0?2:1,this.setData({sortDirection:i,sortClass:e,sortKey:t.currentTarget.dataset.index})}this.setData({viewType:this.data.viewType,campId:this.data.campId,part:this.data.part,sortKey:this.data.sortKey,sortType:this.data.sortDirection}),this.getRankData()},myQequest:function(t,e,i,s){var r=this;wx.request({url:"".concat(this.data.apiUrl,"/w/epro/wechatuser").concat(t),data:e,method:s||"get",header:{wxToken:this.data.wxToken},success:function(t){setTimeout((function(){r.data.canClick=!0}),1e3),t.data.status?i&&i(t.data):-10000301==t.data.code?r.data.onLogin||(r.data.onLogin=!0,a.getLogin(),a.initOkCallback=function(t){r.setData({wxToken:t}),a.initOkCallback=null,setTimeout((function(){r.data.onLogin=!1}),3e3)}):wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})},onReady:function(){},onShow:function(){},handleBindUserDialog:function(){this.setData({bindUserVisible:!0})},bindCol:function(t){var e=this;a.reGetUserInfo((function(t){e.setData({userInfo:t})}))},handleCustomReject:function(){var t;null!==(t=this.data.userInfo)&&void 0!==t&&t.idvId&&!a.globalData.userinfoApiStatus&&wx.redirectTo({url:a.globalData.pageIndex})},handleBind:function(t){"true"!==t.detail?this.setData({bindUserVisible:!this.data.bindUserVisible}):this.setData({bindUserVisible:!1})},onReachBottom:function(){},onShareAppMessage:function(){return{title:"快来看看本赛季的热门角色吧",imageUrl:"".concat(this.data.imgUrl,"/vsrecord/rank/share.png"),path:"/pages_user/pages/rank/index?from=share"}}});