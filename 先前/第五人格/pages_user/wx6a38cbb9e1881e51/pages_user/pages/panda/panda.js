var t=getApp(),a="https://nie.res.netease.com/id5/m/zt/20201215094138/data";Page({data:{wxToken:t.globalData.wxToken,apiUrl:t.globalData.apiUrl,imgUrl:t.globalData.imgUrl,userInfo:null,nbHeight:60,pageCount:1,drowRolls:0,kpcount:0,helpPeople:0,info:{},cardFaceImg:{mc1:a+"/panda/jiesuo.png",mc2:a+"/panda/suo.png",pandaCard:a+"/panda/card.png"},listIndex:"",unBindTipImgList:[{pic:a+"/panda/limit_card1.png",showBigImg:!1},{pic:a+"/panda/limit_card2.png",showBigImg:!1},{pic:a+"/panda/limit_card3.png",showBigImg:!1},{pic:a+"/panda/limit_card4.png",showBigImg:!1}],limitBigCard:[{pic:a+"/panda/limit_big_card1.jpg",showBigImg:!1},{pic:a+"/panda/limit_big_card2.jpg",showBigImg:!1},{pic:a+"/panda/limit_big_card3.jpg",showBigImg:!1},{pic:a+"/panda/limit_big_card4.jpg",showBigImg:!1}],prizeList:[],prizePic:[a+"/panda/coin.png",a+"/panda/coin.png",a+"/panda/coin.png",a+"/panda/coin.png",a+"/panda/tuya_panda.png",a+"/panda/prize_frame.png"],cardId:0,drawCardShake:!0,bigkpcard:!1,prizename:"",kplist:[],kpcardlist:[{pic:a+"/panda/kcard4.png",showBigImg:!1,text:"å¤§ç†ŠçŒ«æ˜¯ä¸–ç•Œä¸Šæœ€å¯çˆ±çš„åŠ¨ç‰©ä¹‹ä¸€ï¼Œå®ƒæœ‰ç€åœ†åœ†çš„è„¸é¢Šï¼Œå¤§å¤§çš„é»‘çœ¼åœˆï¼Œèƒ–å˜Ÿå˜Ÿçš„èº«ä½“ï¼Œæ ‡å¿—æ€§çš„å†…å…«å­—çš„è¡Œèµ°æ–¹å¼ï¼Œä¹Ÿæœ‰è§£å‰–åˆ€èˆ¬é”‹åˆ©çš„çˆªå­ã€‚"},{pic:a+"/panda/kcard1.png",showBigImg:!1,text:"å¤§ç†ŠçŒ«ä¸ºç‹¬å±…åŠ¨ç‰©ã€‚é‡å¤–å¤§ç†ŠçŒ«çš„å¯¿å‘½ä¸€èˆ¬ä¸º18--20å²ï¼Œåœˆå…»çŠ¶æ€ä¸‹å› ä¸ºæœ‰å¾ˆå¥½çš„é¥²å…»ç®¡ç†å’ŒåŒ»ç–—ï¼Œæœ‰çš„å¯ä»¥è¶…è¿‡30å²ã€‚é¦™æ¸¯æµ·æ´‹å…¬å›­çš„ä½³ä½³ï¼Œå‡ºç”Ÿäº1978å¹´ï¼Œæ˜¯ç›®å‰å…¨ä¸–ç•Œæœ€é•¿å¯¿çš„å¤§ç†ŠçŒ«ã€‚"},{pic:a+"/panda/kcard4.png",showBigImg:!1,text:"å¤§ç†ŠçŒ«æ›¾å¹¿æ³›åˆ†å¸ƒäºä¸­å›½é•¿æ±Ÿã€é»„æ²³å’Œç æ±Ÿä¸‰å¤§æµåŸŸï¼ŒåŒ…æ‹¬ä»åŒ—äº¬é™„è¿‘å‘¨å£åº—è‡³ä¸¤å¹¿ä»¥åŠé™„è¿‘çš„ä¸œå—äºšåœ°åŒºã€‚è€Œç°åœ¨æˆ‘ä»¬åªèƒ½åœ¨ç§¦å²­å±±ç³»ã€å²·å±±å±±ç³»ã€é‚›å´ƒå±±ç³»ã€å‡‰å±±å’Œå¤§ã€å°ç›¸å²­å±±ç³»æ‰¾åˆ°å®ƒä»¬ã€‚"},{pic:a+"/panda/kcard1.png",showBigImg:!1,text:"å¤§ç†ŠçŒ«99%çš„é£Ÿç‰©éƒ½æ˜¯ç«¹å­ï¼Œå¯ä¾›å¤§ç†ŠçŒ«é£Ÿç”¨çš„ç«¹ç±»æ¤ç‰©å…±æœ‰12å±ã€60å¤šç§ã€‚æ­¤å¤–ï¼Œé‡ç”Ÿå¤§ç†ŠçŒ«è¿˜å¶é£Ÿä¸€äº›åŠ¨ç‰©å°¸ä½“æˆ–å…¶å®ƒæ¤ç‰©ã€èœ‚èœœç­‰ã€‚"},{pic:a+"/panda/kcard4.png",showBigImg:!1,text:"å¤§ç†ŠçŒ«çš„é£Ÿç‰©åœ¨ä½“å†…åœç•™çš„æ—¶é—´çŸ­ï¼Œæ¶ˆåŒ–é€Ÿåº¦å¾ˆå¿«ï¼Œå¯¹ç«¹ç±»çš„æ¶ˆåŒ–åˆ©ç”¨ç‡è¾ƒä½ï¼Œå› è€Œé‡‡å–å¤§é‡è¿›é£Ÿã€å¿«é€Ÿæ’å‡ºçš„æ–¹å¼ï¼Œæ¥ä¿è¯å®ƒä»¬åƒå¾—æ›´å¤šï¼Œè·å¾—è¶³å¤Ÿèƒ½é‡ä»¥æ»¡è¶³å…¶éœ€æ±‚ã€‚"},{pic:a+"/panda/kcard1.png",showBigImg:!1,text:"åœˆå…»æ¡ä»¶ä¸‹é›Œæ€§å¤§ç†ŠçŒ«5å²å·¦å³ï¼Œé›„æ€§å¤§ç†ŠçŒ«6å²å·¦å³è¿›å…¥æ€§æˆç†Ÿï¼Œé‡å¤–å¤§ç†ŠçŒ«æ€§æˆç†Ÿç¨æ™šã€‚å¤§ç†ŠçŒ«é™¤å‘æƒ…é…ç§å­£èŠ‚å¤–ï¼Œå…¶ä»–æ—¶å€™ä¸€èˆ¬æ˜¯ç‹¬å±…ï¼Œå„æœ‰å…¶æ´»åŠ¨çš„åŒºåŸŸã€‚"},{pic:a+"/panda/kcard2.png",showBigImg:!1,text:"å°ç†ŠçŒ«çš„ä½“å‹æ¯”è¾ƒå°ï¼Œé¢œè‰²å¤šä¸ºçº¢è¤è‰²ï¼Œå¤§ç†ŠçŒ«å’Œå°ç†ŠçŒ«ä¸æ˜¯åŒä¸€ç§åŠ¨ç‰©"},{pic:a+"/panda/kcard3.png",showBigImg:!1,text:"å°ç†ŠçŒ«æ˜¯å›½å®¶äºŒçº§é‡ç‚¹ä¿æŠ¤åŠ¨ç‰©ï¼ŒåˆåçŒ«ç†Šã€çº¢çŒ«ç†Šã€ç«ç‹ï¼Œæ˜¯ä¸€ç§å“ºä¹³ç±»åŠ¨ç‰©ï¼Œåˆ†å¸ƒåœ¨ä¸­å›½å—æ–¹åˆ°å–œé©¬æ‹‰é›…å±±éº“ã€ä¸ä¸¹ã€å°åº¦ã€è€æŒã€ç¼…ç”¸ã€å°¼æ³Šå°”ç­‰å›½ã€‚å±äºé£Ÿè‚‰ç›®ã€å°ç†ŠçŒ«ç§‘ã€‚"},{pic:a+"/panda/kcard2.png",showBigImg:!1,text:"å°ç†ŠçŒ«å››è‚¢ç²—çŸ­ï¼Œå¤´éƒ¨æ£•è‰²ç™½è‰²ç›¸é—´ï¼ŒèƒŒéƒ¨æ¯›è‰²ä¸ºçº¢æ£•è‰²ï¼Œå…¶çœ¼çœ¶å’Œä¸¤é¢Šç”šè‡³è¿å˜´å‘¨å›´åŠèƒ¡é¡»éƒ½æ˜¯ç™½è‰²ã€‚æœ€å¥½çœ‹çš„æ˜¯ä¸€æ¡è“¬æ¾çš„é•¿å°¾å·´ï¼Œé•¿è€Œç²—ï¼Œå…¶æ£•è‰²ä¸ç™½è‰²ç›¸é—´çš„ä¹èŠ‚ç¯çº¹ï¼Œéå¸¸æƒ¹äººå–œçˆ±ï¼Œâ€œä¹èŠ‚ç‹¼â€çš„åˆ«åå› æ­¤è€Œæ¥ã€‚"},{pic:a+"/panda/kcard3.png",showBigImg:!1,text:"å°ç†ŠçŒ«æ—©æ™šå‡ºæ¥æ´»åŠ¨è§…é£Ÿï¼Œç™½å¤©å¤šåœ¨æ´é‡Œæˆ–å¤§æ ‘çš„è«å‡‰å¤„ç¡è§‰ã€‚æˆå¹´å°ç†ŠçŒ«åœ¨äº¤é…å­£èŠ‚ä¹‹å¤–å¾ˆå°‘äº’åŠ¨ï¼Œå–œæ¬¢åƒæµ†æœã€èŠ±æœµã€é¸Ÿè›‹ã€ç«¹å¶å’Œå…¶ä»–æ¤ç‰©çš„å°å¶å­ã€‚ ç«¹å­çš„å¶å­æ˜¯å°ç†ŠçŒ«çš„ä¸»è¦é£Ÿç‰©æ¥æºã€‚"},{pic:a+"/panda/kcard2.png",showBigImg:!1,text:"å°ç†ŠçŒ«æ˜¯ä¸€ç§å–œæ¸©æ¹¿è€Œåˆæ¯”è¾ƒè€é«˜å¯’çš„æ£®æ—åŠ¨ç‰©ï¼Œä¸»è¦ç”Ÿæ´»åœ¨1500-4000ç±³é«˜å±±ä¸›æ—åœ°å¸¦ã€‚"},{pic:a+"/panda/kcard3.png",showBigImg:!1,text:"å°ç†ŠçŒ«æ˜¯ç†ŠçŒ«çš„äº²å¯†ä¼™ä¼´ï¼Œå®ƒä»¬è™½ç„¶éƒ½æ˜¯ä»¥ç«¹ä¸ºç”Ÿï¼Œä½†å°ç†ŠçŒ«å´ä¸å¤§ç†ŠçŒ«åˆæœ‰åˆ†äº«çš„é»˜å¥‘ã€‚å¤§ç†ŠçŒ«åœ¨ç§‹å­£çˆ±åƒç«¹å¶ï¼Œè¿™æ—¶å°ç†ŠçŒ«å´ä¸»è¦æ˜¯åƒé‡æ¨±æ¡ƒã€èŠ±æªç­‰å„ç§é‡æœï¼›å¤§ç†ŠçŒ«åœ¨æ˜¥å¤çˆ±åƒè¾ƒå¤§å¾„çš„ç«¹ç¬‹ï¼Œè€Œå°ç†ŠçŒ«åˆ™ä¸»è¦åƒå¤§ç†ŠçŒ«ä¸åƒçš„å°å¾„ç«¹ç¬‹ï¼›å¤§ç†ŠçŒ«å¤šåƒç«¹å­ä¸Šéƒ¨çš„æå¶ï¼Œå°ç†ŠçŒ«é‡‡é£Ÿåœ¨è¾ƒä½éƒ¨ä½çš„ç«¹å¶ï¼›å¤§ç†ŠçŒ«é‡‡é£Ÿåœ°ç‚¹å¤šåœ¨å¹³ç¼“çš„é˜´å¡ï¼Œè€Œå°ç†ŠçŒ«å¤šåœ¨é™¡å³­çš„é˜³å¡é‡‡é£Ÿã€‚"}],btntext:"(5s)",limitList:[],c:[{count:3,ifGet:!1},{count:6,ifGet:!1},{count:9,ifGet:!1},{count:12,ifGet:!1}],d:!0,isPanda:!1,ifShare:!1,ifGameOver:!1,ifRecordShare:!1,ifActivity:!1,ifFriend:!1,ifjoin:!1,userHelpInfo:[],userHelpInfo2:[],bindUserVisible:!1,showAddfri:!1,tcPrize:!1,tcbindid:!1,tcAddFriend:!1,tcbindPart:!1,tcDrowcard:!1,tcToShop:!1,tcCardTask:!1,tcPanda_knowledge:!1,tckpcard:!1,tcCoin:!1,tcHeadPic:!1,tcxdty:!1,tcHelp:!1,tcSubMsg:!1,helpready:!1,helplimit:!1,helpSelf:!1,helpBindGame:!1,userPhone:!1,taskList:[],haveWorkTodo:null,haveWorkTodoTaskId:"",canGetVs:!0,showSharePic:!1,showShare:!1,longBag:!1,scroll_xd:!0,scroll_help:!0,height_xd:0,height_help:0,listNumber:["â‘ ","â‘¡","â‘¢","â‘£","â‘¤","â‘¥","â‘¦","â‘§","â‘¨","â‘©","â‘ª","â‘«"],helpFull:!1,firstId:!1,shareNum:1,jall:!1,showremind:!1,partNotStart:!1,partEnd:!1},onLoad:function(a){var e=this;console.log(a);var i=new Date("2022/09/02 23:59:59").getTime(),n=(new Date).getTime();console.log(n),n>i&&this.setData({partEnd:!0});var d={uid:a.uid,userHead:a.userHead};this.setData({info:d});var o=a.count;if(o&&2==o&&this.setData({pageCount:o}),this.data.wxToken=t.globalData.wxToken,this.data.wxToken?this.getdata():t.initOkCallback=function(a){e.setData({wxToken:a}),e.getdata(),t.initOkCallback=null},a.sharetype&&1==a.sharetype?wx.reportEvent("panda_sharecard2_click",{}):a.sharetype&&2==a.sharetype&&wx.reportEvent("panda_sharecard_click",{}),a.from)switch(a.from){case"shequn":wx.reportEvent("panda_shequn",{});break;case"weibo":wx.reportEvent("panda_weibo",{});break;case"weixin":wx.reportEvent("panda_weixin",{});break;case"xiaochengxu":wx.reportEvent("panda_xiaochengxu",{});break;case"beiyong":wx.reportEvent("panda_beiyong",{})}a.sub&&wx.reportEvent("panda_subscription",{})},getdata:function(){var a=this,e=t.globalData.userInfo;e?(this.setData({userInfo:e}),e.phone&&""!=e.phone&&this.setData({userPhone:!0}),this.getPartInfo()):t.initUserOver=function(t){a.setData({userInfo:t}),t.phone&&""!=t.phone&&a.setData({userPhone:!0}),a.getPartInfo()}},getPartInfo:function(){2==this.data.pageCount?(wx.reportEvent("panda_helppage_pop_pv",{}),this.gethelpInfo(this.data.userInfo.uid),this.gethelpInfo2(this.data.info.uid)):(wx.reportEvent("panda_main_pv",{}),this.gethelpInfo(this.data.userInfo.id),this.getUserJoinInfo())},getDrawChance:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/mission/getDrawTime",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},success:function(t){200==t.data.code?a.setData({drowRolls:t.data.data.num}):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},getShareNum:function(){var a=this;wx.getStorage({key:"20220801ShareNum",success:function(t){a.data.shareNum=t.data,a.setWxmlToCanvas()},fail:function(){wx.request({url:a.data.apiUrl+"/w/lottery/activity/share",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},success:function(t){200==t.data.code?(a.data.shareNum=t.data.data,wx.setStorage({key:"20220801ShareNum",data:t.data.data}),a.setWxmlToCanvas()):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})}})},gethelpInfo:function(a){var e=this;wx.request({url:e.data.apiUrl+"/w/lottery/activity/helpInfo",data:{activityId:t.globalData.activityId2,userId:a},header:{wxToken:e.data.wxToken},method:"GET",success:function(t){200==t.data.code?(t.data.data.userList&&t.data.data.userList.length>0&&t.data.data.userList.forEach((function(t){t.id==e.data.userInfo.id&&e.setData({helpready:!0})})),e.setData({userHelpInfo:t.data.data,helpPeople:t.data.data.count})):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},gethelpInfo2:function(a){var e=this;wx.request({url:e.data.apiUrl+"/w/lottery/activity/helpInfo",data:{activityId:t.globalData.activityId2,userId:a},header:{wxToken:e.data.wxToken},method:"GET",success:function(t){200==t.data.code?e.setData({userHelpInfo2:t.data.data}):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},getMyPrize:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/lottery/person/my",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},method:"GET",success:function(t){if(200==t.data.code){var e=t.data.data;e.forEach((function(t){var a=new Date(t.winTime),e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();t.winTime=e})),a.setData({prizeList:e})}else wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},getremarks:function(a){var e=this;wx.request({url:e.data.apiUrl+"/w/epro/common/dict/get/type/data/remarks",data:{type:"isEnterprise",name:"isPandaOpen"},header:{wxToken:e.data.wxToken},success:function(i){"true"==i.data.data?e.getqwFriend(a):"false"==i.data.data?(e.setData({ifFriend:!0}),a&&a()):t.requestError(i.msg)},fail:function(a){t.requestError()},complete:function(){}})},getqwFriend:function(a){var e=this,i=e.data,n=i.wxToken,d=i.apiUrl;wx.getStorage({key:"20220801joinQwFriend",success:function(t){e.setData({ifFriend:!0}),a&&a()},fail:function(){wx.request({url:d+"/w/weChatEnterprise/isWechatContact",data:{wxToken:n},success:function(i){200===i.statusCode?(e.setData({ifFriend:i.data.data}),a&&a(),i.data.data&&wx.setStorage({key:"20220801joinQwFriend",data:i.data.data,success:function(t){},fail:function(){},complete:function(){}})):t.requestError(i.msg)},fail:function(a){t.requestError()},complete:function(){}})},complete:function(){}})},findwqFanBao:function(){var a=this,e=a.data,i=e.wxToken,n=e.apiUrl;wx.request({url:n+"/w/weChatEnterprise/limit",data:{wxToken:i},success:function(e){200===e.data.code?e.data.data.limit||a.setData({ifFriend:!0}):t.requestError(e.msg)},fail:function(a){t.requestError()},complete:function(){}})},getPhoneNumber:function(t){var a=this;"getPhoneNumber:ok"==t.detail.errMsg&&wx.request({url:a.data.apiUrl+"/w/epro/wechatuser/mine/bindPhone",data:{code:t.detail.code?t.detail.code:"",encryptedData:t.detail.encryptedData?t.detail.encryptedData:"",iv:t.detail.iv?t.detail.iv:""},header:{wxToken:a.data.wxToken},method:"POST",dataType:"json",responseType:"text",success:function(t){a.setData({userPhone:!0})},fail:function(){},complete:function(){}})},getUserJoinInfo:function(){var a=this,e=this;function i(){e.data.somethingChanged||(e.getMyPrize(),e.getDrawChance(),e.getPandaList(),e.getShareNum())}wx.getStorage({key:"20220801joinPart",success:function(t){t.data!=a.data.userInfo.idvId?e.data.somethingChanged=!0:e.data.somethingChanged=!1,e.setData({ifjoin:!0,ifFriend:!0}),i(),e.getTaskList()},fail:function(){wx.request({url:e.data.apiUrl+"/w/mission/whetherPartActivity",data:{activityId:t.globalData.activityId2},header:{wxToken:e.data.wxToken},method:"GET",success:function(t){console.log(t.code),-10000900==t.data.code?e.setData({partNotStart:!0}):-10000901==t.data.code?e.setData({partEnd:!0}):200==t.data.code?(t.data.data.firstUse!=e.data.userInfo.idvId?e.data.somethingChanged=!0:e.data.somethingChanged=!1,e.setData({ifjoin:t.data.data.result}),t.data.data.result?(wx.setStorage({key:"20220801joinPart",data:t.data.data.firstUse,success:function(t){},fail:function(){},complete:function(){}}),e.setData({ifFriend:!0}),i()):e.getremarks()):wx.showToast({title:t.data.msg,icon:"none",duration:3e3}),e.getTaskList()}})},complete:function(){}})},joinPart:function(){var a=this;this.data.drawCardShake&&(a.setData({drawCardShake:!1}),wx.request({url:a.data.apiUrl+"/w/mission/insertActivity",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},method:"GET",success:function(t){200==t.data.code?(t.data.msg&&wx.showToast({title:"ç»‘å®šæˆåŠŸ",icon:"none",duration:2e3}),a.setData({tcbindPart:!a.data.tcbindPart,tcSubMsg:!0}),a.getUserJoinInfo()):wx.showToast({title:t.data.msg,icon:"none",duration:3e3}),setTimeout((function(){a.setData({drawCardShake:!0})}),1e3)}}))},judgeAll:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(console.log(a),this.data.partNotStart)wx.showToast({title:"æ´»åŠ¨æœªå¼€å§‹",icon:"none",duration:3e3});else if(this.data.partEnd&&1==a)wx.showToast({title:"æ´»åŠ¨å·²ç»“æŸ",icon:"none",duration:3e3});else if(this.data.userPhone)if(""!=this.data.userInfo.idvId&&this.data.userInfo.idvId)if(this.data.ifFriend)if(this.data.ifjoin){if(!this.data.somethingChanged)return this.setData({jall:!0}),!0;wx.showToast({title:"è¯·ç»‘å®šç¬¬ä¸€æ¬¡å‚ä¸çš„æ¸¸æˆid",icon:"none",duration:3e3})}else this.setData({tcbindPart:!this.data.tcbindPart});else this.getremarks((function(){t.data.ifFriend?t.judgeAll():t.setData({tcAddFriend:!t.data.tcAddFriend})}));else this.setData({tcbindid:!this.data.tcbindid});else this.getPhoneNumber()},handlerGobackClick:function(a){getCurrentPages().length>=2?wx.navigateBack({delta:a}):wx.redirectTo({url:t.globalData.pageIndex})},handlerGohomeClick:function(){2==this.data.pageCount?this.goPanda():wx.redirectTo({url:t.globalData.pageIndex})},getPandaGraffiti:function(){var a=this;a.judgeAll()&&a.data.drawCardShake&&(wx.reportEvent("panda_taskpandaframe_click",{}),a.data.kpcount>=12&&a.data.limitList.length>=4?(a.setData({drawCardShake:!1}),wx.request({url:a.data.apiUrl+"/w/lottery/prize/setQualifiedCard",data:{activityId:t.globalData.activityId2,card:"5"},header:{wxToken:a.data.wxToken},method:"GET",success:function(t){200==t.data.code?(t.data.data.panda&&(a.setData({tcxdty:!a.data.tcxdty}),wx.reportEvent("panda_frame_pop_pv",{})),t.data.data.frame&&(a.setData({tcHeadPic:!a.data.tcHeadPic}),wx.reportEvent("panda_panda_pop_pv",{})),a.getMyPrize(),a.setData({isPanda:!0})):wx.showToast({title:t.data.msg,icon:"none",duration:3e3}),setTimeout((function(){a.setData({drawCardShake:!0})}),1e3)}})):wx.showToast({title:"è¯·è§£é”å®Œ4å¼ é™å®šå¡åæ‰èƒ½é¢†å–å“¦",icon:"none",duration:3e3}))},changeifget:function(a){var e=this;if(e.judgeAll()){var i=a.currentTarget.dataset.index;switch(i){case 0:wx.reportEvent("panda_limitcard_click1",{});break;case 1:wx.reportEvent("panda_limitcard_click2",{});break;case 2:wx.reportEvent("panda_limitcard_click3",{});break;case 3:wx.reportEvent("panda_limitcard_click4",{})}var n=e.data.c;e.data.kpcount>=n[i].count?wx.request({url:e.data.apiUrl+"/w/lottery/prize/setQualifiedCard",data:{activityId:t.globalData.activityId2,card:i+1},header:{wxToken:e.data.wxToken},method:"GET",success:function(t){200==t.data.code?(wx.showToast({title:"è§£é”æˆåŠŸ",icon:"none",duration:3e3}),e.getQualifiedCard()):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}}):wx.showToast({title:"æ²¡æœ‰è¶³å¤Ÿçš„ç§‘æ™®å¡è§£é”è¯¥é™å®šå¡ç‰‡å“¦ï¼ï¼",icon:"none",duration:2e3})}},getQualifiedCard:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/lottery/prize/getQualifiedCard",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},method:"GET",success:function(t){if(200==t.data.code){var e=a.data.c;t.data.data.forEach((function(t){t<=4?e[t-1].ifGet=!0:5==t&&a.setData({isPanda:!0})})),a.setData({limitList:t.data.data,c:e})}else wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},handlePreview:function(t){var a=t.currentTarget.dataset.index,e=this.data.limitBigCard;e[a].showBigImg=!0,this.setData({limitBigCard:e,listIndex:a})},setWxmlToCanvas:function(){var t=this;t.setData({_canvasw:750,_canvasH:1500});var a=wx.createCanvasContext("mycanvas"),e=[{url:this.data.imgUrl+"/panda/share_bg3.jpg",w:750,h:1500,t:0,l:0},{url:this.data.imgUrl+"/panda/qrcode2.jpg",w:263,h:263,t:883,l:242},{url:this.data.userInfo.userAvatarUrl,w:91,h:91,t:1375,l:65},{url:this.data.imgUrl+"/panda/ic_zz.png",w:131,h:131,t:1355,l:45}],i=0,n=e.length;!function d(){if(n>i){var o=e[i];o.url?wx.getImageInfo({src:o.url,success:function(t){o.endUrl=t.path,i++,d()},fail:function(t){i++,d()}}):(i++,d())}else n==i&&(e.forEach((function(t,e){t.endUrl&&a.drawImage(t.endUrl,t.l,t.t,t.w,t.h)})),a.setFontSize(24),a.setFillStyle("#ffffff"),a.fillText("æˆ‘æ˜¯å…¨æœç¬¬".concat(t.data.shareNum,"ä¸ªå¤§ç†ŠçŒ«xå°ç†ŠçŒ«å…¬ç›ŠåŠ©åŠ›è€…ï¼Œ"),175,1412),a.fillText("ä¿æŠ¤ç†ŠçŒ«ï¼Œä»æˆ‘åšèµ·ï¼",175,1448),a.draw(!0,(function(a){setTimeout((function(){!function a(){wx.canvasToTempFilePath({canvasId:"mycanvas",fileType:"jpg",quality:.8,destWidth:750,destHeight:1500,success:function(a){t.setData({shareImgUrl:a.tempFilePath})},fail:function(t){setTimeout((function(){a()}),200)}})}()}),200)})))}()},closeBigImg:function(){var t=this.data,a=t.listIndex,e=t.limitBigCard;e[a].showBigImg=!1,this.setData({limitBigCard:e})},noneShow:function(){},friendHelp:function(){this.setData({pnbox:!0})},btnlazy:function(){var t=this,a=5,e=setInterval((function(){a>0?(t.setData({btntext:"("+a+"s)"}),a--):(t.setData({btntext:"",d:!1}),clearInterval(e))}),1e3)},drawcard:function(){var a=this;if(a.judgeAll()){if(wx.reportEvent("panda_draw_click",{}),a.data.drowRolls>0&&a.data.drawCardShake&&(a.setData({drawCardShake:!1}),wx.request({url:a.data.apiUrl+"/w/lottery/draw/panda/drawPrize",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},method:"POST",success:function(t){200==t.data.code?(a.getMyPrize(),a.getPandaList(),a.getDrawChance(),a.setData({d:!0,cardId:t.data.data.id-1,prizename:t.data.data.prizeName,tckpcard:!a.data.tckpcard}),wx.reportEvent("panda_kpcard_pop_pv",{}),a.btnlazy()):wx.showToast({title:t.data.msg,icon:"none",duration:3e3}),setTimeout((function(){a.setData({drawCardShake:!0})}),1e3)}})),a.data.drowRolls<=0&&a.data.kpcount<12){wx.getSystemInfoSync().windowHeight;var e=wx.createSelectorQuery(),i=0;return e.select(".drawTitle").boundingClientRect((function(t){i=t.top})).exec(),e.select(".cardTask").boundingClientRect((function(t){wx.pageScrollTo({scrollTop:t.top+t.height-i,duration:400})})).exec(),void wx.showToast({title:"ä½ çš„æŠ½å¡åˆ¸ä¸º0,\r\nè¯·å®Œæˆä¸‹æ–¹ä»»åŠ¡é¢†å–æŠ½å¡åˆ¸",icon:"none",duration:2e3})}if(a.data.kpcount>=12)return void wx.showToast({title:"æ‚¨å·²è·å¾—æ‰€æœ‰ç§‘æ™®å¡",icon:"none",duration:2e3})}},catGameId:function(){this.setData({bindUserVisible:!0,tcbindid:!1}),""!=this.data.userInfo.idvId&&this.data.userInfo.idvId?wx.reportEvent("panda_cut_click",{}):wx.reportEvent("panda_bindid_click",{})},closeTcbindid:function(){this.setData({tcbindid:!1})},handleBind:function(){this.setData({bindUserVisible:!1})},showPraize:function(){this.judgeAll(2)&&(this.setData({tcPrize:!this.data.tcPrize}),wx.reportEvent("panda_price_click",{}))},closePraize:function(){this.setData({tcPrize:!this.data.tcPrize})},showTcAddFriend:function(){this.setData({tcAddFriend:!this.data.tcAddFriend})},closeTcbindPart:function(){this.setData({tcbindPart:!this.data.tcbindPart})},addFriend:function(){this.setData({showAddfri:!this.data.showAddfri,tcAddFriend:!1}),wx.reportEvent("panda_qwposter_pop_pv",{})},showTitle:function(){this.setData({showremind:!this.data.showremind})},shareShow:function(){this.setData({showShare:!this.data.showShare}),wx.reportEvent("panda_partposter_pop_pv",{}),this.data.isDoTaskShare&&(this.data.isDoTaskShare=!1,wx.showToast({title:"ä»»åŠ¡å®Œæˆï¼ŒæŠ½å¥–åˆ¸+1",icon:"none",duration:2e3}))},tagQwFriend:function(){this.setData({longBag:!0})},showTcDrowcard:function(){this.setData({tcDrowcard:!this.data.tcDrowcard})},showTcToShop:function(){this.setData({tcToShop:!this.data.tcToShop})},showTcCardTask:function(){this.setData({tcCardTask:!this.data.tcCardTask})},showTcPanda_knowledge:function(){this.judgeAll(2)&&(this.setData({tcPanda_knowledge:!this.data.tcPanda_knowledge}),wx.reportEvent("panda_knowledge_pop_pv",{}),wx.reportEvent("panda_knowledge_click",{}))},getPandaList:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/lottery/prize/getPandaList",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},method:"GET",success:function(t){200==t.data.code?a.setData({kplist:t.data.data,kpcount:t.data.data.length}):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}})},showTckpcard:function(){wx.reportEvent("panda_takenow_click",{}),this.setData({tckpcard:!this.data.tckpcard,tcCoin:!this.data.tcCoin}),wx.reportEvent("panda_coin_pop_pv",{})},showTcCoin:function(){this.setData({tcCoin:!this.data.tcCoin})},showTcHeadPic:function(){wx.reportEvent("panda_takeframe_click",{}),this.setData({tcHeadPic:!this.data.tcHeadPic})},showTcxdty:function(){wx.reportEvent("panda_takepanda_click",{}),this.setData({tcxdty:!this.data.tcxdty})},preventTouchMove:function(){},showimg:function(t){var a=t.target.dataset.index,e=this.data.kplist[a]-1;this.setData({cardId:e,bigkpcard:!this.data.bigkpcard})},closeBigCard:function(){this.setData({bigkpcard:!this.data.bigkpcard})},colsetc:function(){this.setData({tcHelp:!this.data.tcHelp})},helpIf:function(){return this.data.userPhone?this.data.userInfo.userAvatarUrl&&this.data.userInfo.wxName?!(""==this.data.userInfo.idvId||!this.data.userInfo.idvId)||(this.setData({tcHelp:!0,helpBindGame:!0}),void wx.reportEvent("panda_bindid_pop_pv",{})):void this.getUserProfile():void this.getPhoneNumber()},helpNow:function(){var a=this,e=a.data.userInfo;if(a.helpIf()){if(wx.reportEvent("panda_helpnow_click",{}),a.data.info.uid==e.id)return a.setData({tcHelp:!0,helpSelf:!0}),void wx.reportEvent("panda_helpmyself_pop_pv",{});if(a.data.userHelpInfo.userList.length>=3)return a.setData({tcHelp:!0,helplimit:!0}),void wx.reportEvent("panda_helplimit_pop_pv",{});if(a.data.userHelpInfo2.userList.length>=3)return void a.setData({tcHelp:!0,helpFull:!0});wx.request({url:a.data.apiUrl+"/w/lottery/activity/help",data:{activityId:t.globalData.activityId2,beHelpId:a.data.info.uid},header:{wxToken:a.data.wxToken},success:function(t){t.data.data;200==t.data.code?a.setData({tcHelp:!0,helpready:!0}):wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})}},goPanda:function(){wx.reportEvent("panda_takeparttoo_click",{}),this.setData({pageCount:1}),this.getdata()},getTaskList:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/mission/taskList",data:{activityId:t.globalData.activityId2},header:{wxToken:a.data.wxToken},success:function(t){t.data.data;200==t.data.code?(a.data.somethingChanged&&t.data.data.forEach((function(t,a){t.status=0})),t.data.data.forEach((function(t,a){switch(a){case 0:console.log(a,t),1==t.status?wx.reportEvent("panda_taskshare_gray_pv",{}):2==t.status&&wx.reportEvent("panda_taskshare_end_pv",{});break;case 1:1==t.status?wx.reportEvent("panda_taskfind_gray_pv",{}):2==t.status&&wx.reportEvent("panda_taskfind_end_pv",{});break;case 2:1==t.status?wx.reportEvent("panda_tasktosharerecord_gray_pv",{}):2==t.status&&wx.reportEvent("panda_tasktosharerecord_end_pv",{})}})),a.setData({taskList:t.data.data}),null!=a.data.haveWorkTodo&&a.doWork()):wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})},doWork:function(a){var e=this,i=a?parseInt(a.currentTarget.dataset.index):null,n=a?a.currentTarget.dataset.task:null;if(!this.judgeAll())return e.data.haveWorkTodo=i,e.data.haveWorkTodoTaskId=n,!1;switch(null!=e.data.haveWorkTodo&&(i=e.data.haveWorkTodo,n=e.data.haveWorkTodoTaskId,e.data.haveWorkTodo=null,e.data.canGetVs=!0),i){case 0:e.data.userInfo.userAvatarUrl&&e.data.userInfo.wxName?this.data.showShare?wx.request({url:e.data.apiUrl+"/w/mission/doTask",data:{taskId:e.data.taskList[0].id,activityId:t.globalData.activityId2},header:{wxToken:e.data.wxToken},success:function(t){200==t.data.code?(e.getTaskList(),e.getDrawChance(),e.data.isDoTaskShare=!0):wx.showToast({title:t.data.msg,icon:"none",duration:3e3})}}):(wx.reportEvent("panda_taskshare_click",{}),this.shareShow(),wx.showToast({title:"é•¿æŒ‰å›¾ç‰‡åˆ†äº«ç»™å¥½å‹å§~",icon:"none",duration:3e3})):this.getUserProfile();break;case 1:wx.reportEvent("panda_taskfind_click",{}),e.data.canGetVs&&(e.data.canGetVs=!1,wx.request({url:e.data.apiUrl+"/w/mission/selectDataPlay",data:{taskId:n,activityId:t.globalData.activityId2},header:{wxToken:e.data.wxToken},success:function(t){200==t.data.code?t.data.data.flag?t.data.data.flag&&(wx.showToast({title:"ä»»åŠ¡å®Œæˆï¼ŒæŠ½å¥–åˆ¸+1",icon:"none",duration:2e3}),e.getTaskList(),e.getDrawChance()):wx.showToast({title:"ä»Šå¤©å°šæœªè¿›è¡Œå¯¹å±€ï¼Œå¿«æ‰“å¼€æ¸¸æˆç©ä¸€æŠŠå§ï½",icon:"none",duration:2e3}):wx.showToast({title:t.data.msg,icon:"none",duration:2e3}),setTimeout((function(){e.data.canGetVs=!0}),1e3)}}));break;case 2:wx.reportEvent("panda_tasktosharerecord_click",{}),console.log(this.data.refreshTaskList,"refreshTaskList"),wx.navigateTo({url:"/pages/vsrecord/index?task="+n}),this.data.refreshTaskList=!0}},handleShoppingMall:function(t){this.data.userInfo.userAvatarUrl&&this.data.userInfo.wxName?this.data.userInfo.idvId&&""!=this.data.userInfo.idvId?(wx.reportEvent("panda_shop_click",{}),wx.navigateTo({url:"/pages_user/pages/saishi/dh/index"})):this.setData({bindUserVisible:!this.data.bindUserVisible}):this.getUserProfile()},helpBtn:function(){this.judgeAll()},getUserProfile:function(a){var e=this;wx.getUserProfile({desc:"ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™",success:function(a){wx.request({url:e.data.apiUrl+"/w/epro/wechatuser/mine/bdWxName",data:{wxName:a.userInfo.nickName,userAvatarUrl:a.userInfo.avatarUrl},method:"POST",header:{wxToken:e.data.wxToken,"Content-Type":"application/x-www-form-urlencoded"},success:function(a){t.reGetUserInfo((function(t){e.setData({userInfo:t}),e.setWxmlToCanvas()}))}})}})},judgeHead:function(){this.judgeAll()&&(this.data.userInfo.userAvatarUrl&&this.data.userInfo.wxName||this.getUserProfile())},getAward:function(){var a=this.judgeAll(),e=this;a&&(wx.reportEvent("panda_getcoin5_click",{}),e.data.userHelpInfo.hadPrize?wx.showToast({title:"å·²é¢†å–ï¼Œä¸èƒ½é‡å¤é¢†å–",icon:"none",duration:2e3}):e.data.drawCardShake&&(e.setData({drawCardShake:!1}),wx.request({url:e.data.apiUrl+"/w/lottery/activity/acceptPrize",data:{activityId:t.globalData.activityId2},header:{wxToken:e.data.wxToken},success:function(t){200==t.data.code?(e.getMyPrize(),e.gethelpInfo(e.data.userInfo.id),wx.showToast({title:"é¢†å–æˆåŠŸ",icon:"none",duration:3e3})):wx.showToast({title:t.data.msg,icon:"none",duration:2e3}),setTimeout((function(){e.setData({drawCardShake:!0})}),1e3)}})))},bindCol:function(t){this.getdata()},subscribeMsg:function(){var t=this,a="rziIrEMaSy5-bHcO3FaUu8ewPldLq6bGoeH7FQEBX60";wx.requestSubscribeMessage({tmplIds:[a],success:function(e){"accept"==e[a]&&(wx.reportEvent("panda_subscribe_sums",{}),wx.request({url:t.data.apiUrl+"/w/subscribe/subscribe",data:{type:3,always:!1,idvId:t.data.userInfo.idvId},header:{wxToken:t.data.wxToken},method:"POST",success:function(t){200==t.data.code||wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}}))},fail:function(){},complete:function(){t.setData({tcSubMsg:!1})}})},closeTcSubMag:function(){this.setData({tcSubMsg:!this.data.tcSubMsg})},handleCustomReject:function(){this.getdata()},onReady:function(){var t=this.selectComponent("#navBar");this.setData({nbHeight:t.data.navBarExtendHeight+t.data.navBarHeight});var a=wx.getSystemInfoSync().windowHeight,e=this;wx.createSelectorQuery().select(".cardSm").boundingClientRect((function(t){e.setData({height_xd:t.top-a})})).exec(),wx.createSelectorQuery().select(".headBox").boundingClientRect((function(t){e.setData({height_help:t.top-a})})).exec()},onShow:function(){this.data.longBag&&(wx.showToast({title:"æ·»åŠ å¥½å‹ç³»ç»Ÿå¯èƒ½å­˜åœ¨å»¶è¿Ÿ,è¯·ä¸€åˆ†é’Ÿåå†å°è¯•æŠ½å¡",icon:"none",duration:3e3}),this.getremarks()),this.data.refreshTaskList&&(this.data.refreshTaskList=!1,this.getTaskList(),this.getDrawChance())},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(t){return"button"==t.from&&(t.target.dataset.btntype&&1==t.target.dataset.btntype?wx.reportEvent("panda_invitehelp_click",{}):t.target.dataset.btntype&&2==t.target.dataset.btntype&&wx.reportEvent("panda_invitehelp_click2",{})),{title:"button"==t.from?"æ‹¿åˆ°é™å®šæ¶‚é¸¦å°±å·®ä½ çš„åŠ©åŠ›å•¦ï¼":"ç‚¹å‡»ğŸ‘‡ğŸ‘‡é¢†[é™å®šæ¶‚é¸¦]",imageUrl:"button"==t.from?a+"/panda/shareex_2.jpg":a+"/panda/share3.png",path:"button"==t.from?"pages_user/pages/panda/panda?count=2&uid="+this.data.userInfo.id+"&userHead="+this.data.userInfo.userAvatarUrl+"&sharetype=2":"pages_user/pages/panda/panda?sharetype=1",success:function(t){},fail:function(){},complete:function(){}}},onPageScroll:function(t){if(2!=this.data.pageCount&&this.data.ifjoin&&!this.data.somethingChanged&&t.scrollTop>=this.data.height_xd&&this.data.scroll_xd&&(this.getQualifiedCard(),this.setData({scroll_xd:!1})),2!=this.data.pageCount&&t.scrollTop>=this.data.height_help&&this.data.scroll_help){var a=!(!this.data.userInfo.idvId||!this.data.ifFriend||!this.data.ifjoin||this.data.somethingChanged);this.setData({scroll_help:!1,jall:a})}},onTabItemTap:function(t){}});