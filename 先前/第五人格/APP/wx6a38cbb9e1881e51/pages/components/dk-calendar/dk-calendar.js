Component({properties:{originActiveData:{type:Array,value:""},size:{type:String,value:""}},data:{week:["日","一","二","三","四","五","六"],row1:[],row2:[],row3:[],currDay:0,currDayDetail:"",chooseYear:"",chooseMonth:"",currDayTag:0,currYear:"",currMonth:"",activeData:[],isNext:!0,isPre:!0},methods:{preDate:function(){if(this.data.isPre){var t=this.data.chooseMonth,a=this.data.chooseYear;0==--t&&(a--,t=12),console.log(this.data.chooseMonth),this.setData({chooseMonth:t,chooseYear:a}),this.getInit(),this.triggerEvent("preShow",{chooseYear:this.data.chooseYear,chooseMonth:this.data.chooseMonth})}},nextDate:function(){if(this.data.isNext){var t=this.data.chooseMonth,a=this.data.chooseYear;++t>12&&(a++,t=1),this.setData({chooseMonth:t,chooseYear:a}),this.getInit(),this.triggerEvent("nextShow",{chooseYear:this.data.chooseYear,chooseMonth:this.data.chooseMonth})}},checkedDate:function(){var t=this.data.chooseYear,a=this.data.chooseMonth,e=this.data.currYear,o=this.data.currMonth;2021==t&&1==a?this.setData({isPre:!1}):this.setData({isPre:!0}),t==e&&a==o?this.setData({isNext:!1}):this.setData({isNext:!0})},goDateDK:function(){wx.showToast({title:"跳转其他页面"})},getCurrDayTotal:function(t,a){return new Date(t,a,0).getDate()},getInitSm:function(){var t=(new Date).getDate(),a=(new Date).getFullYear(),e=(new Date).getMonth()+1,o=this.getCurrDayTotal(a,e),h=(new Date).getDay(),s=[],i=[],c=[];s.push(this.data.week[h]),i.push(t),c.push("".concat(a,"/").concat(e<10?"0"+e:e,"/").concat(t<10?"0"+t:t));for(var n=h,r=t,D=a,u=e,d=0;d<3;d++){if(r--,--n<0&&(n=this.data.week.length-1),r<1)0==--u&&(u=12,D--),r=new Date(D,u,0).getDate();s.unshift(this.data.week[n]),i.unshift(r),c.unshift("".concat(D,"/").concat(u<10?"0"+u:u,"/").concat(r<10?"0"+r:r))}n=h,r=t,D=a,u=e;for(var g=0;g<3;g++)++n>6&&(n=0),++r>o&&(r=1,13==++u&&(u=1,D++)),s.push(this.data.week[n]),i.push(r),c.push("".concat(D,"/").concat(u<10?"0"+u:u,"/").concat(r<10?"0"+r:r));for(var l=[],M=!1,f=0;f<c.length;f++){M=!1;for(var w=0;w<this.data.activeData.length;w++)c[f]==this.data.activeData[w]&&(M=!0);l[f]=!!M}console.log(l,"-----row3"),this.setData({row1:s,row2:i,row3:l,currDay:t})},getInit:function(){var t,a,e="".concat(this.data.chooseYear,"/").concat(this.data.chooseMonth,"/01"),o=(new Date).getDate(),h=new Date(e).getFullYear(),s=new Date(e).getMonth()+1,i=this.getCurrDayTotal(h,s),c=new Date("".concat(this.data.chooseYear,"/").concat(this.data.chooseMonth,"/01")).getDay(),n=[],r=[];t=this.data.week;for(var D=1;D<=i;D++)n.push(D);for(var u=1;u<c+1;u++)n.unshift("");a=o+c;for(var d=0;d<n.length;d++){var g=!1;if(n[d]){for(var l=0;l<this.data.activeData.length;l++){"".concat(this.data.chooseYear,"/").concat(this.data.chooseMonth<10?"0"+this.data.chooseMonth:this.data.chooseMonth,"/").concat(n[d]<10?"0"+n[d]:n[d])==this.data.activeData[l]&&(g=!0)}g?r.push(!0):r.push(!1)}else r.push(!1)}this.setData({row1:t,row2:n,currDayTag:a,row3:r}),this.data.currDay||this.setData({currDay:o,currDayDetail:"".concat(this.data.chooseYear,"/").concat(this.data.chooseMonth<10?"0"+this.data.chooseMonth:this.data.chooseMonth,"/").concat(o<10?"0"+o:o)}),this.checkedDate()},changeCurrDay:function(t){var a=t.currentTarget.dataset.day,e=!t.currentTarget.dataset.click;if(console.log(a,e),a&&e){if("m"==this.data.size)if(a>(new Date).getDate()){var o=this.data.chooseMonth-1,h=this.data.chooseYear;0==o?this.setData({chooseYear:h-1,chooseMonth:12}):this.setData({chooseMonth:o})}var s="".concat(this.data.chooseYear,"/").concat(this.data.chooseMonth<10?"0"+this.data.chooseMonth:this.data.chooseMonth,"/").concat(a<10?"0"+a:a),i="".concat(this.data.chooseYear,"-").concat(this.data.chooseMonth<10?"0"+this.data.chooseMonth:this.data.chooseMonth,"-").concat(a<10?"0"+a:a);this.triggerEvent("selectDate",{currDayDetail:i}),this.setData({currDay:a,currDayDetail:s})}},getFormatDate:function(t){return[(t=new Date(t)).getFullYear(),t.getMonth()+1,t.getDate()].map((function(t){return(t=t.toString())[1]?t:"0"+t})).join("/")},init:function(){this.updateDate(),console.log("选中日期:",this.data.activeData),this.setData({currYear:(new Date).getFullYear(),chooseYear:(new Date).getFullYear(),currMonth:(new Date).getMonth()+1,chooseMonth:(new Date).getMonth()+1}),"m"==this.data.size?this.getInitSm():this.getInit()},updateDate:function(){var t=this,a=[];this.data.originActiveData.map((function(e){a.push(t.getFormatDate(e))})),this.setData({activeData:a}),t.getInit()}},lifetimes:{attached:function(){this.init()},detached:function(){}},observers:{originActiveData:function(t,a){this.updateDate()}}});