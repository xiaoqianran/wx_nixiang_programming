var isOutRange = (function (x1,y1,x2,y2,x3,y3){return(x1 < 0 || x1 >= y1 || x2 < 0 || x2 >= y2 || x3 < 0 || x3 >= y3)});var sortCore = (function (sKey,eKey,st){var _ = st.baseData;var excludeFix = (function (cKey,type){if (st.list[((nt_0=(cKey),null==nt_0?undefined:'number'=== typeof nt_0?nt_0:""+nt_0))].fixed){type ? --cKey:++cKey;return(excludeFix(cKey,type))};return(cKey)});var endRealKey = -1;st.list.forEach((function (item){if (item.sortKey === eKey)endRealKey = item.realKey;}));return(st.list.map((function (item){if (item.fixed)return(item);;var cKey = item.sortKey;var rKey = item.realKey;if (sKey < eKey){if (cKey > sKey && cKey <= eKey){--rKey;cKey = excludeFix(--cKey,true)} else if (cKey === sKey){rKey = endRealKey;cKey = eKey}} else if (sKey > eKey){if (cKey >= eKey && cKey < sKey){++rKey;cKey = excludeFix(++cKey,false)} else if (cKey === sKey){rKey = endRealKey;cKey = eKey}};if (item.sortKey !== cKey){item.tranX = (cKey % _.columns) * 100 + "%";item.tranY = Math.floor(cKey / _.columns) * 100 + "%";item.sortKey = cKey;item.realKey = rKey};return(item)})))});var triggerCustomEvent = (function (list,type,ins){var _list = [];var listData = [];list.forEach((function (item){_list[((nt_1=(item.sortKey),null==nt_1?undefined:'number'=== typeof nt_1?nt_1:""+nt_1))] = item}));_list.forEach((function (item){if (!item.extraNode){listData.push(item.data)}}));ins.triggerEvent(type,({listData:listData,}))});var longPress = (function (event,ownerInstance){var ins = event.instance;var st = ownerInstance.getState();var _ = st.baseData;var sTouch = event.changedTouches[(0)];if (!sTouch)return;;st.cur = ins.getDataset().index;var item = st.list[((nt_3=(st.cur),null==nt_3?undefined:'number'=== typeof nt_3?nt_3:""+nt_3))];if (item && item.fixed)return;;if (st.dragging)return;;st.dragging = true;ownerInstance.callMethod("drag",({dragging:true,}));st.tranX = _.columns === 1 ? 0:sTouch.pageX - (_.itemWidth / 2 + _.wrapLeft);st.tranY = sTouch.pageY - (_.itemHeight / 2 + _.wrapTop);st.sId = sTouch.identifier;ins.setStyle(({'transform':'translate3d(' + st.tranX + 'px, ' + st.tranY + 'px, 0)',}));st.itemsInstance.forEach((function (item,index){item.removeClass("tran").removeClass("cur");item.addClass(index === st.cur ? "cur":"tran")}));ownerInstance.callMethod("vibrate")});var touchMove = (function (event,ownerInstance){var ins = event.instance;var st = ownerInstance.getState();var _ = st.baseData;var mTouch = event.changedTouches[(0)];if (!mTouch)return;;if (!st.dragging)return;;if (st.sId !== mTouch.identifier)return;;var tranX = _.columns === 1 ? 0:mTouch.pageX - (_.itemWidth / 2 + _.wrapLeft);var tranY = mTouch.pageY - (_.itemHeight / 2 + _.wrapTop);if (mTouch.clientY > _.windowHeight - _.itemHeight - _.realBottomSize){ownerInstance.callMethod("pageScroll",({scrollTop:mTouch.pageY + _.itemHeight - (_.windowHeight - _.realBottomSize),}))} else if (mTouch.clientY < _.itemHeight + _.realTopSize){ownerInstance.callMethod("pageScroll",({scrollTop:mTouch.pageY - _.itemHeight - _.realTopSize,}))};ins.setStyle(({'transform':'translate3d(' + tranX + 'px, ' + tranY + 'px, 0)',}));var startKey = st.list[((nt_5=(st.cur),null==nt_5?undefined:'number'=== typeof nt_5?nt_5:""+nt_5))].sortKey;var curX = Math.round(tranX / _.itemWidth);var curY = Math.round(tranY / _.itemHeight);var endKey = curX + _.columns * curY;var item = st.list[((nt_6=(endKey),null==nt_6?undefined:'number'=== typeof nt_6?nt_6:""+nt_6))];if (item && item.fixed)return;;if (isOutRange(curX,_.columns,curY,_.rows,endKey,st.list.length))return;;if (startKey === endKey || startKey === st.preStartKey)return;;st.preStartKey = startKey;var list = sortCore(startKey,endKey,st);st.itemsInstance.forEach((function (itemIns,index){var item = list[((nt_7=(index),null==nt_7?undefined:'number'=== typeof nt_7?nt_7:""+nt_7))];if (index !== st.cur){itemIns.setStyle(({'transform':'translate3d(' + item.tranX + ',' + item.tranY + ', 0)',}))}}));ownerInstance.callMethod("vibrate");ownerInstance.callMethod("listChange",({list:list,}));triggerCustomEvent(list,"change",ownerInstance)});var touchEnd = (function (event,ownerInstance){var ins = event.instance;var st = ownerInstance.getState();if (!st.dragging)return;;triggerCustomEvent(st.list,"sortend",ownerInstance);ins.addClass("tran");ins.setStyle(({'transform':'translate3d(' + st.list[((nt_8=(st.cur),null==nt_8?undefined:'number'=== typeof nt_8?nt_8:""+nt_8))].tranX + ',' + st.list[((nt_9=(st.cur),null==nt_9?undefined:'number'=== typeof nt_9?nt_9:""+nt_9))].tranY + ', 0)',}));st.preStartKey = -1;st.dragging = false;ownerInstance.callMethod("drag",({dragging:false,}));st.cur = -1;st.tranX = 0;st.tranY = 0});var baseDataObserver = (function (newVal,oldVal,ownerInstance,ins){var st = ownerInstance.getState();st.baseData = newVal});var listObserver = (function (newVal,oldVal,ownerInstance,ins){var st = ownerInstance.getState();st.itemsInstance = ownerInstance.selectAllComponents('.item');st.list = newVal || [];st.list.forEach((function (item,index){var itemIns = st.itemsInstance[((nt_10=(index),null==nt_10?undefined:'number'=== typeof nt_10?nt_10:""+nt_10))];if (item && itemIns){itemIns.setStyle(({'transform':'translate3d(' + item.tranX + ',' + item.tranY + ', 0)',}));if (item.fixed)itemIns.addClass("fixed");}}))});module.exports = ({longPress:longPress,touchMove:touchMove,touchEnd:touchEnd,baseDataObserver:baseDataObserver,listObserver:listObserver,});