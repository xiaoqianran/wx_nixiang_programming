var t=require("../../@babel/runtime/helpers/interopRequireWildcard").default,a=require("../../@babel/runtime/helpers/slicedToArray"),e=require("../../@babel/runtime/helpers/toConsumableArray"),i=require("../../@babel/runtime/helpers/objectSpread2"),n=require("../../@babel/runtime/helpers/defineProperty"),r=t(require("../components/ec-canvas/echarts")),s=require("../common/const"),o=getApp(),l="https://nie.res.netease.com/id5/m/zt/20201215094138/data",d=require("../../utils/util"),u=(d.encrypt,d.decrypt,require("../../utils/level.js"));Page({data:n(n(n(n(n({imgUrl:o.globalData.imgUrl,apiUrl:o.globalData.apiUrl,wxToken:o.globalData.wxToken,isSurvi:!1,swpIndex:0,swpEasyIndex:0,showTips:!1,shareTipsStatus:!1,array:["当前赛季","全部赛季"],arrayVal1:"当前赛季",arrayVal2:"全部赛季",arrayVal3:"全部赛季",array2:[{name:"全部比赛",mode:"-"},{name:"排位模式",mode:"2,10"},{name:"匹配模式",mode:"1"},{name:"联合狩猎",mode:"8,9"},{name:"娱乐模式",mode:"11,12,13,14,18,19"},{name:"标准模式",mode:"1,2"}],array2Index:0,_canvasw:0,_canvasH:0,showCanvas:!1,caHeadImg:[],caImg:[{url:l+"/vsrecord/bg2.jpg",w:750,h:586,t:0,l:0},{url:l+"/user/test_ic.png",w:100,h:100,t:32,l:36},{url:l+"/vsrecord/in_bg5.png",w:673,h:376,t:166,l:39},{w:733,h:219,t:675,l:9},{w:733,h:63,t:914,l:9},{w:733,h:579,t:977,l:9},{w:733,h:30,t:1556,l:9},{w:733,h:57,t:170,l:15},{w:94,h:95,t:284,l:510},{w:94,h:95,t:284,l:620},{w:94,h:95,t:442,l:510},{w:94,h:95,t:442,l:620},{url:l+"/vsrecord/ic/q1.png",w:142,h:142,t:279,l:92,unus:!0},{url:l+"/vsrecord/ic/j1.png",w:142,h:142,t:279,l:92,unus:!0},{url:l+"/vsrecord/ic/w1.png",w:106,h:106,t:302,l:322,unus:!0},{url:l+"/vsrecord/ic1_3.png",w:26,h:24,t:502,l:72},{w:705,h:7,t:730,l:24},{w:705,h:7,t:970,l:24},{w:687,h:93,t:1054,l:32,unus:!0},{w:138,h:33,t:1068,l:122,unus:!0},{w:109,h:80,t:1062,l:485,unus:!0},{w:109,h:80,t:1062,l:485,unus:!0},{w:51,h:39,t:279,l:330},{url:"",w:168,h:168,t:-4,l:4},{url:l+"/vsrecord/ic/q_x.png",w:22,h:24,t:456,l:163,unus:!0},{url:l+"/vsrecord/ic/j_x.png",w:22,h:24,t:456,l:163,unus:!0},{url:l+"/vsrecord/ic/w_x.png",w:22,h:24,t:448,l:375,unus:!0},{url:l+"/vsrecord/ic/q_x2.png",w:30,h:30,t:458,l:130,unus:!0},{url:l+"/vsrecord/ic/j_x2.png",w:30,h:30,t:458,l:130,unus:!0},{url:l+"/vsrecord/mvp2.png",w:82,h:35,t:30,l:11,unus:!0},{url:l+"/icon.png",w:105,h:105,t:0,l:627,unus:!0},{url:l+"/vsrecord/icon-win.png",w:107,h:34,t:870,l:270,unus:!0},{url:l+"/vsrecord/icon8.png",w:141,h:41,t:870,l:270,unus:!0},{url:l+"/vsrecord/icon-radar.png",w:180,h:207,t:251,l:416,unus:!0},{w:430,h:270,t:221,l:292,unus:!0},{w:430,h:270,t:221,l:292,unus:!0},{url:l+"/vsrecord/in_bg5_i.png",w:589,h:126,t:294,l:84,unus:!0},{unus:!0},{unus:!0},{unus:!0}],caText:[{text:"",size:32,color:"#32292d",align:"left",l:172,t:62},{text:"ID：",size:24,color:"#32292d",align:"left",l:172,t:122},{text:"当前赛季",size:18,color:"#ffe4c4",align:"left",l:90,t:194},{text:"对战数：398",size:20,color:"#3d3d3d",align:"right",l:670,t:304,unus:!0},{text:"全场最佳：398",size:20,color:"#3d3d3d",align:"right",l:670,t:340,unus:!0},{size:18,color:"#3d3d3d",align:"center",l:556,t:398,unus:!0},{size:18,color:"#3d3d3d",align:"center",l:666,t:398,unus:!0},{text:"得赞数：398",size:20,color:"#3d3d3d",align:"right",l:670,t:391,unus:!0},{text:"人品值：398",size:20,color:"#3d3d3d",align:"right",l:670,t:423,unus:!0},{size:18,color:"#3d3d3d",align:"center",l:556,t:557},{size:18,color:"#3d3d3d",align:"center",l:666,t:557},{text:"求生者段位",size:24,color:"#2d1d10",align:"center",l:168,t:252,unus:!0},{size:24,color:"#2d1d10",align:"center",l:256,t:267},{size:24,color:"#2d1d10",align:"center",l:416,t:267},{text:"胜率：40%",size:20,color:"#3d3d3d",align:"left",l:86,t:422,unus:!0},{text:"胜场数：26",size:20,color:"#3d3d3d",align:"left",l:86,t:390,unus:!0},{text:"总局数：81",size:20,color:"#3d3d3d",align:"left",l:86,t:304,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:422,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:390,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:304,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:422,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:390,unus:!0},{size:20,color:"#3d3d3d",align:"left",l:86,t:304,unus:!0},{text:"赛季段位",size:22,color:"#e3d7c9",align:"left",l:106,t:524},{text:"最近常玩",size:28,color:"#000000",align:"left",l:30,t:634},{text:"游戏对局",size:28,color:"#000000",align:"left",l:30,t:898},{text:"",size:24,color:"#6d6d6d",align:"left",l:156,t:898},{text:"",size:20,color:"#363636",align:"center",l:163,t:450,unus:!0},{text:"",size:24,color:"#fff",align:"center",l:163,t:450,unus:!0},{text:"",size:24,color:"#fff",align:"center",l:375,t:440,unus:!0}],caReadyImg:[],promiseList:[],promiseList2:[],promiseList3:[],imgbuilded:!1,bindPopShow:!1,user:null,gameId:"",userRecord:[],userRecordUse:[],jgMvp:0,qsMvp:0,hideBindClose:!0,numberChangeQs:0,numberChangeJg:0,codeImg:null,lastUseList:[],canvasQrcode:null,liansheng:null,lianbai:null,pinju:null,loaded:0,detOrEasy:0,popZxShow:!1,firstBindUser:!1,bindUserVisible:!1,ec:{disableTouch:!0,lazyLoad:!0},ec2:null,cWidth:0,leidaDate1:[],leidaDate2:[],leidaDate3:[],leidaDate4:[],ind:[{name:"场均演绎分",max:10298},{name:"场均牵制时间",max:109.1},{name:"场均破译进度",max:157.75},{name:"场均治疗次数",max:.66},{name:"场均救人次数",max:.83},{name:"逃生率",max:48.44}],ind2:[{name:"场均演绎分",max:13153},{name:"场均击倒次数",max:9.06},{name:"场均破坏板子次数",max:3.19},{name:"场均淘汰人数",max:2.26},{name:"场均恐惧震慑次数",max:.83},{name:"四抓率",max:40.63}],pixelRatio:0,messageTipGif:!1,messageTipGifUrl:"".concat(o.globalData.imgUrl,"/vsrecord/message_subscription-wechat.gif"),userCivPvpPart:null,userButPvpPart:null,identity:!1,userPlayerrecord:null,dataType:!0,userSevenRecord:null,userPlayerStatis:null,checkRoleFlag:!1},"array",["近7天","近30场"]),"arrayValTime","近7天"),"array3",s.rolesOptions),"arrayValRole","求生者"),"bindVisibleDialog",!1),onLoad:function(t){var a=this;a.setData({taskId:(null==t?void 0:t.task)||"",wxToken:o.globalData.wxToken}),a.data.wxToken?a.getData():o.initOkCallback=function(t){a.setData({wxToken:o.globalData.wxToken}),a.getData()},this.setData({cWidth:wx.getSystemInfoSync().windowWidth}),wx.reportEvent("vsrecord_index",{}),a.getDpr(),"develop"!=o.globalData.envVersion&&"trial"!=o.globalData.envVersion||this.setData({canShowDev:!0})},getDpr:function(){var t=this;wx.getSystemInfo({success:function(a){t.data.pixelRatio=a.pixelRatio},fail:function(){pixelRatio=0}})},newSize:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:750;return t*(this.data.cWidth/a)},initRadar:function(t,a){},initRadar1:function(t,a){var e=this,i=this,s=this.selectComponent("#lchart1");s.init((function(o,l,d){var u=r.init(o,null,{width:l,height:d,devicePixelRatio:e.data.pixelRatio}),c={legend:{selectedMode:!1},radar:n(n(n(n(n({center:["50%","50%"],radius:e.newSize(95),splitNumber:1,axisTick:{show:!1},axisLabel:{show:!1},splitLine:{show:!1},axisLine:{show:!1,lineStyle:{color:"#000000"}},splitArea:{show:!1}},"splitLine",{show:!1,lineStyle:{width:1,color:"#a0654b"}}),"name",{textStyle:{fontSize:e.newSize(14),color:"#2d1d10"}}),"nameGap",e.newSize(15)),"indicator",a),"triggerEvent",!1),series:[{name:"rq",type:"radar",symbol:"circle",symbolSize:e.newSize(4),itemStyle:{normal:{color:"#ffffff",opacity:.5,lineStyle:{width:0}}},areaStyle:{color:"#ffd646",opacity:.5},data:[{value:t}]}]};return u.setOption(c),e.chart1=u,u.on("finished",(function(){s.canvasToTempFilePath({x:0,y:0,destWidth:1720,destHeight:1080,success:function(t){i.data.caImg[34].endUrl=t.tempFilePath,console.log(t.tempFilePath)}})})),u}))},initRadar2:function(t,a){},initRadar3:function(t,a){var e=this,i=this,s=this.selectComponent("#lchart3");s.init((function(o,l,d){var u=r.init(o,null,{width:l,height:d,devicePixelRatio:e.data.pixelRatio}),c={legend:{selectedMode:!1},radar:n(n(n(n(n({center:["50%","50%"],radius:e.newSize(95),splitNumber:1,axisTick:{show:!1},axisLabel:{show:!1},splitLine:{show:!1},axisLine:{show:!1,lineStyle:{color:"#000000"}},splitArea:{show:!1}},"splitLine",{show:!1,lineStyle:{width:1,color:"#a0654b"}}),"name",{textStyle:{fontSize:e.newSize(14),color:"#2d1d10"}}),"nameGap",e.newSize(15)),"indicator",a),"triggerEvent",!1),series:[{name:"rq",type:"radar",symbol:"circle",symbolSize:e.newSize(4),itemStyle:{normal:{color:"#ffffff",opacity:.5,lineStyle:{width:0}}},areaStyle:{color:"#ffd646",opacity:.5},data:[{value:t}]}]};return u.setOption(c),e.chart3=u,u.on("finished",(function(){s.canvasToTempFilePath({x:0,y:0,destWidth:1720,destHeight:1080,success:function(t){i.data.caImg[35].endUrl=t.tempFilePath,console.log(t.tempFilePath)}})})),u}))},getcdnPath:function(){var t=this;t.data.promiseList=new Promise((function(a,e){var i=0,n=t.data.caImg.length;!function e(){if(n>i){var r=t.data.caImg[i];r.url?wx.getImageInfo({src:r.url,success:function(t){r.endUrl=t.path,i++,e()},fail:function(t){console.log("错误-res",t,r,i),i++,e()}}):(i++,e())}else n==i&&a()}()}))},createNewImg:function(){var t,a=this,e=this.data.caImg,i=this.data.caHeadImg,n=this.data.lastUseList,r=this.data.caText,s=a.data.userRecordUse.length>10?10:a.data.userRecordUse.length;r[26].text=a.data.array2[a.data.array2Index].name;t=131*s+922+190,a.setData({_canvasw:750,_canvasH:t}),setTimeout((function(){var o=wx.createCanvasContext("mycanvas");if(o.font="ls",e[5].h=70+131*s,e[6].t=921+131*s-30,o.setFillStyle("#fff"),o.fillRect(0,0,750,t),e.forEach((function(t,a){t.unus||t.endUrl&&o.drawImage(t.endUrl,t.l,t.t,t.w,t.h),2==a&&(o.setFillStyle("#a0654b"),o.fillRect(t.l+32,t.t-7,110,56)),13==a&&(o.setFillStyle("#c9c9c9"),o.fillRect(0,856,750,1),o.fillRect(30,918,690,1),o.fillRect(0,665,750,1))})),a.data.liansheng>1){var l=a.data.liansheng.toString().length;o.drawImage(e[31].endUrl,e[31].l,e[31].t,e[31].w+40*l,e[31].h),o.setTextAlign("left"),o.setFontSize(40),o.setFillStyle("#fff9d0"),o.fillText(a.data.liansheng,e[31].l-4,e[31].t+32),o.setFontSize(20),o.setFillStyle("#ffffff"),o.fillText("连胜",e[31].l+22*l,e[31].t+24)}else a.data.pinju>1&&o.drawImage(e[32].endUrl,e[32].l,e[32].t,e[32].w,e[31].h);r.forEach((function(t,e){t.text&&!t.unus&&(2==e&&(t.text=a.data.arrayVal1),o.setFontSize(t.size),o.setTextAlign(t.align),o.setFillStyle(t.color),o.fillText(t.text,t.l,t.t))}));n.forEach((function(t,a){a<6&&(t.endUrl&&o.drawImage(t.endUrl,30+118*a,693,100,100),o.beginPath(),o.setLineWidth(22),o.arc(30+118*a+50,743,62,0,2*Math.PI),o.setStrokeStyle("#fff"),o.stroke())})),n.forEach((function(t,a){a<6&&(o.beginPath(),o.setLineWidth(1),o.arc(30+118*a+50,743,50,0,2*Math.PI),o.setStrokeStyle("#564036"),o.stroke(),o.setFontSize(24),o.setFillStyle("#000000"),o.setTextAlign("center"),o.fillText(t.heroIdValue,30+118*a+50,828))}));i.forEach((function(t,n){var r=a.data.userRecordUse[n],s=921+131*n;if(o.beginPath(),o.setStrokeStyle("#9d866a"),o.setLineJoin("round"),o.setLineWidth(1),o.moveTo(30,921+131*n+28),o.lineTo(30,995+131*n+28),o.lineTo(103,995+131*n+28),o.lineTo(103,921+131*n+28),o.lineTo(30,921+131*n+28),o.stroke(),i[n].endUrl&&o.drawImage(i[n].endUrl,31,s+29,72,72),r.ismvp){var l=580-30*r.selfResultValue.length;o.drawImage(e[29].endUrl,l,s+e[29].t,e[29].w,e[29].h)}o.setFontSize(30),o.setTextAlign("right"),o.setFillStyle("#927966"),o.fillText(r.selfResultValue,666,s+58),o.setFontSize(20),o.setTextAlign("right"),o.setFillStyle("#bbbbbb"),o.fillText(r.showTime,666,s+96),o.setFontSize(24),o.setTextAlign("left"),o.setFillStyle("#000000"),o.fillText("总分 "+r.score,138,s+98),o.setFontSize(34),"失败"==r.teamResultValue?o.setFillStyle("#cb5a45"):"平局"==r.teamResultValue?o.setFillStyle("#313131"):o.setFillStyle("#527ad1"),o.fillText(r.teamResultValue,138,s+56),o.setFontSize(20),o.setFillStyle("#000000"),o.fillText(r.battleModeValue,214,s+60),o.setFillStyle("#cfcfcf"),o.fillRect(30,s+131,690,1)}));var d=a.data.user,u=a.data.userEx;if(0==a.data.swpEasyIndex){var c=d.civ_pvp_part_xing;if(o.beginPath(),o.arc(163,350,71,0,2*Math.PI),o.setFillStyle("#cfa991"),o.fill(),o.setFontSize(24),o.setTextAlign("center"),o.setFillStyle("#3f210a"),"当前赛季"==a.data.arrayVal1?(o.fillText("当前赛季排位表现",507,212),o.drawImage(e[12].endUrl,e[12].l,e[12].t,e[12].w,e[12].h),o.setFillStyle("#000"),o.fillText(r[27].text,r[27].l,r[27].t)):(o.fillText("所有赛季排位表现",507,212),c=u.civ_toppart_xing,o.drawImage(e[38].endUrl,e[12].l,e[12].t,e[12].w,e[12].h),o.setFillStyle("#000"),o.fillText(u.civ_toppart_duanWei+u.civ_toppart_jie,r[27].l,r[27].t)),o.setStrokeStyle("#a0654b"),o.beginPath(),o.moveTo(280,194),o.lineTo(280,478),o.stroke(),o.setFontSize(24),o.setTextAlign("left"),o.setFillStyle("#3d3d3d"),o.drawImage(e[33].endUrl,e[33].l,e[33].t,e[33].w,e[33].h),o.drawImage(e[34].endUrl,e[34].l,e[34].t,e[34].w,e[34].h),o.setTextAlign("center"),o.setFillStyle("#363636"),o.fillText(r[11].text,r[11].l,r[11].t),d.civ_pvp_part_duan<7)for(var _=12*c,p=0;p<c;p++)o.drawImage(e[24].endUrl,e[24].l+24*p-_,e[24].t,e[24].w,e[24].h);else d.civ_pvp_part_duan>6&&(o.drawImage(e[27].endUrl,e[27].l,e[27].t,e[27].w,e[27].h),o.setFontSize("22"),o.setTextAlign("left"),o.setFillStyle("#3f210a"),o.fillText("x"+c,164,480))}else if(1==a.data.swpEasyIndex){var h=d.but_pvp_part_xing;if(o.beginPath(),o.arc(163,350,71,0,2*Math.PI),o.setFillStyle("#cfa991"),o.fill(),o.setFontSize(24),o.setTextAlign("center"),o.setFillStyle("#3f210a"),"当前赛季"==a.data.arrayVal1?(o.fillText("当前赛季排位表现",507,212),o.drawImage(e[13].endUrl,e[13].l,e[13].t,e[13].w,e[13].h),o.setFillStyle("#000"),o.fillText(r[28].text,r[28].l,r[28].t)):(o.fillText("所有赛季排位表现",507,212),h=u.but_toppart_xing,o.drawImage(e[37].endUrl,e[12].l,e[12].t,e[12].w,e[12].h),o.setFillStyle("#000"),o.fillText(u.but_toppart_duanWei+u.but_toppart_jie,r[27].l,r[27].t)),o.setStrokeStyle("#a0654b"),o.beginPath(),o.moveTo(280,194),o.lineTo(280,478),o.stroke(),o.setFontSize(24),o.setTextAlign("left"),o.setFillStyle("#3d3d3d"),o.drawImage(e[33].endUrl,e[33].l,e[33].t,e[33].w,e[33].h),o.drawImage(e[35].endUrl,e[35].l,e[35].t,e[35].w,e[35].h),o.setTextAlign("center"),o.setFillStyle("#363636"),o.fillText(r[11].text,r[11].l,r[11].t),d.but_pvp_part_duan<7){var g=12*h;for(p=0;p<h;p++)o.drawImage(e[25].endUrl,e[25].l+24*p-g,e[25].t,e[25].w,e[25].h)}else d.but_pvp_part_duan>6&&(o.drawImage(e[28].endUrl,e[28].l,e[28].t,e[28].w,e[28].h),o.setFontSize("22"),o.setTextAlign("left"),o.setFillStyle("#3f210a"),o.fillText("x"+h,164,480))}else if(2==a.data.swpEasyIndex){var v=d.five_pvp_part_xing;"当前赛季"!=a.data.arrayVal1&&(v=u.five_toppart_xing);var f=12*v;for(p=0;p<v;p++)o.drawImage(e[26].endUrl,e[26].l+24*p-f,e[26].t,e[26].w,e[26].h);o.drawImage(e[36].endUrl,e[36].l,e[36].t,e[36].w,e[36].h),o.setFontSize(20),o.setTextAlign("right"),o.setFillStyle("#3d3d3d"),o.fillText(r[7].text,r[7].l,r[7].t),o.fillText(r[8].text,r[8].l,r[8].t),o.fillText(r[3].text,r[3].l,r[3].t),o.fillText(r[4].text,r[4].l,r[4].t),o.setTextAlign("left"),"当前赛季"==a.data.arrayVal1?(o.fillText(r[20].text,r[20].l,r[20].t),o.fillText(r[21].text,r[21].l,r[21].t),o.fillText(r[22].text,r[22].l,r[22].t),o.drawImage(e[14].endUrl,e[14].l,e[14].t,e[14].w,e[14].h),o.setTextAlign("center"),o.setFillStyle("#363636"),o.fillText(r[29].text,r[29].l,r[29].t)):(o.fillText("胜率："+d.five_total_win_rate,r[20].l,r[20].t),o.fillText("胜场数："+d.five_total_win_num,r[21].l,r[21].t),o.fillText("总局数："+d.five_total_battle_num,r[22].l,r[22].t),o.drawImage(e[39].endUrl,e[14].l,e[14].t,e[14].w,e[14].h),o.setTextAlign("center"),o.setFillStyle("#363636"),o.fillText(u.five_toppart_duanWei+u.five_toppart_jie,r[29].l,r[29].t)),o.setFontSize(24),o.setFillStyle("#2d1d10"),o.fillText(r[11].text,375,212)}o.setFontSize("26"),o.setTextAlign("left"),o.setFillStyle("#000000"),o.fillText("查战绩，就上网易第五人格",196,e[6].t+101),o.setFontSize("20"),o.setTextAlign("left"),o.setFillStyle("#695f53"),o.fillText("扫描二维码，绑定角色即可查看战绩和",196,e[6].t+153),o.fillText("定制专属图鉴",196,e[6].t+183),o.drawImage(e[30].endUrl,e[30].l,e[6].t+80,e[30].w,e[30].h),console.log("canvasQrcode",a.data.canvasQrcode),a.data.canvasQrcode&&o.drawImage(a.data.canvasQrcode,15,e[6].t+50,160,160),o.draw(!0,(function(e){console.log(e),setTimeout((function(){!function e(){wx.canvasToTempFilePath({canvasId:"mycanvas",fileType:"jpg",quality:.8,destWidth:750,destHeight:t,success:function(t){var e=t.tempFilePath;wx.hideLoading(),a.data.imgbuilded||wx.showModal({title:"提示",content:"将生成的海报保存到手机相册，可以发送给微信好友或分享到朋友圈",success:function(t){(t.cancel||t.confirm)&&wx.showToast({title:"长按屏幕可保存生成的海报",icon:"none",duration:3e3})}}),a.setData({loadImagePath:e,imgbuilded:!0})},fail:function(t){console.log(t),setTimeout((function(){e()}),200)}})}()}),2e3)}))}),200)},getData:function(){this.data.loaded=0,this.setData({isLoading:!0}),wx.showLoading({title:"加载中"}),this.getGameUserInfo()},getSysInfo:function(){var t=this;wx.request({url:t.data.apiUrl+"/w/lottery/activity/query",header:{wxToken:t.data.wxToken},success:function(a){console.log(a,"活动列表"),200==a.data.code&&wx.request({url:t.data.apiUrl+"/w/mission/setDrawStatus",header:{wxToken:t.data.wxToken},data:{activityId:a.data.data[0].id,taskId:"5f26a49803e911eda72a0242ac110003"},success:function(t){console.log(t,"战绩已分享")}})}}),wx.reportEvent("vsrecord_share",{}),t.data.taskId&&wx.request({url:t.data.apiUrl+"/w/mission/doTask",data:{taskId:t.data.taskId,activityId:o.globalData.activityId2},header:{wxToken:t.data.wxToken},success:function(a){200==a.data.code?(t.data.taskId=null,t.data.isDotask=!0,wx.setStorage({key:"refreshTaskList",data:!0})):wx.showToast({title:a.data.msg,icon:"none",duration:3e3})}}),this.data.gameId?this.getDingyue((function(){wx.showLoading({title:"图片生成中"}),t.getImginfo(),t.setData({showCanvas:!0})})):wx.showToast({title:"请先绑定角色",icon:"none",duration:3e3})},getDingyue:function(t){var a,e=this,i=this;o.globalData.vsrecordMsgUsed?t&&t():o.getUserSetting((function(n){var r=!1;"accept"===n.subscriptionsSetting["sB-3QWLaTa-JnKsnkGMj6Utcostt2hCjOTGwQFEzmbo"]?(console.log("总是订阅了该条订阅消息"),r=!0):(e.setData({messageTipGif:!0}),a=setInterval((function(){e.setData({messageTipGifUrl:"".concat(o.globalData.imgUrl,"/vsrecord/message_subscription-wechat.gif?time=").concat(Date.now())})}),5e3));var s="sB-3QWLaTa-JnKsnkGMj6Utcostt2hCjOTGwQFEzmbo";wx.requestSubscribeMessage({tmplIds:[s],success:function(t){console.log("requestSubscribeMessage__success",t),o.getUserSetting((function(t){"accept"===t.subscriptionsSetting[s]&&(console.log("总是订阅了该条订阅消息"),r=!0),wx.request({url:i.data.apiUrl+"/w/subscribe/subscribe",data:{type:1,idvId:o.globalData.userInfo.idvId,always:r},method:"POST",header:{wxToken:i.data.wxToken},success:function(t){wx.reportEvent("vsrecord_message_success",{}),200==t.data.code?console.log("subscribe/subscribe成功"):console.log(t.data.msg)}})}))},fail:function(t){console.log(t,"订阅失败")},complete:function(i){t&&t(),o.globalData.vsrecordMsgUsed=!0,wx.reportEvent("vsrecord_message_touch",{}),a&&(e.setData({messageTipGif:!1}),clearInterval(a),a=null)}})}))},canvasHide:function(){this.setData({loadImagePath:"",showCanvas:!1}),wx.hideLoading(),this.data.isDotask&&this.handlerGobackClick()},getImginfo:function(){var t=this;Promise.all([t.data.promiseList,t.data.promiseList2,t.data.promiseList3]).then((function(a){t.createNewImg()}))},handleBindFirst:function(){this.setData({firstBindUser:!0,showTips:!1})},handleDefine:function(){this.setData({showTips:!0})},saveCode:function(){var t=this;wx.saveImageToPhotosAlbum({filePath:t.data.loadImagePath,success:function(a){wx.showToast({title:"已保存到相册",icon:"success",duration:3e3}),t.canvasHide()},fail:function(t){console.log("err",t),"saveImageToPhotosAlbum:fail:auth denied"!==t.errMsg&&"saveImageToPhotosAlbum:fail auth deny"!==t.errMsg&&"saveImageToPhotosAlbum:fail authorize no response"!==t.errMsg||wx.showModal({title:"提示",content:"需要您授权保存相册",showCancel:!1,success:function(t){wx.openSetting({success:function(t){console.log("settingdata",t),t.authSetting["scope.writePhotosAlbum"]?wx.showModal({title:"提示",content:"获取权限成功,再次长按图片即可保存",showCancel:!1}):wx.showModal({title:"提示",content:"获取权限失败，将无法保存到相册哦~",showCancel:!1})},fail:function(t){console.log("failData",t)},complete:function(t){console.log("finishData",t)}})}})}})},getGameUserInfo:function(){var t=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/userinfo",data:{wxToken:t.data.wxToken},header:{wxToken:t.data.wxToken},success:function(a){if(200===a.data.code){a.data.data;"该账号暂未绑定游戏角色！"==a.data.msg||null==a.data.data.idvId?(t.setData({isLoading:!1}),wx.hideLoading()):200==a.data.code?(t.setData({gameId:a.data.data.idvId}),t.data.caText[1].text="ID："+a.data.data.idvId,wx.getStorage({key:"vsTipsShow_20220224",success:function(t){},fail:function(a){wx.setStorage({key:"vsTipsShow_20220224",data:!0}),t.data.firstBindUser||t.setData({showTips:!0})}}),t.getUser(),t.getUserEx(),t.getRecord(),t.searchScoreChange(),t.getQrcode()):wx.showToast({title:a.data.msg,icon:"none",duration:2e3})}}})},getQrcode:function(){var t=this;wx.getImageInfo({src:"https://dwxcx.fp.ps.netease.com/file/62496f270c02f75337872cf7Zukhck0t04",success:function(a){t.data.canvasQrcode=a.path},fail:function(t){console.log("错误-res",t,res.data.msg)}})},getUser:function(){var t=this;function a(a){var e=i({},a);e.role_id=e.role_id.substring(5),e&&(e.civ_pvp_part_duan=parseInt(e.civ_pvp_part.split("_")[0]),e.civ_pvp_part_jie=t.convert(parseInt(-1==e.civ_pvp_part.split("_")[1]?0:e.civ_pvp_part.split("_")[1])),e.civ_pvp_part_jie_num=parseInt(e.civ_pvp_part.split("_")[1]),e.civ_pvp_part_xing=parseInt(e.civ_pvp_part.split("_")[2]),e.civ_pvp_part_duan<7?e.civ_pvp_part_duanWei=t.NoToChinese(e.civ_pvp_part_duan)+"阶":7==e.civ_pvp_part_duan&&(e.civ_pvp_part_xing>=25?(e.civ_pvp_part_duan=8,e.civ_pvp_part_duanWei="巅峰七阶"):e.civ_pvp_part_duanWei="七阶"),-1==e.civ_win_rate&&(e.civ_win_rate=0),-1==e.civ_total_win_rate&&(e.civ_total_win_rate=0),-1==e.but_win_rate&&(e.but_win_rate=0),-1==e.but_total_win_rate&&(e.but_total_win_rate=0),-1==e.five_win_rate&&(e.five_win_rate=0),-1==e.five_total_win_rate&&(e.five_total_win_rate=0),-1==e.civ_win_num&&(e.civ_win_num=0),-1==e.civ_battle_num&&(e.civ_battle_num=0),-1==e.but_win_num&&(e.but_win_num=0),-1==e.but_battle_num&&(e.but_battle_num=0),-1==e.five_win_num&&(e.five_win_num=0),-1==e.five_battle_num&&(e.five_battle_num=0),-1==e.civ_total_win_num&&(e.civ_total_win_num=0),-1==e.civ_total_battle_num&&(e.civ_total_battle_num=0),-1==e.but_total_win_num&&(e.but_total_win_num=0),-1==e.but_total_battle_num&&(e.but_total_battle_num=0),-1==e.five_total_win_num&&(e.five_total_win_num=0),-1==e.five_total_battle_num&&(e.five_total_battle_num=0),e.civ_win_rate=Math.round(1e3*e.civ_win_rate)/10+"%",e.civ_total_win_rate=Math.round(1e3*e.civ_total_win_rate)/10+"%",e.but_pvp_part_duan=parseInt(e.but_pvp_part.split("_")[0]),e.but_pvp_part_jie=t.convert(parseInt(-1==e.but_pvp_part.split("_")[1]?0:e.but_pvp_part.split("_")[1])),e.but_pvp_part_jie_num=parseInt(e.but_pvp_part.split("_")[1]),e.but_pvp_part_xing=parseInt(e.but_pvp_part.split("_")[2]),e.but_pvp_part_duan<7?e.but_pvp_part_duanWei=t.NoToChinese(e.but_pvp_part_duan)+"阶":7==e.but_pvp_part_duan&&(console.log("巅峰",e),e.but_pvp_part_xing>=25?(e.but_pvp_part_duan=8,e.but_pvp_part_duanWei="巅峰七阶"):e.but_pvp_part_duanWei="七阶"),e.but_win_rate=Math.round(1e3*e.but_win_rate)/10+"%",e.but_total_win_rate=Math.round(1e3*e.but_total_win_rate)/10+"%",e.five_pvp_part_duan=parseInt(e.five_pvp_part.split("_")[0]),e.five_pvp_part_jie=t.convert(parseInt(-1==e.five_pvp_part.split("_")[1]?0:e.five_pvp_part.split("_")[1])),e.five_pvp_part_xing=parseInt(e.five_pvp_part.split("_")[2]),e.five_pvp_part_duanWei=t.NoToChinese(e.five_pvp_part_duan)+"阶",e.five_win_rate=Math.round(1e3*e.five_win_rate)/10+"%",e.five_total_win_rate=Math.round(1e3*e.five_total_win_rate)/10+"%",e.headimg=t.data.imgUrl+"/greed"+(-1!=e.use_portrait?e.use_portrait_path:"/face_common/fs_0005.png"),e.headcover=t.data.imgUrl+"/greed"+(-1!=e.use_frame?e.user_frame_path:"/face_cover/fc_0001.png"),t.data.caText[0].text=e.role_name,t.data.caText[3].text="对战数: "+e.battle_num,t.data.caText[4].text="全场最佳: "+e.mvp,t.data.caText[7].text="得赞数: "+e.praise,t.data.caText[8].text="人品值: "+e.credit,t.data.caText[14].text="胜率："+e.civ_win_rate,t.data.caText[15].text="胜场数："+e.civ_win_num,t.data.caText[16].text="总局数："+e.civ_battle_num,t.data.caText[17].text="胜率："+e.but_win_rate,t.data.caText[18].text="胜场数："+e.but_win_num,t.data.caText[19].text="总局数："+e.but_battle_num,t.data.caText[20].text="胜率："+e.five_win_rate,t.data.caText[21].text="胜场数："+e.five_win_num,t.data.caText[22].text="总局数："+e.five_battle_num,t.data.caText[27].text=e.civ_pvp_part_duanWei+e.civ_pvp_part_jie,t.data.caText[28].text=e.but_pvp_part_duanWei+e.but_pvp_part_jie,t.data.caText[29].text=e.five_pvp_part_duanWei+e.five_pvp_part_jie,t.data.caImg[1].url=e.headimg,t.data.caImg[23].url=e.headcover,t.data.caImg[12].url=t.data.imgUrl+"/vsrecord/ic/q"+e.civ_pvp_part_duan+".png",t.data.caImg[13].url=t.data.imgUrl+"/vsrecord/ic/j"+e.but_pvp_part_duan+".png",t.data.caImg[14].url=t.data.imgUrl+"/vsrecord/ic/w"+e.five_pvp_part_duan+".png",t.setData({user:e}),t.data.userEx&&(t.getcdnPath(),console.log("user:getcdnPath"))),t.data.loaded++,t.canShowIndex()}o.globalData.userPlayerStatis?(console.log("已经有了"),a(o.globalData.userPlayerStatis)):(o.userPlayerStatisOver=function(e){console.log("还没有这个, 现在有了"),"err"===e?(t.setData({isLoading:!1}),wx.hideLoading()):a(e)},o.getPlayerStatis()),this.getPlayerrecord(),this.getSevenRecord()},getUserEx:function(){var t=this;function a(a){var n,r,s=i({},a);("-1_-1"!=s.but_toppart&&"-1_-1_-1"!=s.but_toppart||(s.but_toppart="1_3_0"),"-1_-1"!=s.civ_toppart&&"-1_-1_-1"!=s.civ_toppart||(s.civ_toppart="1_3_0"),"-1_-1_-1"==s.five_toppart&&(s.five_toppart="1_3_0"),s.but_toppart_duan=parseInt(s.but_toppart.split("_")[0]),s.but_toppart_jie=t.convert(parseInt(-1==s.but_toppart.split("_")[1]?0:s.but_toppart.split("_")[1])),s.but_toppart_jie_num=parseInt(s.but_toppart.split("_")[1]),s.but_toppart_xing=parseInt(s.but_toppart.split("_")[2]),s.but_toppart_duan<7?s.but_toppart_duanWei=t.NoToChinese(s.but_toppart_duan)+"阶":7==s.but_toppart_duan&&(s.but_toppart_xing>=25?(s.but_toppart_duan=8,s.but_toppart_duanWei="巅峰七阶"):s.but_toppart_duanWei="七阶"),s.civ_toppart_duan=parseInt(s.civ_toppart.split("_")[0]),s.civ_toppart_jie=t.convert(parseInt(-1==s.civ_toppart.split("_")[1]?0:s.civ_toppart.split("_")[1])),s.civ_toppart_jie_num=parseInt(s.civ_toppart.split("_")[1]),s.civ_toppart_xing=parseInt(s.civ_toppart.split("_")[2]),s.civ_toppart_duan<7?s.civ_toppart_duanWei=t.NoToChinese(s.civ_toppart_duan)+"阶":7==s.civ_toppart_duan&&(s.civ_toppart_xing>=25?(s.civ_toppart_duan=8,s.civ_toppart_duanWei="巅峰七阶"):s.civ_toppart_duanWei="七阶"),s.five_toppart_duan=parseInt(s.five_toppart.split("_")[0]),s.five_toppart_jie=t.convert(parseInt(-1==s.five_toppart.split("_")[1]?0:s.five_toppart.split("_")[1])),s.five_toppart_xing=parseInt(s.five_toppart.split("_")[2]),s.five_toppart_duanWei=t.NoToChinese(s.five_toppart_duan)+"阶",t.data.caImg[38].url=t.data.imgUrl+"/vsrecord/ic/q"+s.civ_toppart_duan+".png",t.data.caImg[37].url=t.data.imgUrl+"/vsrecord/ic/j"+s.but_toppart_duan+".png",t.data.caImg[39].url=t.data.imgUrl+"/vsrecord/ic/w"+s.five_toppart_duan+".png",s.saiji_killall_rate=Math.round(1e3*s.saiji_killall_rate)/10+"%",s.saiji_escape_rate=Math.round(1e3*s.saiji_escape_rate)/10+"%",s.total_killall_rate=Math.round(1e3*s.total_killall_rate)/10+"%",s.total_escape_rate=Math.round(1e3*s.total_escape_rate)/10+"%",s.saiji_avg_tease=Math.round(10*s.saiji_avg_tease)/10+"s",s.total_avg_tease=Math.round(10*s.total_avg_tease)/10+"s",s.total_tease=Math.round(s.total_tease/60/60*10)/10+"h",s.saiji_tease=Math.round(s.saiji_tease/60/60*10)/10+"h",s.but_saiji_avg_score=Math.round(s.but_saiji_avg_score),s.civ_saiji_avg_score=Math.round(s.civ_saiji_avg_score),s.saiji_avg_break_board=Math.round(10*s.saiji_avg_break_board)/10,s.saiji_avg_attack_down=Math.round(10*s.saiji_avg_attack_down)/10,s.saiji_avg_terror_shock=Math.round(10*s.saiji_avg_terror_shock)/10,s.total_fix=Math.round(s.total_fix/100),s.saiji_fix=Math.round(s.saiji_fix/100),s.saiji_avg_fix=10*Math.round(s.saiji_avg_fix/10)+"%",s.saiji_avg_kill=Math.round(10*s.saiji_avg_kill)/10,s.saiji_avg_save=Math.round(10*s.saiji_avg_save)/10,s.civ_total_avg_score=Math.round(s.civ_total_avg_score),s.but_total_avg_score=Math.round(s.but_total_avg_score),s.total_avg_fix=10*Math.round(s.total_avg_fix/10)+"%",s.total_avg_save=Math.round(10*s.total_avg_save)/10,s.total_avg_break_board=Math.round(10*s.total_avg_break_board)/10,s.total_avg_attack_down=Math.round(10*s.total_avg_attack_down)/10,s.total_avg_terror_shock=Math.round(10*s.total_avg_terror_shock)/10,s.total_avg_kill=Math.round(10*s.total_avg_kill)/10,s.herolist=[],s.but_total_hero_list)&&(n=s.herolist).push.apply(n,e(s.but_total_hero_list));s.civ_total_hero_list&&(r=s.herolist).push.apply(r,e(s.civ_total_hero_list));s.but_saiji_hero_list&&s.but_saiji_hero_list,s.civ_saiji_hero_list&&s.but_saiji_hero_list,s.dev_max_badeg&&-1!==s.dev_max_badeg.badge?t.setData({badgeTop:s.dev_max_badeg.badge,badgeName:s.dev_max_badeg.hero_name,badgeCard:s.dev_max_badeg.card}):t.setData({badgeTop:null,badgeName:null,badgeCard:null}),t.setData({userEx:s}),t.data.user&&(t.getcdnPath(),console.log("userEx:getcdnPath")),t.data.loaded++,t.canShowIndex(),t.getRadar(i({},a))}o.globalData.userRecord?a(o.globalData.userRecord):(o.userRecordOver=function(e){console.log("还没有这个, 现在有了"),t.data.loaded++,t.canShowIndex(),a(o.globalData.userRecord)},o.getUserRecord())},getRadar:function(t){var a=this.data.userEx,e=this.data.ind,i=this.data.ind2,n=[Math.round(t.civ_saiji_avg_score)>e[0].max?e[0].max:Math.round(t.civ_saiji_avg_score),Math.round(10*t.saiji_avg_tease)/10>e[1].max?e[1].max:Math.round(10*t.saiji_avg_tease)/10,Math.round(100*t.saiji_avg_fix)/100>e[2].max?e[2].max:Math.round(100*t.saiji_avg_fix)/100,Math.round(a.saiji_cure/this.data.user.civ_total_battle_num*1e4)/100>e[3].max?e[3].max:Math.round(a.saiji_cure/this.data.user.civ_total_battle_num*1e4)/100,Math.round(100*t.saiji_avg_save)/100>e[4].max?e[4].max:Math.round(100*t.saiji_avg_save)/100,Math.round(1e4*t.saiji_escape_rate)/100>e[5].max?e[5].max:Math.round(1e4*t.saiji_escape_rate)/100],r=[Math.round(t.civ_total_avg_score)>e[0].max?e[0].max:Math.round(t.civ_total_avg_score),Math.round(10*t.total_avg_tease)/10>e[1].max?e[1].max:Math.round(10*t.total_avg_tease)/10,Math.round(100*t.total_avg_fix)/100>e[2].max?e[2].max:Math.round(100*t.total_avg_fix)/100,Math.round(a.total_cure/this.data.user.civ_total_battle_num*1e4)/100>e[3].max?e[3].max:Math.round(a.total_cure/this.data.user.civ_total_battle_num*1e4)/100,Math.round(100*t.total_avg_save)/100>e[4].max?e[4].max:Math.round(100*t.total_avg_save)/100,Math.round(1e4*t.total_escape_rate)/100>e[5].max?e[5].max:Math.round(1e4*t.total_escape_rate)/100],s=[Math.round(t.but_saiji_avg_score)>i[0].max?i[0].max:Math.round(t.but_saiji_avg_score),Math.round(100*t.saiji_avg_attack_down)/100>i[1].max?i[1].max:Math.round(100*t.saiji_avg_attack_down)/100,Math.round(100*t.saiji_avg_break_board)/100>i[2].max?i[2].max:Math.round(100*t.saiji_avg_break_board)/100,Math.round(100*t.saiji_avg_kill)/100>i[3].max?i[3].max:Math.round(100*t.saiji_avg_kill)/100,Math.round(100*t.saiji_avg_terror_shock)/100>i[4].max?i[4].max:Math.round(100*t.saiji_avg_terror_shock)/100,Math.round(1e4*t.saiji_killall_rate)/100>i[5].max?i[5].max:Math.round(1e4*t.saiji_killall_rate)/100],o=[Math.round(t.but_total_avg_score)>i[0].max?i[0].max:Math.round(t.but_total_avg_score),Math.round(100*t.total_avg_attack_down)/100>i[1].max?i[1].max:Math.round(100*t.total_avg_attack_down)/100,Math.round(100*t.total_avg_break_board)/100>i[2].max?i[2].max:Math.round(100*t.total_avg_break_board)/100,Math.round(100*t.total_avg_kill)/100>i[3].max?i[3].max:Math.round(100*t.total_avg_kill)/100,Math.round(100*t.total_avg_terror_shock)/100>i[4].max?i[4].max:Math.round(100*t.total_avg_terror_shock)/100,Math.round(1e4*t.total_killall_rate)/100>i[5].max?i[5].max:Math.round(1e4*t.total_killall_rate)/100];this.setData({leidaDate1:n,leidaDate2:r,leidaDate3:s,leidaDate4:o}),this.initRadar(this.data.leidaDate1,this.data.ind),this.initRadar2(this.data.leidaDate3,this.data.ind2)},compare:function(t){return function(a,e){var i=a[t];return e[t]-i}},getRecord:function(){var t=this,a=wx.getStorageSync("mine/playerrecord");if(a&&!o.ifTimeOut(a.et)&&a.envVersion==o.globalData.envVersion)return e(a.sj),!1;function e(a){if(200==a.data.code){var e=a.data.data,i=[],n=[],r=0,s=0,o=0,d=0,u=0,c=!0;null!=e?(e.forEach((function(t,a){var e=t.twhen.split(" "),_=e[0].split("-"),p=e[1].split(":");if(t.showTime=_[1]+"-"+_[2]+" "+p[0]+":"+p[1],"none"==t.selfResultValue&&"五排"==t.battleModeValue&&(t.selfResultValue="五排"),"空军地勤"==t.heroIdValue&&(t.heroIdValue="空军"),a<10){var h={};h.url=l+"/vsrecord/headimg2/"+t.heroId+".jpg",i.push(h)}t.mvpScore=0,t.playerInfo&&(t.playerInfo=JSON.parse(t.playerInfo.replace(/\\/g,'"')),t.playerInfo.forEach((function(a,e){a.score>t.mvpScore&&(t.mvpScore=a.score)})),t.mvpScore==t.score&&(t.ismvp=!0,1==t.campId?s++:2==t.campId&&r++)),n.some((function(a){if(a.heroId==t.heroId)return!0}))||2!=t.battleMode&&10!=t.battleMode&&1!=t.battleMode||n.push(t),0==a?"失败"==t.teamResultValue?u++:"平局"==t.teamResultValue?d++:"胜利"==t.teamResultValue&&o++:c&&(u>0?"失败"==t.teamResultValue?u++:c=!1:d>0?"平局"==t.teamResultValue?d++:c=!1:o>0&&("胜利"==t.teamResultValue?o++:c=!1)),(1==t.battleMode||2==t.battleMode)&&""!=t.playerInfo&&t.playerInfo.length>1&&(t.canGoDetail=!0),"黑杰克"==t.battleModeValue&&"21点获胜"==t.selfResultValue&&(t.teamResultValue="胜利")})),t.setData({pinju:d,lianbai:u,liansheng:o})):(e=[],t.setData({pinju:0,lianbai:0,liansheng:0})),t.data.userRecord=e,t.data.caHeadImg=i,t.setData({userRecordUse:e,lastUseList:n,jgMvp:s,qsMvp:r})}else wx.showToast({title:a.data.msg,icon:"none",duration:2e3});t.data.loaded++,t.canShowIndex()}wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/playerrecord",data:{wxToken:t.data.wxToken,server:10001,roleId:t.data.gameId},success:function(t){200==t.data.code&&wx.setStorage({key:"mine/playerrecord",data:{et:(new Date).getTime(),sj:t,envVersion:o.globalData.envVersion}}),e(t)}})},goDetail:function(t){var a=this,e=a.data.userRecordUse[t.currentTarget.dataset.index];this.getDingyue((function(){e.canGoDetail&&(wx.setStorage({key:"vsdetail",data:a.data.userRecordUse[t.currentTarget.dataset.index]}),wx.navigateTo({url:"/pages/vsrecord/details?headimg="+a.data.user.headimg+"&gameId="+a.data.gameId}))}))},searchScoreChange:function(){var t=this,a=new Date,e=a.getMonth()+1;e=e<10?"0"+e.toString():e.toString();var i=a.getDate();i=i<10?"0"+i.toString():i.toString();var n=a.getFullYear().toString()+e+i,r=wx.getStorageSync("points/day");if(r&&!o.ifTimeOut(r.et)&&r.envVersion==o.globalData.envVersion)return s(r.sj),!1;function s(a){var e;if(200==a.data.code)if(""==a.data.data.data)t.setData({numberChangeQs:0,numberChangeJg:0});else{var i=a.data&&a.data.data&&a.data.data.data&&a.data.data.data[0]&&a.data.data.data[0].data_list?a.data.data.data[0].data_list:[],n=0,r=0;i.forEach((function(t,a){1==t.type?r+=parseInt(t.count):2==t.type&&(n+=parseInt(t.count))})),t.setData({numberChangeQs:n,numberChangeJg:r})}else-1===(null===(e=a.data.msg)||void 0===e?void 0:e.indexOf("你的手速太快"))&&wx.showToast({title:a.data.msg,icon:"none",duration:2e3});t.data.loaded++,t.canShowIndex()}wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/rank/points/day",data:{wxToken:t.data.wxToken,roleId:t.data.gameId,server:10001,dateId:n},success:function(t){200==t.data.code&&wx.setStorage({key:"points/day",data:{et:(new Date).getTime(),sj:t,envVersion:o.globalData.envVersion}}),s(t)}})},canShowIndex:function(){4==this.data.loaded&&(this.setData({isLoading:!1}),wx.hideLoading())},banSurviCh:function(t){0==t.currentTarget.dataset.id?this.setData({isSurvi:!1}):this.setData({isSurvi:!0})},changeDetOrEasy:function(t){var a=t.currentTarget.dataset.type;this.setData({detOrEasy:0==this.data.detOrEasy?1:0,isSurvi:0!=a}),0==this.data.detOrEasy&&(0==this.data.swpEasyIndex?"当前赛季"==this.data.arrayVal1?this.initRadar(this.data.leidaDate1,this.data.ind):this.initRadar1(this.data.leidaDate2,this.data.ind):1==this.data.swpEasyIndex&&("当前赛季"==this.data.arrayVal1?this.initRadar2(this.data.leidaDate3,this.data.ind2):this.initRadar3(this.data.leidaDate4,this.data.ind2)))},swiperChange:function(t){var a=t.detail.current;this.data.swpIndex=a,wx.reportEvent("vsrecord_sjchange",{})},swiperEasyChange:function(t){var a=t.detail.current;this.data.swpEasyIndex=a,0==a?(this.data.caText[11].text="求生者段位","当前赛季"==this.data.arrayVal1?this.initRadar(this.data.leidaDate1,this.data.ind):this.initRadar1(this.data.leidaDate2,this.data.ind)):1==a?(this.data.caText[11].text="监管者段位","当前赛季"==this.data.arrayVal1?this.initRadar2(this.data.leidaDate3,this.data.ind2):this.initRadar3(this.data.leidaDate4,this.data.ind2)):2==a&&(this.data.caText[11].text="五排段位")},swpPrev:function(){this.data.swpIndex>0?this.setData({swpIndex:this.data.swpIndex-1}):0==this.data.swpIndex&&this.setData({swpIndex:2}),2==this.data.swpIndex&&wx.reportEvent("vsrecord_avgcard",{})},swpNext:function(){0==this.data.detOrEasy?this.data.swpEasyIndex<2?this.setData({swpEasyIndex:this.data.swpEasyIndex+1}):2==this.data.swpEasyIndex&&this.setData({swpEasyIndex:0}):(this.data.swpIndex<1?this.setData({swpIndex:this.data.swpIndex+1}):1==this.data.swpIndex&&this.setData({swpIndex:0}),2==this.data.swpIndex&&wx.reportEvent("vsrecord_avgcard",{}))},goRole:function(t){var a="监管";2==t.currentTarget.dataset.campid&&(a="求生"),wx.navigateTo({url:"/pages/vsrecord/role?now=true&heroId="+t.currentTarget.dataset.heroid+"&gameId="+this.data.gameId+"&zy="+a})},goRolelist:function(){this.data.gameId?(wx.reportEvent("vsrecord_allrole",{}),wx.navigateTo({url:"/pages/vsrecord/rolelist?gameId="+this.data.gameId})):wx.showToast({title:"请先绑定角色",icon:"none",duration:3e3})},goDetails:function(){wx.navigateTo({url:"/pages/vsrecord/details"})},goAsk:function(){wx.navigateTo({url:"/pages/ask/index"})},goActive:function(){wx.reportEvent("vsrecord_activerbanner",{}),wx.navigateTo({url:"/pages/active/znq/index"}),this.setData({popZxShow:!1}),this.data.gameId&&""!=this.data.gameId||this.setData({bindPopShow:!0,hideBindClose:!0})},handlerGobackClick:function(t){getCurrentPages().length>=2?wx.navigateBack({delta:t}):wx.redirectTo({url:o.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:o.globalData.pageIndex})},search:function(){wx.navigateTo({url:"../index/query?key="+this.data.queryKey})},bindPickerChange:function(t){1==t.currentTarget.dataset.id?(this.setData({arrayVal1:this.data.array[t.detail.value]}),0==this.data.swpEasyIndex?"当前赛季"==this.data.arrayVal1?this.initRadar(this.data.leidaDate1,this.data.ind):this.initRadar1(this.data.leidaDate2,this.data.ind):1==this.data.swpEasyIndex&&("当前赛季"==this.data.arrayVal1?this.initRadar2(this.data.leidaDate3,this.data.ind2):this.initRadar3(this.data.leidaDate4,this.data.ind2))):2==t.currentTarget.dataset.id?this.setData({arrayVal2:this.data.array[t.detail.value]}):3==t.currentTarget.dataset.id&&this.setData({arrayVal3:this.data.array[t.detail.value]}),wx.reportEvent("vsrecord_nowcom",{})},bindPickerComChange:function(t){var a=this,e=t.detail.value,i=a.data.array2[e].mode.split(","),n=[],r=0,s=0,o=0,d=!0;"-"==i[0]?a.data.userRecordUse=a.data.userRecord:(a.data.userRecordUse=[],a.data.userRecord.forEach((function(t,e){i.forEach((function(e,i){e==t.battleMode&&a.data.userRecordUse.push(t)}))}))),a.data.userRecordUse.forEach((function(t,a){if(a<10){var e={};e.url=l+"/vsrecord/headimg2/"+t.heroId+".jpg",n.push(e)}0==a?"失败"==t.teamResultValue?o++:"平局"==t.teamResultValue?s++:"胜利"==t.teamResultValue&&r++:d&&(o>0?"失败"==t.teamResultValue?o++:d=!1:s>0?"平局"==t.teamResultValue?s++:d=!1:r>0&&("胜利"==t.teamResultValue?r++:d=!1))})),a.data.promiseList2=new Promise((function(t,e){var i=0,r=n.length;console.log(2),function e(){if(r>i){var s=n[i];wx.getImageInfo({src:s.url,success:function(t){s.endUrl=t.path,i++,e()},fail:function(t){console.log("错误-res",t,s,i),i++,e()}})}else r==i&&(console.log("2加载完了"),a.data.caHeadImg=n,t())}()})),a.setData({array2Index:e,userRecordUse:a.data.userRecordUse,pinju:s,lianbai:o,liansheng:r})},myevent:function(t){this.setData({bindPopShow:t.detail.bindPopShow})},bindCol:function(t){this.setData({gameId:t.detail.gameId}),this.getData()},handleCustomReject:function(){this.data.gameId&&!o.globalData.userinfoApiStatus&&wx.redirectTo({url:o.globalData.pageIndex})},chBind:function(t){"develop"!=o.globalData.envVersion&&"trial"!=o.globalData.envVersion||(wx.reportEvent("vsrecord_changebind",{}),t.currentTarget.dataset.sbex?this.setData({sbex:t.currentTarget.dataset.sbex}):this.setData({sbex:!1}),this.setData({bindPopShow:!0,hideBindClose:!1,bindUserVisible:!1}))},handleToggleBind:function(){this.setData({checkRoleFlag:!0})},handleBind:function(t){t&&"true"===t.detail?this.setData({bindUserVisible:!1}):this.setData({bindUserVisible:!this.data.bindUserVisible})},NoToChinese:function(t){if(!/^\d*(\.\d*)?$/.test(t))return console.log("Number is wrong!"),"Number is wrong!";for(var a=new Array("零","一","二","三","四","五","六","七","八","九"),e=new Array("","十","百","千","万","亿","点",""),i=(""+t).replace(/(^0*)/g,"").split("."),n=0,r="",s=i[0].length-1;s>=0;s--){switch(n){case 0:r=e[7]+r;break;case 4:new RegExp("0{4}\\d{"+(i[0].length-s-1)+"}$").test(i[0])||(r=e[4]+r);break;case 8:r=e[5]+r,e[7]=e[5],n=0}n%4==2&&0!=i[0].charAt(s+2)&&0==i[0].charAt(s+1)&&(r=a[0]+r),0!=i[0].charAt(s)&&(r=a[i[0].charAt(s)]+e[n%4]+r),n++}if(i.length>1){r+=e[6];for(s=0;s<i[1].length;s++)r+=a[i[1].charAt(s)]}return"一十"==r.substring(0,2)&&(r="十"+r.substring(2)),r},convert:function(t){for(var a="",e=Math.floor(t/1e3),i=Math.floor(t%1e3/100),n=Math.floor(t%100/10),r=t%10,s=0;s<e;s++)a+="M";return i&&(a+=["C","CC","CCC","CD","D","DC","DCC","DCCC","CM"][i-1]),n&&(a+=["X","XX","XXX","XL","L","LX","LXX","LXXX","XC"][n-1]),r&&(a+=["I","II","III","IV","V","VI","VII","VIII","IX"][r-1]),a},hideTips:function(){this.setData({showTips:!1,shareTipsStatus:!0})},handleShareTipsClick:function(){this.setData({shareTipsStatus:!1})},closePop:function(){this.setData({popZxShow:!1,checkRoleFlag:!1}),this.data.gameId&&""!=this.data.gameId||this.setData({bindPopShow:!0,hideBindClose:!0})},toRank:function(){wx.navigateTo({url:"/pages_user/pages/rank/index"})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},goPandaPart:function(){wx.navigateTo({url:"/pages_user/pages/panda/panda"})},handleBindUserDialog:function(){console.log("handleBindUserDialog-------"),this.setData({bindUserVisible:!0}),wx.reportEvent("home_bindcansee",{})},getPlayerrecord:function(){var t=this,a=o.globalData,e=a.userPlayerrecord,i=a.userButPvpPart,n=a.userCivPvpPart;e?(null!=o.globalData.usPvpPartIdentity&&this.setData({identity:o.globalData.usPvpPartIdentity}),this.setData({userPlayerrecord:e,userButPvpPart:i,userCivPvpPart:n})):(o.userPlayerrecordOver=function(a,e,i){t.setData({userPlayerrecord:a,userButPvpPart:e,userCivPvpPart:i}),null!=o.globalData.usPvpPartIdentity&&t.setData({identity:o.globalData.usPvpPartIdentity})},o.getPlayerrecord())},handleInitChart:function(t,e,i){var n=this,s=i.yAxis,o=s.min,l=s.max,d=(s.interval,l-o==3);this.selectComponent("#mychart-dom-bar").init((function(s,o,l,c){var _=r.init(s,null,{width:o,height:l,devicePixelRatio:c});s.setChart(_);var p={xAxis:{type:"category",data:t,axisLine:{show:!0,lineStyle:{color:"#b7a38b"}},axisTick:{show:!1},axisLabel:{interval:2,showMaxLabel:!0,show:n.data.dataType,color:"#2d1d10",fontSize:9,margin:20}},grid:{left:70,bottom:70,top:40,right:30},yAxis:{show:!0,type:"value",scale:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!0,color:"#2d1d10",fontSize:d?8:12,formatter:function(){var t=u.numToLevel(arguments.length<=0?void 0:arguments[0]).split(","),e=a(t,2),i=e[0],n=e[1];if(n<0)return"";n=Number(n);var r="{level|"+i+"}\n";if(-1!==i.indexOf("七"))return Number(n)>25?r+"{dianfengqijie| } x"+n:r+"{dianfengqijie|} x"+n;for(var s=0,o=Number(n);s<o;s++)r+="{xing| }";return r},rich:{level:{color:"#2d1d10",align:"right",fontSize:d?10:12},xing:{color:"#000",height:d?6:8,width:d?6:8,align:"right",fontSize:6,backgroundColor:{image:n.data.imgUrl+"/home/xing.png"}},dianfengqijie:{color:"#000",height:d?8:12,width:d?8:12,align:"right",fontSize:6,backgroundColor:{image:n.data.imgUrl+"/vsrecord/ic/q_x2.png"}}}},splitLine:{show:!0,lineStyle:{color:"#b7a38b"}}},series:[{data:e,type:"line",symbol:"circle",symbolSize:5,lineStyle:{color:"#a2684e",width:1},itemStyle:{color:"#a2684e"},areaStyle:{opacity:.8,color:new r.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(230, 197, 173)"},{offset:1,color:"rgba(235, 205, 183, 0.3)"}])}}]};return i&&Object.keys(i).forEach((function(t){Object.assign(p[t],i[t])})),_.setOption(p),_}))},ifTimeOut:function(t){return(new Date).getTime()-t>o.globalData.overTime},getSevenRecord:function(){var t=this;wx.getStorage({key:"userSevenRecord20220812",success:function(a){var e=t.ifTimeOut(a.data.times);console.log(a,e),e?(console.log("过期了"),t.getUserSevenRecord()):(console.log("没过期"),t.setData({userSevenRecord:a.data.userSevenRecord,userButSevenRecord:a.data.userButSevenRecord,userCivSevenRecord:a.data.userCivSevenRecord}),t.updateCanvas(a.data.userButSevenRecord,a.data.userCivSevenRecord))},fail:function(){t.getUserSevenRecord()},complete:function(){}})},getUserSevenRecord:function(){var t=this;wx.request({url:"https://yapi.u1.netease.com/mock/536/w/epro/wechatuser/mine/rank/seven",data:{wxToken:this.data.wxToken,server:"10001",roleId:t.data.user.role_id},success:function(a){if(a.data&&a.data.data&&a.data.data.rank7&&a.data.data.rank7.data&&a.data.data.rank7.data.length>0){console.log("有数据");var e=a.data.data.rank7.data[0],i=[],n=[];for(var r in e.but_pvp_level_info_week){var s={str:e.but_pvp_level_info_week[r],qData:r};i.push(s)}for(var o in e.civ_pvp_level_info_week){var l={str:e.civ_pvp_level_info_week[o],qData:o};n.push(l)}i.forEach((function(t,a){var e=t.str.split("_");t.before_pvp_part=e[0],t.before_pvp_level=e[1],t.before_pvp_star=e[2]})),n.forEach((function(t,a){var e=t.str.split("_");t.before_pvp_part=e[0],t.before_pvp_level=e[1],t.before_pvp_star=e[2]})),t.setData({userSevenRecord:e,userButSevenRecord:i,userCivSevenRecord:n});var d={userSevenRecord:e,userButSevenRecord:i,userCivSevenRecord:n,times:(new Date).getTime()};wx.setStorage({key:"userSevenRecord20220812",data:d}),t.updateCanvas(i,n)}else console.log("无数据")}})},updateCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=[],i=[],n=0,r=0,s=1,l=this.data.identity?t:a;if(console.log(l),l.forEach((function(t,a){var s=u.levelToNum("".concat(t.before_pvp_part,"_").concat(t.before_pvp_level,"_").concat(t.before_pvp_star));if(a?(s>n&&(n=s),s<r&&(r=s)):(n=s,r=s),t.qData){var o=t.qData.slice(4),l=o.split("");l.splice(2,0,"."),o=l.join(""),e.push(o)}else e.push(t.qData);i.push(s)})),!e.length){var d="",c=o.globalData.userPlayerStatis;this.data.identity&&c?d=u.levelToNum(c.but_pvp_part):c&&(d=u.levelToNum(c.civ_pvp_part)),console.log("nowDUan",!!d),d||0===d?(n=d+2,r=d,s=1):(n=180,r=178,s=1)}3!==(s=n-r)&&2!==s||(s=1),n===r&&(r-=1),console.log(e,i,{min:r,max:n,interval:s||1}),this.handleInitChart(e,i,{yAxis:{min:r,max:n,interval:s||1}})},handleToggleDataType:function(t){var a=this;this.data.toggleLoading||(wx.reportEvent("home_datachange",{}),this.setData({dataType:"0"===t.detail.value,arrayValTime:this.data.array[t.detail.value],toggleLoading:!0},(function(){var t=a.data,e=t.userButPvpPart,i=t.userCivPvpPart,n=t.userButSevenRecord,r=t.userCivSevenRecord,s=t.dataType;console.log("data",a.data),s?a.updateCanvas(n,r):a.updateCanvas(e,i),setTimeout((function(){a.setData({toggleLoading:!1})}),1500),o.globalData.usPvpPartIdentity=a.data.identity})))},handleToggleRole:function(t){var a=this;this.data.toggleLoading||this.getDingyue((function(){wx.reportEvent("home_changeidentity",{}),a.setData({identity:"0"!==t.detail.value,arrayValRole:a.data.array3[t.detail.value],toggleLoading:!0},(function(){var t=a.data,e=t.userButPvpPart,i=t.userCivPvpPart,n=t.userButSevenRecord,r=t.userCivSevenRecord;t.dataType?a.updateCanvas(n,r):a.updateCanvas(e,i),setTimeout((function(){a.setData({toggleLoading:!1})}),1500),o.globalData.usPvpPartIdentity=a.data.identity}))}))},handlePreview:function(t){var a=t.target.dataset.index,e=this.data.unBindTipImgList;wx.previewImage({current:e[a],urls:this.data.unBindTipImgList})},handleBindUserClose:function(){this.setData({bindVisibleDialog:!this.data.bindVisibleDialog,checkRoleFlag:!this.data.checkRoleFlag})},handUnBindProcess:function(){this.setData({bindVisibleDialog:!this.data.bindVisibleDialog})}});