var t=require("../../@babel/runtime/helpers/toConsumableArray"),a=getApp();Page({data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,gameId:null,sortName:"total_battle",sortDirection:"bottom",filterList:[{id:"total",name:"所有角色"},{id:"but_total_hero_list",name:"监管者"},{id:"civ_total_hero_list",name:"求生者"}],value:0,userEx:[],but_total_hero_list:[],civ_total_hero_list:[]},onLoad:function(t){var e=this;e.setData({wxToken:a.globalData.wxToken,gameId:t.gameId}),e.data.wxToken?e.getData():a.initOkCallback=function(t){e.setData({wxToken:a.globalData.wxToken}),e.getData()},wx.reportEvent("vsrecord_rolelist_pvuv",{})},getData:function(){this.getUserEx()},goRole:function(t){var a="监管";null==t.currentTarget.dataset.kill&&(a="求生"),wx.navigateTo({url:"/pages/vsrecord/role?heroId="+t.currentTarget.dataset.heroid+"&gameId="+this.data.gameId+"&zy="+a})},getUserEx:function(){var a=this,e=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/record/day",data:{wxToken:e.data.wxToken,server:10001,roleId:e.data.gameId},success:function(o){if(200==o.data.code){var r=o.data.data.data[0];if(!r)return;var n=e.data,i=n.sortDirection,l=n.sortName,s=function(t){t.headImg=e.data.imgUrl+"/vsrecord/headimg2/"+t.hero_id+".jpg",t.kv=e.data.imgUrl+"/vsrecord/roleimg2/"+t.hero_id+".jpg",t.win_rate=Math.round(1e4*t.win_rate)/100+"%",t.hero_rank_score=Math.round(t.hero_rank_score),t.hero_name="空军地勤"===t.hero_name?"空军":t.hero_name};"0"==r.but_total_hero_list&&(r.but_total_hero_list=[]),"0"==r.civ_total_hero_list&&(r.but_total_hero_list=[]);var c=r.but_total_hero_list,u=r.civ_total_hero_list;c.forEach((function(t){return s(t)})),u.forEach((function(t){return s(t)})),r.herolist=a.compare([].concat(t(u||[]),t(c||[])),l,i),e.setData({userEx:r,but_total_hero_list:r.but_total_hero_list,civ_total_hero_list:r.civ_total_hero_list})}else wx.showToast({title:o.data.msg,icon:"none",duration:2e3})}})},toRank:function(){wx.navigateTo({url:"/pages_user/pages/rank/index"})},handlerGobackClick:function(t){getCurrentPages().length>=2?wx.navigateBack({delta:t}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})},handlePickerChange:function(a){var e=parseInt(a.detail.value);console.log("value",e);var o=this.data,r=o.sortName,n=o.sortDirection,i=o.but_total_hero_list,l=o.civ_total_hero_list,s={0:[].concat(t(i),t(l)),1:i,2:l};this.setData({value:e,"userEx.herolist":s[e].length>0?this.compare(s[e],r,n):[]})},handlerSort:function(a){console.log(a,"eeeee");var e=a.target.dataset.name,o=this.data,r=o.sortName,n=o.sortDirection,i=o.but_total_hero_list,l=o.civ_total_hero_list,s=o.value,c={0:[].concat(t(i),t(l)),1:i,2:l},u="bottom";e===r&&(u="bottom"===n?"top":"bottom"),this.setData({sortDirection:u,sortName:e,"userEx.herolist":this.compare(c[s],e,u)})},compare:function(t,a,e){if(0!=t)return t.sort((function(t,o){return"bottom"===e?parseFloat(o[a])-parseFloat(t[a]):parseFloat(t[a])-parseFloat(o[a])}))},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){return{path:"/pages/vsrecord/index?from=share",success:function(t){},fail:function(){},complete:function(){}}}});