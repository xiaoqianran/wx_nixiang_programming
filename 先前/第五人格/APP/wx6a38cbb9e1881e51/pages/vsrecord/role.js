var a,t=require("../../@babel/runtime/helpers/defineProperty"),e=getApp();Page({data:(a={imgUrl:e.globalData.imgUrl,apiUrl:e.globalData.apiUrl,wxToken:e.globalData.wxToken,isSurvi:!1,swpIndex:0,gameId:null,heroId:null,useAllData:[],useSaijiData:[]},t(t(t(t(t(t(t(t(t(t(a,"isSurvi",!1),"swpIndex",0),"array",["当前赛季","全部赛季"]),"arrayVal1","全部赛季"),"arrayVal2","全部赛季"),"array2",[{name:"全部比赛",mode:"-"},{name:"排位模式",mode:"2,10"},{name:"匹配模式",mode:"1"},{name:"联合狩猎",mode:"8"},{name:"娱乐模式",mode:"13,18"},{name:"标准模式",mode:"1,2"}]),"array2Index",0),"tiersList",[{name:"所有段位",key:-127},{name:"巅峰七阶",key:8},{name:"七阶",key:7},{name:"六阶",key:6},{name:"五阶",key:5},{name:"四阶",key:4},{name:"三阶",key:3},{name:"二阶",key:2},{name:"一阶",key:1}]),"tiersIndex",0),"tiersObj",{name:"所有段位",key:-127}),t(t(a,"start_time",[]),"end_time",[])),onLoad:function(a){var t=this;console.log("options",a),t.setData({wxToken:e.globalData.wxToken,heroId:a.heroId,gameId:a.gameId,zy:a.zy,campId:"监管"===a.zy?1:2,from:a.from}),"求生"==t.data.zy&&t.setData({isSurvi:!0}),t.data.wxToken?t.getData():e.initOkCallback=function(a){t.setData({wxToken:e.globalData.wxToken}),t.getData()},wx.reportEvent("vsrecord_role_pvuv",{})},getData:function(){this.getUserEx(),this.getRecord(),this.getRankData()},getUserEx:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/record/day",data:{wxToken:a.data.wxToken,server:10001,roleId:a.data.gameId},success:function(t){if(200==t.data.code){var e=t.data.data.data[0];if(!e)return!1;"监管"==a.data.zy?(e.but_saiji_hero_list&&0!=e.but_saiji_hero_list&&e.but_saiji_hero_list.forEach((function(t,e){t.hero_id==a.data.heroId&&(t.play_hour=Math.round(10*t.play_hour)/10+"h",t.win_rate=Math.round(1e3*t.win_rate)/10+"%",t.killall_per=Math.round(t.killall/t.total_battle*1e3)/10+"%",t.avg_score=Math.round(t.avg_score),t.avg_break_board=Math.round(10*t.avg_break_board)/10,t.avg_attack_down=Math.round(10*t.avg_attack_down)/10,t.avg_terror_shock=Math.round(10*t.avg_terror_shock)/10,t.avg_kill=Math.round(10*t.avg_kill)/10,a.setData({useSaijiData:t}))})),e.but_total_hero_list&&0!=e.but_total_hero_list&&e.but_total_hero_list.forEach((function(t,e){t.play_hour=Math.round(10*t.play_hour)/10+"h",t.win_rate=Math.round(1e3*t.win_rate)/10+"%",t.killall_per=Math.round(t.killall/t.total_battle*1e3)/10+"%",t.avg_score=Math.round(t.avg_score),t.avg_break_board=Math.round(10*t.avg_break_board)/10,t.avg_attack_down=Math.round(10*t.avg_attack_down)/10,t.avg_terror_shock=Math.round(10*t.avg_terror_shock)/10,t.avg_kill=Math.round(10*t.avg_kill)/10,t.hero_id==a.data.heroId&&a.setData({useAllData:t})}))):(e.civ_total_hero_list&&0!=e.civ_total_hero_list&&e.civ_total_hero_list.forEach((function(t,e){t.hero_id==a.data.heroId&&(t.play_hour=Math.round(10*t.play_hour)/10+"h",t.win_rate=Math.round(1e3*t.win_rate)/10+"%",t.tease=Math.round(t.tease/60/60*10)/10+"h",t.fix=Math.round(t.fix/100),t.avg_score=Math.round(t.avg_score),t.avg_fix=Math.round(t.avg_fix/10)/10,t.avg_save=Math.round(10*t.avg_save)/10,t.avg_tease=Math.round(10*t.avg_tease)/10+"s",t.escape_rate=Math.round(t.escape_battle/t.total_battle*1e3)/10+"%",t.board_hit=Math.round(t.avg_board_hit*t.total_battle),t.save=Math.round(t.save),t.cure=Math.round(t.cure),"空军地勤"==t.hero_name&&(t.hero_name="空军"),a.setData({useAllData:t}))})),e.civ_saiji_hero_list&&0!=e.civ_saiji_hero_list&&e.civ_saiji_hero_list.forEach((function(t,e){t.hero_id==a.data.heroId&&(t.play_hour=Math.round(10*t.play_hour)/10+"h",t.win_rate=Math.round(1e3*t.win_rate)/10+"%",t.tease=Math.round(t.tease/60/60*10)/10+"h",t.fix=Math.round(t.fix/100),t.avg_score=Math.round(t.avg_score),t.avg_fix=Math.round(t.avg_fix/10)/10,t.avg_save=Math.round(10*t.avg_save)/10,t.avg_tease=Math.round(10*t.avg_tease)/10+"s",t.escape_rate=Math.round(t.escape_battle/t.total_battle*1e3)/10+"%",t.board_hit=Math.round(t.avg_board_hit*t.total_battle),t.save=Math.round(t.save),t.cure=Math.round(t.cure),"空军地勤"==t.hero_name&&(t.hero_name="空军"),a.setData({useSaijiData:t}))}))),""==a.data.useSaijiData&&a.setData({arrayVal:"全部赛季"}),a.setData({userEx:e})}else wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})},getRecord:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/playerrecord",data:{wxToken:a.data.wxToken,server:10001,roleId:a.data.gameId},success:function(t){if(200==t.data.code){var e=t.data.data,r=[],o=0,n=0;null!=e?e.forEach((function(t,e){if(t.heroId==a.data.heroId){var i=t.twhen.split(" "),s=i[0].split("-"),d=i[1].split(":");t.showTime=s[1]+"-"+s[2]+" "+d[0]+":"+d[1],"none"==t.selfResultValue&&"五排"==t.battleModeValue&&(t.selfResultValue="五排"),t.mvpScore=0,t.playerInfo&&(t.playerInfo=JSON.parse(t.playerInfo.replace(/\\/g,'"')),t.playerInfo.forEach((function(a,e){a.score>t.mvpScore&&(t.mvpScore=a.score)})),t.mvpScore==t.score&&(t.ismvp=!0,1==t.campId?n++:2==t.campId&&o++)),r.push(t)}})):e=[],a.data.userRecord=r,a.setData({userRecordUse:r,jgMvp:n,qsMvp:o})}else wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})},bindPickerComChange:function(a){var t=this,e=a.detail.value,r=t.data.array2[e].mode.split(",");"-"==r[0]?t.data.userRecordUse=t.data.userRecord:(t.data.userRecordUse=[],t.data.userRecord.forEach((function(a,e){r.forEach((function(e,r){e==a.battleMode&&t.data.userRecordUse.push(a)}))}))),t.setData({array2Index:e,userRecordUse:t.data.userRecordUse})},banSurviCh:function(a){0==a.currentTarget.dataset.id?this.setData({isSurvi:!1}):this.setData({isSurvi:!0})},bindPickerChange:function(a){0!=a.detail.value||""!=this.data.useSaijiData?1==a.currentTarget.dataset.id?this.setData({arrayVal1:this.data.array[a.detail.value]}):2==a.currentTarget.dataset.id&&this.setData({arrayVal2:this.data.array[a.detail.value]}):wx.showToast({title:"当前赛季暂无数据",icon:"none",duration:2e3})},bindTiersChange:function(a){this.setData({tiersObj:this.data.tiersList[a.detail.value],tiersIndex:a.detail.value}),this.getRankData()},getRankData:function(){var a=this;this.myQequest("/gameRole/playTop",{campId:this.data.campId,part:this.data.tiersObj.key,sortKey:1,sortType:2,position:""},(function(t){console.log("/gameRole/playTop",t),a.setData({roleData:t.data,start_time:t.data[0].start_time.split("-"),end_time:t.data[0].end_time.split("-")});for(var e=a.data.roleData,r=0;r<a.data.roleData.length;r++){var o=a.data.roleData[r];o.hero_id==a.data.heroId&&(o.use_rate=parseFloat((100*e[r].use_rate).toFixed(1)),o.win_rate=parseFloat((100*e[r].win_rate).toFixed(1)),o.ping_rate=parseFloat((100*e[r].ping_rate).toFixed(1)),o.ban_rate=parseFloat((100*e[r].ban_rate).toFixed(1)),o.run_rate=parseFloat((100*e[r].run_rate).toFixed(1)),a.setData({roleRank:o}))}a.setData({newroleData:a.data.roleData}),console.log(a.data.newroleData)}))},toRank:function(){"rank"===this.data.from?wx.navigateBack({delta:1}):wx.navigateTo({url:"/pages_user/pages/rank/index"})},handlerGobackClick:function(a){getCurrentPages().length>=2?wx.navigateBack({delta:a}):wx.redirectTo({url:e.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:e.globalData.pageIndex})},swiperChange:function(a){var t=a.detail.current;this.data.swpIndex=t},swpPrev:function(){this.data.swpIndex>0?this.setData({swpIndex:this.data.swpIndex-1}):0==this.data.swpIndex&&this.setData({swpIndex:1})},swpNext:function(){this.data.swpIndex<1?this.setData({swpIndex:this.data.swpIndex+1}):1==this.data.swpIndex&&this.setData({swpIndex:0})},onReady:function(){},onShow:function(){},myQequest:function(a,t,r,o){var n=this;wx.request({url:"".concat(this.data.apiUrl,"/w/epro/wechatuser").concat(a),data:t,method:o||"get",header:{wxToken:this.data.wxToken},success:function(a){setTimeout((function(){n.data.canClick=!0}),1e3),a.data.status?r&&r(a.data):-10000301==a.data.code?n.data.onLogin||(n.data.onLogin=!0,e.getLogin(),e.initOkCallback=function(a){n.setData({wxToken:a}),e.initOkCallback=null,setTimeout((function(){n.data.onLogin=!1}),3e3)}):wx.showToast({title:a.data.msg,icon:"none",duration:2e3})}})},onShareAppMessage:function(){return{path:"/pages/vsrecord/index?from=share",success:function(a){},fail:function(){},complete:function(){}}}});