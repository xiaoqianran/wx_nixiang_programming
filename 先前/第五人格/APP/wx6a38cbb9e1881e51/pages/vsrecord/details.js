var e=require("../../@babel/runtime/helpers/toConsumableArray"),a=getApp();Page({data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,isSurvi:!1,vsdata:null,gameId:null,headimg:"https://nie.res.netease.com/id5/m/zt/20201215094138/data/greed/face/f_0462.png",userEx:null},onLoad:function(e){var t=this;t.setData({wxToken:a.globalData.wxToken,gameId:e.gameId,headimg:e.headimg}),wx.getStorage({key:"vsdetail",success:function(e){console.log(),t.setData({vsdata:e.data}),wx.removeStorage({key:"vsdetail"}),t.data.wxToken?t.getData():a.initOkCallback=function(e){t.setData({wxToken:a.globalData.wxToken}),t.getData()}}}),wx.reportEvent("vsrecord_detail",{})},getData:function(){this.madeData(),this.getUserEx()},madeData:function(){var e=this,a=e.data.vsdata;a.max_fix_rate=0,a.max_put_down_plate=0,a.max_rescue_num=0,a.max_treatment_num=0,a.max_pin_down_time=0,a.playerInfo.forEach((function(t,_){1==t.camp_id?9==t.self_result?t.selfResultValue="一败涂地":8==t.self_result||7==t.self_result?t.selfResultValue="大获全胜":3==t.self_result?t.selfResultValue="恶意退出":10==t.self_result?t.selfResultValue="勉强获胜":11==t.self_result&&(1==a.campResult?t.selfResultValue="大获全胜":2==a.campResult?t.selfResultValue="一败涂地":0==a.campResult&&(t.selfResultValue="勉强获胜")):2==t.camp_id&&(2==t.self_result||4==t.self_result||5==t.self_result?t.selfResultValue="逃脱":3==t.self_result?t.selfResultValue="恶意退出":1!=t.self_result&&6!=t.self_result&&11!=t.self_result||(t.selfResultValue="迷失")),2==t.camp_id&&(t.pin_down_time=Math.round(100*t.pin_down_time)/100,t.fix_rate>a.max_fix_rate&&(a.max_fix_rate=t.fix_rate),t.put_down_plate>a.max_put_down_plate&&(a.max_put_down_plate=t.put_down_plate),t.rescue_num>a.max_rescue_num&&(a.max_rescue_num=t.rescue_num),t.treatment_num>a.max_treatment_num&&(a.max_treatment_num=t.treatment_num),t.pin_down_time>a.max_pin_down_time&&(a.max_pin_down_time=t.pin_down_time)),t.score==a.mvpScore&&(t.ismvp=!0),t.headimg=e.data.imgUrl+"/vsrecord/headimg2/"+t.hero_id+".jpg",t.before_pvp_part=t["before_pvp_part "],t.before_pvp_level=t["before_pvp_level "],t.before_pvp_star=t["before_pvp_star "],t.before_pvp_level_num=e.convert(parseInt(-1==t.before_pvp_level?0:t.before_pvp_level))})),a.playerInfo.forEach((function(e,t){2==e.camp_id&&(e.fix_rate==a.max_fix_rate&&0!=a.max_fix_rate&&(e.is_max_fix_rate=!0,a.roleName==e.role_name&&(a.is_max_fix_rate=!0)),e.put_down_plate==a.max_put_down_plate&&0!=a.max_put_down_plate&&(e.is_max_put_down_plate=!0,a.roleName==e.role_name&&(a.is_max_put_down_plate=!0)),e.rescue_num==a.max_rescue_num&&0!=a.max_rescue_num&&(e.is_max_rescue_num=!0,a.roleName==e.role_name&&(a.is_max_rescue_num=!0)),e.treatment_num==a.max_treatment_num&&0!=a.max_treatment_num&&(e.is_max_treatment_num=!0,a.roleName==e.role_name&&(a.is_max_treatment_num=!0)),e.pin_down_time==a.max_pin_down_time&&0!=a.max_pin_down_time&&(e.is_max_pin_down_time=!0,a.roleName==e.role_name&&(a.is_max_pin_down_time=!0)))})),e.setData({vsdata:e.data.vsdata})},getUserEx:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/record/day",data:{wxToken:a.data.wxToken,server:10001,roleId:a.data.gameId},success:function(t){if(200==t.data.code){if(!t.data.data)return a.setData({userEx:[]}),!1;var _,r,l=t.data.data.data[0];if(l.herolist=[],l.but_total_hero_list&&0!=l.but_total_hero_list)(_=l.herolist).push.apply(_,e(l.but_total_hero_list));if(l.civ_total_hero_list&&0!=l.civ_total_hero_list)(r=l.herolist).push.apply(r,e(l.civ_total_hero_list));l.but_saiji_hero_list,l.civ_saiji_hero_list,l.herolist.forEach((function(e,t){e.hero_id==a.data.vsdata.heroId&&(e.headImg=a.data.imgUrl+"/vsrecord/headimg2/"+e.hero_id+".jpg",e.kv=a.data.imgUrl+"/vsrecord/roleimg2/"+e.hero_id+".jpg",e.win_rate=Math.round(1e3*e.win_rate)/10+"%",e.hero_rank_score=Math.round(e.hero_rank_score),"空军地勤"==e.hero_name&&(e.hero_name="空军"),a.setData({userEx:e}))}))}else wx.showToast({title:t.data.msg,icon:"none",duration:2e3})}})},handlerGobackClick:function(e){getCurrentPages().length>=2?(console.log(e),wx.navigateBack({delta:e})):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})},banSurviCh:function(e){0==e.currentTarget.dataset.id?this.setData({isSurvi:!1}):this.setData({isSurvi:!0})},onPullDownRefresh:function(){},onReachBottom:function(){},convert:function(e){for(var a="",t=Math.floor(e/1e3),_=Math.floor(e%1e3/100),r=Math.floor(e%100/10),l=e%10,n=0;n<t;n++)a+="M";return _&&(a+=["C","CC","CCC","CD","D","DC","DCC","DCCC","CM"][_-1]),r&&(a+=["X","XX","XXX","XL","L","LX","LXX","LXXX","XC"][r-1]),l&&(a+=["I","II","III","IV","V","VI","VII","VIII","IX"][l-1]),a},onShareAppMessage:function(){return{path:"/pages/vsrecord/index?from=share",success:function(e){},fail:function(){},complete:function(){}}}});