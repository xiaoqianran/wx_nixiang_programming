var t=require("../../../@babel/runtime/helpers/defineProperty"),a=getApp(),e=require("../../../utils/util"),i=e.encrypt,n=e.decrypt;Component({properties:{bindPopShow:{type:Boolean,value:"default value"},wxToken:{type:String,value:"default value"},userName:{type:String,value:"default value"},hideClose:{type:Boolean,value:!1},sbex:{type:Boolean,value:!1}},data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,user:[],idVal:"",codeVal:"",gameId:"",canClick:!0,bindTipsPopShow:!1,firstBindPopShow:!1,imglist:["https://nie.res.netease.com/id5/m/zt/20201215094138/data/active/pic1.jpg","https://nie.res.netease.com/id5/m/zt/20201215094138/data/active/pic2.jpg","https://nie.res.netease.com/id5/m/zt/20201215094138/data/active/pic3.jpg"]},methods:t(t({chBind:function(){},showBind:function(t){this.setData({bindPopShow:!0})},showBindTips:function(t){this.setData({bindPopShow:!1,bindTipsPopShow:!0})},bindInit:function(){wx.getStorageSync("openId_appName",!0),wx.setClipboardData({data:i('{"openId":"'.concat(a.globalData.userInfo.openId,'","appName":"D5_COMMUNITY_2"}')),success:function(t){wx.hideToast(),wx.getClipboardData({success:function(t){var a=t.data.split("+")[1];a&&console.log(n(a))}})}});var t=this;t.data.canClick&&(""==t.data.idVal?wx.showToast({title:"请输入角色ID",icon:"none",duration:1e3}):""==t.data.codeVal?wx.showToast({title:"请输入绑定码",icon:"none",duration:1e3}):(t.setData({canClick:!1}),wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/bdPlayer",data:{wxToken:t.data.wxToken,idvId:t.data.idVal,code:t.data.codeVal},success:function(e){200==e.data.code?(wx.reportEvent("bind_success",{}),wx.showToast({title:"绑定成功",icon:"success",duration:2e3}),wx.clearStorageSync(),a.globalData.userPlayerStatis=null,a.globalData.userPlayerrecord=null,a.globalData.userRecord=null,a.globalData.userInfo=null,a.handleBind(),t.setData({bindPopShow:!1,gameId:t.data.idVal}),e.data.data.isFirst&&(t.triggerEvent("HandleBindFirst",{firstBind:!0}),t.setData({firstBindPopShow:!0})),t.triggerEvent("bindCol",{gameId:t.data.idVal},{})):("player not online, save offline event!"==e.data.msg?wx.showToast({title:"绑定的账号未在线，请登录游戏后再试。",icon:"none",duration:3e3}):"no this player in game"==e.data.msg?wx.showToast({title:"未找到该账号，请检查账号输入是否有误。",icon:"none",duration:3e3}):"error code"==e.data.msg?wx.showToast({title:"绑定码错误",icon:"none",duration:3e3}):"请先到游戏中解除绑定,再重新绑定角色"==e.data.msg?wx.showToast({title:"请先到游戏中解除绑定 "+t.data.userName+" 的账号，再重新绑定新账号",icon:"none",duration:4e3}):e.data.msg.indexOf("has bind app_id")>-1?wx.showToast({title:"请先到游戏中解除绑定 "+e.data.msg.split(":")[1]+" 的账号，再重新绑定新账号",icon:"none",duration:4e3}):wx.showToast({title:e.data.msg,icon:"none",duration:3e3}),wx.reportEvent("userbind_fail",{content:t.data.idVal+"_"+e.data.msg})),setTimeout((function(){t.setData({canClick:!0})}),500)}})))},previewImage:function(t){var a=t.target.dataset.src;wx.previewImage({current:a,urls:this.data.imglist})},inputClear:function(){this.setData({idVal:"",codeVal:""})},closeBind:function(){this.setData({bindPopShow:!1})},closeFirstBindPop:function(){this.setData({firstBindPopShow:!1}),this.triggerEvent("HandleDefine")},closeBindTips:function(){this.setData({bindTipsPopShow:!1,bindPopShow:!0})},idVal:function(t){this.setData({idVal:t.detail.value})},codeVal:function(t){this.setData({codeVal:t.detail.value})}},"showBind",(function(t){this.setData({bindPopShow:!0})})),"goDrawlist",(function(){wx.navigateTo({url:"/pages_user/pages/draw/list"}),this.closeFirstBindPop()})),onLoad:function(t){},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});