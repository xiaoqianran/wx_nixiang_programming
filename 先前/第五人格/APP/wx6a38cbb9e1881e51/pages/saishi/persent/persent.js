var e=getApp();Page({data:{imgUrl:e.globalData.imgUrl,apiUrl:e.globalData.apiUrl,wxToken:e.globalData.wxToken,btVideo:[],nowVsData:[],newsList:[],queryKey:"",pageNo:1,pageSize:10,videoHidden:!0,videoSrc:null,dailyIcon:""},onShow:function(){this.setData({dailyIcon:wx.getStorageSync("daily-icon")||!1})},onLoad:function(){var a=this;wx.reportEvent("zx_match",{}),e.globalData.pageIndex="/pages/index/index",this.setData({wxToken:e.globalData.wxToken}),this.data.wxToken?this.getData():e.initOkCallback=function(t){a.setData({wxToken:e.globalData.wxToken}),a.getData()}},getData:function(){this.getBtVideo(),this.getNews()},getBtVideo:function(){var e=this;wx.request({url:this.data.apiUrl+"/w/epro/event/showvideo",data:{wxToken:e.data.wxToken,catalogId:"40beffe6638245c5b20e428a8d0a2e9e"},success:function(a){console.log("BtVideo",a),e.setData({btVideo:a.data.data[0].videoUrl})}})},topLink:function(e){wx.redirectTo({url:["/pages/index/index","/pages/index/newsgg","/pages/index/newszx","/pages/saishi/persent/persent","/pages/index/daily/index","/pages/index/fan/fan"][e.currentTarget.dataset.index]})},search:function(){wx.navigateTo({url:"/pages/index/query?key="+this.data.queryKey}),wx.reportEvent("index_topsearch",{})},getNowVs:function(){var e=this;wx.request({url:this.data.apiUrl+"/w/spider/idvschedule/getscheduledatatoday",data:{wxToken:e.data.wxToken},success:function(a){console.log("NowVs:",a);var t=a.data.data,i={},o=(new Date).getTime();t.forEach((function(e,a){console.log(e);var t={};t.zbTime=new Date(e.scheduleDatetime).getHours(),t.competitionID=e.competitionID,t.teamALogoUrl=e.teamALogoUrl,t.teamBLogoUrl=e.teamBLogoUrl,o<new Date(e.scheduleDatetime).getTime()?t.state="未开始":o>new Date(e.scheduleDatetime).getTime()&&o-new Date(e.scheduleDatetime).getTime()<72e5?t.state="进行中":t.state="已结束",i[a]=t})),console.log(i),e.setData({nowVsData:i})}})},getAllVs:function(){var e=this;wx.request({url:this.data.apiUrl+"/w/epro/event/netease/allschedule",data:{wxToken:e.data.wxToken},success:function(a){console.log("AllVs:",a),e.setData({btVideo:a})}})},getNews:function(){var e=this;wx.request({url:this.data.apiUrl+"/w/epro/article/catalog_page",data:{wxToken:e.data.wxToken,pageNo:e.data.pageNo,pageSize:e.data.pageSize,catalogId:"40beffe6638245c5b20e428a8d0a2e9e"},success:function(a){var t,i=[];a.data.data.items.forEach((function(e,a){var t=e.createTime.split(" ")[0].split("-");e.videoUrl&&e.videoUrl.indexOf("bilibili")>-1&&(e.isOut=!0),i[a]=e,i[a].showDate=t[1]+"-"+t[2]})),(t=e.data.newsList).push.apply(t,i),e.setData({newsList:e.data.newsList})}})},getInputValue:function(e){this.data.queryKey=e.detail.value},getQuery:function(){wx.navigateTo({url:"../../index/query?key="+this.data.queryKey})},goNowSaishi:function(e){wx.navigateTo({url:"/pages/saishi/now/now"})},goAllSaishi:function(e){wx.navigateTo({url:"/pages/saishi/all/all"})},goVideoSaishi:function(e){wx.navigateTo({url:"/pages/saishi/video/list"})},goTicketSaishi:function(e){wx.navigateToMiniProgram({appId:"wx7564fd5313d24844",path:"pages/video/video.html?__preload_=16291798621481&__key_=16291798621482&avid=249815657"})},goTeamSaishi:function(e){wx.navigateTo({url:"/pages/saishi/team/list"})},goUserSaishi:function(e){wx.navigateTo({url:"/pages/saishi/my/my"})},onReachBottom:function(){this.data.pageNo++,this.getNews()},handlerGobackClick:function(a){getCurrentPages();wx.redirectTo({url:e.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:e.globalData.pageIndex})}});