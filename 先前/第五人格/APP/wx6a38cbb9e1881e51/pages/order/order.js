var e=getApp();Page({data:{imgUrl:e.globalData.imgUrl,apiUrl:e.globalData.apiUrl,wxToken:e.globalData.wxToken,isOrderClick:!1,popShow:!1,popZxShow:!1,popYyShow:!1,popTipsShow:!1,bfb:"0%",unLockNum:0,orderNum:0,isbind:!1,gameId:null,isOrder:!1,isAllComplete:!1,newApi:"https://s2.game.163.com"},onLoad:function(a){var t=this;console.log(a.download),a.download&&(wx.reportEvent("order_openby_msgsend",{}),t.setData({popTipsShow:!0,popShow:!0})),a.share&&wx.reportEvent("order_openbyshare",{}),wx.reportEvent("order_pvuv",{}),t.setData({wxToken:e.globalData.wxToken}),t.data.wxToken||(e.initOkCallback=function(a){t.setData({wxToken:e.globalData.wxToken})}),wx.request({url:t.data.newApi+"/2cf94ffbf44a0e31/getnumber",data:{},success:function(e){var a=e.data.data,o=0;a>=5e6?(o=100,t.setData({unLockNum:3,isAllComplete:!0})):a<5e6&&a>=3e6?(o=(a-3e6)/2e6*36.2+50,t.setData({unLockNum:2,isAllComplete:!1})):a<3e6&&a>=1e6?(o=(a-1e6)/2e6*35.63+14.37,t.setData({unLockNum:1,isAllComplete:!1})):a<1e6&&(o=a/1e6*14.37,t.setData({isAllComplete:!1})),t.setData({bfb:o+"%",orderNum:a})}}),wx.getStorage({key:"orderMsg",success:function(e){console.log(e),"GjaRSSC51bbkLfrJ0sEeH3MqVd2ruXbBOeM-TpKFa1U_20211028"==e.data&&t.setData({isOrderClick:!0})}})},getSendmsgCol:function(){var e=this;wx.reportEvent("order_orderbtn_click",{});var a=new Date("2021/10/28 12:00:00").getTime();if(1==e.data.isOrderClick)return wx.navigateTo({url:"/pages/out/out?url=https://id5.163.com/m/"}),!1;wx.requestSubscribeMessage({tmplIds:["GjaRSSC51bbkLfrJ0sEeH3MqVd2ruXbBOeM-TpKFa1U"],success:function(t){wx.reportEvent("order_msg_colsuccess",{}),wx.request({url:e.data.apiUrl+"/w/subscribe/send",data:{template_id:"GjaRSSC51bbkLfrJ0sEeH3MqVd2ruXbBOeM-TpKFa1U",data:{thing5:{value:"第五人格-重逢之时主线版本上线"},date1:{value:"2021-10-28"},thing2:{value:"打开游戏，参与新版本活动领取稀世时装"},thing3:{value:"预约的奖励将以游戏邮件形式发放"}},sendTime:a,page:"/pages/order/order?download=true"},method:"POST",header:{wxToken:e.data.wxToken},success:function(a){200==a.data.code?(wx.setStorage({key:"orderMsg",data:"GjaRSSC51bbkLfrJ0sEeH3MqVd2ruXbBOeM-TpKFa1U_20211028"}),e.setData({isOrderClick:!0}),wx.navigateTo({url:"/pages/out/out?url=https://id5.163.com/m/"})):wx.showToast({title:a.data.msg,icon:"none",duration:2e3})}})},fail:function(e){wx.navigateTo({url:"/pages/out/out?url=https://id5.163.com/m/"})},complete:function(e){}})},closePop:function(){this.setData({popShow:!1,popZxShow:!1,popYyShow:!1,popTipsShow:!1})},showShare:function(){wx.reportEvent("order_sharebtn_click",{})},handlerGobackClick:function(a){getCurrentPages().length>=2?wx.navigateBack({delta:a}):wx.redirectTo({url:e.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:e.globalData.pageIndex})},getGameId:function(){var e=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/getIdvId",data:{wxToken:e.data.wxToken},success:function(a){-10000304==a.data.code&&"该账号暂未绑定游戏角色！"==a.data.msg?e.setData({isbind:!1}):200==a.data.code?(e.setData({isbind:!0,gameId:a.data.data.idvId}),e.getOrderStatus()):wx.showToast({title:a.data.msg,icon:"none",duration:2e3})}})},getOrderStatus:function(){var e=this;wx.request({url:e.data.newApi+"/2cf94ffbf44a0e31/select",data:{uid:e.data.gameId},success:function(a){-804==a.data.code?e.data.unOrder=!0:200==a.data.code?(e.setData({isOrder:!0}),e.data.unOrder&&e.setData({popYyShow:!0,popShow:!0})):wx.showToast({title:a.data.msg,icon:"none",duration:2e3})}})},onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(e){return{title:"主线资料片“重逢之时”重磅开启！快参与活动领取稀世时装！",path:"/pages/order/order?share=true",imageUrl:"https://nie.res.netease.com/id5/m/zt/20201215094138/data/order/share.jpg?as",success:function(e){},fail:function(){},complete:function(){}}}});