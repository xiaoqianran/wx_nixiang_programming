var a=getApp();Page({data:{dailyIcon:wx.getStorageSync("daily-icon"),queryKey:"",imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,bannerList:[],bannerIndex:0,videoList:{},videoListUse:{},videoListUseNum:0,videoHidden:!0,videoSrc:null,newsList:[],topNewsList:[],bottomNewsList:[],pageNo:1,pageSize:8,popShow:!1,popZxShow:!1,showSaishi:!1},onLoad:function(){var t=this;wx.reportEvent("zx_recommend",{});this.setData({wxToken:a.globalData.wxToken}),this.data.wxToken?this.getData():a.initOkCallback=function(e){t.setData({wxToken:a.globalData.wxToken}),t.getData()};(new Date).getTime(),new Date("2022/01/30 00:00:00").getTime();this.readyAddTipsShow()},handleCustomListChange:function(a){this.setData({newsList:Array.from(a.detail)})},oldPlayPause:function(a){this.data.onPlayCamId&&this.data.onPlayCamId!==a.detail&&this.selectComponent("#"+this.data.onPlayCamId).pauseAll(),this.data.onPlayCamId=a.detail},readyAddTipsShow:function(){var a=this;wx.getStorage({key:"addTipsShow",success:function(a){},fail:function(t){wx.setStorage({key:"addTipsShow",data:!0}),a.setData({addTipsShow:!0})}})},gobilibili:function(){},getData:function(){this.getBanner(),this.getNews(),this.getGfzx()},goDetails:function(a){a.currentTarget.dataset.newsid;var t=a.currentTarget.dataset.type,e=a.currentTarget.dataset.url;if("banner"==a.currentTarget.dataset.from&&wx.reportEvent("index_banner_click",{news_name:a.currentTarget.dataset.title,content:e}),"inside-mp"===t)wx.navigateTo({url:e});else if("web-view"===t)wx.navigateTo({url:"/pages/out/out?url="+e});else{var i=a.currentTarget.dataset.appid;i?wx.navigateToMiniProgram({appId:i,path:e}):wx.navigateTo({url:"/pages/out/out?url="+e})}},topLink:function(a){wx.redirectTo({url:["/pages/index/index","/pages/index/newsgg","/pages/index/newszx","/pages/saishi/persent/persent","/pages/index/daily/index","/pages/index/fan/fan"][a.currentTarget.dataset.index]})},search:function(){wx.navigateTo({url:"../index/query?key="+this.data.queryKey}),wx.reportEvent("index_topsearch",{})},getBanner:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/ad/banner/get",header:{wxToken:a.data.wxToken},success:function(t){var e;console.log(t.data.data.article,"灌灌灌灌"),a.setData({bannerList:null===(e=t.data.data)||void 0===e?void 0:e.article})}})},getVideo:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/article/getvideo",data:{scope:"hot",wxToken:a.data.wxToken,pageNo:1,pageSize:20},success:function(t){a.setData({videoList:t.data.data.items,videoListUse:t.data.data.items[0],videoListUseNum:0})}})},getNews:function(){var t=this;wx.request({url:this.data.apiUrl+"/w/epro/article/recommend",data:{wxToken:t.data.wxToken,pageNo:t.data.pageNo,pageSize:t.data.pageSize,needTop:!0},success:function(e){if(200==e.data.code){var i,o=[];e.data.data.records.forEach((function(a,t){var e=a.createTime.split(" ")[0].split("-");a.videoUrl&&a.videoUrl.indexOf("bilibili")>-1&&(a.isOut=!0),o[t]=a,o[t].showDate=e[1]+"-"+e[2]})),(i=t.data.newsList).push.apply(i,o),t.setData({newsList:t.data.newsList,topNewsList:t.data.newsList.slice(0,3),bottomNewsList:t.data.newsList.slice(3)},(function(){}))}else-10000301==e.data.code?wx.login({success:function(e){a.globalData.wxcode=e.code,wx.request({url:t.data.apiUrl+"/w/epro/wechatauth/callback",data:{jsCode:e.code},success:function(e){200==e.data.code?(a.globalData.wxToken=e.data.data,t.data.wxToken=e.data.data,t.getData()):wx.showToast({title:"服务器出错啦",icon:"loading",duration:1e4})}})}}):wx.showToast({title:e.data.msg,icon:"loading",duration:1e4})}})},getGfzx:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/article/catalog_page",data:{wxToken:a.data.wxToken,pageNo:1,pageSize:3,catalogId:"4767cb6f427a4c818b8892e6b6912113"},success:function(t){a.setData({gfzxList:t.data.data.items})}})},swiperChange:function(a){this.setData({bannerIndex:a.detail.current})},changeVideo:function(a){var t=this.data.videoListUseNum;this.data.videoList.length==t+1?this.setData({videoListUseNum:0,videoListUse:this.data.videoList[0]}):this.setData({videoListUseNum:t+1,videoListUse:this.data.videoList[t+1]})},handlerGobackClick:function(t){getCurrentPages().length>=2?wx.navigateBack({delta:t}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})},closePop:function(){this.setData({popShow:!1,popZxShow:!1}),this.readyAddTipsShow()},getSendmsgCol:function(){wx.reportEvent("order_pop_start_go",{click:"click"}),wx.navigateToMiniProgram({appId:"wx39bdda69602fb0d9",path:"pages/game/game?code=17d8197a189fdfc6"}),this.closePop(),this.readyAddTipsShow()},myevent:function(a){this.setData({videoHidden:a.detail.videoHidden,videoSrc:a.detail.videoSrc})},callHideVideo:function(a){this.setData({videoHidden:a,videoSrc:null})},addTipsHide:function(){this.setData({addTipsShow:!1})},onShow:function(){var a=wx.getStorageSync("daily-icon");this.setData({dailyIcon:a||!1})},onReachBottom:function(){this.data.pageNo++,this.getNews()},goPandaPart:function(){wx.navigateTo({url:"/pages_user/pages/panda/panda"})}});