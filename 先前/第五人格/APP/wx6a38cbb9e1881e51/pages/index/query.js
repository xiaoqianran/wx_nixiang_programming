var a=getApp();Page({data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,videoHidden:!0,videoSrc:null,newsList:[],queryKey:"",queryKeyChange:!1,nowPage:1,canGetNextPage:!0,canShow:!0},onLoad:function(e){var t=this;this.setData({wxToken:a.globalData.wxToken,queryKey:e.key}),this.data.wxToken?this.getData():a.initOkCallback=function(e){t.setData({wxToken:a.globalData.wxToken}),t.getData()}},getData:function(){},confirmSearch:function(a){this.data.newsList=[],this.data.nowPage=1,this.data.queryKey=a.detail.value,this.getNews()},getUserInfo:function(e){a.globalData.userInfo=e.detail.userInfo,this.setData({userInfo:e.detail.userInfo,hasUserInfo:!0})},goDetails:function(a){var e=a.currentTarget.dataset,t=e.newsid;100===e.catalogtype?(wx.request({url:this.data.apiUrl+"/w/epro/article/click",data:{articleId:e.id,wxToken:this.data.wxToken},success:function(a){}}),e.video.indexOf("bilibili")>-1?wx.navigateTo({url:"../out/out?url="+e.video}):this.setData({videoHidden:!1,videoSrc:e.video})):wx.navigateTo({url:"/pages/details/index?id="+t})},handlerGobackClick:function(e){getCurrentPages().length>=2?wx.navigateBack({delta:e}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})},getNews:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/article/search",data:{wxToken:a.data.wxToken,keyword:a.data.queryKey,pageNo:a.data.nowPage,pageSize:10},success:function(e){var t,i=[];e.data.data.items.forEach((function(a,e){var t=a.createTime.split(" ")[0].split("-");i[e]=a,i[e].showDate=t[1]+"-"+t[2]})),(t=a.data.newsList).push.apply(t,i),a.setData({newsList:a.data.newsList,canGetNextPage:!0})}})},videoPlay:function(a){var e=a.currentTarget.dataset.src;e.indexOf("bilibili")>-1?wx.navigateTo({url:"../out/out?url="+e}):this.setData({videoHidden:!1,videoSrc:e})},callHideVideo:function(a){this.setData({videoHidden:a,videoSrc:null})},onReachBottom:function(){if(this.data.canGetNextPage){var a=this.data.nowPage+1;this.setData({nowPage:a,canGetNextPage:!1}),this.getNews()}},handleCustomListChange:function(a){this.setData({newsList:a.detail})}});