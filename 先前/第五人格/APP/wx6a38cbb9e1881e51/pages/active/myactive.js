var e=require("../../@babel/runtime/helpers/toConsumableArray"),t=getApp();Page({data:{imgUrl:t.globalData.imgUrl,apiUrl:t.globalData.apiUrl,wxToken:t.globalData.wxToken,hdList:[],prListNo:1,prListReget:!0,videoHidden:!0,videoSrc:null,newsList:[],pageNo:1,pageSize:10,canClickBack:!0},onLoad:function(){var e=this;this.setData({wxToken:t.globalData.wxToken}),this.data.wxToken?this.getData():t.initOkCallback=function(a){e.setData({wxToken:t.globalData.wxToken}),e.getData()}},getData:function(){this.getHdList()},getHdList:function(){var t=this,a=(new Date).getTime();if(!t.data.prListReget)return!1;wx.request({url:this.data.apiUrl+"/w/epro/idvPointsRaceMember/participateActivity",data:{pageNo:t.data.prListNo,pageSize:20,wxToken:t.data.wxToken},header:{wxToken:t.data.wxToken},success:function(i){var r,o=i.data.data;o.forEach((function(e,t){var i=new Date(e.entryPeriodFrom.replace(/-/g,"/")),r=new Date(e.entryPeriodTo.replace(/-/g,"/")),o=new Date(e.lasePeriodFrom.replace(/-/g,"/")),n=new Date(e.lastPeriodTo.replace(/-/g,"/"));e.entryPeriodFrom=e.entryPeriodFrom.split("-")[1]+"-"+e.entryPeriodFrom.split("-")[2].substring(0,8),e.entryPeriodTo=e.entryPeriodTo.split("-")[1]+"-"+e.entryPeriodTo.split("-")[2].substring(0,8),e.lasePeriodFrom=e.lasePeriodFrom.split("-")[1]+"-"+e.lasePeriodFrom.split("-")[2].substring(0,8),e.lastPeriodTo=e.lastPeriodTo.split("-")[1]+"-"+e.lastPeriodTo.split("-")[2].substring(0,8),a>=i.getTime()&&a<=r.getTime()?e.entryPeriodType="now":a<=i.getTime()?e.entryPeriodType="fet":a<=r.getTime()&&(e.entryPeriodType="yet"),a>=o.getTime()&&a<=n.getTime()?e.lasePeriodType="now":a<=o.getTime()?e.lasePeriodType="fet":a<=n.getTime()&&(e.lasePeriodType="yet");var s=n.getTime()-a,d=r.getTime()-a,l=o.getTime()-a,g=i.getTime()-a;if(s>0){var p=parseInt(s/1e3/60/60/24),c=parseInt(s/1e3/60/60)-24*p;e.dateDes="距离活动截止还有"+p+"天"+c+"小时"}else if(d>0){var T=parseInt(d/1e3/60/60/24),u=parseInt(d/1e3/60/60)-24*T;e.dateDes="距离报名截止还有"+T+"天"+u+"小时"}else if(l>0){var h=parseInt(l/1e3/60/60/24),m=parseInt(l/1e3/60/60)-24*h;e.dateDes="距离报名开始还有"+h+"天"+m+"小时"}else if(g>0){var w=parseInt(g/1e3/60/60/24),D=parseInt(g/1e3/60/60)-24*w;e.dateDes="距离活动开始还有"+w+"天"+D+"小时"}else e.dateDes="活动已结束"})),(r=t.data.hdList).push.apply(r,e(o)),""==t.data.hdList&&(wx.showToast({title:"尚未参与任何活动",icon:"none",duration:3e3}),setTimeout((function(){t.data.canClickBack&&t.handlerGobackClick()}),2e3)),t.setData({hdList:t.data.hdList})}})},hdDetails:function(e){var t=e.currentTarget.dataset.newsid;wx.navigateTo({url:"/pages/active/active?id="+t})},goDh:function(){wx.navigateTo({url:"/pages_user/pages/saishi/dh/index"})},goMyList:function(){},handlerGobackClick:function(e){getCurrentPages().length>=2?wx.navigateBack({delta:e}):wx.redirectTo({url:t.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:t.globalData.pageIndex})},onReachBottom:function(){this.data.prListNo++,this.getHdList()}});