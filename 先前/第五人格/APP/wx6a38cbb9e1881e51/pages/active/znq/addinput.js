var a=getApp();Page({data:{imgUrl:a.globalData.imgUrl,apiUrl:a.globalData.apiUrl,wxToken:a.globalData.wxToken,id:null,addressInfo:{name:"",phoneNo:"",region:"",wechatNumber:"",detailedAddress:"",alipay:""},region:["请选择您的地区","",""],canDh:!0,type:0},onLoad:function(e){var t=this;wx.setNavigationBarTitle({title:"填写收货地址"}),t.setData({wxToken:a.globalData.wxToken,id:e.id,type:e.type?3:0}),t.data.wxToken?t.getData():a.initOkCallback=function(e){t.setData({wxToken:a.globalData.wxToken}),t.getData()},wx.hideShareMenu({menus:["shareAppMessage","shareTimeline"]})},getData:function(){},priceDh:function(){var e=this;if(console.log(e.data.canDh,"canDh"),0==e.data.canDh||!e.data.id)return!1;if(2==e.data.type){if(""==e.data.addressInfo.name)return wx.showToast({title:"请输入您的名字",icon:"none",duration:2e3}),!1;if(""==e.data.addressInfo.phoneNo)return wx.showToast({title:"请输入您的手机号",icon:"none",duration:2e3}),!1;if(""==e.data.addressInfo.wechatNumber)return wx.showToast({title:"请输入您的VX号",icon:"none",duration:2e3}),!1;if("请选择您的地区"==e.data.region[0])return wx.showToast({title:"请选择您的地区",icon:"none",duration:2e3}),!1;if(""==e.data.addressInfo.detailedAddress)return wx.showToast({title:"请输入您的详细地址",icon:"none",duration:2e3}),!1}else if(3==e.data.type){if(""==e.data.addressInfo.name)return wx.showToast({title:"请输入您的真实姓名",icon:"none",duration:2e3}),!1;if(""==e.data.addressInfo.alipay)return wx.showToast({title:"请输入您的支付宝账号",icon:"none",duration:2e3}),!1;if(""==e.data.addressInfo.wechatNumber)return wx.showToast({title:"请输入您的VX号",icon:"none",duration:2e3}),!1}e.data.canDh=!1,2==e.data.type&&(e.data.addressInfo.region=e.data.region[0]+" "+e.data.region[1]+" "+e.data.region[2]),e.data.addressInfo.activityId=a.globalData.activityId,e.data.addressInfo.personnelId=e.data.id,wx.showModal({title:"温馨提示",content:"请检查信息是否填写正确，保存后将无法更改",cancelText:"修改信息",confirmText:"确认保存",success:function(a){a.confirm?wx.request({url:e.data.apiUrl+"/w/lottery/address/insertAddress",data:e.data.addressInfo,method:"POST",header:{wxToken:e.data.wxToken},success:function(a){200==a.data.code?wx.showModal({title:"领取成功",content:"领取成功, 奖励将在14个工作日内发放",showCancel:!1,success:function(a){e.data.addressInfo={name:"",phoneNo:"",region:"",wechatId:"",detailedAddress:"",alipay:""},wx.setStorage({key:"refreshPrList",data:!0}),wx.navigateBack()}}):wx.showToast({title:a.data.msg,icon:"none",duration:2e3}),e.data.canDh=!0}}):a.cancel&&(e.data.canDh=!0)}})},nameVal:function(a){this.data.addressInfo.name=a.detail.value},wechatNumberVal:function(a){this.data.addressInfo.wechatNumber=a.detail.value},telVal:function(a){this.data.addressInfo.phoneNo=a.detail.value},addressVal:function(a){this.data.addressInfo.detailedAddress=a.detail.value},alipayVal:function(a){this.data.addressInfo.alipay=a.detail.value},bindRegionChange:function(a){this.setData({region:a.detail.value})},handlerGobackClick:function(e){getCurrentPages().length>=2?wx.navigateBack({delta:e}):wx.redirectTo({url:a.globalData.pageIndex})},handlerGohomeClick:function(){wx.redirectTo({url:a.globalData.pageIndex})}});