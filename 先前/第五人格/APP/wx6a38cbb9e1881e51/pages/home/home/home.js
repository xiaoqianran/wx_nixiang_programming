var a=require("../../../@babel/runtime/helpers/interopRequireWildcard").default,t=require("../../../@babel/runtime/helpers/slicedToArray"),e=require("../../../@babel/runtime/helpers/toConsumableArray"),r=require("../../../@babel/runtime/helpers/objectSpread2"),i=a(require("../../components/ec-canvas/echarts")),o=require("../../../utils/util"),s=require("../../common/const"),n=require("../../common/utils"),l=getApp(),d=require("../../../utils/level.js");Page({data:{newsList:[],loading:!1,firstLoading:!0,listStatus:!0,wxToken:l.globalData.wxToken,apiUrl:l.globalData.apiUrl,imgUrl:l.globalData.imgUrl,pageNo:0,pageSize:8,userInfo:null,identity:!1,dataType:!0,userRecord:null,userPlayerStatis:null,userPlayerrecord:null,userButPvpPart:null,userCivPvpPart:null,userSevenRecord:null,myCharts:null,ec:{disableTouch:!0,lazyLoad:!0},chart:null,bindUserVisible:!1,toggleLoading:!1,homeHelper:!1,wxHelper:!1,homeFirst:!0,wqFanBao:!1,showAddfri:!1,rqpm:0,userPhone:!1,showPanda:!1,springTc:!1,bannerSpring:!1,errFlag:!1,bannerList:[],bannerIndex:0,headFalg:!1,array:s.seasonTypeOptions,arrayVal1:"当前赛季",array2:s.rolesOptions,arrayVal2:"求生者",ind:s.survivorInd,ind2:s.regulatorsInd2,currentRadarData1:[],currentRadarData2:[],allRadarData1:[],allRadarData2:[],pixelRatio:0,cWidth:0,adviserUrlList:[],checkRoleFlag:!1,swpEasyIndex:0,chartData:{pvp_part_duan:"",imgurl:"",label:"",pvp_part_duanWei:"",pvp_part_jie:"",pvp_part_xing:[],toppart_duan:"",chartTitle:""},bindVisibleDialog:!1,currentIndex:0,messageTipGif:!1,messageTipGifUrl:"".concat(l.globalData.imgUrl,"/vsrecord/message_subscription-wechat.gif"),messageWxid:["yjFFsl7dJSo3UoNEdM3tpzJiUXw6kHXviLCL78G4ysI"],msgOrderWxid:["WxeAbZCbyA3QmrZSUFvtXXvsMz4RhiIt7HVmo3JEBsQ"]},getDpr:function(){var a=this;wx.getSystemInfo({success:function(t){a.data.pixelRatio=t.pixelRatio},fail:function(){pixelRatio=0}})},goAsk:function(){wx.navigateTo({url:"/pages/ask/index"})},onLoad:function(a){var t=this;console.log("homeOptions",a),this.data.wxToken=l.globalData.wxToken;var e=this;this.data.wxToken?(this.getData(),this.getAdviser()):l.initOkCallback=function(a){t.setData({wxToken:a}),t.getData(),t.getAdviser(),e.getDpr(),l.initOkCallback=null},setTimeout((function(){t.setData({errFlag:l.globalData.erroFlag})}),1e3),this.setData({cWidth:wx.getSystemInfoSync().windowWidth}),e.getDpr(),a.showBind&&(this.data.needShowBind=!0)},getData:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/epro/system/time",success:function(t){if(200==t.data.code){var e=new Date(t.data.data),r=wx.getStorageSync("20221123fristInXCX");r&&e.toDateString()==r.toDateString()?a.setData({headFalg:!1}):(wx.setStorageSync("20221123fristInXCX",e),a.setData({headFalg:!0}))}}}),this.getBanner(),this.getNewslist(),this.getUserInfo(),wx.getStorageSync("20221116icNew")||this.setData({icNew:!0})},getBanner:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/ad/banner/get",header:{wxToken:a.data.wxToken},success:function(t){-10000301==t.data.code?a.data.onLogin||(a.data.onLogin=!0,l.getLogin(),l.initOkCallback=function(t){a.setData({wxToken:t}),a.getData(),l.initOkCallback=null,setTimeout((function(){a.data.onLogin=!1}),3e3)}):a.setData({bannerList:t.data.data.index})}})},getAdviser:function(){l.globalData.isFirstADShow=!1;var a=this,t=l.globalData.isADShow;wx.request({url:this.data.apiUrl+"/w/epro/ad/pop/list",data:{wxToken:a.data.wxToken},success:function(e){if(e.data.data){var r=(new Date).toLocaleDateString(),i=r!==wx.getStorageSync("lastShowTime");i&&wx.setStorageSync("lastShowTime",r);var o=!1!==t,s=e.data.data.filter((function(a){return!(!o||!i)||(i?"daily"===a.showFrequency:o?"everytime"===a.showFrequency:void 0)})),n=(o||i)&&!!s.length;a.setData({adviserFlag:n,adviserUrlList:s}),a.showNextAd(!0)}}})},swiperChange:function(a){this.setData({bannerIndex:a.detail.current})},goDetails:function(a){var t=a.currentTarget.dataset.newsid,e=a.currentTarget.dataset.type,r=a.currentTarget.dataset.url;if("banner"==a.currentTarget.dataset.from&&wx.reportEvent("index_banner_click",{news_name:a.currentTarget.dataset.title,content:r}),"inside-mp"===e)wx.navigateTo({url:r});else if("web-view"===e)l.globalData.userInfo.idvId?(console.log("path---------","/pages/out/out?url="+encodeURIComponent(r)),wx.navigateTo({url:"/pages/out/out?url="+encodeURIComponent(r)})):this.handleBindUserDialog();else{var i=a.currentTarget.dataset.appid;i?wx.navigateToMiniProgram({appId:i,path:r}):wx.navigateTo({url:"/pages/out/out?url="+r})}l.eventTracking("2",t)},handleDing:function(){wx.requestSubscribeMessage({tmplIds:["HJ967D7Z2lbOejG0m6Ngu2c18Xi-AOZPMolOLdnpR0M","qu4m8mq3gcIqUtrih-GradI1Bl8nXkXmEqn16Gw1Mcg"],complete:function(a){}})},getUserInfo:function(){var a=this,t=l.globalData.userInfo;t?(t.idvId?(this.setData({userInfo:t}),this.getUserRecord(),this.getPlayerStatis(),this.getPlayerrecord(),this.getSevenRecord(),this.getUserEx()):(this.updateCanvas([],[],[]),this.data.needShowBind&&(this.data.needShowBind=!1,this.handleBindUserDialog())),t.phone&&""!=t.phone&&this.setData({userPhone:!0})):l.initUserOver=function(t){t.idvId?(a.setData({userInfo:t}),a.getUserRecord(),a.getPlayerStatis(),a.getPlayerrecord(),a.getSevenRecord(),a.getUserEx()):(a.updateCanvas([],[],[]),a.data.needShowBind&&a.handleBindUserDialog()),t.phone&&""!=t.phone&&a.setData({userPhone:!0})}},ifTimeOut:function(a){return(new Date).getTime()-a>l.globalData.overTime},getSevenRecord:function(){var a=this;wx.getStorage({key:"userSevenRecord20220812",success:function(t){var e=a.ifTimeOut(t.data.times);console.log(t,e),e?(console.log("过期了"),a.getUserSevenRecord()):(console.log("没过期"),a.setData({userSevenRecord:t.data.userSevenRecord,userButSevenRecord:t.data.userButSevenRecord,userCivSevenRecord:t.data.userCivSevenRecord}),a.updateCanvas("",t.data.userButSevenRecord,t.data.userCivSevenRecord))},fail:function(){a.getUserSevenRecord()},complete:function(){}})},getUserSevenRecord:function(){var a=this;wx.request({url:this.data.apiUrl+"/w/epro/wechatuser/mine/rank/seven",data:{wxToken:this.data.wxToken,server:"10001",roleId:a.data.userInfo.idvId},success:function(t){if(t.data&&t.data.data&&t.data.data.rank7&&t.data.data.rank7.data&&t.data.data.rank7.data.length>0){console.log("有数据");var e=t.data.data.rank7.data[0],r=[],i=[];for(var o in e.but_pvp_level_info_week){var s={str:e.but_pvp_level_info_week[o],qData:o};r.push(s)}for(var n in e.civ_pvp_level_info_week){var l={str:e.civ_pvp_level_info_week[n],qData:n};i.push(l)}r.forEach((function(a,t){var e=a.str.split("_");a.before_pvp_part=e[0],a.before_pvp_level=e[1],a.before_pvp_star=e[2]})),i.forEach((function(a,t){var e=a.str.split("_");a.before_pvp_part=e[0],a.before_pvp_level=e[1],a.before_pvp_star=e[2]})),a.setData({userSevenRecord:e,userButSevenRecord:r,userCivSevenRecord:i});var d={userSevenRecord:e,userButSevenRecord:r,userCivSevenRecord:i,times:(new Date).getTime()};wx.setStorage({key:"userSevenRecord20220812",data:d}),a.updateCanvas("",r,i)}else console.log("无数据")}})},getUserEx:function(){var a=this;function t(t){var i,s,n=r({},t);("-1_-1"!=n.but_toppart&&"-1_-1_-1"!=n.but_toppart||(n.but_toppart="1_3_0"),"-1_-1"!=n.civ_toppart&&"-1_-1_-1"!=n.civ_toppart||(n.civ_toppart="1_3_0"),"-1_-1_-1"==n.five_toppart&&(n.five_toppart="1_3_0"),n.but_toppart_duan=parseInt(n.but_toppart.split("_")[0]),n.but_toppart_jie=(0,o.convert)(parseInt(-1==n.but_toppart.split("_")[1]?0:n.but_toppart.split("_")[1])),n.but_toppart_jie_num=parseInt(n.but_toppart.split("_")[1]),n.but_toppart_xing=parseInt(n.but_toppart.split("_")[2]),n.but_toppart_duan<7?n.but_toppart_duanWei=(0,o.NoToChinese)(n.but_toppart_duan)+"阶":7==n.but_toppart_duan&&(n.but_toppart_xing>=25?(n.but_toppart_duan=8,n.but_toppart_duanWei="巅峰七阶"):n.but_toppart_duanWei="七阶"),n.civ_toppart_duan=parseInt(n.civ_toppart.split("_")[0]),n.civ_toppart_jie=(0,o.convert)(parseInt(-1==n.civ_toppart.split("_")[1]?0:n.civ_toppart.split("_")[1])),n.civ_toppart_jie_num=parseInt(n.civ_toppart.split("_")[1]),n.civ_toppart_xing=parseInt(n.civ_toppart.split("_")[2]),n.civ_toppart_duan<7?n.civ_toppart_duanWei=(0,o.NoToChinese)(n.civ_toppart_duan)+"阶":7==n.civ_toppart_duan&&(n.civ_toppart_xing>=25?(n.civ_toppart_duan=8,n.civ_toppart_duanWei="巅峰七阶"):n.civ_toppart_duanWei="七阶"),n.five_toppart_duan=parseInt(n.five_toppart.split("_")[0]),n.five_toppart_jie=(0,o.convert)(parseInt(-1==n.five_toppart.split("_")[1]?0:n.five_toppart.split("_")[1])),n.five_toppart_xing=parseInt(n.five_toppart.split("_")[2]),n.five_toppart_duanWei=(0,o.NoToChinese)(n.five_toppart_duan)+"阶",n.saiji_killall_rate=Math.round(1e3*n.saiji_killall_rate)/10+"%",n.saiji_escape_rate=Math.round(1e3*n.saiji_escape_rate)/10+"%",n.total_killall_rate=Math.round(1e3*n.total_killall_rate)/10+"%",n.total_escape_rate=Math.round(1e3*n.total_escape_rate)/10+"%",n.saiji_avg_tease=Math.round(10*n.saiji_avg_tease)/10+"s",n.total_avg_tease=Math.round(10*n.total_avg_tease)/10+"s",n.total_tease=Math.round(n.total_tease/60/60*10)/10+"h",n.saiji_tease=Math.round(n.saiji_tease/60/60*10)/10+"h",n.but_saiji_avg_score=Math.round(n.but_saiji_avg_score),n.civ_saiji_avg_score=Math.round(n.civ_saiji_avg_score),n.saiji_avg_break_board=Math.round(10*n.saiji_avg_break_board)/10,n.saiji_avg_attack_down=Math.round(10*n.saiji_avg_attack_down)/10,n.saiji_avg_terror_shock=Math.round(10*n.saiji_avg_terror_shock)/10,n.total_fix=Math.round(n.total_fix/100),n.saiji_fix=Math.round(n.saiji_fix/100),n.saiji_avg_fix=10*Math.round(n.saiji_avg_fix/10)+"%",n.saiji_avg_kill=Math.round(10*n.saiji_avg_kill)/10,n.saiji_avg_save=Math.round(10*n.saiji_avg_save)/10,n.civ_total_avg_score=Math.round(n.civ_total_avg_score),n.but_total_avg_score=Math.round(n.but_total_avg_score),n.total_avg_fix=10*Math.round(n.total_avg_fix/10)+"%",n.total_avg_save=Math.round(10*n.total_avg_save)/10,n.total_avg_break_board=Math.round(10*n.total_avg_break_board)/10,n.total_avg_attack_down=Math.round(10*n.total_avg_attack_down)/10,n.total_avg_terror_shock=Math.round(10*n.total_avg_terror_shock)/10,n.total_avg_kill=Math.round(10*n.total_avg_kill)/10,n.herolist=[],n.but_total_hero_list)&&(i=n.herolist).push.apply(i,e(n.but_total_hero_list));n.civ_total_hero_list&&(s=n.herolist).push.apply(s,e(n.civ_total_hero_list));if(n.but_saiji_hero_list&&n.but_saiji_hero_list,n.civ_saiji_hero_list&&n.but_saiji_hero_list,n.herolist){var l="",d=-1,u=null;if(n.herolist.forEach((function(a,t){a.badge>d&&(d=a.badge,l=a.hero_name,u=a.kill)})),-1!=d){var c="",g="";d<11?c="s":d<101?c="a":d<301?c="b":d<501&&(c="c"),g=null!=u?"j_"+c:"q_"+c,a.setData({badgeTop:d,badgeName:l,badgeCard:g})}else a.setData({badgeTop:null,badgeName:null,badgeCard:null})}a.setData({userEx:n}),a.getRadar(r({},t))}l.globalData.userRecord?t(l.globalData.userRecord):(l.userRecordOver=function(a){console.log("还没有这个, 现在有了"),t(l.globalData.userRecord)},l.getUserRecord())},getRadar:function(a){var t=this.data.userEx,e=this.data.ind,r=this.data.ind2,i=[Math.round(a.civ_saiji_avg_score)>e[0].max?e[0].max:Math.round(a.civ_saiji_avg_score),Math.round(10*a.saiji_avg_tease)/10>e[1].max?e[1].max:Math.round(10*a.saiji_avg_tease)/10,Math.round(100*a.saiji_avg_fix)/100>e[2].max?e[2].max:Math.round(100*a.saiji_avg_fix)/100,Math.round(t.saiji_cure/this.data.userPlayerStatis.civ_total_battle_num*1e4)/100>e[3].max?e[3].max:Math.round(t.saiji_cure/this.data.userPlayerStatis.civ_total_battle_num*1e4)/100,Math.round(100*a.saiji_avg_save)/100>e[4].max?e[4].max:Math.round(100*a.saiji_avg_save)/100,Math.round(1e4*a.saiji_escape_rate)/100>e[5].max?e[5].max:Math.round(1e4*a.saiji_escape_rate)/100],o=[Math.round(a.civ_total_avg_score)>e[0].max?e[0].max:Math.round(a.civ_total_avg_score),Math.round(10*a.total_avg_tease)/10>e[1].max?e[1].max:Math.round(10*a.total_avg_tease)/10,Math.round(100*a.total_avg_fix)/100>e[2].max?e[2].max:Math.round(100*a.total_avg_fix)/100,Math.round(t.total_cure/this.data.userPlayerStatis.civ_total_battle_num*1e4)/100>e[3].max?e[3].max:Math.round(t.total_cure/this.data.userPlayerStatis.civ_total_battle_num*1e4)/100,Math.round(100*a.total_avg_save)/100>e[4].max?e[4].max:Math.round(100*a.total_avg_save)/100,Math.round(1e4*a.total_escape_rate)/100>e[5].max?e[5].max:Math.round(1e4*a.total_escape_rate)/100],s=[Math.round(a.but_saiji_avg_score)>r[0].max?r[0].max:Math.round(a.but_saiji_avg_score),Math.round(100*a.saiji_avg_attack_down)/100>r[1].max?r[1].max:Math.round(100*a.saiji_avg_attack_down)/100,Math.round(100*a.saiji_avg_break_board)/100>r[2].max?r[2].max:Math.round(100*a.saiji_avg_break_board)/100,Math.round(100*a.saiji_avg_kill)/100>r[3].max?r[3].max:Math.round(100*a.saiji_avg_kill)/100,Math.round(100*a.saiji_avg_terror_shock)/100>r[4].max?r[4].max:Math.round(100*a.saiji_avg_terror_shock)/100,Math.round(1e4*a.saiji_killall_rate)/100>r[5].max?r[5].max:Math.round(1e4*a.saiji_killall_rate)/100],n=[Math.round(a.but_total_avg_score)>r[0].max?r[0].max:Math.round(a.but_total_avg_score),Math.round(100*a.total_avg_attack_down)/100>r[1].max?r[1].max:Math.round(100*a.total_avg_attack_down)/100,Math.round(100*a.total_avg_break_board)/100>r[2].max?r[2].max:Math.round(100*a.total_avg_break_board)/100,Math.round(100*a.total_avg_kill)/100>r[3].max?r[3].max:Math.round(100*a.total_avg_kill)/100,Math.round(100*a.total_avg_terror_shock)/100>r[4].max?r[4].max:Math.round(100*a.total_avg_terror_shock)/100,Math.round(1e4*a.total_killall_rate)/100>r[5].max?r[5].max:Math.round(1e4*a.total_killall_rate)/100];this.setData({currentRadarData1:i,allRadarData1:o,currentRadarData2:s,allRadarData2:n}),this.updateRadarBoxData()},getUserRecord:function(){var a=this,t=l.globalData.userRecord;t?this.setData({userRecord:t}):(l.userRecordOver=function(t){var e=t.userRecord;a.setData({userRecord:e})},l.getUserRecord())},updateRadarBoxData:function(){var a=(0,n.formatRadarBoxData)(this,this.data.arrayVal1,this.data.arrayVal2,this.data.userPlayerStatis,this.data.userEx),t=a.chartData,e=a.radarData;this.setData({chartData:t}),(0,n.initRadar)(this,e.data,e.ind,this.data.pixelRatio)},getPlayerStatis:function(){var a=this,t=l.globalData.userPlayerStatis;t?(console.log("获取游戏信息__缓存"),this.setData({userPlayerStatis:(0,n.formatUserPlayerStatis)(t)})):(console.log("获取游戏信息__非缓存"),l.userPlayerStatisOver=function(t){console.log("userPlayerStatisOver--func：",t),a.setData({userPlayerStatis:(0,n.formatUserPlayerStatis)(t)}),l.userPlayerStatisOver=null,a.getUserEx()},l.getPlayerStatis())},clearData:function(){l.clearGlobalData()},getPlayerrecord:function(){var a=this,t=l.globalData,e=t.userPlayerrecord,r=t.userButPvpPart,i=t.userCivPvpPart;e?(null!=l.globalData.usPvpPartIdentity&&this.setData({identity:l.globalData.usPvpPartIdentity}),this.setData({userPlayerrecord:e,userButPvpPart:r,userCivPvpPart:i}),this.searchPaiwei()):(l.userPlayerrecordOver=function(t,e,r){a.setData({userPlayerrecord:t,userButPvpPart:e,userCivPvpPart:r}),null!=l.globalData.usPvpPartIdentity&&a.setData({identity:l.globalData.usPvpPartIdentity}),a.searchPaiwei()},l.getPlayerrecord())},searchPaiwei:function(){var a=!1;this.data.userPlayerrecord.forEach((function(t,e){2==t.battleMode&&(a=!0)})),this.setData({canShowOneVs:a})},getNewslist:function(){var a=this,t=this.data,e=t.wxToken,r=t.pageNo,i=t.pageSize,o=t.loading,s=t.newsList,n=t.apiUrl;t.listStatus&&(o||(this.setData({loading:!0}),wx.request({url:n+"/w/epro/article/recommend",data:{wxToken:e,pageNo:r+1,pageSize:i,needTop:!1},success:function(t){var e=t.data;if(200==e.code&&e.data){var i=e.data,o=i.total,n=i.records;a.setData({newsList:r?s.concat(n):n,listStatus:!!o,pageNo:r+1})}else l.requestError(e.msg)},fail:function(a){l.requestError()},complete:function(){a.setData({loading:!1,firstLoading:!1})}})))},hanleJump:function(a){var t=a.currentTarget.dataset,e=t.path,r=t.tips;"/pages_user/pages/user/collect"==e?wx.reportEvent("home_collect",{}):"/pages_user/pages/draw/list"==e?wx.reportEvent("home_draw",{}):"/pages/out/out?url=https://id5.163.com/m/"==e?wx.reportEvent("home_dh",{}):"/pages/active/index"==e?wx.reportEvent("home_act_banner",{}):"/pages_user/pages/signin/index"==e&&(wx.setStorageSync("20221116icNew",!0),this.setData({icNew:!1})),r?(wx.showToast({title:r,icon:"none",duration:2e3}),wx.reportEvent("home_checkcheck",{})):"/pages_user/pages/signin/index"==e&&l.globalData.userInfo.idvId?this.getDingyue((function(){wx.navigateTo({url:e})})):"/pages_user/pages/user/mycollect"!=e||l.globalData.userInfo.idvId?wx.navigateTo({url:e}):this.handleBindUserDialog()},handleCustomListChange:function(a){this.setData({newsList:a.detail})},handleBindUserDialog:function(){this.setData({bindUserVisible:!0}),wx.reportEvent("home_bindcansee",{})},handleToggleRoles:function(){this.setData({checkRoleFlag:!0})},handleBind:function(a){"true"!==a.detail?this.setData({bindUserVisible:!this.data.bindUserVisible}):this.setData({bindUserVisible:!1})},onHide:function(){},onReady:function(){},handleInitChart:function(a,e,r){var o=this,s=r.yAxis,n=s.min,l=s.max-n==3;this.selectComponent("#mychart-dom-bar").init((function(s,n,u,c){var g=i.init(s,null,{width:n,height:u,devicePixelRatio:c});s.setChart(g);var _={xAxis:{type:"category",data:a,axisLine:{show:!0,lineStyle:{color:"#b7a38b"}},axisTick:{show:!1},axisLabel:{interval:2,showMaxLabel:!0,show:o.data.dataType,color:"#2d1d10",fontSize:9,margin:20}},grid:{left:70,bottom:40,top:90,right:30},yAxis:{show:!0,type:"value",scale:!0,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!0,color:"#2d1d10",fontSize:l?8:12,formatter:function(){var a=d.numToLevel(arguments.length<=0?void 0:arguments[0]).split(","),e=t(a,2),r=e[0],i=e[1];i=Number(i);var o="{level|"+r+"}\n";if(-1!==r.indexOf("七"))return Number(i)>25?o+"{dianfengqijie| } x"+i:o+"{dianfengqijie|} x"+i;for(var s=0,n=Number(i);s<n;s++)o+="{xing| }";return o},rich:{level:{color:"#2d1d10",align:"right",fontSize:l?10:12},xing:{color:"#000",height:l?6:8,width:l?6:8,align:"right",fontSize:6,backgroundColor:{image:o.data.imgUrl+"/home/xing.png"}},dianfengqijie:{color:"#000",height:l?8:12,width:l?8:12,align:"right",fontSize:6,backgroundColor:{image:o.data.imgUrl+"/vsrecord/ic/q_x2.png"}}}},splitLine:{show:!0,lineStyle:{color:"#b7a38b"}}},series:[{data:e,type:"line",symbol:"circle",symbolSize:5,lineStyle:{color:"#a2684e",width:1},itemStyle:{color:"#a2684e"},areaStyle:{opacity:.8,color:new i.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(230, 197, 173)"},{offset:1,color:"rgba(235, 205, 183, 0.3)"}])}}]};return r&&Object.keys(r).forEach((function(a){Object.assign(_[a],r[a])})),g.setOption(_),g}))},updateCanvas:function(a){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=[],i=[],o=0,s=0,n=1,l=this.data.identity?t:e;if(console.log(l),l.forEach((function(a,t){var e=d.levelToNum("".concat(a.before_pvp_part,"_").concat(a.before_pvp_level,"_").concat(a.before_pvp_star));if(t?(e>o&&(o=e),e<s&&(s=e)):(o=e,s=e),a.qData){var n=a.qData.slice(4),l=n.split("");l.splice(2,0,"."),n=l.join(""),r.push(n)}else r.push(a.qData);i.push(e)})),!r.length){var u="";this.data.identity&&this.data.userPlayerStatis?u=d.levelToNum(this.data.userPlayerStatis.but_pvp_part):this.data.userPlayerStatis&&(u=d.levelToNum(this.data.userPlayerStatis.civ_pvp_part)),console.log("nowDUan",!!u),u||0===u?(o=u+2,s=u,n=1):(o=180,s=178,n=1)}3!==(n=o-s)&&2!==n||(n=1),o===s&&(s-=1)},initChart:function(a,t,e,r){var o=i.init(a,null,{width:t,height:e,devicePixelRatio:r});return a.setChart(o),o.setOption(this.getLineOptions()),o},bindCol:function(a){this.getData()},search:function(){wx.navigateTo({url:"/pages/index/query"})},handleCustomReject:function(){var a;null!==(a=this.data.userInfo)&&void 0!==a&&a.idvId&&!l.globalData.userinfoApiStatus&&wx.redirectTo({url:l.globalData.pageIndex})},getremarks:function(){var a=this;wx.request({url:a.data.apiUrl+"/w/epro/common/dict/get/type/data/remarks",data:{type:"isEnterprise",name:"isPandaOpen"},header:{wxToken:a.data.wxToken},success:function(t){"true"==t.data.data?a.getqwFriend():"false"==t.data.data||l.requestError(t.msg)},fail:function(a){console.log("is me 22222"),l.requestError()},complete:function(){}})},getqwFriend:function(){var a=this,t=this;wx.getSystemInfo({success:function(a){console.log("屏幕",a);var e=a.screenWidth/a.screenHeight;t.setData({rqpm:e})}});var e=t.data,r=e.wxToken,i=e.apiUrl;wx.request({url:i+"/w/weChatEnterprise/isWechatContact",data:{wxToken:r},success:function(t){console.log(t),200==t.data.code?t.data.data?console.log("是企业微信"):a.findwqFanBao():l.requestError(t.msg)},fail:function(a){l.requestError()},complete:function(){}})},findwqFanBao:function(){var a=this,t=a.data,e=t.wxToken,r=t.apiUrl;wx.request({url:r+"/w/weChatEnterprise/limit",data:{wxToken:e},success:function(t){console.log("判断防爆",t),200==t.data.code?t.data.data.limit&&(console.log(a.data.homeHelper,"homeHelper"),a.setData({homeHelper:!0})):l.requestError(t.msg)},fail:function(a){l.requestError()},complete:function(){}})},addFrishow:function(){console.log(this.data.showAddfri),this.setData({showAddfri:!this.data.showAddfri}),this.data.isLongpress&&this.closeTcbox()},finishAddfri:function(){this.data.isLongpress=!0},showqwhb:function(){wx.reportEvent("home_popqw_btn2_click",{}),console.log(this.data.showAddfri),this.setData({showAddfri:!this.data.showAddfri})},closeTcbox:function(){this.setData({homeHelper:!1,wxHelper:!1,springTc:!1,headFalg:!1,adviserFlag:!1,checkRoleFlag:!1}),wx.setStorageSync("20221123fristInXCX",new Date)},showNextAd:function(a){var t=this.data.adviserUrlList,e=this.data.currentIndex;if(e>=t.length)return this.setData({adviserFlag:!1}),void(a||(getApp().globalData.isADShow=!1));t[e].show=!1,this.setData({adviserUrlList:t,currentIndex:e+1})},closeTcboxAD:(0,o.debounce)((function(a){var t=this,e=a.currentTarget.dataset.index,r=this.data.adviserUrlList;r[e].show=!0,this.setData({adviserUrlList:r}),setTimeout((function(){t.showNextAd()}),200)}),500),getDingyue:function(a){var t,e=this,r=this;l.globalData.signMsgUsed?a&&a():l.getUserSetting((function(i){var o=!1;console.log(i),"accept"===i.subscriptionsSetting[e.data.messageWxid[0]]?(console.log("总是订阅了该条订阅消息"),o=!0):(e.setData({messageTipGif:!0}),t=setInterval((function(){e.setData({messageTipGifUrl:"".concat(l.globalData.imgUrl,"/vsrecord/message_subscription-wechat.gif")})}),5e3)),wx.requestSubscribeMessage({tmplIds:e.data.messageWxid,success:function(a){console.log("requestSubscribeMessage__success",a),l.getUserSetting((function(a){"accept"===a.subscriptionsSetting[e.data.messageWxid[0]]&&(console.log("总是订阅了该条订阅消息"),o=!0),wx.request({url:r.data.apiUrl+"/w/subscribe/subscribe",data:{type:4,idvId:l.globalData.userInfo.idvId,always:o},method:"POST",header:{wxToken:r.data.wxToken},success:function(a){}})}))},fail:function(a){console.log(a,"订阅失败")},complete:function(r){l.globalData.signMsgUsed=!0,wx.reportEvent("signin_openmsg",{}),t&&(e.setData({messageTipGif:!1}),clearInterval(t),t=null),a&&a()}})}))},getPhoneNumber:function(a){var t=this;console.log(a),"getPhoneNumber:fail user deny"!=a.detail.errMsg?wx.request({url:t.data.apiUrl+"/w/epro/wechatuser/mine/bindPhone",data:{code:a.detail.code?a.detail.code:"",encryptedData:a.detail.encryptedData?a.detail.encryptedData:"",iv:a.detail.iv?a.detail.iv:""},method:"POST",header:{wxToken:t.data.wxToken},success:function(a){console.log("bindPhone",a),t.setData({userPhone:!0})}}):t.setData({userPhone:!0})},goPandaPart:function(a){console.log(a),a.target.dataset.gopandatype&&1==a.target.dataset.gopandatype?wx.reportEvent("panda_hometail_click",{}):a.target.dataset.gopandatype&&2==a.target.dataset.gopandatype&&wx.reportEvent("panda_homebanner_click",{}),this.setData({showPanda:!1}),wx.navigateTo({url:"/pages_user/pages/panda/panda"})},goTransfer:function(a){var t,e=this,r=this,i=a.currentTarget.dataset.id,o=a.currentTarget.dataset.type,s=a.currentTarget.dataset.path,n=a.currentTarget.dataset.appid,d=a.currentTarget.dataset.index;"dingyue"===s?l.getUserSetting((function(a){var i=!1;"accept"===a.subscriptionsSetting[e.data.msgOrderWxid[0]]?i=!0:(e.setData({messageTipGif:!0}),t=setInterval((function(){e.setData({messageTipGifUrl:"".concat(l.globalData.imgUrl,"/vsrecord/message_subscription-wechat.gif")})}),5e3)),wx.requestSubscribeMessage({tmplIds:e.data.msgOrderWxid,success:function(a){console.log("success",a),"accept"===a[e.data.msgOrderWxid[0]]&&l.getUserSetting((function(a){var t="";l.globalData.userInfo&&l.globalData.userInfo.idvId&&(t=l.globalData.userInfo.idvId),"accept"===a.subscriptionsSetting[e.data.msgOrderWxid[0]]&&(i=!0),wx.showToast({title:"订阅活动成功",icon:"none",duration:2e3}),wx.request({url:r.data.apiUrl+"/w/subscribe/subscribe",data:{type:15,idvId:t,always:i},method:"POST",header:{wxToken:r.data.wxToken},success:function(a){}})}))},fail:function(a){console.log(a,"订阅失败")},complete:function(a){e.closeTcboxAD({currentTarget:{dataset:{index:d}}}),t&&(e.setData({messageTipGif:!1}),clearInterval(t),t=null)}})})):"inside-mp"===o?wx.navigateTo({url:s}):"web-view"===o?l.globalData.userInfo.idvId?(console.log("path---------","/pages/out/out?url="+encodeURIComponent(s)),wx.navigateTo({url:"/pages/out/out?url="+encodeURIComponent(s)})):this.handleBindUserDialog():n?wx.navigateToMiniProgram({appId:n,path:s}):wx.navigateTo({url:"/pages/out/out?url="+s});this.setData({wxHelper:!1}),l.eventTracking("11",i)},onShow:function(){this.data.wxToken&&l.globalData.isFirstADShow&&(this.data.currentIndex=0,this.getAdviser())},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){this.getNewslist()},share:function(){console.log(分享函数)},onShareAppMessage:function(a){return console.log(a,"分享"),{title:"查战绩就上网易第五人格小程序",imageUrl:"https://nie.res.netease.com/r/pic/20231222/2cfe8cd1-36a1-4b67-9aa9-efa29a26b38e.png",path:"/pages/home/home/home"}},goSpring:function(){wx.navigateTo({url:"/pages/out/out?url=https://id5.163.com/h5/20230112/2023sf/"}),this.closeTcbox(),wx.reportEvent("spring_tc",{})},headNew:function(){wx.navigateTo({url:"/pages_user/pages/head/head"})},close:function(){this.setData({headFalg:!1})},bindPickerChange:function(a){this.setData({arrayVal1:this.data.array[a.detail.value]}),this.updateRadarBoxData(),wx.reportEvent("vsrecord_nowcom",{})},bindPickerChange2:function(a){this.setData({arrayVal2:this.data.array2[a.detail.value]}),this.updateRadarBoxData(this.data.arrayVal2,"-------------這台11111"),console.log()},getMore:function(){wx.navigateTo({url:"/pages/more/index"})},handleBindUserClose:function(){this.setData({bindVisibleDialog:!this.data.bindVisibleDialog,checkRoleFlag:!this.data.checkRoleFlag})},handUnBindProcess:function(){this.setData({bindVisibleDialog:!this.data.bindVisibleDialog})}});