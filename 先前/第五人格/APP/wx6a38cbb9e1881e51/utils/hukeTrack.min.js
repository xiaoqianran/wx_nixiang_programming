var e=require("../@babel/runtime/helpers/createForOfIteratorHelper"),t=require("../@babel/runtime/helpers/typeof"),i={},r=Array.isArray,n=Object.prototype,a=Array.prototype,s=a.forEach,o=a.indexOf,u=n.toString,c=n.hasOwnProperty,p=a.slice,d=function(e,t,i){if(null==e)return!1;var r={};if(s&&e.forEach===s)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,a=e.length;n<a;n++)if(n in e&&t.call(i,e[n],n,e)===r)return!1}else for(var o in e)if(c.call(e,o)&&t.call(i,e[o],o,e)===r)return!1};function h(e){return null!=e&&"[object Object]"==u.call(e)}var f,l=(f=(new Date).getTime(),function(e){return Math.ceil((f=(9301*f+49297)%233280)/233280*e)});function _(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),h(e)&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}return l(1e19)/1e19}function g(e){return d(p.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])})),e}var m=r||function(e){return"[object Array]"===u.call(e)};function y(e){return!(!e||!c.call(e,"callee"))}function v(e){var t=[];return null==e||d(e,(function(e){t[t.length]=e})),t}function S(){var e=Date.now();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:3&i|8).toString(16)}))}var b=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},I=Number.isSafeInteger||function(e){return b(e)&&Math.abs(e)<=Math.pow(2,53)-1},k={each:d,isObject:h,getRandomBasic:l,getRandom:_,extend:g,extend2Lev:function(e){return d(p.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&null!==t[i]&&(h(t[i])&&h(e[i])?g(e[i],t[i]):e[i]=t[i])})),e},coverExtend:function(e){return d(p.call(arguments,1),(function(t){for(var i in t)void 0!==t[i]&&void 0===e[i]&&(e[i]=t[i])})),e},isArray:m,isFunction:function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t},isArguments:y,toArray:function(e){return e?e.toArray?e.toArray():m(e)||y(e)?p.call(e):v(e):[]},values:v,include:function(e,t){var i=!1;return null==e?i:o&&e.indexOf===o?-1!=e.indexOf(t):(d(e,(function(e){if(i||(i=e===t))return{}})),i)},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},isEmptyObject:function(e){if(h(e)){for(var t in e)if(c.call(e,t))return!1;return!0}return!1},deepCopy:function(e){var t={};return function e(t,i){for(var r in i){var n=i[r];m(n)?(t[r]=[],e(t[r],n)):h(n)?(t[r]={},e(t[r],n)):t[r]=n}}(t,e),t},isUndefined:function(e){return void 0===e},isString:function(e){return"[object String]"==u.call(e)},isDate:function(e){return"[object Date]"==u.call(e)},isBoolean:function(e){return"[object Boolean]"==u.call(e)},isNumber:function(e){return"[object Number]"==u.call(e)&&/[\d\.]+/.test(String(e))},isJSONString:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isInteger:b,isSafeInteger:I,slice:p,uuid:S},P={buildData:function(e,t){var r={distinctId:i.store.getDistinctId(),identities:i.store._state.identities,properties:{}};return"track_id_unbind"===e.type&&"$UnbindID"===e.event&&(r.identities=k.deepCopy(e.unbind_value),delete e.unbind_value),k.isObject(t)||(t={}),k.extend(r,i.store.getUnionId(),e),k.isObject(e.properties)&&!k.isEmptyObject(e.properties)&&k.extend(r.properties,e.properties),e.type&&"profile"===e.type.slice(0,7)||(r._trackId=Number(String(_()).slice(2,5)+String(_()).slice(2,4)+String(Date.now()).slice(-4)),r.properties=k.extend({},k.info.properties,i.store.getProps(),k.info.currentProps,t,r.properties),"track"===e.type&&(r.properties.isFirstDay=k.getIsFirstDay()),function(e){if(e&&e.properties){var t=i._.getRefPage(),r=i._.getCurrentPageInfo(),n={referrer:t.route,referrerTitle:t.title,title:r.title,url:r.url};for(var a in!0===i.para.preset_properties.url_path&&(n.urlPath=r.path),n)e.properties.hasOwnProperty(a)||(e.properties[a]=n[a])}}(r)),r.properties.$time&&k.isDate(r.properties.$time)?(r.time=1*r.properties.$time,delete r.properties.$time):r.time=1*new Date,i.ee.sdk.emit("createData",r),k.parseSuperProperties(r.properties),k.searchObjDate(r),k.searchObjString(r),r},processData:function(e){return e},onceTrackData:function(e){return"data="+function(e){return e=JSON.stringify(e),i._.base64Encode(e)}(e)},batchTrackData:function(e){var t=Date.now(),i="",r="",n="";return e.forEach((function(e){e._flushTime=t,e.identities&&e.identities.identityMpUnionid&&(r=e.identities.identityMpUnionid),e.identities&&e.identities.hukeShareInfo&&(n=e.identities.hukeShareInfo),e.identities&&e.identities.identityMpOpenid&&(i=e.identities.identityMpOpenid)})),{data:e,openId:i,unionId:r,shareInfo:n}},onEventSend:function(){return{}}},O={getData:function(e){wx.getStorage({key:i.para.storage_prepare_data_key,complete:function(t){var r=t.data&&i._.isArray(t.data)?t.data:[];O.deleteAesData(r),e&&e()}})},deleteAesData:function(e){var t=[],r=e.length;if(r>0){for(var n=0;n<r;n++)i._.isObject(e[n])&&t.push(e[n]);i.store.mem.mdata=t.concat(i.store.mem.mdata)}}},x={dataHasSend:!0,dataHasChange:!1,syncStorage:!1,failTime:0,init:function(){O.getData(x.syncStorageState),x.batchInterval()},syncStorageState:function(){x.syncStorage=!0},onAppHide:function(){i.para.batch_send&&this.batchSend()},send:function(e){this.dataHasChange=!0,i.store.mem.getLength()>=500&&(i._.logger.info("数据量存储过大，有异常"),i.store.mem.mdata.shift()),(e=P.processData(e))&&i.store.mem.add(e),i.store.mem.getLength()>=i.para.batch_send.max_length&&this.batchSend()},wxrequest:function(e){if(i._.isArray(e.data)&&e.data.length>0){var t=P.batchTrackData(e.data);i._.wxrequest({url:i.para.serverUrl,method:"POST",dataType:"text",data:t,success:function(){e.success(e.len)},fail:function(){e.fail()}})}else e.success(e.len)},batchSend:function(){if(this.dataHasSend){var e,t,r=i.store.mem.mdata;(t=(e=r.length>=100?r.slice(0,100):r).length)>0&&(this.dataHasSend=!1,this.wxrequest({data:e,len:t,success:this.batchRemove.bind(this),fail:this.sendFail.bind(this)}))}},sendFail:function(){this.dataHasSend=!0,this.failTime++},batchRemove:function(e){i.store.mem.clear(e),this.dataHasSend=!0,this.dataHasChange=!0,this.batchWrite(),this.failTime=0},is_first_batch_write:!0,batchWrite:function(){var e=this;this.dataHasChange&&(this.is_first_batch_write&&(this.is_first_batch_write=!1,setTimeout((function(){e.batchSend()}),1e3)),this.dataHasChange=!1,this.syncStorage&&i._.setStorageSync(i.para.storage_prepare_data_key,i.store.mem.mdata))},batchInterval:function(){var e=this;!function t(){setTimeout((function(){e.batchWrite(),t()}),500)}(),function t(){setTimeout((function(){e.batchSend(),t()}),i.para.batch_send.send_timeout*Math.pow(2,e.failTime))}()}};var w={send:function(e,t){if(!i.para.serverUrl)return i._.logger.info("error: serverUrl 不能为空"),!1;if(i.current_scene&&1154===i.current_scene&&!i.para.preset_events.moments_page)return!1;var r=i._.deepCopy(e),n=i.kit.onEventSend(r),a=i.kit.buildData(e,n);a?(w.debug(a),i.events.emit("send",a),console.log("data232323232",a,i.para),i.para.batch_send?x.send(a):function(e){e._flushTime=Date.now();var t=function(e,t){var i=P.onceTrackData(t);return-1!==e.indexOf("?")?e+"&"+i:e+"?"+i}(i.para.serverUrl,e);i._.wxrequest({url:t,method:"GET"})}(a)):i._.logger.info("error: 数据异常 "+a)},debug:function(e){i._.logger.info(e)}},C={init_status:!1,life_state:{app_launched:!1},plugin:{init_list:[],uninitialized_list:[]},privacy:{enable_data_collect:!1},mp_hook:{data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onShareAppMessage:1,onShareTimeline:1,onReachBottom:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1},user:{LOGIN_ID_KEY:"identityLoginId"}};function T(){var e;return global&&global.huke_data_pre_config&&(e=!!global.huke_data_pre_config.is_compliance_enabled&&global.huke_data_pre_config.is_compliance_enabled),!e||!!C.init_status||!!C.privacy.enable_data_collect}function D(e,t,r){var n=i.autoTrackCustom[r];if(e[t]){var a=e[t];e[t]=function(){!i.para.autoTrackIsFirst||h(i.para.autoTrackIsFirst)&&!i.para.autoTrackIsFirst[r]?(a.apply(this,arguments),n.apply(this,arguments)):(!0===i.para.autoTrackIsFirst||h(i.para.autoTrackIsFirst)&&i.para.autoTrackIsFirst[r])&&(n.apply(this,arguments),a.apply(this,arguments))}}else e[t]=function(){n.apply(this,arguments)}}function j(e){var t={},r={},n="",a=e.currentTarget||{},s=e.target||{};if(h(i.para.framework)&&h(i.para.framework.taro)&&!i.para.framework.taro.createApp&&s.id&&a.id&&s.id!==a.id)return!1;var o=a.dataset||{};if(n=e.type,t.$element_id=a.id,t.$element_type=o.type,t.$element_content=o.content,t.$element_name=o.name,h(e.event_prop)&&(r=e.event_prop),n&&$(n)){if(i.para.preset_events&&i.para.preset_events.collect_element&&!1===i.para.preset_events.collect_element(arguments[0]))return!1;t.urlPath=i._.getCurrentPath(),i._.setPageRefData(t),t=i._.extend(t,r),i.track("$MPClick",t)}}function A(e,t){var r=e[t];e[t]=function(){var e=r.apply(this,arguments),t=arguments[0];return h(t)&&(i.para.preset_events.defer_track?setTimeout((function(){j(t)}),0):j(t)),e}}function $(e){return!!{tap:1,longpress:1,longtap:1}[e]}function U(e){var t=[];if(i.para.autoTrack&&i.para.autoTrack.mpClick){t=function(e){var t=C.mp_hook,i=[];for(var r in e)"function"!=typeof e[r]||t[r]||i.push(r);return i}(e),function(e){var t=e.onTabItemTap;e.onTabItemTap=function(e){t&&t.apply(this,arguments);var r={};e&&(r.$element_content=e.text),r.$element_type="tabBar",r.urlPath=i._.getCurrentPath(),i._.setPageRefData(r),i.track("$MPClick",r)}}(e);for(var r=t.length,n=0;n<r;n++)A(e,t[n])}}function q(e){i.para.autoTrack&&i.para.autoTrack.pageLeave&&function(e){var t=e.onHide;e.onHide=function(){t&&t.apply(this,arguments),i._.sendPageLeave()};var r=e.onUnload;e.onUnload=function(){r&&r.apply(this,arguments),i._.sendPageLeave()}}(e),D(e,"onLoad","pageLoad"),D(e,"onShow","pageShow"),D(e,"onAddToFavorites","pageAddFavorites"),"function"==typeof e.onShareAppMessage&&i.autoTrackCustom.pageShare(e),"function"==typeof e.onShareTimeline&&i.autoTrackCustom.pageShareTimeline(e)}function M(e){return"function"==typeof e||!(!e||"object"!=t(e))&&M(e.listener)}function L(){this._events={}}function F(e,t){return e!==i.store._state.history_login_id.name||i.store._state.history_login_id.value!==t}function E(e){var t=i.store.getFirstId(),r=i.store.getDistinctId();return t?e===t:e===r}function R(t,i){var r,n=["identityAnonymousId","mpOpenid","identityMpOpenid","identityMpUnionid","mpUnionid"],a=e((m(i)&&(n=n.concat(i)),n));try{for(a.s();!(r=a.n()).done;){if(r.value===t)return!0}}catch(e){a.e(e)}finally{a.f()}return!1}i.popupEmitter={attached:function(){return!1}},L.prototype.on=function(e,i){if(!e||!i)return!1;if(!M(i))throw new Error("listener must be a function");this._events[e]=this._events[e]||[];var r="object"==t(i);return this._events[e].push(r?i:{listener:i,once:!1}),this},L.prototype.prepend=function(e,i){if(!e||!i)return!1;if(!M(i))throw new Error("listener must be a function");this._events[e]=this._events[e]||[];var r="object"==t(i);return this._events[e].unshift(r?i:{listener:i,once:!1}),this},L.prototype.prependOnce=function(e,t){return this.prepend(e,{listener:t,once:!0})},L.prototype.once=function(e,t){return this.on(e,{listener:t,once:!0})},L.prototype.off=function(e,t){var i=this._events[e];if(!i)return!1;if("number"==typeof t)i.splice(t,1);else if("function"==typeof t)for(var r=0,n=i.length;r<n;r++)i[r]&&i[r].listener===t&&i.splice(r,1);return this},L.prototype.emit=function(e,t){var i=this._events[e];if(!i)return!1;for(var r=0;r<i.length;r++){var n=i[r];n&&(n.listener.call(this,t||{}),n.once&&this.off(e,r))}return this},L.prototype.removeAllListeners=function(e){e&&this._events[e]?this._events[e]=[]:this._events={}},L.prototype.listeners=function(e){return e&&"string"==typeof e?this._events[e]:this._events},i.kit=P,i.mergeStorageData=O,i.saEvent=w,i.sendStrategy=x,i._=k,i.ee={},i.ee.sdk=new L,i.IDENTITY_KEY={EMAIL:"$identity_email",MOBILE:"$identity_mobile"},i.usePlugin=function(e,t){if(e&&e.info&&"miniprogram_abtesting"===e.info.lib_plugin_name)return"function"==typeof e.init&&e.init(i,t),!1;if(C.init_status)"function"==typeof e.init&&e.init(i,t);else{var r={target:e,para:t};C.plugin.uninitialized_list.push(r)}},i.checkPluginInitStatus=function(){if(C.plugin.uninitialized_list.length>0){for(var e in C.plugin.uninitialized_list){var t=C.plugin.uninitialized_list[e];t&&t.target&&"function"==typeof t.target.init&&t.target.init(i,t.para)}C.plugin.uninitialized_list=[]}},i.enableDataCollect=function(){C.privacy.enable_data_collect=!0},i.para={name:"huke",serverUrl:"https://urchin.netease.com/api/urchin/wxshare/record/detail/upload",send_timeout:1e3,show_log:!1,login_id_key:"identityLoginId",allow_amend_share_path:!0,max_string_length:500,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0,pageShow:!0,pageShare:!0,mpClick:!1,mpFavorite:!0,pageLeave:!0},autotrack_exclude_page:{pageShow:[],pageLeave:[]},is_persistent_save:{share:!1,utm:!1},preset_properties:{url_path:!0},preset_events:{moments_page:!1,defer_track:!1,share_info_use_string:!1},batch_send:!0,storage_store_key:"hukedata_wechat",storage_prepare_data_key:"huke_mp_prepare_data"};var Q="object"==t(Q)?Q:{};Q.info=function(){if(i.para.show_log&&"object"==("undefined"==typeof console?"undefined":t(console))&&console.log)try{if(3===arguments.length)return console.log(arguments[0],arguments[1],arguments[2]);if(2===arguments.length)return console.log(arguments[0],arguments[1]);if(1===arguments.length)return console.log(arguments[0])}catch(e){console.log(arguments[0])}},k.logger=Q,i.setPara=function(e){i.para=k.extend2Lev(i.para,e);var t=[];if(k.isArray(i.para.source_channel))for(var r=i.para.source_channel.length,n=0;n<r;n++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" "+i.para.source_channel[n]+" ")&&t.push(i.para.source_channel[n]);i.para.source_channel=t,k.isObject(i.para.register)&&k.extend(k.info.properties,i.para.register),i.para.openid_url||(i.para.openid_url=i.para.serverUrl.replace(/([^\/])\/(hukeTrack)(\.gif){0,1}/,"$1/mp_login")),"number"!=typeof i.para.send_timeout&&(i.para.send_timeout=1e3);var a={send_timeout:6e3,max_length:6};e&&e.datasend_timeout||i.para.batch_send&&(i.para.datasend_timeout=1e4),!0===i.para.batch_send?i.para.batch_send=k.extend({},a):k.isObject(i.para.batch_send)&&(i.para.batch_send=k.extend({},a,i.para.batch_send));var s={share:!1,utm:!1};!0===i.para.is_persistent_save?(i.para.is_persistent_save=k.extend({},s),i.para.is_persistent_save.utm=!0):k.isObject(i.para.is_persistent_save)&&(i.para.is_persistent_save=k.extend({},s,i.para.is_persistent_save)),i.para.serverUrl?(i.para.preset_properties=k.isObject(i.para.preset_properties)?i.para.preset_properties:{},k.isObject(i.para.autotrack_exclude_page)||(i.para.autotrack_exclude_page={pageShow:[],pageLeave:[]}),k.isArray(i.para.autotrack_exclude_page.pageShow)||(i.para.autotrack_exclude_page.pageShow=[]),k.isArray(i.para.autotrack_exclude_page.pageLeave)||(i.para.autotrack_exclude_page.pageLeave=[])):Q.info("请使用 setPara() 方法设置 serverUrl 数据接收地址")},i.getServerUrl=function(){return i.para.serverUrl};var N,K,H,B=["$latest_utm_source","$latest_utm_medium","$latest_utm_campaign","$latest_utm_content","$latest_utm_term","$latest_sa_utm"],V=["$latest_share_distinct_id","$latest_share_url_path","$latest_share_depth","$latest_share_method"],z=["huke_share_d","huke_share_p","huke_share_i","huke_share_m"],J=Date.now(),Y=null,G=0,W="",Z="",X="",ee=!1,te="",ie={},re=[];k.decodeURIComponent=function(e){var t="";try{t=decodeURIComponent(e)}catch(i){t=e}return t},k.encodeDates=function(e){return k.each(e,(function(t,i){k.isDate(t)?e[i]=k.formatDate(t):k.isObject(t)&&(e[i]=k.encodeDates(t))})),e},k.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())},k.searchObjDate=function(e){k.isObject(e)&&k.each(e,(function(t,i){k.isObject(t)?k.searchObjDate(e[i]):k.isDate(t)&&(e[i]=k.formatDate(t))}))},k.formatString=function(e){return e.length>i.para.max_string_length?(Q.info("字符串长度超过限制，已经做截取--"+e),e.slice(0,i.para.max_string_length)):e},k.searchObjString=function(e){k.isObject(e)&&k.each(e,(function(t,i){k.isObject(t)?k.searchObjString(e[i]):k.isString(t)&&(e[i]=k.formatString(t))}))},k.parseSuperProperties=function(e){k.isObject(e)&&(k.each(e,(function(t,i){if(k.isFunction(t))try{e[i]=t(),k.isFunction(e[i])&&(Q.info("您的属性- "+i+" 格式不满足要求，我们已经将其删除"),delete e[i])}catch(t){delete e[i],Q.info("您的属性- "+i+" 抛出了异常，我们已经将其删除")}})),k.strip_sa_properties(e))},k.unique=function(e){for(var t,i=[],r={},n=0;n<e.length;n++)(t=e[n])in r||(r[t]=!0,i.push(t));return i},k.check={checkKeyword:function(e){return/^((?!^distinctId$|^original_id$|^device_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_group|^user_tag)[a-zA-Z_$][a-zA-Z\d_$]{0,99})$/i.test(e)},ckeckIdLength:function(e){return!(String(e).length>255&&(Q.info("id 长度超过 255 个字符！"),1))}},k.strip_sa_properties=function(e){return k.isObject(e)?(k.each(e,(function(t,i){if(k.isArray(t)){var r=[];k.each(t,(function(e){k.isString(e)?r.push(e):Q.info("您的数据-",t,"的数组里的值必须是字符串,已经将其删除")})),e[i]=r}k.isString(t)||k.isNumber(t)||k.isDate(t)||k.isBoolean(t)||k.isArray(t)||(Q.info("您的数据 - "+i+":"+t+" - 格式不满足要求，已经将其删除"),delete e[i])})),e):e},k.strip_empty_properties=function(e){var t={};return k.each(e,(function(e,i){null!=e&&(t[i]=e)})),t},k.utf8Encode=function(e){var t,i,r,n,a="";for(t=i=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,n=0;n<r;n++){var s=e.charCodeAt(n),o=null;s<128?i++:o=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==o&&(i>t&&(a+=e.substring(t,i)),a+=o,t=i=n+1)}return i>t&&(a+=e.substring(t,e.length)),a},k.base64Encode=function(e){var t,i,r,n,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=0,u=0,c="",p=[];if(!e)return e;e=k.utf8Encode(e);do{t=(a=e.charCodeAt(o++)<<16|e.charCodeAt(o++)<<8|e.charCodeAt(o++))>>18&63,i=a>>12&63,r=a>>6&63,n=63&a,p[u++]=s.charAt(t)+s.charAt(i)+s.charAt(r)+s.charAt(n)}while(o<e.length);switch(c=p.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c},k.urlSafeBase64=(N={"+":"-","/":"_","=":"."},K={"-":"+",_:"/",".":"="},{encode:function(e){return e.replace(/[+/=]/g,(function(e){return N[e]}))},decode:function(e){return e.replace(/[-_.]/g,(function(e){return K[e]}))},trim:function(e){return e.replace(/[.=]{1,2}$/,"")},isBase64:function(e){return/^[A-Za-z0-9+/]*[=]{0,2}$/.test(e)},isUrlSafeBase64:function(e){return/^[A-Za-z0-9_-]*[.]{0,2}$/.test(e)}}),k.btoa=function(e){for(var t,i,r,n,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="",o=0,u=(e=String(e)).length%3;o<e.length;)((i=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255)&&Q.info("Failed to execute 'btoa' : The string to be encoded contains characters outside of the Latin1 range."),s+=a.charAt((t=i<<16|r<<8|n)>>18&63)+a.charAt(t>>12&63)+a.charAt(t>>6&63)+a.charAt(63&t);return u?s.slice(0,u-3)+"===".substring(u):s},k.urlBase64Encode=function(e){return k.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},k.rot13obfs=function(e,t){t="number"==typeof t?t:13;for(var i=(e=String(e)).split(""),r=0,n=i.length;r<n;r++)i[r].charCodeAt(0)<126&&(i[r]=String.fromCharCode((i[r].charCodeAt(0)+t)%126));return i.join("")},k.rot13defs=function(e){return e=String(e),k.rot13obfs(e,113)},k.getCurrentPage=function(){var e={};try{var t=getCurrentPages();e=t[t.length-1]}catch(e){Q.info(e)}return e},k.getCurrentPath=function(){var e="未取到";try{var t=k.getCurrentPage();e=t?t.route:e}catch(e){Q.info(e)}return e},k.getIsFirstDay=function(){return"object"==t(i.store._state)&&"number"==typeof i.store._state.first_visit_day_time&&i.store._state.first_visit_day_time>(new Date).getTime()},k.getCurrentUrl=function(e){var t=k.getCurrentPath(),i="";return k.isObject(e)&&e.huke_mp_encode_url_query&&(i=e.huke_mp_encode_url_query),t?i?t+"?"+i:t:"未取到"},k.getPath=function(e){return"string"==typeof e?e.replace(/^\//,""):"取值异常"},i.initialState={queue:[],isComplete:!1,systemIsComplete:!1,storeIsComplete:!1,checkIsComplete:function(){this.systemIsComplete&&this.storeIsComplete&&(this.isComplete=!0,this.queue.length>0&&(k.each(this.queue,(function(e){"appLaunch"===e[0]?i.autoTrackCustom.appLaunch.apply(i.autoTrackCustom,k.slice.call(e[1])):i[e[0]].apply(i,k.slice.call(e[1]))})),this.queue=[]))}},k.getCustomUtmFromQuery=function(e,t,r,n){if(!k.isObject(e))return{};var a={};if(e.sa_utm)for(var s in e)"sa_utm"!==s?k.include(i.para.source_channel,s)&&(a[r+s]=e[s]):a[n+s]=e[s];else for(var s in e)-1===" utm_source utm_medium utm_campaign utm_content utm_term ".indexOf(" "+s+" ")?k.include(i.para.source_channel,s)&&(a[r+s]=e[s]):a[t+s]=e[s];return a},k.getObjFromQuery=function(e){var t=e.split("?"),i=[],r={};return t&&t[1]?(k.each(t[1].split("&"),(function(e){(i=e.split("="))[0]&&i[1]&&(r[i[0]]=i[1])})),r):{}},k.setStorageSync=function(e,t){var i=function(){wx.setStorageSync(e,t)};try{i()}catch(e){Q.info("set Storage fail --",e);try{i()}catch(e){Q.info("set Storage fail again --",e)}}},k.getStorageSync=function(e){var t="";try{t=wx.getStorageSync(e)}catch(i){try{t=wx.getStorageSync(e)}catch(e){Q.info("getStorage fail")}}return t},k.getMPScene=function(e){return"number"==typeof e||"string"==typeof e&&""!==e?e="wx-"+String(e):"未取到值"},k.objToParam=function(e,t){if("[object Object]"!==Object.prototype.toString.call(e))return Q.info("请传入有效对象"),"";var i=[];for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];void 0===n?i.push(r+"="):(n=t?encodeURIComponent(n):n,i.push(r+"="+n))}return i.join("&")},k.delObjectKey=function(e){if("[object Object]"===Object.prototype.toString.call(e))for(var t=0;t<z.length;t++)delete e[z[t]];else Q.info("请传入有效对象")},k.shareInfoData=function(e){var t={},r={};if(i.para.preset_events.share_info_use_string){r=e.query;for(var n=0;n<z.length;n++){if(!r.hasOwnProperty(z[n]))return{};r[z[n]]=k.decodeURIComponent(r[z[n]])}t={depth:Number(r.huke_share_d),path:r.huke_share_p||"",id:r.huke_share_i||"",method:r.huke_share_m||""}}else{if(!e.query.sampshare)return{};if(r=k.decodeURIComponent(e.query.sampshare),!k.isJSONString(r))return{};t={depth:(r=JSON.parse(r)).d,path:r.p,id:r.i,method:r.m}}return t},k.setShareInfo=function(e,t){var r={},n={},a=i.store.getDistinctId(),s=i.store.getFirstId();if(e&&k.isObject(e.query)){if(r=k.shareInfoData(e),k.isEmptyObject(r))return{};var o=r.depth,u=r.path,c=r.id,p=r.method}"string"==typeof c?(t.$share_distinct_id=c,W=c,n.$latest_share_distinct_id=c):t.$share_distinct_id="取值异常","number"==typeof o?!W||W!==a&&W!==s?!W||W===a&&W===s?t.$share_depth="-1":(t.$share_depth=o+1,G=o+1,n.$latest_share_depth=o+1):(t.$share_depth=o,G=o,n.$latest_share_depth=o):t.$share_depth="-1","string"==typeof u?(t.$share_url_path=u,n.$latest_share_url_path=u):t.$share_url_path="取值异常","string"==typeof p?(t.$share_method=p,n.$latest_share_method=p):t.$share_method="取值异常",k.setLatestShare(n)},k.getShareInfo=function(){if(i.para.preset_events.share_info_use_string){var e={huke_share_i:i.store.getDistinctId()||"取值异常",huke_share_p:k.getCurrentPath(),huke_share_d:G,huke_share_m:Z};return k.objToParam(e,!0)}var t=JSON.stringify({i:i.store.getDistinctId()||"取值异常",p:k.getCurrentPath(),d:G,m:Z});return"sampshare="+encodeURIComponent(t)},k.detectOptionQuery=function(e){if(!e||!k.isObject(e.query))return{};var t,r,n,a,s={};return s.query=k.extend({},e.query),"string"==typeof s.query.scene&&(t=s.query,r=["utm_source","utm_content","utm_medium","utm_campaign","utm_term","sa_utm"].concat(i.para.source_channel),n=new RegExp("("+r.join("|")+")%3D","i"),1===(a=Object.keys(t)).length&&"scene"===a[0]&&n.test(t.scene))&&(s.scene=s.query.scene,delete s.query.scene),e.query.q&&e.query.scancode_time&&"101"===String(e.scene).slice(0,3)&&(s.q=String(s.query.q),delete s.query.q,delete s.query.scancode_time),s},k.getMixedQuery=function(e){var t=k.detectOptionQuery(e),i=t.scene,r=t.q,n=t.query;for(var a in n)n[a]=k.decodeURIComponent(n[a]);return i&&(i=-1!==(i=k.decodeURIComponent(i)).indexOf("?")?"?"+i.replace(/\?/g,""):"?"+i,k.extend(n,k.getObjFromQuery(i))),r&&k.extend(n,k.getObjFromQuery(k.decodeURIComponent(r))),n},k.setUtm=function(e,t){var i={},r=k.getMixedQuery(e),n=k.getCustomUtmFromQuery(r,"$","_","$"),a=k.getCustomUtmFromQuery(r,"$latest_","_latest_","$latest_");return i.pre1=n,i.pre2=a,k.extend(t,n),i},k.setSfSource=function(e,t){!k.isEmptyObject(e.query)&&e.query._sfs&&(t.$sf_source=e.query._sfs,i.registerApp({$latest_sf_source:t.$sf_source}))},k.setPageSfSource=function(e){try{var t=k.getCurrentPage(),i=t?t.options:"",r=k.deepCopy(i);for(var n in r)r[n]=k.decodeURIComponent(r[n]);!k.isEmptyObject(r)&&r._sfs&&(e.$sf_source=r._sfs)}catch(e){Q.info(e)}};try{var ne=wx.setNavigationBarTitle;Object.defineProperty(wx,"setNavigationBarTitle",{get:function(){return function(e){var t=k.getCurrentPath();e=k.isObject(e)?e:{},ie[t]=e.title,ne.call(this,e)}}})}catch(i){Q.info(i)}k.setRefPage=function(){var e="直接打开",t={route:e,path:e,title:""};try{var i=k.getCurrentPage();if(i&&i.route){var r=i.hukeMpUrlQuery?"?"+i.hukeMpUrlQuery:"",n=i.route,a=k.getPageTitle(n);t.route=n+r,t.path=n,t.title=a,re.length>=2?(re.shift(),re.push(t)):re.push(t)}}catch(e){Q.info(e)}},k.getRefPage=function(){var e="直接打开",t={route:e,path:e,title:""};return re.length>1&&(t.title=re[0].title,t.route=re[0].route,t.path=re[0].path),t},k.getCurrentPageInfo=function(){var e=k.getCurrentPage(),t={title:"",url:"",path:"未取到"};if(e&&e.route){var i=e.hukeMpUrlQuery?"?"+e.hukeMpUrlQuery:"";t.title=k.getPageTitle(e.route),t.url=e.route+i,t.path=e.route}return t},k.setPageRefData=function(e,t,i){var r=k.getRefPage();k.isObject(e)&&(t?re.length>0&&t?(i=i?"?"+i:"",e.referrer=k.getPath(t)+i,e.referrerTitle=k.getPageTitle(t)):(e.referrer="直接打开",e.referrerTitle=""):(e.referrer=r.route,e.referrerTitle=r.title))},k.getPageTitle=function(e){if("未取到"===e||!e)return"";var t="";try{if(__wxConfig){var i=__wxConfig,r=__wxConfig.page||{},n=r[e]||r[e+".html"],a={},s={};if(i.global&&i.global.window&&i.global.window.navigationBarTitleText&&(a.titleVal=i.global.window.navigationBarTitleText),n&&n.window&&n.window.navigationBarTitleText&&(s.titleVal=n.window.navigationBarTitleText),!s.titleVal&&__wxAppCode__){var o=__wxAppCode__[e+".json"];o&&o.navigationBarTitleText&&(s.titleVal=o.navigationBarTitleText)}if(k.each(ie,(function(i,r){if(r===e)return t=i})),0===t.length){var u=k.extend(a,s);t=u.titleVal||""}}}catch(e){Q.info(e)}return t},k.wxrequest=function(e){if(k.compareSDKVersion(te,"2.10.0")>=0)e.timeout=i.para.datasend_timeout,wx.request(e);else{var t=wx.request(e);setTimeout((function(){k.isObject(t)&&k.isFunction(t.abort)&&t.abort()}),i.para.datasend_timeout)}},k.getAppInfoSync=function(){if(wx.getAccountInfoSync){var e=wx.getAccountInfoSync(),t=e&&e.miniProgram?e.miniProgram:{};return{appId:t.appId,appEnv:t.envVersion,appVersion:t.version}}return{}},k.getAppId=function(){var e=k.getAppInfoSync();return e&&e.appId?e.appId:""},k.validId=function(e){return"string"!=typeof e&&"number"!=typeof e||""===e?(Q.info("输入 ID 类型错误"),!1):"number"!=typeof e||(e=String(e),/^\d+$/.test(e))?!!k.check.ckeckIdLength(e)&&e:(Q.info("输入 ID 类型错误"),!1)},k.compareSDKVersion=function(e,t){e=e.split("."),t=t.split(".");for(var i=Math.max(e.length,t.length);e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(var r=0;r<i;r++){var n=parseInt(e[r]),a=parseInt(t[r]);if(n>a)return 1;if(n<a)return-1}return 0},k.setUpperCase=function(e){return k.isString(e)?e.toLocaleUpperCase():e},k.getOpenidNameByAppid=function(){return"identityMpOpenid"},k.info={currentProps:{},properties:{},getSystem:function(){var e=this.properties;wx.getSystemInfo({success:function(e){te=e.SDKVersion},complete:function(){var t=(new Date).getTimezoneOffset(),r=k.getAppInfoSync();k.isNumber(t)&&(e.timeZoneOffset=t),r.appId&&(e.appId=r.appId),r.appVersion&&(e.$app_version=r.appVersion),i.initialState.systemIsComplete=!0,i.initialState.checkIsComplete()}})}},k.eventEmitter=function(){this.sub=[]},k.eventEmitter.prototype={add:function(e){this.sub.push(e)},emit:function(e,t){this.sub.forEach((function(i){i.on(e,t)}))}},k.eventSub=function(e){i.events.add(this),this._events=[],this.handle=e,this.ready=!1},k.eventSub.prototype={on:function(e,t){if(this.ready){if(k.isFunction(this.handle))try{this.handle(e,t)}catch(e){Q.info(e)}}else this._events.push({event:e,data:t})},isReady:function(){var e=this;e.ready=!0,e._events.forEach((function(t){if(k.isFunction(e.handle))try{e.handle(t.event,t.data)}catch(e){Q.info(e)}}))}},i.eventSub=k.eventSub,i.events=new k.eventEmitter,i.store={storageInfo:null,store_queue:[],getUUID:function(){return Date.now()+"-"+Math.floor(1e7*_())+"-"+_().toString(16).replace(".","")+"-"+String(31242*_()).replace(".","").slice(0,8)},getStorage:function(){return this.storageInfo||(this.storageInfo=i._.getStorageSync(i.para.storage_store_key)||""),this.storageInfo},_state:{},mem:{mdata:[],getLength:function(){return this.mdata.length},add:function(e){this.mdata.push(e)},clear:function(e){this.mdata.splice(0,e)}},toState:function(e){var t=null;k.isJSONString(e)?(t=JSON.parse(e)).distinctId?this._state=t:this.set("distinctId",this.getUUID()):k.isObject(e)&&(t=e).distinctId?this._state=t:this.set("distinctId",this.getUUID());var i=this._state._first_id||this._state.first_id,r=this._state._distinct_id||this._state.distinctId,n=this._state.openid,a=(this._state.history_login_id?this._state.history_login_id:{}).name;if(this._state.identities&&k.isString(this._state.identities)){var s=JSON.parse(k.rot13defs(this._state.identities));this._state.identities=s}var o,u,c=k.getOpenidNameByAppid();if(this._state.identities&&k.isObject(this._state.identities)&&!k.isEmptyObject(this._state.identities)){var p=(u="mpOpenid",(o=k.getAppId())&&(u="$mp_"+o+"_openid"),u);this._state.identities.hasOwnProperty("mpId")&&(this._state.identities.identityMpId=this._state.identities.mpId,delete this._state.identities.mpId),this._state.identities.hasOwnProperty("mpUnionid")&&(this._state.identities.identityMpUnionid=this._state.identities.mpUnionid,delete this._state.identities.mpUnionid),this._state.identities.hasOwnProperty(p)&&(this._state.identities[c]=this._state.identities[p],delete this._state.identities[p]),this._state.identities.hasOwnProperty("identityAnonymousId")&&(this._state.identities.identityAnonymousId=i||r)}else this._state.identities={},this._state.identities.identityMpId=this.getUUID(),this._state.identities.identityAnonymousId=i||r;if(n&&(this._state.identities[c]=n),i)if(a&&this._state.identities.hasOwnProperty(a)){if(this._state.identities[a]!==r){for(var d in this._state.identities[a]=r,this._state.identities)this._state.identities.hasOwnProperty(d)&&"identityMpId"!==d&&d!==a&&delete this._state.identities[d];this._state.history_login_id.value=r}}else{for(var d in this._state.identities[C.user.LOGIN_ID_KEY]=r,this._state.identities)this._state.identities.hasOwnProperty(d)&&"identityMpId"!==d&&d!==C.user.LOGIN_ID_KEY&&delete this._state.identities[d];this._state.history_login_id={name:C.user.LOGIN_ID_KEY,value:r}}else{if(this._state.identities.hasOwnProperty("identityLoginId")||this._state.identities.hasOwnProperty(a))for(var d in this._state.identities)this._state.identities.hasOwnProperty(d)&&"identityMpId"!==d&&"identityAnonymousId"!==d&&delete this._state.identities[d];this._state.history_login_id={name:"",value:""}}this.save()},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){return this.getLoginDistinctId()||this._state._distinct_id||this._state.distinctId},getUnionId:function(){var e={},t=this._state._first_id||this._state.first_id,i=this.getDistinctId();return t&&i?(e.loginId=i,e.anonymousId=t):e.anonymousId=i,e},getHistoryLoginId:function(){return h(this._state.history_login_id)?this._state.history_login_id:null},getLoginDistinctId:function(){var e=this.getHistoryLoginId();return h(e)&&e.value?e.name!==C.user.LOGIN_ID_KEY?e.name+"+"+e.value:e.value:null},getProps:function(){return this._state.props||{}},setProps:function(e,t){var i=this._state.props||{};t?this.set("props",e):(k.extend(i,e),this.set("props",i))},set:function(e,r){var n={};for(var a in"string"==typeof e?n[e]=r:"object"==t(e)&&(n=e),this._state=this._state||{},n)this._state[a]=n[a],"first_id"===a?delete this._state._first_id:"distinctId"===a&&(delete this._state._distinct_id,i.events.emit("changeDistinctId"));this.save()},identitiesSet:function(e){var t={};switch(e.type){case"login":t.identityMpId=i.store._state.identities.identityMpId,t[e.id_name]=e.id;break;case"logout":t.identityMpId=i.store._state.identities.identityMpId;break;case"identify":(t=k.deepCopy(i.store._state.identities)).identityAnonymousId=e.id}i.store.set("identities",t)},change:function(e,t){this._state["_"+e]=t},encryptStorage:function(){var e=this.getStorage(),t="data:enc;";k.isObject(e)?e=t+k.rot13obfs(JSON.stringify(e)):k.isString(e)&&-1===e.indexOf(t)&&(e=t+k.rot13obfs(e)),i._.setStorageSync(i.para.storage_store_key,e)},save:function(){var e=k.deepCopy(this._state),t=k.rot13obfs(JSON.stringify(e.identities));e.identities=t,delete e._first_id,delete e._distinct_id,i.para.encrypt_storage&&(e="data:enc;"+k.rot13obfs(JSON.stringify(e))),i._.setStorageSync(i.para.storage_store_key,e)},init:function(){var e=this.getStorage(),t="data:enc;";if(e)k.isString(e)&&-1!==e.indexOf(t)&&(e=e.substring(t.length),e=JSON.parse(k.rot13defs(e))),this.toState(e);else{ee=!0;var r=new Date,n=r.getTime();r.setHours(23),r.setMinutes(59),r.setSeconds(60),i.setOnceProfile({$first_visit_time:new Date}),this.set({distinctId:this.getUUID(),first_visit_time:n,first_visit_day_time:r.getTime(),identities:{identityMpId:this.getUUID()},history_login_id:{name:"",value:""}})}i.store.checkStoreInit()},checkStoreInit:function(){C.init_status&&(this.store_queue.length>0&&k.each(this.store_queue,(function(e){i[e.method].apply(i,k.slice.call(e.params))})),this.store_queue=[])}},i.setProfile=function(e,t){i.saEvent.send({type:"profile_set",properties:e},t)},i.setOnceProfile=function(e,t){i.saEvent.send({type:"profile_set_once",properties:e},t)},i.appendProfile=function(e,t){if(!k.isObject(e))return!1;k.each(e,(function(t,i){k.isString(t)?e[i]=[t]:(delete e[i],Q.info("appendProfile属性的值必须是字符串或者数组"))})),i.saEvent.send({type:"profile_append",properties:e},t)},i.incrementProfile=function(e,t){if(!k.isObject(e))return!1;var r=e;k.isString(e)&&((e={})[r]=1),i.saEvent.send({type:"profile_increment",properties:e},t)},i.track=function(e,t,i){console.log("e,p,c",e,t,i),this.saEvent.send({type:"track",event:e,properties:t},i)},i.identify=function(e,t){if(!T())return!1;if(!C.init_status)return i.store.store_queue.push({method:"identify",params:arguments}),!1;if(e=k.validId(e)){var r=i.store.getFirstId();!0===t?r?i.store.set("first_id",e):i.store.set("distinctId",e):r?i.store.change("first_id",e):i.store.change("distinctId",e),i.store.identitiesSet({type:"identify",id:e})}},i.trackSignup=function(e,t,r,n){var a,s,o,u;h(e)?(a=e.id,s=e.event_name,o=e.id_name):(a=e,s=t),i.store.set("distinctId",a),u=o&&o!==C.user.LOGIN_ID_KEY?o+"+"+a:a;var c=i.store.getFirstId()||i.store.getDistinctId();i.saEvent.send({original_id:c,distinctId:u,loginId:u,type:"track_signup",event:s,properties:r},n)},i.registerApp=function(e){k.isObject(e)&&!k.isEmptyObject(e)&&(k.info.currentProps=k.extend(k.info.currentProps,e),e.hukeShareInfo&&(i.store._state.identities.hukeShareInfo=e.hukeShareInfo,i.store.save()))},i.register=function(e){k.isObject(e)&&!k.isEmptyObject(e)&&i.store.setProps(e)},i.clearAllRegister=function(){i.store.setProps({},!0)},i.clearAllProps=function(e){var t=i.store.getProps(),r={};k.isArray(e)&&(k.each(t,(function(t,i){k.include(e,i)||(r[i]=t)})),i.store.setProps(r,!0))},i.clearAppRegister=function(e){k.isArray(e)&&k.each(k.info.currentProps,(function(t,i){k.include(e,i)&&delete k.info.currentProps[i]}))},k.setLatestChannel=function(e){k.isEmptyObject(e)||(function(e,t){var i=!1;for(var r in t)e[t[r]]&&(i=!0);return i}(e,B)&&(i.clearAppRegister(B),i.clearAllProps(B)),i.para.is_persistent_save.utm?i.register(e):i.registerApp(e))},k.setLatestShare=function(e){(e.$latest_share_depth||e.$latest_share_distinct_id||e.$latest_share_url_path||e.$latest_share_method)&&(i.clearAppRegister(V),i.clearAllProps(V),i.para.is_persistent_save.share?i.register(e):i.registerApp(e))},i.login=function(e){if(!(e=k.validId(e)))return!1;if(E(e))return!1;var t=i.store.getFirstId(),r=i.store.getDistinctId(),n=C.user.LOGIN_ID_KEY;F(n,e)&&(i.store._state.identities[n]=e,i.store.set("history_login_id",{name:n,value:e}),t||i.store.set("first_id",r),i.store.identitiesSet({type:"login",id:e,id_name:n}))},i.loginWithKey=function(e,t){if(!k.isString(e))return Q.info("Key must be String"),!1;if(!k.check.checkKeyword(e)&&e.length>100)r="Key ["+e+"] is invalid",Q.info(r);else if(!k.check.checkKeyword(e))return r="Key ["+e+"] is invalid",Q.info(r),!1;if(R(e,["mpId","identityMpId"])){var r="Key ["+e+"] is invalid";return Q.info(r),!1}if(!(t=k.validId(t)))return!1;if(E(t))return!1;var n=i.store.getFirstId(),a=i.store.getDistinctId();F(e,t)&&(i.store._state.identities[e]=t,i.store.set("history_login_id",{name:e,value:t}),n||i.store.set("first_id",a),i.store.identitiesSet({type:"login",id:t,id_name:e}))},i.getAnonymousID=function(){if(!k.isEmptyObject(i.store._state))return i.store._state._first_id||i.store._state.first_id||i.store._state._distinct_id||i.store._state.distinctId;Q.info("请先初始化SDK")},i.getIdentities=function(){return k.isEmptyObject(i.store._state)?(Q.info("请先初始化SDK"),null):i.store._state.identities||null},i.logout=function(e){var t=i.store.getFirstId();i.store.identitiesSet({type:"logout"}),i.store.set("history_login_id",{name:"",value:""}),t?(i.store.set("first_id",""),!0===e?i.store.set("distinctId",i.store.getUUID()):i.store.set("distinctId",t)):Q.info("没有first_id，logout失败")},i.openid={getRequest:function(e){wx.login({success:function(t){t.code&&i.para.appid&&i.para.openid_url?k.wxrequest({url:i.para.openid_url+"&code="+t.code+"&appid="+i.para.appid,method:"GET",complete:function(t){k.isObject(t)&&k.isObject(t.data)&&t.data.openid?e(t.data.openid):e()}}):e()}})},getWXStorage:function(){var e=i.store.getStorage();if(e&&k.isObject(e))return e.openid},getOpenid:function(e){if(!i.para.appid)return e(),!1;var t=this.getWXStorage();t?e(t):this.getRequest(e)}},i.init=function(e){if(!0===C.init_status)return!1;C.init_status=!0,e&&k.isObject(e)&&i.setPara(e),i.store.init(),i._.info.getSystem(),i.checkPluginInitStatus(),i.para.batch_send&&x.init(),i.initialState.storeIsComplete=!0,i.initialState.checkIsComplete(),function(){if(!C.life_state.app_launched){var e=wx.getLaunchOptionsSync()||{};i.autoTrackCustom.appLaunch(e)}}()},i.getPresetProperties=function(){if(k.info&&k.info.properties&&k.info.properties.$lib){var e={};k.each(k.info.currentProps,(function(t,i){0===i.indexOf("$")&&(e[i]=t)}));var t={urlPath:k.getCurrentPath(),isFirstDay:k.getIsFirstDay(),isFirstTime:ee},r=k.extend(e,t,k.info.properties,i.store.getProps());return delete r.$lib,r}return{}},i.setOpenid=function(e,t){if(!(e=k.validId(e)))return!1;if(!T())return!1;if(!C.init_status)return i.store.store_queue.push({method:"setOpenid",params:arguments}),!1;t&&console.log("%c 当前版本 setOpenid 接口 已不支持传入第二个参数","color:#F39C12;font-size: 14px;"),i.store.set("openid",e),i.identify(e,!0);var r=k.getOpenidNameByAppid();i.store._state.identities[r]=e,i.store.save()},i.unsetOpenid=function(e){var t=k.validId(e);if(!t)return!1;i.store._state.openid===t&&i.store.set("openid","");var r=k.getOpenidNameByAppid();i.store._state.identities.hasOwnProperty(r)&&t===i.store._state.identities[r]&&(delete i.store._state.identities[r],i.store.save())},i.setUnionid=function(e){var t=k.validId(e);t&&(i.store._state.identities.identityMpUnionid=t,i.store.save())},i.setEid=function(e){},i.unsetUnionid=function(e){var t=k.validId(e);if(t&&i.store._state.identities.hasOwnProperty("identityMpUnionid")&&t===i.store._state.identities.identityMpUnionid){var r=k.getOpenidNameByAppid();i.store._state.identities.hasOwnProperty(r)&&(delete i.store._state.identities[r],delete i.store._state.openid,i.store.save()),delete i.store._state.identities.identityMpUnionid,i.store.save()}},i.initWithOpenid=function(e,t){(e=e||{}).appid&&(i.para.appid=e.appid),i.openid.getOpenid((function(r){r&&i.setOpenid(r,e.isCoverLogin),t&&k.isFunction(t)&&t(r),i.init(e)}))},i.bind=function(e,t){if(k.isNumber(t)){if(k.isInteger(t)&&!1===k.isSafeInteger(t))return Q.info("Value must be String"),!1;t=String(t)}if(!k.isString(e))return Q.info("Key must be String"),!1;var r=i.store.getHistoryLoginId(),n=r?r.name:"";if(!k.check.checkKeyword(e)||R(e,[C.user.LOGIN_ID_KEY,n,"mpId","identityMpId"])){var a="Key ["+e+"] is invalid";return Q.info(a),!1}return t&&""!==t?k.isString(t)?k.check.ckeckIdLength(t)?(i.store._state.identities[e]=t,i.store.save(),void i.saEvent.send({type:"track_id_bind",event:"$BindID"})):(a="Value ["+t+"] is beyond the maximum length 255",Q.info(a),!1):(Q.info("Value must be String"),!1):(Q.info("Value is empty or null"),!1)},i.unbind=function(e,t){if(k.isNumber(t)){if(k.isInteger(t)&&!1===k.isSafeInteger(t))return Q.info("Value must be String"),!1;t=String(t)}if(!k.isString(e))return Q.info("Key must be String"),!1;if(!k.check.checkKeyword(e)||R(e,[C.user.LOGIN_ID_KEY])){var r="Key ["+e+"] is invalid";return Q.info(r),!1}if(!t||""===t)return Q.info("Value is empty or null"),!1;if(!k.isString(t))return Q.info("Value must be String"),!1;if(!k.check.ckeckIdLength(t))return r="Value ["+t+"] is beyond the maximum length 255",Q.info(r),!1;i.store._state.identities.hasOwnProperty(e)&&t===i.store._state.identities[e]&&("mpId"!==e&&"identityMpId"!==e&&delete i.store._state.identities[e],i.store.save());var n=i.store.getDistinctId(),a=i.store.getFirstId();n===e+"+"+t&&(i.store.set("first_id",""),i.store.set("distinctId",a),i.store.set("history_login_id",{name:"",value:""}));var s={};s[e]=t,i.saEvent.send({type:"track_id_unbind",event:"$UnbindID",unbind_value:s})},i.setWebViewUrl=function(e,t){if(!k.isString(e)||""===e)return Q.info("error:请传入正确的 URL 格式"),!1;if(!/^http(s)?:\/\//.test(e))return Q.info("warning: 请传入正确的 URL 格式"),!1;var r=/([^?#]+)(\?[^#]*)?(#.*)?/.exec(e);if(!r)return!1;var n,a=r[1]||"",s=r[2]||"",o=r[3]||"",u="",c=i.store.getDistinctId()||"",p=i.store.getFirstId()||"";k.urlSafeBase64&&k.urlSafeBase64.encode?c=c?k.urlSafeBase64.trim(k.urlSafeBase64.encode(k.urlBase64Encode(c))):"":this._.rot13obfs&&(c=c?k.rot13obfs(c):""),c=encodeURIComponent(c);var d=p?"f"+c:"d"+c;return t?(n=o.indexOf("_sasdk"),u=o.indexOf("?")>-1?n>-1?a+s+"#"+o.substring(1,n)+"_sasdk="+d:a+s+"#"+o.substring(1)+"&_sasdk="+d:a+s+"#"+o.substring(1)+"?_sasdk="+d):(n=s.indexOf("_sasdk"),u=/^\?(\w)+/.test(s)?n>-1?a+s.replace(/(_sasdk=)([^&]*)/gi,"_sasdk="+d)+o:a+"?"+s.substring(1)+"&_sasdk="+d+o:a+"?"+s.substring(1)+"_sasdk="+d+o),u},k.each(["setProfile","setOnceProfile","track","quick","incrementProfile","appendProfile","login","logout","registerApp","register","clearAllRegister","clearAllProps","clearAppRegister","bind","unbind","unsetOpenid","setUnionid","unsetUnionid"],(function(e){var t=i[e];i[e]=function(){if(!T())return!1;i.initialState.isComplete?t.apply(i,arguments):i.initialState.queue.push([e,arguments])}})),k.setQuery=function(e,t){if(e&&k.isObject(e)&&!k.isEmptyObject(e)){var i=[];return k.each(e,(function(e,r){"q"===r&&k.isString(e)&&0===e.indexOf("http")||(t?i.push(r+"="+e):i.push(r+"="+k.decodeURIComponent(e)))})),i.join("&")}return""},k.getUtmFromPage=function(){var e={};try{var t=k.getCurrentPage(),i=k.deepCopy(t.options);for(var r in i)i[r]=k.decodeURIComponent(i[r]);e=k.getCustomUtmFromQuery(i,"$","_","$")}catch(e){Q.info(e)}return e},k.sendPageLeave=function(){var e={},t="";try{t=(e=k.getCurrentPage())?e.route:""}catch(e){Q.info(e)}if(J>=0&&""!==t){var r={},n=k.getPageTitle(t),a=(Date.now()-J)/1e3;(isNaN(a)||a<0)&&(a=0),r.urlQuery=e.hukeMpUrlQuery?e.hukeMpUrlQuery:"",r.urlPath=t,r.title=n,r.eventDuration=a,-1===i.para.autotrack_exclude_page.pageLeave.indexOf(t)&&i.track("$MPPageLeave",r),J=-1}},i.autoTrackCustom={trackCustom:function(e,t,r){var n=i.para.autoTrack[e],a="";i.para.autoTrack&&n&&("function"==typeof n?(a=n(),k.isObject(a)&&k.extend(t,a)):k.isObject(n)&&(k.extend(t,n),i.para.autoTrack[e]=!0),i.track(r,t))},appLaunch:function(e,r){if("object"!=t(this)||this.trackCustom||(this[i.para.name]=i),!T())return!1;if(!i.initialState.isComplete)return i.initialState.queue.push(["appLaunch",arguments]),C.life_state.app_launched=!0,!1;C.life_state.app_launched=!0;var n={};if(e&&e.scene?(X=e.scene,i.current_scene=X,n.scene=k.getMPScene(e.scene)):n.scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,k.delObjectKey(e.query)),e&&e.path&&(n.urlPath=k.getPath(e.path),n.title=k.getPageTitle(e.path),e.query&&k.isObject(e.query))){var a=k.setQuery(e.query);a=a?"?"+a:"",n.url=n.urlPath+a}k.setShareInfo(e,n);var s=k.setUtm(e,n);ee?(n.isFirstTime=!0,k.isEmptyObject(s.pre1)||i.setOnceProfile(s.pre1)):n.isFirstTime=!1,k.setLatestChannel(s.pre2),k.setSfSource(e,n),n.urlQuery=k.setQuery(e.query),k.setPageRefData(n),r?(n=k.extend(n,r),i.track("$MPLaunch",n)):i.para.autoTrack&&i.para.autoTrack.appLaunch&&i.autoTrackCustom.trackCustom("appLaunch",n,"$MPLaunch")},appShow:function(e,t){var r={};Y=(new Date).getTime(),e&&e.scene?(X=e.scene,i.current_scene=X,r.scene=k.getMPScene(e.scene)):r.scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,k.delObjectKey(e.query)),e&&e.path&&(r.urlPath=k.getPath(e.path),r.title=k.getPageTitle(e.path)),k.setShareInfo(e,r);var n=k.setUtm(e,r);k.setLatestChannel(n.pre2),k.setSfSource(e,r),i.registerApp({latestScene:r.scene,uuid:S()}),r.urlQuery=k.setQuery(e.query),k.setPageRefData(r,e.path,r.urlQuery),e&&e.path&&(r.url=e.path+(r.urlQuery?"?"+r.urlQuery:"")),t?(r=k.extend(r,t),i.track("$MPShow",r)):i.para.autoTrack&&i.para.autoTrack.appShow&&i.autoTrackCustom.trackCustom("appShow",r,"$MPShow")},appHide:function(e){var t=(new Date).getTime(),r={};r.urlPath=k.getCurrentPath(),Y&&t-Y>0&&(t-Y)/36e5<24&&(r.eventDuration=(t-Y)/1e3),k.setPageRefData(r),e?(r=k.extend(r,e),i.track("$MPHide",r)):i.para.autoTrack&&i.para.autoTrack.appHide&&i.autoTrackCustom.trackCustom("appHide",r,"$MPHide"),x.onAppHide()},pageLoad:function(e){X&&1010===X&&e&&(e.sampshare&&delete e.sampshare,k.delObjectKey(e)),e&&k.isObject(e)&&(this.hukeMpUrlQuery=k.setQuery(e),this.huke_mp_encode_url_query=k.setQuery(e,!0))},pageShow:function(){J=Date.now();var e={},t=k.getCurrentPath(),r=k.getPageTitle(t);k.setRefPage(),e.urlPath=t,e.urlQuery=this.hukeMpUrlQuery?this.hukeMpUrlQuery:"",e=k.extend(e,k.getUtmFromPage()),k.setPageRefData(e),k.setPageSfSource(e),r&&(e.title=r),i.para.onshow?i.para.onshow(i,t,this):-1===i.para.autotrack_exclude_page.pageShow.indexOf(t)&&i.autoTrackCustom.trackCustom("pageShow",e,"$MPViewScreen")},pageShare:function(e){var t=e.onShareAppMessage,r=function(e){return!!e&&k.isFunction(e.then)&&k.isFunction(e.catch)};e.onShareAppMessage=function(){Z="转发消息卡片";var e=t.apply(this,arguments);if(i.para.autoTrack&&i.para.autoTrack.pageShare){var n={urlPath:k.getCurrentPath(),$share_depth:G,$share_method:Z};k.setPageRefData(n),i.autoTrackCustom.trackCustom("pageShare",n,"$MPShare")}function a(e){return k.isObject(e)||(e={}),(k.isUndefined(e.path)||""===e.path)&&(e.path=k.getCurrentUrl(this)),k.isString(e.path)&&(-1===e.path.indexOf("?")?e.path=e.path+"?":"&"!==e.path.slice(-1)&&(e.path=e.path+"&")),e.path=e.path+k.getShareInfo(),e}if(i.para.allow_amend_share_path&&(e=a(e),k.isObject(e)))for(var s in e)if(r(e[s]))try{e[s]=e[s].then((function(e){return a(e)}))}catch(e){Q.info("onShareAppMessage: "+e)}return e}},pageShareTimeline:function(e){var r=e.onShareTimeline;e.onShareTimeline=function(){Z="朋友圈分享";var e=r.apply(this,arguments);if(i.para.autoTrack&&i.para.autoTrack.pageShare){var n={urlPath:k.getCurrentPath(),$share_depth:G,$share_method:Z};k.setPageRefData(n),i.autoTrackCustom.trackCustom("pageShare",n,"$MPShare")}return i.para.allow_amend_share_path&&("object"!=t(e)&&(e={}),"object"==t(e)&&void 0===e.query&&(e.query=""),"object"==t(e)&&"string"==typeof e.query&&""!==e.query&&"&"!==e.query.slice(-1)&&(e.query=e.query+"&"),e.query=e.query+k.getShareInfo()),e}},pageAddFavorites:function(){var e={};e.urlPath=k.getCurrentPath(),i.para.autoTrack&&i.para.autoTrack.mpFavorite&&i.autoTrackCustom.trackCustom("mpFavorite",e,"$MPAddFavorites")}},i.quick=function(){var e=arguments[0],t=arguments[1],r=arguments[2],n=k.isObject(r)?r:{};if("getAnonymousID"===e){if(!k.isEmptyObject(i.store._state))return i.store._state._first_id||i.store._state.first_id||i.store._state._distinct_id||i.store._state.distinctId;Q.info("请先初始化SDK")}else"appLaunch"===e||"appShow"===e?t?i.autoTrackCustom[e](t,n):Q.info("App的launch和show，在huke.quick第二个参数必须传入App的options参数"):"appHide"===e&&(n=k.isObject(t)?t:{},i.autoTrackCustom[e](n))},i.appLaunch=function(e,t){var r={};e&&e.scene?(X=e.scene,i.current_scene=X,r.scene=k.getMPScene(e.scene)):r.scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,k.delObjectKey(e.query)),e&&e.path&&(r.urlPath=k.getPath(e.path),r.title=k.getPageTitle(e.path)),k.setShareInfo(e,r);var n=k.setUtm(e,r);ee?(r.isFirstTime=!0,k.isEmptyObject(n.pre1)||i.setOnceProfile(n.pre1)):r.isFirstTime=!1,k.setLatestChannel(n.pre2),k.setSfSource(e,r),i.registerApp({latestScene:r.scene}),r.urlQuery=k.setQuery(e.query),r.url=e.path+(r.urlQuery?"?"+r.urlQuery:""),k.setPageRefData(t),k.isObject(t)&&(r=k.extend(r,t)),i.track("$MPLaunch",r)},i.appShow=function(e,t){var r={};Y=(new Date).getTime(),e&&e.scene?(X=e.scene,i.current_scene=X,r.scene=k.getMPScene(e.scene)):r.scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,k.delObjectKey(e.query)),e&&e.path&&(r.urlPath=k.getPath(e.path),r.title=k.getPageTitle(e.path)),k.setShareInfo(e,r);var n=k.setUtm(e,r);k.setLatestChannel(n.pre2),k.setSfSource(e,r),i.registerApp({latestScene:r.scene}),r.urlQuery=k.setQuery(e.query),e&&e.path&&(r.url=e.path+(r.urlQuery?"?"+r.urlQuery:"")),k.setPageRefData(r,e.path,r.urlQuery),k.isObject(t)&&(r=k.extend(r,t)),i.track("$MPShow",r)},i.appHide=function(e){console.log("appHide");var t=(new Date).getTime(),r={};r.urlPath=k.getCurrentPath(),Y&&t-Y>0&&(t-Y)/36e5<24&&(r.eventDuration=(t-Y)/1e3),k.setPageRefData(r),k.isObject(e)&&(r=k.extend(r,e)),i.track("$MPHide",r),x.onAppHide()},i.pageShow=function(e){console.log("hukeTrack.pageShow ,pageShow");var t={},r=k.getCurrentPath(),n=k.getPageTitle(r),a=k.getCurrentPage();k.setRefPage(),n&&(t.title=n),t.urlPath=r,t.urlQuery=a.hukeMpUrlQuery?a.hukeMpUrlQuery:"",t=k.extend(t,k.getUtmFromPage()),k.setPageSfSource(t),k.setPageRefData(t),k.isObject(e)&&(t=k.extend(t,e)),i.track("$MPViewScreen",t)},H=App,App=function(e){e[i.para.name]=i,H.apply(this,arguments)},wx.onAppShow((function(e){if(!C.life_state.app_launched){var t=wx.getLaunchOptionsSync()||{};i.autoTrackCustom.appLaunch(t)}i.autoTrackCustom.appShow(e)})),wx.onAppHide((function(){i.autoTrackCustom.appHide()})),function(){var e=Page;Page=function(t){try{t||(t={}),U(t),q(t),e.apply(this,arguments)}catch(t){e.apply(this,arguments)}};var t=Component;Component=function(e){try{e||(e={}),e.methods||(e.methods={}),U(e.methods),q(e.methods),t.apply(this,arguments)}catch(e){t.apply(this,arguments)}}}(),module.exports=i;