var n=require("./config"),o=[];global.isDemo=!0,App({onLaunch:function(o,e){var t=this;wx.canIUse("setBackgroundFetchToken")&&wx.setBackgroundFetchToken({token:"getBackgroundFetchToken"}),wx.getBackgroundFetchData&&wx.getBackgroundFetchData({fetchType:"pre",success:function(n){t.globalData.backgroundFetchData=n,console.log("读取预拉取数据成功",n)},fail:function(){console.log("读取预拉取数据失败"),wx.showToast({title:"无缓存数据",icon:"none"})},complete:function(){console.log("结束读取")}}),console.log("App Launch",o),e&&e.path&&wx.navigateTo({url:e.path}),wx.cloud?wx.cloud.init({env:n.envId,traceUser:!0}):console.error("请使用 2.2.3 或以上的基础库以使用云能力");var a=wx.getSystemInfoSync();console.log("@@@ systemInfo ",a),Object.assign(this.globalData,a),require.async("./packageSkyline/common/custom-route/index.js").then((function(n){console.log("--------begin installRouteBuilder"),n.installRouteBuilder()})).catch((function(n){var o=n.mod,e=n.errMsg;console.error("installRouteBuilder path: ".concat(o,", ").concat(e))}))},onShow:function(n){console.log("App Show",n),console.log("USER_DATA_PATH",wx.env.USER_DATA_PATH)},onHide:function(){console.log("App Hide")},onThemeChange:function(n){var e=n.theme;this.globalData.theme=e,o.forEach((function(n){n(e)}))},watchThemeChange:function(n){o.indexOf(n)<0&&o.push(n)},unWatchThemeChange:function(n){var e=o.indexOf(n);e>-1&&o.splice(e,1)},globalData:{theme:wx.getSystemInfoSync().theme,hasLogin:!1,openid:null,iconTabbar:"/page/extend/images/icon_tabbar.png",systemInfo:{}},getUserOpenId:function(n){var o=this;o.globalData.openid?n(null,o.globalData.openid):wx.login({success:function(){wx.cloud.callFunction({name:"login",data:{action:"openid"},success:function(e){console.log("拉取openid成功",e),o.globalData.openid=e.result.openid,n(null,o.globalData.openid)},fail:function(o){console.log("拉取用户openid失败，将无法正常使用开放接口等服务",o),n(o)}})},fail:function(o){console.log("wx.login 接口调用失败，将无法正常使用开放接口等服务",o),n(o)}})},getUserOpenIdViaCloud:function(){var n=this;return wx.cloud.callFunction({name:"wxContext",data:{}}).then((function(o){return n.globalData.openid=o.result.openid,o.result.openid}))}});