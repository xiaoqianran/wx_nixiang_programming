var e,a=(e=require("../../utils/event-bus"))&&e.__esModule?e:{default:e},t=require("../../utils/worklet");var l,s=0,r=1,o=2,n=3,i=1,c=2,u=1,v=2,_=3,T=4,m=((l=function(e,a,t){return Math.min(t,Math.max(a,e))})._closure={},l.asString="function clamp(value,min,max){return Math.min(max,Math.max(min,value));}",l.__workletHash=3943736986494,l.__location="packageSkylineExamples/examples/album/components/previewer/index.js (39:0)",l.__worklet=!0,l),g=function(){var e=function(e,a,l){return(0,t.getTiming)(a)(e,{duration:200},l)};return e._closure={getTiming:t.getTiming},e.asString="function recoverTiming(target,renderer,callback){const{getTiming}=jsThis._closure;{return getTiming(renderer)(target,{duration:200},callback);}}",e.__workletHash=3600410011445,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (44:0)",e.__worklet=!0,e}(),h=function(){var e=function(e,a){var t=e/(a/2);return m(Math.pow(1-t,3),0,1)};return e._closure={clamp:m},e.asString="function calcOpacity(moveY,screenHeight){const{clamp}=jsThis._closure;{var opacityRatio=moveY/(screenHeight/2);return clamp(Math.pow(1-opacityRatio,3),0,1);}}",e.__workletHash=3137145988915,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (49:0)",e.__worklet=!0,e}(),f=function(){var e=function(e,a){return m(1-.4*(e/(a/3*2)),.6,1)};return e._closure={clamp:m},e.asString="function calcScale(moveY,screenHeight){const{clamp}=jsThis._closure;{var scaleRange=0.4;var scaleRatio=moveY/(screenHeight/3*2);return clamp(1-scaleRange*scaleRatio,0.6,1);}}",e.__workletHash=0xb9fc198fb38,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (55:0)",e.__worklet=!0,e}();Component({properties:{imageId:{type:String,value:""},sourcePageId:{type:String,value:""},list:{type:Array,value:[]}},lifetimes:{created:function(){a.default.initWorkletEventBus(this.renderer);var e=(0,t.getShared)(this.renderer);this.sharedValues=[e(0),e(0),e(0),e(1),e(1),e(1),e(!1),e(0),e(0),e(1),e(this.renderer)]},attached:function(){var e,a=this,l=this.data.sourcePageId,u=wx.getSystemInfoSync().screenHeight,v=this.getPageId(),_=null!==(e=this.sharedValues)&&void 0!==e?e:[];_[8].value=v,this.customRouteContext=wx.router.getRouteContext(this),(0,t.getRunOnUI)(this.renderer)(function(){var e=function(){globalThis.temp["".concat(v,"GestureBack")]||(globalThis.temp["".concat(v,"GestureBack")]=function(e){if(_[7].value!==r){_[7].value=n;var a=e.moveX,t=e.moveY,l=e.offsetY;if(_[0].value+=a,_[1].value<0){var s=.52*Math.pow(1-Math.min(l/u,1),2),o=_[1].value+Math.ceil(t*s);_[1].value=o}else _[1].value+=t;_[3].value=h(l,u);var i=f(l,u);_[4].value=i,_[5].value=Math.min(i,_[5].value)}},globalThis.eventBus.on("".concat(v,"Back"),globalThis.temp["".concat(v,"GestureBack")])),globalThis.temp["".concat(v,"GestureBackEnd")]||(globalThis.temp["".concat(v,"GestureBackEnd")]=function(){var e=_[1].value,t=_[4].value,r=_[5].value,o=(a.customRouteContext||{}).didPop;if(e>1&&t<=r+.01)globalThis.eventBus.emit("".concat(l,"CustomRouteBack"),{scale:t}),o();else{var n=_[10].value;_[3].value=g(1,n),_[0].value=g(0,n),_[1].value=g(0,n),_[4].value=g(1,n,function(){var e=function(){_[7].value=s};return e._closure={sharedValues:_,GESTURE_STATE:7,PreviewerGesture:{Init:s}},e.asString="function _f(){const{sharedValues,GESTURE_STATE,PreviewerGesture}=jsThis._closure;{sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;}}",e.__workletHash=0xef51b592a76,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (159:69)",e.__worklet=!0,e}()),_[5].value=1}},globalThis.eventBus.on("".concat(v,"BackEnd"),globalThis.temp["".concat(v,"GestureBackEnd")])),globalThis.temp["".concat(v,"GestureToggle")]||(globalThis.temp["".concat(v,"GestureToggle")]=function(){_[7].value!==r&&(_[7].value=o)},globalThis.eventBus.on("".concat(v,"Toggle"),globalThis.temp["".concat(v,"GestureToggle")])),globalThis.temp["".concat(v,"GestureMoving")]||(globalThis.temp["".concat(v,"GestureMoving")]=function(){_[7].value=r},globalThis.eventBus.on("".concat(v,"Moving"),globalThis.temp["".concat(v,"GestureMoving")]))};return e._closure={pageId:v,sharedValues:_,GESTURE_STATE:7,PreviewerGesture:{Moving:r,Back:n,Init:s,Toggle:o},TRANSLATE_X:0,TRANSLATE_Y:1,screenHeight:u,OPACITY:3,calcOpacity:h,calcScale:f,SCALE:4,MIN_SCALE:5,_this:{customRouteContext:a.customRouteContext},sourcePageId:l,RENDERER:10,recoverTiming:g},e.asString='function _f(){const{pageId,sharedValues,GESTURE_STATE,PreviewerGesture,TRANSLATE_X,TRANSLATE_Y,screenHeight,OPACITY,calcOpacity,calcScale,SCALE,MIN_SCALE,_this,sourcePageId,RENDERER,recoverTiming}=jsThis._closure;{if(!globalThis.temp["".concat(pageId,"GestureBack")]){globalThis.temp["".concat(pageId,"GestureBack")]=function(args){if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Moving)return;sharedValues[GESTURE_STATE].value=PreviewerGesture.Back;var moveX=args.moveX,moveY=args.moveY,offsetY=args.offsetY;sharedValues[TRANSLATE_X].value+=moveX;if(sharedValues[TRANSLATE_Y].value<0){var fy=0.52*Math.pow(1-Math.min(offsetY/screenHeight,1),2);var translateY=sharedValues[TRANSLATE_Y].value+Math.ceil(moveY*fy);sharedValues[TRANSLATE_Y].value=translateY;}else{sharedValues[TRANSLATE_Y].value+=moveY;}sharedValues[OPACITY].value=calcOpacity(offsetY,screenHeight);var scale=calcScale(offsetY,screenHeight);sharedValues[SCALE].value=scale;sharedValues[MIN_SCALE].value=Math.min(scale,sharedValues[MIN_SCALE].value);};globalThis.eventBus.on("".concat(pageId,"Back"),globalThis.temp["".concat(pageId,"GestureBack")]);}if(!globalThis.temp["".concat(pageId,"GestureBackEnd")]){globalThis.temp["".concat(pageId,"GestureBackEnd")]=function(){var moveY=sharedValues[TRANSLATE_Y].value;var scale=sharedValues[SCALE].value;var minScale=sharedValues[MIN_SCALE].value;var _ref=_this.customRouteContext||{},didPop=_ref.didPop;if(moveY>1&&scale<=minScale+0.01){globalThis.eventBus.emit("".concat(sourcePageId,"CustomRouteBack"),{scale:scale});didPop();}else{var renderer=sharedValues[RENDERER].value;sharedValues[OPACITY].value=recoverTiming(1,renderer);sharedValues[TRANSLATE_X].value=recoverTiming(0,renderer);sharedValues[TRANSLATE_Y].value=recoverTiming(0,renderer);sharedValues[SCALE].value=recoverTiming(1,renderer,function(){var _f=function _f(){sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;};_f._closure={sharedValues:sharedValues,GESTURE_STATE:GESTURE_STATE,PreviewerGesture:{Init:PreviewerGesture.Init}};_f.asString="function _f(){const{sharedValues,GESTURE_STATE,PreviewerGesture}=jsThis._closure;{sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;}}";_f.__workletHash=16445888604790;_f.__location="packageSkylineExamples/examples/album/components/previewer/index.js (159:69)";_f.__worklet=true;return _f;}());sharedValues[MIN_SCALE].value=1;}};globalThis.eventBus.on("".concat(pageId,"BackEnd"),globalThis.temp["".concat(pageId,"GestureBackEnd")]);}if(!globalThis.temp["".concat(pageId,"GestureToggle")]){globalThis.temp["".concat(pageId,"GestureToggle")]=function(){if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Moving)return;sharedValues[GESTURE_STATE].value=PreviewerGesture.Toggle;};globalThis.eventBus.on("".concat(pageId,"Toggle"),globalThis.temp["".concat(pageId,"GestureToggle")]);}if(!globalThis.temp["".concat(pageId,"GestureMoving")]){globalThis.temp["".concat(pageId,"GestureMoving")]=function(){sharedValues[GESTURE_STATE].value=PreviewerGesture.Moving;};globalThis.eventBus.on("".concat(pageId,"Moving"),globalThis.temp["".concat(pageId,"GestureMoving")]);}}}',e.__workletHash=0x9b756fd5fa8,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (109:32)",e.__worklet=!0,e}())(),this.applyAnimatedStyle("#preview-home >>> .need-transform-on-back",function(){var e=function(){return{transform:"translate(".concat(_[0].value,"px, ").concat(_[1].value,"px) scale(").concat(_[4].value,")")}};return e._closure={sharedValues:_,TRANSLATE_X:0,TRANSLATE_Y:1,SCALE:4},e.asString='function _f(){const{sharedValues,TRANSLATE_X,TRANSLATE_Y,SCALE}=jsThis._closure;{return{transform:"translate(".concat(sharedValues[TRANSLATE_X].value,"px, ").concat(sharedValues[TRANSLATE_Y].value,"px) scale(").concat(sharedValues[SCALE].value,")")};}}',e.__workletHash=2784597461612,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (188:75)",e.__worklet=!0,e}());var T=this.customRouteContext||{},m=T.primaryAnimation,p=T.primaryAnimationStatus;this.applyAnimatedStyle("#preview-home >>> .need-hide-on-back",function(){var e=function(){var e=p.value;return{left:1===e||2===e||_[7].value===n?"9999px":"0"}};return e._closure={primaryAnimationStatus:p,sharedValues:_,GESTURE_STATE:7,PreviewerGesture:{Back:n}},e.asString="function _f(){const{primaryAnimationStatus,sharedValues,GESTURE_STATE,PreviewerGesture}=jsThis._closure;{var status=primaryAnimationStatus.value;var isRunningAnimation=status===1||status===2;return{left:isRunningAnimation||sharedValues[GESTURE_STATE].value===PreviewerGesture.Back?'9999px':'0'};}}",e.__workletHash=6895129981417,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (198:70)",e.__worklet=!0,e}()),this.applyAnimatedStyle("#preview-home >>> .preview-middle-self",function(){var e=function(){var e=p.value,a=_[3].value;if(_[6].value)return{opacity:a};var t=m.value;e===i?(t*=3)>1&&(t=1):e===c&&(t=1-3*(1-t))<0&&(t=0);var l=a*t;return{opacity:l>1?1:l}};return e._closure={primaryAnimationStatus:p,sharedValues:_,OPACITY:3,USER_GESTURE_IN_PROGRESS:6,primaryAnimation:m,PrimaryAnimationStatus:{FORWARD:i,REVERSE:c}},e.asString="function _f(){const{primaryAnimationStatus,sharedValues,OPACITY,USER_GESTURE_IN_PROGRESS,primaryAnimation,PrimaryAnimationStatus}=jsThis._closure;{var status=primaryAnimationStatus.value;var opacity=sharedValues[OPACITY].value;if(!sharedValues[USER_GESTURE_IN_PROGRESS].value){var value=primaryAnimation.value;var factor=value;if(status===PrimaryAnimationStatus.FORWARD){factor*=3;if(factor>1)factor=1;}else if(status===PrimaryAnimationStatus.REVERSE){factor=1-(1-factor)*3;if(factor<0)factor=0;}var newOpacity=opacity*factor;return{opacity:newOpacity>1?1:newOpacity};}else{return{opacity:opacity};}}}",e.__workletHash=8561485157556,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js (209:72)",e.__worklet=!0,e}())},detached:function(){var e=this.getPageId();(0,t.getRunOnUI)(this.renderer)(function(){var a=function(){["Back","BackEnd","Toggle","Moving"].forEach(function(){var a=function(a){var t="".concat(e,"Gesture").concat(a);globalThis.temp[t]&&(globalThis.eventBus.off("".concat(e).concat(a),globalThis.temp[t]),delete globalThis.temp[t])};return a._closure={pageId:e},a.asString='function _f(item){const{pageId}=jsThis._closure;{var globalKey="".concat(pageId,"Gesture").concat(item);if(globalThis.temp[globalKey]){globalThis.eventBus.off("".concat(pageId).concat(item),globalThis.temp[globalKey]);delete globalThis.temp[globalKey];}}}',a.__workletHash=5003641712027,a.__location="packageSkylineExamples/examples/album/components/previewer/index.js (240:27)",a.__worklet=!0,a}())};return a._closure={pageId:e},a.asString='function _f(){const{pageId}=jsThis._closure;{var removeList=[\'Back\',\'BackEnd\',\'Toggle\',\'Moving\'];removeList.forEach(function(){var _f=function _f(item){var globalKey="".concat(pageId,"Gesture").concat(item);if(globalThis.temp[globalKey]){globalThis.eventBus.off("".concat(pageId).concat(item),globalThis.temp[globalKey]);delete globalThis.temp[globalKey];}};_f._closure={pageId:pageId};_f.asString="function _f(item){const{pageId}=jsThis._closure;{var globalKey=\\"\\".concat(pageId,\\"Gesture\\").concat(item);if(globalThis.temp[globalKey]){globalThis.eventBus.off(\\"\\".concat(pageId).concat(item),globalThis.temp[globalKey]);delete globalThis.temp[globalKey];}}}";_f.__workletHash=5003641712027;_f.__location="packageSkylineExamples/examples/album/components/previewer/index.js (240:27)";_f.__worklet=true;return _f;}());}}',a.__workletHash=1829920814665,a.__location="packageSkylineExamples/examples/album/components/previewer/index.js (237:32)",a.__worklet=!0,a}())()}},methods:{onScale:function(e){var a,t=null!==(a=this.sharedValues)&&void 0!==a?a:[],l=t[8].value;if(e.state===u)t[2].value=e.focalY,t[9].value=1,t[7].value=s,t[6].value=!0;else if(e.state===v){var r=e.focalX,i=e.focalY,c=e.focalDeltaX,m=e.focalDeltaY,g=i-t[2].value;if(2===e.pointerCount){var h=t[8].value,f=e.scale/t[9].value;t[9].value=e.scale,globalThis.eventBus.emit("".concat(h,"Scale"),{scale:f,centerX:r,centerY:i})}else t[7].value===n?globalThis.eventBus.emit("".concat(l,"Back"),{moveX:c,moveY:m,offsetY:g}):t[7].value===o||globalThis.eventBus.emit("".concat(l,"Move"),{moveX:c,moveY:m,offsetY:g,origin:"move"})}else if(e.state===_||e.state===T){var p=e.velocityX,E=e.velocityY;t[6].value=!1,t[7].value===n?globalThis.eventBus.emit("".concat(l,"BackEnd")):(t[7].value===o||globalThis.eventBus.emit("".concat(l,"End"),{velocityX:p,velocityY:E}),t[7].value=s)}},_onScale_worklet_factory_:function(){var e=this;return function(){var a=function(a){var t,l=null!==(t=e.sharedValues)&&void 0!==t?t:[],r=l[8].value;if(a.state===u)l[2].value=a.focalY,l[9].value=1,l[7].value=s,l[6].value=!0;else if(a.state===v){var i=a.focalX,c=a.focalY,m=a.focalDeltaX,g=a.focalDeltaY,h=c-l[2].value;if(2===a.pointerCount){var f=l[8].value,p=a.scale/l[9].value;l[9].value=a.scale,globalThis.eventBus.emit("".concat(f,"Scale"),{scale:p,centerX:i,centerY:c})}else l[7].value===n?globalThis.eventBus.emit("".concat(r,"Back"),{moveX:m,moveY:g,offsetY:h}):l[7].value===o||globalThis.eventBus.emit("".concat(r,"Move"),{moveX:m,moveY:g,offsetY:h,origin:"move"})}else if(a.state===_||a.state===T){var E=a.velocityX,d=a.velocityY;l[6].value=!1,l[7].value===n?globalThis.eventBus.emit("".concat(r,"BackEnd")):(l[7].value===o||globalThis.eventBus.emit("".concat(r,"End"),{velocityX:E,velocityY:d}),l[7].value=s)}};return a._closure={_this2:{sharedValues:e.sharedValues},PAGE_ID:8,GestureState:{BEGIN:u,ACTIVE:v,END:_,CANCELLED:T},START_Y:2,TEMP_LAST_SCALE:9,GESTURE_STATE:7,PreviewerGesture:{Init:s,Back:n,Toggle:o},USER_GESTURE_IN_PROGRESS:6},a.asString='function _f(evt){const{_this2,PAGE_ID,GestureState,START_Y,TEMP_LAST_SCALE,GESTURE_STATE,PreviewerGesture,USER_GESTURE_IN_PROGRESS}=jsThis._closure;{var _this$sharedValues2;var sharedValues=(_this$sharedValues2=_this2.sharedValues)!==null&&_this$sharedValues2!==void 0?_this$sharedValues2:[];var pageId=sharedValues[PAGE_ID].value;if(evt.state===GestureState.BEGIN){sharedValues[START_Y].value=evt.focalY;sharedValues[TEMP_LAST_SCALE].value=1;sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;sharedValues[USER_GESTURE_IN_PROGRESS].value=true;}else if(evt.state===GestureState.ACTIVE){var focalX=evt.focalX;var focalY=evt.focalY;var moveX=evt.focalDeltaX;var moveY=evt.focalDeltaY;var offsetY=focalY-sharedValues[START_Y].value;if(evt.pointerCount===2){var _pageId=sharedValues[PAGE_ID].value;var realScale=evt.scale/sharedValues[TEMP_LAST_SCALE].value;sharedValues[TEMP_LAST_SCALE].value=evt.scale;globalThis.eventBus.emit("".concat(_pageId,"Scale"),{scale:realScale,centerX:focalX,centerY:focalY});}else if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Back){globalThis.eventBus.emit("".concat(pageId,"Back"),{moveX:moveX,moveY:moveY,offsetY:offsetY});}else if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Toggle){}else{globalThis.eventBus.emit("".concat(pageId,"Move"),{moveX:moveX,moveY:moveY,offsetY:offsetY,origin:\'move\'});}}else if(evt.state===GestureState.END||evt.state===GestureState.CANCELLED){var velocityX=evt.velocityX;var velocityY=evt.velocityY;sharedValues[USER_GESTURE_IN_PROGRESS].value=false;if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Back){globalThis.eventBus.emit("".concat(pageId,"BackEnd"));}else if(sharedValues[GESTURE_STATE].value===PreviewerGesture.Toggle){sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;}else{globalThis.eventBus.emit("".concat(pageId,"End"),{velocityX:velocityX,velocityY:velocityY});sharedValues[GESTURE_STATE].value=PreviewerGesture.Init;}}}}',a.__workletHash=0xf94c9bf8f73,a.__location="packageSkylineExamples/examples/album/components/previewer/index.js",a.__worklet=!0,a}()},onBack:function(){var e;(null!==(e=this.sharedValues)&&void 0!==e?e:[])[7].value=n},shouldResponseOnMove:function(){return!0},_shouldResponseOnMove_worklet_factory_:function(){return function(){var e=function(){return!0};return e._closure={},e.asString="function _f(){return true;}",e.__workletHash=0xc11b190ef7c,e.__location="packageSkylineExamples/examples/album/components/previewer/index.js",e.__worklet=!0,e}()}}});