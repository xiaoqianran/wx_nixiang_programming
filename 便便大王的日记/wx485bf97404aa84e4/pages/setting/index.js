(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[733],{8822:function(e,n,a){e.exports=a.p+"asset/settingLogo.jpg"},7292:function(e,n,a){var t,i,r=a(6073),s=a(675),o=a(467),c=a(3029),l=a(2901),d=a(9874),u=a(5501),h=a(4467),p=a(118),m=a(758),f=a.n(m),g=a(4353),v=a.n(g),A=a(4015),w=a(6540),k=a(8145),x=a(1152),N=a(2197),S=a(4848),j=(t=(0,A.WQ)("store"),t(i=(0,A.PA)(i=function(e){function n(){var e;(0,c.A)(this,n);for(var a=arguments.length,t=new Array(a),i=0;i<a;i++)t[i]=arguments[i];return e=(0,d.A)(this,n,[].concat(t)),(0,h.A)(e,"state",{avatarUrl:"",canHaveRewardAd:!1,rewardAdLoaded:!1,editNickName:!1,nicknameChange:""}),(0,h.A)(e,"componentDidMount",(0,o.A)((0,s.A)().mark((function n(){return(0,s.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.initRewardAd(),e.getRewardAdTime();case 2:case"end":return n.stop()}}),n)})))),(0,h.A)(e,"rewardAd",null),(0,h.A)(e,"getCurrentAvatar",(function(){var n=f().getStorageSync("avatarFileUrl");e.setState({avatarUrl:n})})),(0,h.A)(e,"onChooseAvatar",(function(n){var a=e;f().reportEvent("change_avatar_click"),f().showModal({title:"\u8bf7\u786e\u8ba4",content:"\u662f\u5426\u4fee\u6539\u5934\u50cf\u4e3a\u6240\u9009\u56fe\u7247",success:function(e){e.confirm?(f().showLoading({mask:!0,title:"\u4fee\u6539\u4e2d"}),f().cloud.uploadFile({cloudPath:v()().valueOf()+n.detail.avatarUrl.split("/").pop(),filePath:n.detail.avatarUrl,success:function(){var e=(0,o.A)((0,s.A)().mark((function e(n){var t,i;return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f().cloud.getTempFileURL({fileList:[n.fileID]});case 2:t=e.sent,i=t.fileList[0].tempFileURL,a.changeAvatarFn(i);case 5:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),fail:function(e){f().showToast({title:"\u4e0a\u4f20\u5934\u50cf\u5931\u8d25",icon:"none",duration:2e3})}})):e.cancel&&console.log("\u7528\u6237\u70b9\u51fb\u53d6\u6d88")}})})),(0,h.A)(e,"changeAvatarFn",(function(n){f().cloud.callFunction({name:"userFn",data:{type:"editAvatar",avatarFileUrl:n}}).then((function(n){n.result.code&&"200"===n.result.code&&(0,N.cm)().then((function(n){e.getCurrentAvatar(),f().hideLoading(),f().showToast({title:"\u4fee\u6539\u6210\u529f",icon:"none",duration:2e3}),f().setStorageSync("refreshShitList","true")}))})).catch((function(e){}))})),(0,h.A)(e,"handleAdClick",(function(){e.state.canHaveRewardAd?e.rewardAd?(f().reportEvent("watch_ad"),e.rewardAd.show().catch((function(){e.rewardAd.load().then((function(){return e.rewardAd.show()})).catch((function(e){console.error("\u6fc0\u52b1\u89c6\u9891 \u5e7f\u544a\u663e\u793a\u5931\u8d25",e)}))}))):(f().reportEvent("wait_watch_ad"),f().showToast({title:"\u8bf7\u7b49\u5f85\u4e00\u4e0b\u5e7f\u544a\u7ec4\u4ef6\u52a0\u8f7d",icon:"none",duration:2e3})):f().showToast({title:"\u6bcf\u5929\u53ea\u80fd\u4f7f\u75282\u6b21\u54e6\uff0c\u660e\u5929\u518d\u6765\u5427",icon:"none",duration:2e3})})),(0,h.A)(e,"handleSaveNicknameChange",(function(n){e.setState({nicknameChange:n})})),(0,h.A)(e,"handleSaveNickname",function(){var n=(0,o.A)((0,s.A)().mark((function n(a){var t;return(0,s.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t=e.props.store.globalStore,t.nickname?(0,N.k1)("\u4fee\u6539\u6635\u79f0",100).then((function(n){f().reportEvent("change_nickname"),e.saveNicknameFn(!0)})):(f().reportEvent("set_nickname"),e.saveNicknameFn());case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),(0,h.A)(e,"saveNicknameFn",function(){var n=(0,o.A)((0,s.A)().mark((function n(a){var t,i,r;return(0,s.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e.props.store.globalStore,f().showLoading({}),i=f().cloud.database(),r=i.collection("user"),n.next=6,r.where({_openId:f().getStorageSync("openId")}).update({data:{nickname:e.state.nicknameChange}});case 6:n.sent,f().hideLoading(),t.setNickname(e.state.nicknameChange),f().showToast({title:a?"\u4fee\u6539\u6210\u529f":"\u8bbe\u7f6e\u6210\u529f",icon:"none",duration:1e3}),a&&(0,N.XZ)(-100,"chanegNickname"),e.setState({editNickName:!1});case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),e}return(0,u.A)(n,e),(0,l.A)(n,[{key:"componentDidShow",value:function(){this.getCurrentAvatar(),(0,N.ug)()}},{key:"getRewardAdTime",value:function(){var e=(0,o.A)((0,s.A)().mark((function e(){var n,a,t;return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=f().cloud.database(),n.command,a=n.collection("coinHistory"),e.next=5,a.where({_openId:f().getStorageSync("openId"),createdAt:{$gte:v()().startOf("day").valueOf(),$lte:v()().endOf("day").valueOf()},channel:"rewardAd"}).get();case 5:t=e.sent,this.setState({canHaveRewardAd:t.data.length<2});case 7:case"end":return e.stop()}}),e,this)})));function n(){return e.apply(this,arguments)}return n}()},{key:"initRewardAd",value:function(){var e=this,n=null;this.rewardAd||(f().createRewardedVideoAd&&(n=f().createRewardedVideoAd({adUnitId:"adunit-406df5ca9db8987c"}),n.onLoad((function(){e.setState({rewardAdLoaded:!0}),console.log("rewardAdLoaded")})),n.onError((function(e){console.error("\u6fc0\u52b1\u89c6\u9891\u5149\u544a\u52a0\u8f7d\u5931\u8d25",e),f().showToast({title:"\u62b1\u6b49\uff0c\u5e7f\u544a\u7ec4\u4ef6\u817e\u8baf\u5ba1\u6838\u4e2d\uff0c\u8bf7\u8fc7\u6bb5\u65f6\u95f4\u518d\u6765\u54e6",icon:"none",duration:2e3})})),n.onClose((function(n){n&&n.isEnded||void 0===n?(0,N.XZ)(30,"rewardAd",2).then((function(n){e.getRewardAdTime()})):f().showToast({title:"\u4e2d\u9014\u9000\u51fa\u6ca1\u6709\u5956\u52b1\u54e6",icon:"none",duration:2e3})}))),this.rewardAd=n)}},{key:"onShareAppMessage",value:function(e){return{title:"\u6bd4\u4e00\u6bd4\u8c01\u662f\u62c9\u5c4e\u5927\u738b",path:"/pages/index/index",imageUrl:a(3159)}}},{key:"onShareTimeline",value:function(){return{title:"\u6bd4\u4e00\u6bd4\u8c01\u662f\u62c9\u5c4e\u5927\u738b",path:"/pages/index/index",imageUrl:a(3159)}}},{key:"render",value:function(){var e=this,n=this.props.store.globalStore;return(0,S.jsxs)(p.Ss,{className:"settingWrapper",children:[!this.state.avatarUrl&&(0,S.jsx)(p.Ss,{className:"settingLogoWrapper",children:(0,S.jsx)(p._V,{className:"settingLogo",src:a(8822)})}),!!this.state.avatarUrl&&(0,S.jsxs)(p.Ss,{onClick:function(){e.setState({editNickName:!1})},className:"userSettingWrapper",children:[(0,S.jsx)(p.Ss,{className:"avatarContainer",children:(0,S.jsxs)(p.$n,{class:"avatarBtn","open-type":"chooseAvatar",onChooseAvatar:this.onChooseAvatar,children:[(0,S.jsx)(p._V,{className:"avatarImg",src:this.state.avatarUrl}),(0,S.jsx)(p.Ss,{className:"editIcon",children:(0,S.jsx)(x.A,{name:"bianjitouxiang1",color:"#564d44",size:16})})]})}),(0,S.jsxs)(p.Ss,{className:"middleWrapper",children:[(0,S.jsxs)(p.Ss,{className:"nicknameWrapper",children:[!this.state.editNickName&&(0,S.jsx)(p.EY,{onClick:function(a){a.stopPropagation(),e.setState({nicknameChange:n.nickname,editNickName:!0})},className:"nicknameTxt",children:n.nickname||"\u8bbe\u7f6e\u6635\u79f0"}),!this.state.editNickName&&(0,S.jsx)(p.Ss,{onClick:function(a){a.stopPropagation(),e.setState({nicknameChange:n.nickname,editNickName:!0})},className:"editIconNickname",children:(0,S.jsx)(x.A,{name:"bianjitouxiang1",color:"#564d44",size:14})}),this.state.editNickName&&(0,S.jsxs)(p.Ss,{onClick:function(e){e.stopPropagation()},className:"nicknameEditWrapper",children:[(0,S.jsx)(k.uO,{className:"nicknameInput",maxLength:8,type:"text",placeholder:"\u8bf7\u8f93\u5165\u6635\u79f0",value:this.state.nicknameChange,onChange:function(n,a){e.handleSaveNicknameChange(n)}}),(0,S.jsx)(k.Ib,{type:"primary",active:!0,size:"small",circle:!0,onClick:function(n,a){e.handleSaveNickname(n)},children:"\u4fdd\u5b58"})]})]}),(0,S.jsx)(p.Ss,{className:"pointContainer",children:(0,S.jsxs)(p.Ss,{className:"pointWrapper",onClick:function(){f().showModal({title:"\u5657\u5657\u5e01",content:"\u7528\u4e8e\u89e3\u9501\u5c0f\u7a0b\u5e8f\u4e2d\u5404\u79cd\u529f\u80fd,\n\u89c2\u770b30s\u89c6\u9891\u5e7f\u544a+30\u679a/\u6b21\uff0c\u6bcf\u5929\u6700\u591a+60\u679a,\n\u8fd8\u6709\u5176\u4ed6\u83b7\u53d6\u65b9\u5f0f\u6b22\u8fce\u63a2\u7d22",success:function(e){e.confirm?console.log("\u7528\u6237\u70b9\u51fb\u786e\u5b9a"):e.cancel&&console.log("\u7528\u6237\u70b9\u51fb\u53d6\u6d88")}})},children:[(0,S.jsx)(p.Ss,{className:"iconFontCoin",children:(0,S.jsx)(x.A,{name:"jinbi",size:18})}),(0,S.jsxs)(p.EY,{className:"pointTxt",children:[(0,S.jsx)(p.EY,{className:"pointNumber",children:n.coin||0}),"\u5657\u5657\u5e01"]})]})}),(0,S.jsxs)(p.Ss,{className:"adWrapperOuter",onClick:this.handleAdClick,children:[this.state.canHaveRewardAd&&(0,S.jsxs)(p.Ss,{className:"adTip",children:[(0,S.jsx)(p.EY,{children:"+30 \u5657\u5657\u5e01"}),(0,S.jsx)(p.Ss,{class:"arrow"})]}),(0,S.jsx)(p.Ss,{className:this.state.canHaveRewardAd?"adWrapper adWrapperShake":"adWrapper",children:(0,S.jsx)(x.A,{name:"icon_advertising_nor",color:"#000",size:24})})]})]})]}),(0,S.jsxs)(k.UB,{children:[(0,S.jsx)(k.zg,{title:"\u5410\u69fd/\u5efa\u8bae",onClick:function(){f().navigateTo({url:"/pages/feedBack/index"})},iconInfo:{size:25,color:"#5a5f67",value:"message"},arrow:"right"}),(0,S.jsx)(k.zg,{title:"\u5173\u4e8e\u6211\u4eec",onClick:function(){f().reportEvent("about_us_click"),f().showToast({title:"\u5f88\u60ed\u6127\uff0c\u5c31\u505a\u4e86\u4e00\u70b9\u5fae\u5c0f\u7684\u5de5\u4f5c\uff0c\u8c22\u8c22\u5927\u5bb6\u3002",icon:"none",duration:2e3})},iconInfo:{size:25,color:"#5a5f67",value:"alert-circle"}}),(0,S.jsx)(k.zg,{title:"\u6309\u65f6\u4fbf\u4fbf\uff0c\u6309\u65f6\u4e0b\u73ed",onClick:function(){f().reportEvent("an_shi_bian_bian"),f().showModal({title:"",content:"\u6211\u4eec\u8981\u95fb\u95fb\u82b1\u9999\uff0c\n\u6211\u4eec\u8981\u6652\u6652\u592a\u9633\uff0c\n\u6211\u4eec\u4e89\u53d6\u516b\u5c0f\u65f6\u5de5\u4f5c\uff0c\n\u516b\u5c0f\u65f6\u4f11\u606f\uff0c\n\u53e6\u5916\u7684\u516b\u5c0f\u65f6\uff0c\n\u7559\u7ed9\u6211\u4eec\u81ea\u5df1\u3002",success:function(){var e=(0,o.A)((0,s.A)().mark((function e(n){return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n.confirm||n.cancel;case 1:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}()})},iconInfo:{size:25,color:"#5a5f67",value:"tags"}}),(0,S.jsx)(p.$n,{class:"share-button",openType:"share"}),(0,S.jsx)(k.zg,{title:"\u5206\u4eab\u5c0f\u7a0b\u5e8f",iconInfo:{size:24,color:"#5a5f67",value:"share"}})]})]})}}])}(w.Component))||i)||i),C=j,y={navigationBarTitleText:"",navigationBarBackgroundColor:"#eeede9",usingComponents:{}};C.enableShareTimeline=!0,C.enableShareAppMessage=!0;Page((0,r.createPageConfig)(C,"pages/setting/index",{root:{cn:[]}},y||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],(function(){return n(7292)}));e.O()}]);