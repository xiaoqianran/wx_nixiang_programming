require("../../../../@babel/runtime/helpers/Arrayincludes");var a=require("../../../lib/tools/lunar_lib.js"),t=require("../../../helper/time_helper.js"),e=require("../../../helper/data_helper.js");require("../../../helper/page_helper.js");function n(a){if(!a)return!1;for(var t=["一","二","三","四","五","六","七","八","九","十","初","廿"],e=0;e<t.length;e++)if(a.includes(t[e]))return!1;return!0}function o(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new Date;null==a?(a=n.getFullYear(),t=n.getMonth(),e=n.getDate()):(a=Number(a),t=Number(t)-1,e=Number(e));var o=(n=new Date(a,t,1)).getDay()-1;return-1==o&&(o=6),Math.ceil((e+o)/7)}function r(a){return 1==(a+="").length?"0"+a:a}function i(a,t){return 2!=t||a%4!=0||a%100==0&&a%400!=0?[31,28,31,30,31,30,31,31,30,31,30,31][t-1]:29}function l(a,t){return 1==t?(t=12,--a):--t,i(a,t)}function u(t,e,o){var i=new Date(e,o-1,1).getDay()-1;-1==i&&(i=6);var u=l(e,o);1==o?(o=12,--e):--o;for(var d=[],m=i;m>=1;m--){var D=t.data.isLunar?a.sloarToLunar(e,o,u-m+1):"",h=n(D),s=e+"-"+r(o)+"-"+r(u-m+1);d.push({lunar:D,holiday:h,show:u-m+1,curMonth:!1,weekNo:1,val:e+"-"+o+"-"+(u-m+1),full:s})}return d}function d(t,e,o,l){if("multi"!=t.mode){var u=i(e,o),d=new Date(e,o-1,u).getDay();if(7==(d=7-d)&&(d=0),d<=0)return[];12==o?(o=1,++e):o++;for(var m=[],D=1;D<=d;D++){var h=t.data.isLunar?a.sloarToLunar(e,o,D):"",s=n(h),y=e+"-"+r(o)+"-"+r(D);m.push({lunar:h,holiday:s,show:D,curMonth:!1,weekNo:t.data.weekNo,val:e+"-"+o+"-"+D,full:y})}return m}12==o?(o=1,++e):o++;for(var f=[],c=1;c<=42-l;c++){var g=Math.ceil((l+c)/7),v=t.data.isLunar?a.sloarToLunar(e,o,c):"",p=n(v),T=e+"-"+r(o)+"-"+r(c);f.push({lunar:v,holiday:p,has:!1,show:c,curMonth:!1,weekNo:g,val:e+"-"+o+"-"+c,full:T})}return dayArr}function m(t){for(var e=t.data.month,l=t.data.year,m=[],D=i(l,e),h=1;h<=D;h++){var s=t.data.isLunar?a.sloarToLunar(l,e,h):"",y=n(s),f=l+"-"+r(e)+"-"+r(h);m.push({lunar:s,holiday:y,has:!1,show:h,curMonth:!0,weekNo:o(l,e,h),val:l+"-"+e+"-"+h,full:f})}var c=u(t,l,e),g=d(t,l,e,m.length+c.length),v=c.concat(m).concat(g),p=0;if("one"==t.data.mode)if(t.data.oneDoDay){var T=t.data.oneDoDay.split("-");p=o(T[0],T[1],T[2])}else p=o();t.setData({weekNo:p,dayArr:v})}module.exports={isHoliday:n,weekIndexInMonth:o,fmtDate:r,getNowTime:function(a){var e=new Date,n=e.getFullYear(),o=e.getMonth()+1,i=e.getDay(),l=e.getDate(),u=n+"-"+r(o)+"-"+r(l);"one"==a.data.mode&&a.data.oneDoDay?(n=Number(t.timestamp2Time(t.time2Timestamp(a.data.oneDoDay),"Y")),o=Number(t.timestamp2Time(t.time2Timestamp(a.data.oneDoDay),"M"))):"multi"==a.data.mode&&a.data.multiDoDay&&a.data.multiDoDay.length>0&&a.data.multiDoDay[0]&&(n=Number(t.timestamp2Time(t.time2Timestamp(a.data.multiDoDay[0]),"Y")),o=Number(t.timestamp2Time(t.time2Timestamp(a.data.multiDoDay[0]),"M")));var d=a.data.oneDoDay||u,m=a.data.multiDoDay;a.setData({year:n,month:o,fullToday:u,oneDoDay:d,multiDoDay:m,week:i})},getMonthCnt:i,getLastMonthCnt:l,getLastMonthArr:u,getNextMonthArr:d,createDay:m,listTouchEnd:function(a){"left"==a.data.touchDirection?(a.setData({animation:"slide-left"}),setTimeout((function(){a.setData({animation:""})}),200),a.bindNextTap()):"right"==a.data.touchDirection&&(a.setData({animation:"slide-right"}),setTimeout((function(){a.setData({animation:""})}),200),a.bindLastTap()),a.setData({touchDirection:null})},bindToNowTap:function(a){var t=new Date,n=t.getFullYear(),o=t.getMonth()+1;a.setData({month:o,year:n,fold:!1}),a.setData({animation:"fade"}),setTimeout((function(){a.setData({animation:""})}),300),m(a),"one"==a.data.mode&&a.triggerEvent("monthChange",{yearMonth:a.data.year+"-"+e.padLeft(a.data.month,2,"0")})},bindDayMultiTap:function(a,t){var n=a.currentTarget.dataset.fullday,o=e.deepClone(t.data.multiDoDay);(o=t.data.multiOnlyOne?[n]:e.arrAddDel(o,n)).length<t.data.multiDoDay.length&&t.triggerEvent("cancel",{day:n}),t.setData({multiDoDay:o}),t.triggerEvent("click",{days:o})},bindDayOneTap:function(a,t){var e,n=a.currentTarget.dataset.fullday,r=n.split("-");e=o(r[0],r[1],r[2]),t.setData({oneDoDay:n,weekNo:e}),t.triggerEvent("click",{day:n})},bindNextTap:function(a){var t=a.data.month;12==t?a.setData({year:a.data.year+1,month:1,fold:!1}):a.setData({month:t+1,fold:!1}),m(a),"one"==a.data.mode&&a.triggerEvent("monthChange",{yearMonth:a.data.year+"-"+e.padLeft(a.data.month,2,"0")})},bindLastTap:function(a){var t=a.data.month;1==t?a.setData({year:a.data.year-1,month:12,fold:!1}):a.setData({month:t-1,fold:!1}),m(a),"one"==a.data.mode&&a.triggerEvent("monthChange",{yearMonth:a.data.year+"-"+e.padLeft(a.data.month,2,"0")})},bindFoldTap:function(a){a.data.fold?a.setData({fold:!1}):a.setData({fold:!0})}};