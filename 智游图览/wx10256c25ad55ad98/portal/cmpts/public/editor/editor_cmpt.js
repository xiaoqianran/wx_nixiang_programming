var e=require("../../../../@babel/runtime/helpers/regeneratorRuntime"),t=require("../../../../@babel/runtime/helpers/asyncToGenerator"),a=require("../../../helper/page_helper.js"),i=require("../../../helper/data_helper.js"),s=require("../../../helper/cloud_helper.js"),n=require("../../../helper/content_check_helper.js"),r=require("../../../setting/setting.js");Component({options:{addGlobalClass:!0},properties:{nodeList:{type:Array,value:[{type:"text",val:""}]},viewMode:{type:Boolean,value:!1},isView:{type:Boolean,value:!1},upDirectDir:{type:String,value:""}},data:{cur:-1},lifetimes:{attached:function(){},ready:function(){},detached:function(){}},methods:{url:function(e){a.url(e,this)},setGlow:function(e){var t=this;this.setData({cur:e}),setTimeout((function(){t.setData({cur:-1})}),1e3)},bindAddTextTap:function(e){var t=a.dataset(e,"idx"),i=this.data.nodeList;i.splice(t+1,0,{type:"text",val:""}),this.setData({nodeList:i}),this.setGlow(t+1)},bindAddImageTap:function(i){var o,d=this,h=a.dataset(i,"idx"),p=this;wx.chooseMedia({count:8,mediaType:["image"],sizeType:["compressed"],sourceType:["album","camera"],success:(o=t(e().mark((function t(i){var o,c,u,l,m;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=p.data.nodeList,c=0;case 2:if(!(c<i.tempFiles.length)){e.next=25;break}if(u=i.tempFiles[c].tempFilePath,l=i.tempFiles[c].size,n.imgTypeCheck(u)){e.next=8;break}return wx.hideLoading(),e.abrupt("return",a.showNoneToast("只能上传png、jpg、jpeg格式",3e3));case 8:if(console.log("IMGX SIZE="+l+"Byte,"+l/1024+"K"),n.imgSizeCheck(l,2048e4)){e.next=14;break}return wx.hideLoading(),e.abrupt("return",a.showModal("图片大小不能超过 20兆"));case 14:if(r.IS_DEMO||!d.data.upDirectDir){e.next=20;break}return wx.showLoading({title:"上传中"}),e.next=18,s.transTempPicOne(u,d.data.upDirectDir,"",!1);case 18:u=e.sent,wx.hideLoading();case 20:m={type:"img",val:u},o.splice(h+1,0,m);case 22:c++,e.next=2;break;case 25:p.setData({nodeList:o});case 26:case"end":return e.stop()}}),t)}))),function(e){return o.apply(this,arguments)})})},bidnDeleteNodeTap:function(e){var t=a.dataset(e,"idx"),i=this.data.nodeList;if(1==this.data.nodeList.length)return a.showNoneToast("至少需要一个内容框");i.splice(t,1),this.setData({nodeList:i})},bindUpTap:function(e){var t=a.dataset(e,"idx"),s=this.data.nodeList;s=i.arraySwap(s,t,t-1),this.setData({nodeList:s}),a.anchor("editor-node-"+(t-1),this),this.setGlow(t-1)},bindTopTap:function(e){var t=a.dataset(e,"idx"),s=this.data.nodeList;s=i.arrayTop(s,t),this.setData({nodeList:s}),a.anchor("editor-node-0",this),this.setGlow(0)},bindBottomTap:function(e){var t=a.dataset(e,"idx"),s=this.data.nodeList;s=i.arrayBottom(s,t),this.setData({nodeList:s}),a.anchor("editor-node-"+(s.length-1),this),this.setGlow(s.length-1)},bindDownTap:function(e){var t=a.dataset(e,"idx"),s=this.data.nodeList;s=i.arraySwap(s,t,t+1),this.setData({nodeList:s}),a.anchor("editor-node-"+(t+1),this),this.setGlow(t+1)},bindTextareaInput:function(e){var t=a.dataset(e,"idx"),i=this.data.nodeList,s=i[t];"text"==s.type&&(s.val=e.detail.value,i[t]=s)},getNodeList:function(e){for(var t=this.data.nodeList,a=0,i=0,s=0;s<t.length;s++)"img"==t[s].type&&""!=t[s].val.trim()&&a++,"text"==t[s].type&&""!=t[s].val.trim()&&i++;return a+i==0?[]:this.data.nodeList}}});