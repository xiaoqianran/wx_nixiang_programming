var e,t,i,n,o,a,c=require("../../../../../../@babel/runtime/helpers/regeneratorRuntime"),r=require("../../../../../../@babel/runtime/helpers/asyncToGenerator"),s=require("../../../../../../index"),d=require("../../../public/indexdata"),l=require("../../../../../helper/page_helper.js"),u=require("../../../../../helper/cloud_helper.js"),h=require("../../../biz/project_biz.js"),p=getApp();Page({data:{mediaSrvUrl:(0,s.getServeUrl)(),rootScenicId:0,summbgimg:null,albumbgimg:null,slidepics:[],album:[],newsType:[],albumType:[],hotScenicList:[],hotAlbumList:[],showCitySelector:!1,cityName:"",cityCode:""},onLoad:(a=r(c().mark((function e(t){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._useSavedRootScenicId=!1,t.scene?(this._useSavedRootScenicId=!0,console.log("get scene value: "+t.scene),this.data.rootScenicId=parseInt(t.scene)):t.rootScenicId?(console.log("get rootScenicId value: "+t.rootScenicId),this.data.rootScenicId=t.rootScenicId):null==(i=wx.getStorageSync("rootScenicId"))||""===i?(console.log("use root scenic id 0"),this.data.rootScenicId=0):(console.log("get savedRootScenicId value: "+i),this._useSavedRootScenicId=!0,this.data.rootScenicId=i),console.log("rootScenicId: ".concat(this.data.rootScenicId)),null==t.ntype&&wx.setStorageSync("rootScenicId",this.data.rootScenicId),h.initPage(this),wx.showLoading({title:"加载中...",mask:!0}),this.loadingIndexData=!0;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)}),_loadList:(o=r(c().mark((function e(t){var i,n,o,a,r,s,l,u,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.data.rootScenicId,n=this.data.mediaSrvUrl,e.next=4,(0,d.initIndexData)(i,t);case 4:for(o=p.indexData,i=o.sid,a=[],r=0;r<o.index.slidepics.length;++r)a.push(n+o.index.slidepics[r]);return s=null==o.index.summbgimg?null:n+o.index.summbgimg,l=null==o.index.albumbgimg?null:n+o.index.albumbgimg,u=o.newsType,h=o.albumType,this.setData({rootScenicId:i,summbgimg:s,albumbgimg:l,slidepics:a,newsType:u,albumType:h}),this.loadingIndexData&&(this.loadingIndexData=!1,wx.hideLoading()),e.next=16,this._loadHotList();case 16:this._loadCity();case 17:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)}),_loadHotList:(n=r(c().mark((function e(){var t,i,n=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={title:"bar"},i=p.indexData.sid,e.next=4,u.callCloudSumbit("hot/list",{sid:i},t).then((function(e){var t=e.data,i=t.hotScenicList,o=t.hotAlbumList;n.setData({hotScenicList:i,hotAlbumList:o})}));case 4:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)}),onReady:function(){},onShow:(i=r(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.globalData.changeRootScenic.default_index&&(this.data.rootScenicId=p.globalData.changeRootScenic.sid,p.globalData.changeRootScenic.default_index=!1,wx.setStorageSync("rootScenicId",this.data.rootScenicId)),e.prev=1,e.next=4,this._loadList(!this._useSavedRootScenicId);case 4:e.next=15;break;case 6:if(e.prev=6,e.t0=e.catch(1),!this._useSavedRootScenicId){e.next=15;break}return wx.setStorageSync("rootScenicId",0),this.data.rootScenicId=0,console.log("reset root scenic id to 0"),e.next=15,this._loadList(!0);case 15:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)}),onPullDownRefresh:(t=r(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadList(!0);case 2:wx.stopPullDownRefresh();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)}),onHide:function(){},onUnload:function(){},url:(e=r(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.url(t,this);case 1:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)}),onShareAppMessage:function(){},selectCity:function(){var e=encodeURI(l.getCurrentPageURL()),t=this.data.cityName,i=this.data.cityCode;wx.navigateTo({url:"/portal/lib/citySelector/switchcity/switchcity?city=".concat(t,"&code=").concat(i,"&back_url=").concat(e)})},_loadCity:function(){var e=this,t=p.indexData.sid;u.callCloudSumbit("city/view",{sid:t},{title:"bar"}).then((function(t){var i=t.data;null!=i&&null!=i.id&&e.setData({cityName:i.name,cityCode:i.code,showCitySelector:!0})}))}});