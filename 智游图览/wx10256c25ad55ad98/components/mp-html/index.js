var e=require("./parser"),t=[];Component({data:{nodes:[]},properties:{containerStyle:String,content:{type:String,value:"",observer:function(e){this.setContent(e)}},copyLink:{type:Boolean,value:!0},domain:String,errorImg:String,lazyLoad:Boolean,loadingImg:String,pauseVideo:{type:Boolean,value:!0},previewImg:{type:null,value:!0},scrollTable:Boolean,selectable:null,setTitle:{type:Boolean,value:!0},showImgMenu:{type:Boolean,value:!0},tagStyle:Object,useAnchor:null},created:function(){this.plugins=[];for(var e=t.length;e--;)this.plugins.push(new t[e](this))},detached:function(){this._hook("onDetached")},methods:{in:function(e,t,n){e&&t&&n&&(this._in={page:e,selector:t,scrollTop:n})},navigateTo:function(e,t){var n=this;return new Promise((function(i,o){if(n.data.useAnchor){var a=wx.createSelectorQuery().in(n._in?n._in.page:n).select((n._in?n._in.selector:"._root")+(e?"".concat(">>>","#").concat(e):"")).boundingClientRect();n._in?a.select(n._in.selector).scrollOffset().select(n._in.selector).boundingClientRect():a.selectViewport().scrollOffset(),a.exec((function(e){if(e[0]){var a=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+(t||parseInt(n.data.useAnchor)||0);n._in?n._in.page.setData(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n._in.scrollTop,a)):wx.pageScrollTo({scrollTop:a,duration:300}),i()}else o(Error("Label not found"))}))}else o(Error("Anchor is disabled"))}))},getText:function(e){var t="";return function e(n){for(var i=0;i<n.length;i++){var o=n[i];if("text"===o.type)t+=o.text.replace(/&amp;/g,"&");else if("br"===o.name)t+="\n";else{var a="p"===o.name||"div"===o.name||"tr"===o.name||"li"===o.name||"h"===o.name[0]&&o.name[1]>"0"&&o.name[1]<"7";a&&t&&"\n"!==t[t.length-1]&&(t+="\n"),o.children&&e(o.children),a&&"\n"!==t[t.length-1]?t+="\n":"td"!==o.name&&"th"!==o.name||(t+="\t")}}}(e||this.data.nodes),t},getRect:function(){var e=this;return new Promise((function(t,n){wx.createSelectorQuery().in(e).select("._root").boundingClientRect().exec((function(e){return e[0]?t(e[0]):n(Error("Root label not found"))}))}))},pauseMedia:function(){for(var e=(this._videos||[]).length;e--;)this._videos[e].pause()},setPlaybackRate:function(e){this.playbackRate=e;for(var t=(this._videos||[]).length;t--;)this._videos[t].playbackRate(e)},setContent:function(t,n){var i=this;this.imgList&&n||(this.imgList=[]),this._videos=[];var o={},a=new e(this).parse(t);if(n)for(var r=this.data.nodes.length,s=a.length;s--;)o["nodes[".concat(r+s,"]")]=a[s];else o.nodes=a;if(this.setData(o,(function(){i._hook("onLoad"),i.triggerEvent("load")})),this.data.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){var l=0,c=function e(t){t&&t.height||(t={}),t.height===l?i.triggerEvent("ready",t):(l=t.height,setTimeout((function(){i.getRect().then(e).catch(e)}),350))};this.getRect().then(c).catch(c)}else this.imgList._unloadimgs||this.getRect().then((function(e){i.triggerEvent("ready",e)})).catch((function(){i.triggerEvent("ready",{})}))},_hook:function(e){for(var n=t.length;n--;)this.plugins[n][e]&&this.plugins[n][e]()},_add:function(e){e.detail.root=this}}});