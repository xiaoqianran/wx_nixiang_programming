Object.defineProperty(exports,"__esModule",{value:!0}),exports.MinaTouch=void 0;var t=require("../../../@babel/runtime/helpers/objectSpread2"),i=require("../../../@babel/runtime/helpers/classCallCheck"),e=require("../../../@babel/runtime/helpers/createClass"),o={touchStart:function(){},touchMove:function(){},touchEnd:function(){},touchCancel:function(){},multipointStart:function(){},multipointEnd:function(){},tap:function(){},doubleTap:function(){},longTap:function(){},singleTap:function(){},rotate:function(){},pinch:function(){},pressMove:function(){},swipe:function(){}},s=exports.MinaTouch=function(){return e((function e(s,n){var h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,e),this.preV={x:null,y:null},this.pinchStartLen=null,this.scale=1,this.isDoubleTap=!1,this.delta=null,this.last=null,this.now=null,this.tapTimeout=null,this.singleTapTimeout=null,this.longTapTimeout=null,this.swipeTimeout=null,this.x1=this.x2=this.y1=this.y2=null,this.preTapPosition={x:null,y:null},this.lastZoom=1,this.tempZoom=1;try{this._checkBeforeCreate(s,n)&&(this._name=n,this._option=t(t({},o),h),s[n]=this,this._bindFunc(s))}catch(t){console.error(t)}}),[{key:"_checkBeforeCreate",value:function(t,i){if(!t||!i)throw new Error("MinaTouch实例化时，必须传入page对象和引用名");if(t[i])throw new Error("MinaTouch实例化error： "+i+" 已经存在page中");return!0}},{key:"_bindFunc",value:function(t){for(var i=0,e=["start","move","end","cancel"];i<e.length;i++){var o=e[i];t[this._name+"."+o]=this[o].bind(this)}}},{key:"start",value:function(t){if(t.touches){this.now=Date.now(),this.x1=null==t.touches[0].pageX?t.touches[0].x:t.touches[0].pageX,this.y1=null==t.touches[0].pageY?t.touches[0].y:t.touches[0].pageY,this.delta=this.now-(this.last||this.now),this._option.touchStart(t),null!==this.preTapPosition.x&&(this.isDoubleTap=this.delta>0&&this.delta<=250&&Math.abs(this.preTapPosition.x-this.x1)<30&&Math.abs(this.preTapPosition.y-this.y1)<30),this.preTapPosition.x=this.x1,this.preTapPosition.y=this.y1,this.last=this.now;var i=this.preV;if(t.touches.length>1){this._cancelLongTap(),this._cancelSingleTap();var e=null==t.touches[1].pageX?t.touches[1].x:t.touches[1].pageX,o=null==t.touches[1].pageY?t.touches[1].y:t.touches[1].pageY,s={x:e-this.x1,y:o-this.y1};i.x=s.x,i.y=s.y,this.pinchStartLen=n(i),this._option.multipointStart(t)}this.longTapTimeout=setTimeout(function(){t.type="longTap",this._option.longTap(t)}.bind(this),750)}}},{key:"move",value:function(t){if(t.touches){var i=this.preV,e=t.touches.length,o=null==t.touches[0].pageX?t.touches[0].x:t.touches[0].pageX,s=null==t.touches[0].pageY?t.touches[0].y:t.touches[0].pageY;if(this.isDoubleTap=!1,e>1){var h={x:(null==t.touches[1].pageX?t.touches[1].x:t.touches[1].pageX)-o,y:(null==t.touches[1].pageY?t.touches[1].y:t.touches[1].pageY)-s};null!==i.x&&(this.pinchStartLen>0&&(t.singleZoom=n(h)/this.pinchStartLen,t.zoom=t.singleZoom*this.lastZoom,this.tempZoom=t.zoom,t.type="pinch",t.status="running",this._lastPinch=t,this._option.pinch(t)),t.angle=function(t,i){var e=function(t,i){var e=n(t)*n(i);if(0===e)return 0;var o=function(t,i){return t.x*i.x+t.y*i.y}(t,i)/e;o>1&&(o=1);return Math.acos(o)}(t,i);(function(t,i){return t.x*i.y-i.x*t.y})(t,i)>0&&(e*=-1);return 180*e/Math.PI}(h,i),t.type="rotate",t.status="running",this._lastRotate=t,this._option.rotate(t)),i.x=h.x,i.y=h.y}else null!==this.x2?(t.deltaX=o-this.x2,t.deltaY=s-this.y2):(t.deltaX=0,t.deltaY=0),this._option.pressMove(t);this._option.touchMove(t),this._cancelLongTap(),this.x2=o,this.y2=s}}},{key:"end",value:function(t){if(t.changedTouches){if(null!=this._lastPinch){var i=this._lastPinch;i.type="pinch",i.status="stop",this._option.pinch(i)}if(null!=this._lastRotate){var e=this._lastRotate;e.type="rotate",e.status="stop",this._option.rotate(e)}this._lastPinch=this._lastRotate=null,this._cancelLongTap();var o=this;t.direction=this._swipeDirection(this.x1,this.x2,this.y1,this.y2),t.touches.length<2&&(this.lastZoom=this.tempZoom,this._option.multipointEnd(t)),this._option.touchEnd(t),this.x2&&Math.abs(this.x1-this.x2)>30||this.y2&&Math.abs(this.y1-this.y2)>30?this.swipeTimeout=setTimeout((function(){t.type="swipe",o._option.swipe(t)}),0):(this.tapTimeout=setTimeout((function(){t.type="tap",o._option.tap(t),o.isDoubleTap&&(t.type="doubleTap",o._option.doubleTap(t),clearTimeout(o.singleTapTimeout),o.isDoubleTap=!1)}),0),o.isDoubleTap||(o.singleTapTimeout=setTimeout((function(){o._option.singleTap(t)}),250))),this.preV.x=0,this.preV.y=0,this.scale=1,this.pinchStartLen=null,this.x1=this.x2=this.y1=this.y2=null}}},{key:"cancel",value:function(t){clearTimeout(this.singleTapTimeout),clearTimeout(this.tapTimeout),clearTimeout(this.longTapTimeout),clearTimeout(this.swipeTimeout),this._option.touchCancel(t)}},{key:"_cancelLongTap",value:function(){clearTimeout(this.longTapTimeout)}},{key:"_cancelSingleTap",value:function(){clearTimeout(this.singleTapTimeout)}},{key:"_swipeDirection",value:function(t,i,e,o){return Math.abs(t-i)>=Math.abs(e-o)?t-i>0?"Left":"Right":e-o>0?"Up":"Down"}},{key:"destroy",value:function(){return this.singleTapTimeout&&clearTimeout(this.singleTapTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this._option.rotate=null,this._option.touchStart=null,this._option.multipointStart=null,this._option.multipointEnd=null,this._option.pinch=null,this._option.swipe=null,this._option.tap=null,this._option.doubleTap=null,this._option.longTap=null,this._option.singleTap=null,this._option.pressMove=null,this._option.touchMove=null,this._option.touchEnd=null,this._option.touchCancel=null,this.preV=this.pinchStartLen=this.scale=this.isDoubleTap=this.delta=this.last=this.now=this.tapTimeout=this.singleTapTimeout=this.longTapTimeout=this.swipeTimeout=this.x1=this.x2=this.y1=this.y2=this.preTapPosition=this.rotate=this.touchStart=this.multipointStart=this.multipointEnd=this.pinch=this.swipe=this.tap=this.doubleTap=this.longTap=this.singleTap=this.pressMove=this.touchMove=this.touchEnd=this.touchCancel=null,null}}])}();function n(t){return Math.sqrt(t.x*t.x+t.y*t.y)}module.exports={MinaTouch:s};