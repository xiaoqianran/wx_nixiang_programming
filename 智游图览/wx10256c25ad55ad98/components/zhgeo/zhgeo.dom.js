Object.defineProperty(exports,"__esModule",{value:!0}),exports.WxDomUtils=void 0,exports.addEventListener=function(e,t,a,n){var i,r,o,s;wx.leaflet.L.stamp(a),null!==(i=e.eventHeaders)&&void 0!==i||(e.eventHeaders={}),null!==(o=(r=e.eventHeaders)[t])&&void 0!==o||(r[t]=[]);var l=e.eventHeaders[t];null!==(s=l)&&void 0!==s||(l=[]),l.push({event:t,func:a,useCapture:n})},exports.cvtEventType=o,exports.filterTouchMoveEvent=r,exports.processImageOverlayEvent=function(e){var t,a=n.id2obj[n.id2obj[e.currentTarget.dataset.lid].overlayid];if(o(e),null==e.type)return;if(null!==(t=a.eventHeaders)&&void 0!==t||(a.eventHeaders={}),null==(e=r(e)))return;a.fire(e.type)},exports.processMarkerEvent=function(e){if("tap"===e.type){var t=n.id2obj[e.currentTarget.dataset.iconid],a=n.id2obj[t.markerid];a.fire("click"),t.isClusterMarker&&a._group&&a._group.fire("click",{layer:a},!0)}},exports.removeEventListener=function(e,t,a,n){var i,r;null!==(r=(i=e.eventHeaders)[t])&&void 0!==r||(i[t]=[]);for(var o=e.eventHeaders[t],s=0;s<o.length;++s){if(o[s].func._leaflet_id==a._leaflet_id){o.splice(s,1),!0;break}}},exports.wx2leflet=void 0;var e,t=require("../../@babel/runtime/helpers/defineProperty"),a=require("./config"),n=require("./leafletwx"),i=exports.wx2leflet={tap:"click",doubleTap:"dblclick",touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pinch:"pinch"};function r(t){if("touchstart"==t.wxtype)return e=t,t;if("touchmove"==t.wxtype){if(null==e||null==t.touches||t.touches.length<1)return t;var n=t.touches[0],i=e.touches[0];if(t.timeStamp-e.timeStamp>=a.zhgeoCfg.dragTimeTolerance)return e=t,t;var r=n.clientX-i.clientX,o=n.clientY-i.clientY;return Math.sqrt(r*r+o*o)>=a.zhgeoCfg.dragPixelTolerance?(e=t,t):null}return"touchend"==t.wxtype?(e=null,t):t}function o(e){var t=i[e.type];e.wxtype=e.type,e.type=t}exports.WxDomUtils=n.Class.extend({initContainer:function(e){this._container=e},removeTileLayer:function(e){this._container.setData(t({},"tileLayers.".concat(e),null))},_updateLayerTiles:function(){for(var e=this._container,a={},i={},r=0;r<this._updatedLayers.length;++r){var o=this._updatedLayers[r],s=e.data.tileLayers[o];if(null!=s){var l=s.getShowingLevel();n.Util.extend(a,t(t(t({},"tileLayers.".concat(o,".levelArray[").concat(s.getHidingIndex(),"].zIndex"),s.getHidingLevel().zIndex),"tileLayers.".concat(o,".levelArray[").concat(s.getShowingIndex(),"].zIndex"),l.zIndex),"tileLayers.".concat(o,".levelArray[").concat(s.getShowingIndex(),"].tiles"),l.tiles));var c=s.getHidingLevel();void 0!==c.tiles&&Object.keys(c.tiles).length>0&&(c.tiles={},n.Util.extend(i,t({},"tileLayers.".concat(o,".levelArray[").concat(s.getHidingIndex(),"].tiles"),c.tiles)))}}e.setData(a,(function(){i&&this.setData(i)}))},addTiles:function(e,a,n,i){var r,o=this._container,s=o.data.tileLayers[e];if(null!=s){var l=!0;for(var c in s.levelArray)void 0!==s.levelArray[c].tiles&&(l=!1);var u,d,g=s.getShowingLevel();if(g.zoom!==a&&(s.toggle(),g=s.getShowingLevel()),!0===i)g.tiles={};else null!==(d=(u=g).tiles)&&void 0!==d||(u.tiles={});g.zoom=a;for(var m=0;m<n.length;++m)g.tiles[n[m]._leaflet_id]=n[m];l?o.setData(t({},"tileLayers.".concat(e),s)):(null!==(r=this._updatedLayers)&&void 0!==r||(this._updatedLayers=[]),-1==this._updatedLayers.indexOf(e)&&this._updatedLayers.push(e),this._updateLayerTiles())}},setMarkers:function(){var e=this._container;e.setData(e._waitingMarkers),e._waitingMarkers=null,e._markerRequest=null},removeMarker:function(e){var t,a=this._container;null!==(t=a._waitingMarkers)&&void 0!==t||(a._waitingMarkers={}),a._waitingMarkers["markers."+e.unique]=null,a._markerRequest=a._markerRequest||n.Util.requestAnimFrame(this.setMarkers.bind(this))},updateMarkers:function(e){var t,a=this._container;e.unique="icon_"+e._leaflet_id,null!==(t=a._waitingMarkers)&&void 0!==t||(a._waitingMarkers={}),a._waitingMarkers["markers."+e.unique]=e,a._markerRequest=a._markerRequest||n.Util.requestAnimFrame(this.setMarkers.bind(this))},updatePopups:function(e){var a=this._container;e.unique="pp_"+e._leaflet_id,e.show=!0,a.setData(t({},"popups."+e.unique,e))},showPopup:function(e){var a,n=this._container,i=null!==(a=n.data.popups)&&void 0!==a?a:{},r=e.unique;r in i&&(i[r].show=!0,n.setData(t({},"popups."+r,i[r])))},removePopup:function(e){var a,n=this._container,i=null!==(a=n.data.popups)&&void 0!==a?a:{},r=e.unique;r in i&&(i[r].show=!1,n.setData(t({},"popups."+r,i[r])))},closePoiPopup:function(e){null!=e.marker_leaflet_id&&null!=n.id2obj[e.marker_leaflet_id]&&n.id2obj[e.marker_leaflet_id].closePopup()},setMapPanePosition:function(e){var t=this._container,a=Math.round(e.x),n=Math.round(e.y);t.setData({mapPaneLeft:a,mapPaneTop:n})},getMapPanePosition:function(){var e=this._container;return new n.Point(e.data.mapPaneLeft,e.data.mapPaneTop)},getOverlayCanvasSize:function(){var e=this._container;return{width:e.data.mapWidth,height:e.data.mapHeight}},setOverlayCanvasPosition:function(e,a){this._container.setData(t(t({},"overlayCanvasData.left",e.x),"overlayCanvasData.top",e.y),a)},getOverlayCanvasPosition:function(){var e=this._container;return new n.Point(-e.data.mapPaneLeft,-e.data.mapPaneTop)},updateOverlayCanvasData:function(e,a,n,i){var r=this._container,o=r.wxDomUtils.getMapPanePosition(),s=r.data.canvasImages[e];null!=s&&(s.toggle(),s.zoom=n,r.setData(t(t(t(t(t(t(t(t(t(t({},"canvasImages.".concat(e,".imageArray[").concat(s.getHidingIndex(),"].zIndex"),s.getHidingImage().zIndex),"canvasImages.".concat(e,".imageArray[").concat(s.getHidingIndex(),"].data"),""),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].zIndex"),s.getShowingImage().zIndex),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].width"),r.data.mapWidth),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].height"),r.data.mapHeight),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].left"),-o.x),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].top"),-o.y),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].data"),a),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].show"),s.getShowingImage().show),"canvasImages.".concat(e,".imageArray[").concat(s.getShowingIndex(),"].elemid"),s.getShowingImage().elemid),(function(){r.setData(t({},"canvasImages.".concat(e,".imageArray[").concat(s.getHidingIndex(),"].show"),s.getHidingImage().show),i)})))},getBoundingClientRect:function(){var e=this._container;return{width:e.data.mapWidth,height:e.data.mapHeight,top:e.data.mapTop,left:e.data.mapLeft}},getTouchEventPosition:function(e){var t=this._container;if("touchstart"==e.wxtype||"touchmove"==e.wxtype){var a=e.touches[0];return new n.Point(a.clientX-t.data.mapLeft,a.clientY-t.data.mapTop)}if("touchend"==e.wxtype){a=e.changedTouches[0];return new n.Point(a.clientX-t.data.mapLeft,a.clientY-t.data.mapTop)}return"doubleTap"==e.wxtype?new n.Point(e.changedTouches[0].clientX-t.data.mapLeft,e.changedTouches[0].clientY-t.data.mapTop):null==e.wxtype?new n.Point(e.clientX-t.data.mapLeft,e.clientY-t.data.mapTop):new n.Point(e.detail.x-t.data.mapLeft,e.detail.y-t.data.mapTop)},tileLayerTransform:function(e,t,a,n){var i,r=this._container,o="#"+e.elemid;null!==(i=a)&&void 0!==i||(a=0),r.animate(o,t,a),setTimeout((function(){n&&n()}),a)},overlayCanvasTransform:function(e,t,a,n){var i,r=this._container,o="#"+e.elemid;null!==(i=a)&&void 0!==i||(a=0),r.animate(o,t,a),setTimeout((function(){n&&n()}),a)},markerLayerTransform:function(e,t,a,n){var i;e=null==e?".leaflet-marker-item":e,null!==(i=a)&&void 0!==i||(a=0),this._container.animate(e,t,a),setTimeout((function(){n&&n()}),a)},setZoomControlState:function(e,t){this._container.setData({zoomInState:e,zoomOutState:t})},updateImageLayer:function(e){var a,n=this._container;null!==(a=n._imageLayers)&&void 0!==a||(n._imageLayers={}),n.unique="img_"+e._leaflet_id,n._imageLayers[n.unique]=e,n.setData(t({},"imageLayers.".concat(n.unique),e),(function(){var e=n._imageLayers,t=!1;for(var a in e)if(null==e[a])delete e[a],t=!0;else if(null!=e[a]._old_leaflet_id){delete e["img_"+e[a]._old_leaflet_id],t=!0}t&&n.setData({imageLayers:e})}))},removeImageLayer:function(e){var a,n=this._container;null!==(a=n._imageLayers)&&void 0!==a||(n._imageLayers={}),n.unique="img_"+e._leaflet_id,n._imageLayers[n.unique]=null,null==e._old_leaflet_id&&n.setData(t({},"imageLayers.".concat(n.unique),null))},imageLayerTransform:function(e,t,a,n){var i,r=this._container,o=null==e?".leaflet-marker-item":"#leaflet-image-item-"+e._leaflet_id;null!==(i=a)&&void 0!==i||(a=0),r.animate(o,t,a),setTimeout((function(){n&&n()}),a)},getImageLayerPosition:function(e){return{x:e.left,y:e.top}},getImageLayerSize:function(e){return{width:e.width,height:e.height}}});