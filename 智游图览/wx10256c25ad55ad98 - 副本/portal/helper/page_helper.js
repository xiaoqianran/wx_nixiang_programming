var t=require("../../@babel/runtime/helpers/regeneratorRuntime"),e=require("../../@babel/runtime/helpers/objectSpread2"),a=require("../../@babel/runtime/helpers/asyncToGenerator"),n=require("../../@babel/runtime/helpers/defineProperty"),r=require("./helper.js"),o=require("../setting/setting.js"),i=require("./cache_helper.js"),s=require("./pic_helper.js");function c(){var t=getCurrentPages(),e=t[t.length-1];return"/".concat(e.route)}function u(){var t=c().replace("/portal/projects/","");return t=t.split("/")[0]}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e||(e=u()),t=t.startsWith("/pages/")?t.replace("/pages/","/portal/projects/"+e+"/pages/"):"/portal/projects/"+e+"/"+t}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=getCurrentPages(),a=e[e.length-t];return a}function g(t,e,a,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"_id";if(!e||!Array.isArray(e))return!1;var o=e.findIndex((function(e){return e[r]===t}));return o>-1&&(e[o][a]=n,!0)}function h(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"_id";if(!e||!Array.isArray(e))return!1;var n=e.findIndex((function(e){return e[a]===t}));return n>-1&&(e.splice(n,1),!0)}function f(){return(f=a(t().mark((function e(){var a,n,r,o,i=arguments;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=i.length>0&&void 0!==i[0]?i[0]:2,n=i.length>1&&void 0!==i[1]?i[1]:"dataList",r=i.length>2&&void 0!==i[2]?i[2]:"_getList",o=d(a),o.data[n]){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,o[r]();case 9:case"end":return t.stop()}}),e)})))).apply(this,arguments)}function v(t,e){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return a?t.target.dataset[e]:t.currentTarget.dataset[e]}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"操作完成",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=arguments.length>2?arguments[2]:void 0;return wx.showToast({title:t,icon:"none",duration:e,mask:!0,success:function(){a&&setTimeout((function(){a()}),e)}})}function m(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"操作成功",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=arguments.length>2?arguments[2]:void 0;return wx.showToast({title:t,icon:"success",duration:e,mask:!0,success:function(){a&&setTimeout((function(){a()}),e)}})}function w(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"确定要删除吗？",e=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return wx.showModal({title:"",content:t,cancelText:"取消",confirmText:"确定",success:function(t){t.confirm?e&&e():t.cancel&&a&&a()}})}function T(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"温馨提示",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return wx.showModal({title:e,content:t,confirmText:n||"确定",showCancel:!1,success:function(t){a&&a()}})}function b(){wx.pageScrollTo({scrollTop:0})}function x(t,e){try{var a=wx.createSelectorQuery().in(e);a.selectViewport().scrollOffset(),a.select("#"+t).boundingClientRect(),a.exec((function(t){if(t&&2==t.length&&t[0]&&t[1]){var e=t[0].scrollTop+t[1].top-10;wx.pageScrollTo({scrollTop:e,duration:300})}}))}catch(t){console.error(t)}}function D(t){for(var e=getCurrentPages(),a=0;a<e.length;a++)if(e[a].route.includes(t))return void wx.navigateBack({delta:e.length-a-1});wx.redirectTo({url:t})}module.exports={addPhoneCalendar:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3600;wx.addPhoneCalendar({title:t,startTime:e,endTime:a,alarm:"true",alarmOffset:n,success:function(){pageHelper.showSuccToast("添加成功")},fail:function(t){t&&t.errMsg&&t.errMsg.includes("refuesed")&&pageHelper.showModal('请在手机的"设置›微信" 选项中，允许微信访问你的日历',"日历权限未开启")},complete:function(t){console.log(t)}})},getCustomNavHeight:function(){var t=wx.getSystemInfoSync(),e=wx.getMenuButtonBoundingClientRect();return e.top+e.bottom-t.statusBarHeight},getPID:u,getCurrentPageURL:c,getCurrentPageUrlWithArgs:function(){var t=getCurrentPages(),e=t[t.length-1],a=e.route,n=e.options,r=a+"?";for(var o in n){r+=o+"="+n[o]+"&"}return"/"+(r=r.substring(0,r.length-1))},fmtURLByPID:l,formClearFocus:function(t){var a=t.data,n={};for(var r in a)r.startsWith("form")&&!r.endsWith("Focus")&&(n[r+"Focus"]=null);t.setData(e({},n))},formHint:function(t,e,a){return t.setData(n({},e+"Focus",a)),T(a)},dataset:v,getPrevPage:d,modifyListNode:g,modifyPrevPageListNode:function(t,e,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"dataList",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"_id",s=d(r);if(s){var c=s.data[o];if(c){var u=c.list;g(t,u,e,a,i)&&s.setData(n({},o+".list",u))}}},modifyPrevPageListNodeObject:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"dataList",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"_id",i=d(a);if(i){var s=i.data[r];if(s){var c=s.list;for(var u in e)g(t,c,u,e[u],o);i.setData(n({},r+".list",c))}}},delListNode:h,delPrevPageListNode:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"dataList",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"_id",o=d(e),i=o.data[a];if(i){var s=i.list,c=i.total-1;h(t,s,r)&&o.setData(n(n({},a+".list",s),a+".total",c))}},refreshPrevListNode:function(){return f.apply(this,arguments)},scrollTop:function(t,e){t.scrollTop>100?e.setData({topShow:!0}):e.setData({topShow:!1})},previewImage:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imgList";wx.previewImage({urls:t.data[a],current:e})},delImage:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imgList",r=function(){t.data[a].splice(e,1),t.setData(n({},a,t.data[a]))};w("确定要删除该图片吗？",r)},showSuccToastReturn:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"操作成功",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=function(){wx.navigateBack()};return m(t,e,a)},showSuccToast:m,showErrToast:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"操作失败",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=arguments.length>2?arguments[2]:void 0;return wx.showToast({title:t,icon:"error",duration:e,mask:!0,success:function(){a&&setTimeout((function(){a()}),e)}})},showNoneToast:p,showNoneToastReturn:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"操作完成",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,a=function(){wx.navigateBack()};return p(t,e,a)},showLoadingToast:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"加载中",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1500,a=arguments.length>2?arguments[2]:void 0;return wx.showToast({title:t,icon:"loading",duration:e,mask:!0,success:function(){a&&setTimeout((function(){a()}),e)}})},showConfirm:w,showModal:T,setPageData:function(t,e){r.isDefined(e.__webviewId__)&&delete e.__webviewId__,t.setData(e)},hint:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"redirect";"reLaunch"==e?wx.reLaunch({url:l("/pages/public/hint?type=9&msg="+encodeURIComponent(t))}):wx.redirectTo({url:l("/pages/public/hint?type=9&msg="+encodeURIComponent(t))})},commListListener:function(t,e){r.isDefined(e.detail.search)?t.setData({search:"",sortType:""}):(t.setData({dataList:e.detail.dataList}),e.detail.sortType&&t.setData({sortType:e.detail.sortType}))},bindShowModalTap:function(t){this.setData({modalName:t.currentTarget.dataset.modal})},bindHideModalTap:function(t){this.setData({modalName:null})},showTopBtn:function(t,e){t.scrollTop>100?e.setData({topBtnShow:!0}):e.setData({topBtnShow:!1})},getOptions:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",r=e[a];return r||(r=e.scene),!!r&&(t.setData(n({},a,r)),!0)},model:function(t,e){var a=e.currentTarget.dataset.item;t.setData(n({},a,e.detail.value))},switchModel:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"int",r=e.currentTarget.dataset.item,o=e.detail.value?1:0;"bool"==a&&(o=!!e.detail.value),t.setData(n({},r,o))},top:b,url:function(t,e){var a=t.currentTarget.dataset.url,o=t.currentTarget.dataset.type;switch(o||(o="url"),o){case"picker":var i=t.currentTarget.dataset.item;e.setData(n({},i,t.detail));break;case"top":b();break;case"mini":wx.navigateToMiniProgram({appId:t.currentTarget.dataset.app,path:a,envVersion:"release"});break;case"redirect":if(!a)return;wx.redirectTo({url:a});break;case"reLaunch":case"relaunch":if(!a)return;wx.reLaunch({url:a});break;case"copy":wx.setClipboardData({data:a,success:function(t){wx.getClipboardData({success:function(t){p("已复制到剪贴板")}})}});break;case"hint":if(!a)return;T(a);break;case"switch":if(!a)return;wx.switchTab({url:a});break;case"back":wx.navigateBack();break;case"toURL":D(a);break;case"phone":wx.makePhoneCall({phoneNumber:a});break;case"anchor":x(a,e);break;case"saveimg":case"saveimage":s.getWritePhotosAlbum((function(){wx.saveImageToPhotosAlbum({filePath:a,success:function(e){wx.showToast({title:t.currentTarget.dataset.hint||"保存成功",icon:"none",duration:2e3})},fail:function(t){console.log(t)}})}));break;case"bool":e.setData(n({},a,!e.data[a]));break;case"img":case"image":a.indexOf("qlogo")>-1&&(a=a.replace("/132","/0"));var c=[a];r.isDefined(t.currentTarget.dataset.imgs)&&(c=t.currentTarget.dataset.imgs),wx.previewImage({current:a,urls:c});break;default:if(!a)return;wx.navigateTo({url:a})}},anchor:x,toURL:D,listTouchStart:function(t,e){e.setData({touchX:t.touches[0].pageX})},listTouchMove:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;e.data.touchX-t.touches[0].pageX>a?e.setData({touchDirection:"left"}):e.data.touchX-t.touches[0].pageX<-a&&e.setData({touchDirection:"right"})},listTouchEnd:function(t,e){"left"==e.data.touchDirection?e.setData({touchCur:t.currentTarget.dataset.idx}):e.setData({touchCur:null}),e.setData({touchDirection:null})},queryMulti:function(t,e,a,n,o){a=r.isDefined(a)?a:v(e,"key"),n=r.isDefined(n)?n:v(e,"val"),"int"==(o=r.isDefined(o)?o:v(e,"def"))?n=parseInt(n):"float"==o?n=parseFloat(n):"str"==o&&(n=n.toString());var i=t.data._params;i.query[a]=n,t.setData({_params:i})},clearTimer:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"timer";r.isDefined(t.data[e])&&clearInterval(t.data[e])},cacheListExist:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"list";return t=t.toUpperCase(),!!o.CACHE_IS_LIST&&(i.get(t+"_LIST")&&e.data&&e.data[a])},cacheListRemove:function(t){t=t.toUpperCase(),o.CACHE_IS_LIST&&i.remove(t+"_LIST")},cacheListSet:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.CACHE_LIST_TIME;t=t.toUpperCase(),o.CACHE_IS_LIST&&i.set(t+"_LIST","TRUE",e)}};