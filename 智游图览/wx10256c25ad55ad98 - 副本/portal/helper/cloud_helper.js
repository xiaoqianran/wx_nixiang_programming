require("../../@babel/runtime/helpers/Arrayincludes");var e=require("../../@babel/runtime/helpers/regeneratorRuntime"),t=require("../../@babel/runtime/helpers/asyncToGenerator"),n=require("../setting/setting"),r=require("./helper.js"),a=require("./data_helper.js"),i=require("./cache_helper.js"),s=require("../comm/constants.js"),u=require("../helper/content_check_helper.js"),o=require("../helper/page_helper.js"),c=require("../helper/time_helper.js"),l=require("../setting/setting.js"),p=getApp();function d(e){return f.apply(this,arguments)}function f(){return(f=t(e().mark((function t(n){var a,i,s=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:{},i=s.length>2&&void 0!==s[2]?s[2]:{title:"提交中..."},r.isDefined(i)||(i={title:"提交中.."}),r.isDefined(i.title)||(i.title="提交中.."),e.next=6,g(n,a,i);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function h(){return(h=t(e().mark((function t(n){var a,i,s,u=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>1&&void 0!==u[1]?u[1]:{},i=u.length>2?u[2]:void 0,r.isDefined(i)||(i={title:"加载中.."}),r.isDefined(i.title)||(i.title="加载中.."),e.next=6,g(n,a,i).catch((function(e){return null}));case 6:return(s=e.sent)&&r.isDefined(s.data)&&(s=s.data,Array.isArray(s)||0==Object.keys(s).length&&(s=null)),e.abrupt("return",s);case 9:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,u="加载中",c=!0,l="GET";r.isDefined(a)&&r.isDefined(a.title)&&(u=a.title),r.isDefined(a)&&r.isDefined(a.hint)&&(c=a.hint),r.isDefined(a)&&r.isDefined(a.doFail)&&(doFail=a.doFail),r.isDefined(a)&&r.isDefined(a.method)&&(l=a.method),c&&("bar"==u?wx.showNavigationBarLoading():wx.showLoading({title:u,mask:!0}));var d="",f="",h="",g=i.get(s.CACHE_TOKEN);return g&&g.token&&(d=g.token),g&&g.id&&(f=g.id),p.indexData&&p.indexData.fid&&(h=p.indexData.fid),t.token=d,t.uid=f,t.fid=h,new Promise((function(r,a){var i=o.getPID();t.PID=i,wx.request({url:n.SERVER+(e.startsWith("/")?"":"/")+e+(e.endsWith("/")?"":"/"),data:t,method:l,success:function(e){if(200!=e.statusCode)return console.log(e),c&&wx.showModal({title:"温馨提示",content:""+e.statusCode,showCancel:!1}),void a(e);r(e)},fail:function(e){c&&(console.log(e),wx.showModal({title:"",content:"网络故障，请稍后重试",showCancel:!1})),a(e)},complete:function(e){c&&("bar"==u?wx.hideNavigationBarLoading():wx.hideLoading())}})}))}function x(){return(x=t(e().mark((function t(n,a,i,s,u){var o,c,l,p,d,f,h=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=h.length>5&&void 0!==h[5]&&h[5],console.log("dataList begin"),r.isDefined(n.data[a])&&n.data[a]||((c={})[a]={page:1,size:20,list:[],count:0,total:0,oldTotal:0},n.setData(c)),r.isDefined(s.isTotal)||(s.isTotal=!0),l=s.page,p=n.data[a].count,!(l>1&&l>p)){e.next=9;break}return wx.showToast({duration:500,icon:"none",title:"没有更多数据了"}),e.abrupt("return");case 9:for(d in s)r.isDefined(s[d])||delete s[d];return f=0,n.data[a]&&n.data[a].total&&(f=n.data[a].total),s.oldTotal=f,e.next=15,g(i,s,u).then((function(e){console.log("cloud begin");var t=e.data,r=n.data[a].list;if(1==t.page)r=e.data.list;else{if(!(t.page>n.data[a].page))return;r=o?e.data.list.concat(r):r.concat(e.data.list)}t.list=r;var i={};i[a]=t,n.setData(i),console.log("cloud END")})).catch((function(e){console.log(e)}));case 15:console.log("dataList END");case 16:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function v(){return(v=t(e().mark((function t(n){var r;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return","");case 2:return e.next=4,wx.cloud.getTempFileURL({fileList:[n]});case 4:if(!((r=e.sent)&&r.fileList&&r.fileList[0]&&r.fileList[0].tempFileURL)){e.next=7;break}return e.abrupt("return",r.fileList[0].tempFileURL);case 7:return e.abrupt("return","");case 8:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function m(e,t,n){return b.apply(this,arguments)}function b(){return(b=t(e().mark((function t(n,r,i){var s,u,p,d=arguments;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=d.length>3&&void 0!==d[3]?d[3]:"",!l.IS_DEMO){t.next=3;break}return t.abrupt("return",n);case 3:s&&!s.endsWith("_")&&(s+="_"),i||(i=c.time("YMD")),u=e().mark((function t(u){var c,l,p,d;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n[u],l=c.match(/\.[^.]+?$/)[0],!(c.includes("tmp")||c.includes("temp")||c.includes("wxfile"))){e.next=8;break}return p=s+a.genRandomNum(1e6,9999999),d=i?r+i+"/"+p+l:r+p+l,d=o.getPID()+"/"+d,e.next=8,wx.cloud.uploadFile({cloudPath:d,filePath:c}).then((function(e){n[u]=e.fileID})).catch((function(e){console.error(e)}));case 8:case"end":return e.stop()}}),t)})),p=0;case 7:if(!(p<n.length)){t.next=12;break}return t.delegateYield(u(p),"t0",9);case 9:p++,t.next=7;break;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(){return(w=t(e().mark((function t(n,r,a,i){var s,u,o,c,l;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=[],u=0;u<n.length;u++)"img"==n[u].type&&s.push(n[u].val);return e.next=4,m(s,r,a,"rich");case 4:for(s=e.sent,o=0,c=0;c<n.length;c++)"img"==n[c].type&&(n[c].val=s[o],o++);return l={id:a,content:n},e.prev=8,e.next=11,d(i,l);case 11:return e.abrupt("return",n);case 14:e.prev=14,e.t0=e.catch(8),console.error(e.t0);case 17:return e.abrupt("return",[]);case 18:case"end":return e.stop()}}),t,null,[[8,14]])})))).apply(this,arguments)}function k(){return(k=t(e().mark((function t(n,r,a,i){var s,u;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(n,r,a,"cover");case 2:return n=e.sent,s={id:a,imgList:n},e.prev=4,e.next=7,d(i,s);case 7:return u=e.sent,e.abrupt("return",u.data.urls);case 11:e.prev=11,e.t0=e.catch(4),console.error(e.t0);case 14:case"end":return e.stop()}}),t,null,[[4,11]])})))).apply(this,arguments)}function D(){return(D=t(e().mark((function t(n,r,a,i){var s,u,o,c,l,p;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:wx.showLoading({title:"提交中...",mask:!0}),s=[],u=0;case 3:if(!(u<n.length)){t.next=27;break}if("image"!=n[u].type){t.next=11;break}return t.next=7,m(n[u].val,r,a,"image");case 7:n[u].val=t.sent,s.push(n[u]),t.next=24;break;case 11:if("content"!=n[u].type){t.next=24;break}o=n[u].val,t.t0=e().keys(o);case 14:if((t.t1=t.t0()).done){t.next=23;break}if(c=t.t1.value,"img"!=o[c].type){t.next=21;break}return t.next=19,m([o[c].val],r,a,"content");case 19:l=t.sent,o[c].val=l[0];case 21:t.next=14;break;case 23:s.push(n[u]);case 24:u++,t.next=3;break;case 27:if(0!=s.length){t.next=29;break}return t.abrupt("return");case 29:return p={id:a,hasImageForms:s},t.prev=30,t.next=33,d(i,p);case 33:t.next=38;break;case 35:t.prev=35,t.t2=t.catch(30),console.error(t.t2);case 38:case"end":return t.stop()}}),t,null,[[30,35]])})))).apply(this,arguments)}function y(){return(y=t(e().mark((function t(n,r,a){var i,s=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(s.length>3&&void 0!==s[3])||s[3])){e.next=10;break}return wx.showLoading({title:"图片校验中",mask:!0}),e.next=5,u.imgCheck(n);case 5:if(e.sent){e.next=9;break}return wx.hideLoading(),e.abrupt("return",o.showModal("不合适的图片, 请重新上传","温馨提示"));case 9:wx.hideLoading();case 10:return i=[n],e.next=13,m(i,r,a);case 13:if(0!=(i=e.sent).length){e.next=18;break}return e.abrupt("return","");case 18:return e.abrupt("return",i[0]);case 19:case"end":return e.stop()}}),t)})))).apply(this,arguments)}module.exports={CODE:{SUCC:200,SVR:500,LOGIC:1600,DATA:1301,HEADER:1302,ADMIN_ERROR:2401},dataList:function(e,t,n,r,a){return x.apply(this,arguments)},callCloud:g,callCloudSumbit:d,callCloudData:function(e){return h.apply(this,arguments)},callCloudSumbitAsync:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return r.isDefined(n)||(n={hint:!1}),r.isDefined(n.hint)||(n.hint=!1),g(e,t,n)},transTempPics:m,transRichEditorTempPics:function(e,t,n,r){return w.apply(this,arguments)},transCoverTempPics:function(e,t,n,r){return k.apply(this,arguments)},transFormsTempPics:function(e,t,n,r){return D.apply(this,arguments)},getTempFileURLOne:function(e){return v.apply(this,arguments)},transTempPicOne:function(e,t,n){return y.apply(this,arguments)}};