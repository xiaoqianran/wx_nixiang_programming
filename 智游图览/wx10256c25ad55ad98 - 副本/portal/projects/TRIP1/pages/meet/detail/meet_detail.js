var e,t,r,n=require("../../../../../../@babel/runtime/helpers/regeneratorRuntime"),a=require("../../../../../../@babel/runtime/helpers/asyncToGenerator"),i=require("../../../../../helper/cloud_helper.js"),o=require("../../../../../helper/page_helper.js"),s=require("../../../biz/meet_biz.js"),u=require("../../../public/project_setting.js"),c=require("../../../biz/project_biz.js"),l=require("../../../../../comm/biz/passport_biz.js");Page({data:{isLoad:!1,tabCur:0,mainCur:0,verticalNavTop:0,showMind:!0,showTime:!1},onLoad:function(e){c.initPage(this),o.getOptions(this,e)&&this._loadDetail()},_loadDetail:(r=a(n().mark((function e(){var t,r,a,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.data.id){e.next=3;break}return e.abrupt("return");case 3:return r={id:t},a={title:"bar"},e.next=7,i.callCloudData("meet/view",r,a);case 7:if(o=e.sent){e.next=11;break}return this.setData({isLoad:null}),e.abrupt("return");case 11:this.setData({isLoad:!0,meet:o,canNullTime:u.MEET_CAN_NULL_TIME});case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)}),onReady:function(){},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:(t=a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadDetail();case 2:wx.stopPullDownRefresh();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)}),onReachBottom:function(){},onShareAppMessage:function(){},bindJoinTap:(e=a(n().mark((function e(t){var r,u,c,h,p,d;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.loginMustCancelWin(this);case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:if(r=o.dataset(t,"dayidx"),u=o.dataset(t,"timeidx"),!(c=this.data.meet.MEET_DAYS_SET[r].times[u]).error){e.next=13;break}if(!c.error.includes("预约")){e.next=12;break}return e.abrupt("return",o.showModal("该时段"+c.error+"，换一个时段试试吧！"));case 12:return e.abrupt("return",o.showModal("该时段预约"+c.error+"，换一个时段试试吧！"));case 13:h=this.data.id,p=c.mark,d=function(){var e=a(n().mark((function e(){var t,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={title:"请稍候"},r={meetId:h,timeMark:p},e.next=5,i.callCloudSumbit("meet/before_join",r,t).then((function(e){wx.navigateTo({url:"../join/meet_join?id=".concat(h,"&timeMark=").concat(p)})}));case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),s.subscribeMessageMeet(d);case 17:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)}),url:function(e){o.url(e,this)},onPageScroll:function(e){e.scrollTop>100?this.setData({topShow:!0}):this.setData({topShow:!1})},bindTopTap:function(){wx.pageScrollTo({scrollTop:0})},bindVerticalMainScroll:function(e){var t=this;if(this.data.isLoad){for(var r=this.data.meet.MEET_DAYS_SET,n=0,a=function(e){wx.createSelectorQuery().in(t).select("#main-"+e).fields({size:!0},(function(t){r[e].top=n,n+=t.height,r[e].bottom=n})).exec()},i=0;i<r.length;i++)a(i);for(var o=e.detail.scrollTop+20,s=0;s<r.length;s++)if(o>r[s].top&&o<r[s].bottom)return this.setData({verticalNavTop:50*(s-1),tabCur:s}),!1}},bindTabSelectTap:function(e){var t=o.dataset(e,"idx");this.setData({tabCur:t,mainCur:t,verticalNavTop:50*(t-1)})},bindShowMindTap:function(e){this.setData({showMind:!0,showTime:!1})},bindShowTimeTap:function(e){this.setData({showMind:!1,showTime:!0})}});