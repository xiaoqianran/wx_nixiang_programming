var t=require("../../../helper/helper.js"),e=require("../../../helper/data_helper.js"),a=require("../../../helper/page_helper.js");Component({externalClasses:["outside-picker-class"],options:{},properties:{mark:{type:String,value:""},isSlot:{type:Boolean,value:!1},sourceData:{type:Array,value:[]},sourceDataStr:{type:String,value:""},labelKey:{type:String,value:""},steps:{type:Number,value:1},noDataHint:{type:String,value:"请选择"},index:{type:Number,value:0},indexMulti:{type:Array,value:[]},item:{type:String,value:"",observer:function(t,e){if(t!=e){var a=this.data.options;a&&0!=a.length||this._init(),a&&a.length>0&&this.selected(t)}}},itemMulti:{type:Array,value:[],observer:function(t,e){if(JSON.stringify(t)!=JSON.stringify(e)){var a=this.data.options;a&&0!=a.length||this._init(),a&&a.length>0&&this.selected(t)}}},disabled:{type:Boolean,value:!1},disabledHint:{type:String,value:""}},data:{options:null,idx:0,multiDesc:""},lifetimes:{attached:function(){},ready:function(){this.data.options&&0!=this.data.options.length||this._init()},detached:function(){}},methods:{_init:function(){var a=this.data.sourceData,i=this.data.labelKey,s=this.data.idx;1!=this.data.steps||!this.data.sourceDataStr||a&&0!=a.length||(a=e.getSelectOptions(this.data.sourceDataStr),this.setData({sourceData:a})),a&&0!=a.length&&(1==this.data.steps?(a.length>0&&t.isDefined(a[0].label)&&(i="label"),s=this.data.index):this.data.steps>1&&(a.length>0&&t.isDefined(a[0][0].label)&&(i="label"),s=this.data.indexMulti),this.setData({idx:s,labelKey:i,options:a}),this._getMultiDesc(),1==this.data.steps?this.selected(this.data.item):this.selected(this.data.itemMulti))},_getMultiDesc:function(){var t=this.data.idx,e=this.data.options;if(t.length==e.length){var a=[];if(this.data.labelKey)for(var i=0;i<e.length;i++)a[i]=e[i][t[i]].label;else for(var s=0;s<e.length;s++)a[s]=e[s][t[s]];this.setData({multiDesc:a})}},bindTap:function(t){this.data.disabled&&this.data.disabledHint&&a.showModal(this.data.disabledHint,"提示",null,"知道了")},bindChange:function(t){var e=t.detail.value,a=null;if(1==this.data.steps)a=this.data.labelKey?this.data.options[e].val:this.data.options[e],this.setData({item:a,index:e});else{a=[];var i=this.data.options;if(this.data.labelKey)for(var s=0;s<i.length;s++)a[s]=i[s][e[s]].val;else for(var l=0;l<i.length;l++)a[l]=i[l][e[l]];this._getMultiDesc()}this.triggerEvent("select",a)},getLabelOneStep:function(t){for(var e=0;e<this.data.sourceData.length;e++)if(this.data.sourceData[e].val==t)return this.data.sourceData[e].label;return"unknown"},selected:function(t){var e=this.data.options,a=this.data.labelKey;if(1==this.data.steps){for(var i=0;i<e.length;i++){if(a&&t==e[i].val)return void this.setData({idx:i});if(!a&&t==e[i])return void this.setData({idx:i})}this.setData({idx:-1}),this.triggerEvent("select","")}else if(this.data.steps>1){for(var s=[],l=0;l<e.length;l++){var n=e[l];for(var h in n)a&&t[l]==e[l][h].val?s.push(h):a||t[l]!=e[l][h]||s.push(h)}s.length!=e.length&&(s=[]),this.setData({idx:s}),this._getMultiDesc()}}}});