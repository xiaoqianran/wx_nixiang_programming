var t,e,a,s,r=require("../../../../@babel/runtime/helpers/objectSpread2"),i=require("../../../../@babel/runtime/helpers/regeneratorRuntime"),n=require("../../../../@babel/runtime/helpers/asyncToGenerator"),o=require("../../../helper/cloud_helper.js"),h=require("../../../helper/helper.js"),d=require("../../../comm/biz/public_biz.js"),u=require("../../../helper/page_helper.js");Component({options:{addGlobalClass:!0,pureDataPattern:/^_dataList/,multipleSlots:!0},properties:{doDate:{type:Boolean,value:!1},listHeight:{type:String,value:""},route:{type:String,value:""},source:{type:String,value:"user"},_params:{type:Object,value:null,observer:function(t,e){e&&t&&(t&&(this.setData({pulldownMaskShow:!1}),this._fmtSearchData()),this.data._dataList=null,this.triggerEvent("list",{dataList:this.data._dataList}),this._getList(1))}},isTotalMenu:{type:Boolean,value:!0},_items:{type:Array,value:[],observer:function(t,e){t&&this._fmtSearchData()}},_menus:{type:Array,value:[],observer:function(t,e){t&&this._fmtSearchData()}},_dataList:{type:Object,value:null},type:{type:String,value:""},placeholder:{type:String,value:"搜索关键字"},sortMenusDefaultIndex:{type:Number,value:-1},search:{type:String,value:"",observer:function(t,e){t&&(this.setData({pulldownMaskShow:!1}),this._fmtSearchData()),this.data._dataList=null,this.triggerEvent("list",{dataList:this.data._dataList}),this._getList(1)}},whereEx:{type:Object,value:null},returnUrl:{type:String,value:""},topBottom:{type:String,value:"50"},isCache:{type:Boolean,value:!0},pulldownType:{type:Array,value:["list","list","list","list","list","list"]}},data:{refresherTriggered:!1,sortItems:[],sortMenus:[],sortType:"",sortVal:"",sortItemIndex:-1,sortIndex:-1,topNum:0,topShow:!1,pulldownMaskShow:!1,startDate:"",endDate:""},lifetimes:{created:function(){},attached:function(){},ready:(s=n(i().mark((function t(){var e,a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._fmtSearchData(),!this.data.isCache){t.next=4;break}return t.next=4,this._getList(1);case 4:if(!((e=this.data._params)&&e.sortType&&h.isDefined(e.sortVal))){t.next=15;break}a=this.data._menus,s=0;case 8:if(!(s<a.length)){t.next=15;break}if(e.sortType!=a[s].type||e.sortVal!=a[s].value){t.next=12;break}return this.setData({sortMenusDefaultIndex:s}),t.abrupt("break",15);case 12:s++,t.next=8;break;case 15:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)}),move:function(){},detached:function(){}},pageLifetimes:{show:function(){var t=this;return n(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.isCache&&d.isCacheList(t.data.type)){e.next=3;break}return e.next=3,t._getList(1);case 3:case"end":return e.stop()}}),e)})))()},hide:function(){},resize:function(t){}},methods:{reload:(a=n(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getList(1);case 2:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)}),_getList:(e=n(i().mark((function t(e){var a,s;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=r({page:e},this.data._params),this.data.whereEx&&(a.whereEx=this.data.whereEx),this.data.search&&(a.search=this.data.search),this.data.sortType&&h.isDefined(this.data.sortVal)&&(a.sortType=this.data.sortType,a.sortVal=this.data.sortVal),1==e&&this.triggerEvent("list",{dataList:null}),(s={}).title="bar",t.next=9,o.dataList(this,"_dataList",this.data.route,a,s);case 9:this.triggerEvent("list",{sortType:this.data.sortType,dataList:this.data._dataList}),this.data.isCache&&d.setCacheList(this.data.type),1==e&&this.bindTopTap();case 12:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)}),bindReachBottom:function(){this._getList(this.data._dataList.page+1)},bindPullDownRefresh:(t=n(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setData({refresherTriggered:!0}),t.next=3,this._getList(1);case 3:this.setData({refresherTriggered:!1});case 4:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)}),bindScrollTop:function(t){t.detail.scrollTop>100?this.setData({topShow:!0}):this.setData({topShow:!1})},bindTopTap:function(){this.setData({topNum:0})},_fmtSearchData:function(){for(var t={},e=[],a=this.data._items,s=0;s<a.length;s++){var r={show:!1,items:a[s]};e.push(r)}t.sortItems=e,t.sortMenus=this.data._menus,t.sortItemIndex=-1,t.sortIndex=-1,t.sortType="",t.sortVal="",this.setData(t)},bindSearchClearTap:function(){this.data.search&&this.triggerEvent("list",{search:""})},bindSortTap:function(t){var e=t.currentTarget.dataset.index,a=this.data.sortItems,s=e!=this.data.sortIndex?-1:this.data.sortItemIndex;if(e<5){for(var r=this.data.pulldownMaskShow,i=0;i<a.length;i++)i!=e?a[i].show=!1:(a[i].show=!a[i].show,r=a[i].show);this.setData({pulldownMaskShow:r,sortItems:a,sortIndex:e,sortItemIndex:s})}else{for(var n=0;n<a.length;n++)a[n].show=!1;this.setData({pulldownMaskShow:!1,sortItems:a,sortIndex:e,sortItemIndex:s}),this._getSortKey()}},bindSortItemTap:function(t){var e=t.target.dataset.idx;e||(e=0);for(var a=this.data.sortItems,s=0;s<a.length;s++)a[s].show=!1;this.setData({pulldownMaskShow:!1,sortItemIndex:e,sortItems:a}),this._getSortKey()},_getSortKey:function(){var t="",e="",a=this.data.sortVal,s=this.data.sortType;this.data.sortIndex<5?(t=this.data.sortItems[this.data.sortIndex].items[this.data.sortItemIndex].value,e=this.data.sortItems[this.data.sortIndex].items[this.data.sortItemIndex].type):(t=this.data.sortMenus[this.data.sortIndex-5].value,e=this.data.sortMenus[this.data.sortIndex-5].type),this.setData({sortVal:t,sortType:e}),t==a&&e==s||((this.data.startDate||this.data.endDate)&&this.setData({startDate:"",endDate:""}),this.data.search?this.triggerEvent("list",{search:""}):this._getList(1))},bindSearchTap:function(t){wx.navigateTo({url:u.fmtURLByPID("/pages/search/search?source="+this.data.source+"&type="+this.data.type+"&returnUrl="+this.data.returnUrl)})},getSortIndex:function(){return this.data.sortIndex},setSortIndex:function(t){this.setData({sortIndex:t})},bindDateStartChange:function(t){this.setData({startDate:t.detail.value})},bindDateEndChange:function(t){this.setData({endDate:t.detail.value})},bindDateSearchTap:function(t){if(!this.data.startDate.includes("-"))return u.showNoneToast("请选择开始日期");if(!this.data.endDate.includes("-"))return u.showNoneToast("请选择结束日期");var e=this.data.startDate+"#"+this.data.endDate;this.setData({search:e}),this._getList(1)},bindDateClearTap:function(t){this.setData({startDate:"",endDate:""}),this.data.search&&this.setData({search:""})}}});